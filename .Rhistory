scale_y_break(c(400, 1250)) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
plot.title = element_text(hjust = 0.5)
)
# 画全部 ----
ggplot(issue_trend, aes(x = as.numeric(congress), y = news_count, color = issue)) +
geom_line(size = 1) +
geom_point(size = 2) +
labs(
title = "issue change per Congress",
x = "Congress",
y = "news number",
color = "issue"
) +
theme_minimal() +
scale_color_viridis_d(palette = "turbo") +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
plot.title = element_text(hjust = 0.5)
)
install.packages("ggbreak")
p <- ggplot(issue_trend %>% filter(issue %in% top_issues),
aes(x = as.numeric(congress), y = news_count, color = issue)) +
geom_line(size = 1.2) +
geom_point(size = 2) +
labs(
title = "issue change 115–118",
x = "Congress",
y = "news number",
color = "issue"
) +
theme_minimal() +
scale_color_brewer(palette = "Dark2") +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
plot.title = element_text(hjust = 0.5)
)
ggsave("issue change most 115–118_bills.png", plot = p, width = 8, height = 4, dpi = 300)
p <- ggplot(issue_trend %>% filter(issue %in% top_issues),
aes(x = as.numeric(congress), y = news_count, color = issue)) +
geom_line(size = 1.2) +
geom_point(size = 2) +
labs(
title = "issue change 115–118",
x = "Congress",
y = "news number",
color = "issue"
) +
theme_minimal() +
scale_color_brewer(palette = "Paired") +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
plot.title = element_text(hjust = 0.5)
)
ggsave("issue change most 115–118_bills.png", plot = p, width = 8, height = 4, dpi = 300)
p <- ggplot(issue_trend %>% filter(issue %in% top_issues),
aes(x = as.numeric(congress), y = news_count, color = issue)) +
geom_line(size = 1.2) +
geom_point(size = 2) +
labs(
title = "Top Issues Trend Across Congress 115–118",
x = "Congress",
y = "bills number",
color = "issue"
) +
theme_minimal() +
scale_color_brewer(palette = "Paired") +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
plot.title = element_text(hjust = 0.5)
)
ggsave("issue change most 115–118_bills.png", plot = p, width = 8, height = 4, dpi = 300)
p <- ggplot(issue_trend %>% filter(issue %in% top_issues),
aes(x = as.numeric(congress), y = news_count, color = issue)) +
geom_line(size = 1.2) +
geom_point(size = 2) +
labs(
title = "Top Issues Trend Across Congress 115–118",
x = "Congress",
y = "news number",
color = "issue"
) +
theme_minimal() +
scale_color_brewer(palette = "Paired") +
scale_y_break(c(400, 1250)) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
plot.title = element_text(hjust = 0.5)
)
ggsave("issue change most 115–118_news.png", plot = p, width = 8, height = 4, dpi = 300)
issue_trend <- news_data_clean %>%
group_by(congress, issue) %>%
summarise(news_count = n(), .groups = "drop")
# 找出变化最剧烈的议题
issue_trend_change <- issue_trend %>%
group_by(issue) %>%
summarize(
change = (news_count[congress == max(as.numeric(congress))] - news_count[congress == min(as.numeric(congress))]) /
news_count[congress == min(as.numeric(congress))],
.groups = "drop"
) %>%
arrange(desc(abs(change)))  # 按绝对变化排序
p <- ggplot(issue_trend %>% filter(issue %in% top_issues),
aes(x = as.numeric(congress), y = news_count, color = issue)) +
geom_line(size = 1.2) +
geom_point(size = 2) +
labs(
title = "Top Issues Trend Across Congress 115–118",
x = "Congress",
y = "news number",
color = "issue"
) +
theme_minimal() +
scale_color_brewer(palette = "Paired") +
scale_y_break(c(400, 1250)) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
plot.title = element_text(hjust = 0.5)
)
ggsave("issue change most 115–118_news.png", plot = p, width = 8, height = 4, dpi = 300)
issue_trend <- news_data_clean %>%
group_by(congress, issue) %>%
summarise(news_count = n(), .groups = "drop")
# 找出变化最剧烈的议题
issue_trend_change <- issue_trend %>%
group_by(issue) %>%
summarize(
change = (news_count[congress == max(as.numeric(congress))] - news_count[congress == min(as.numeric(congress))]) /
news_count[congress == min(as.numeric(congress))],
.groups = "drop"
) %>%
arrange(desc(abs(change)))  # 按绝对变化排序
top_issues <- issue_trend_change %>% slice(1:10) %>% pull(issue)
p <- ggplot(issue_trend %>% filter(issue %in% top_issues),
aes(x = as.numeric(congress), y = news_count, color = issue)) +
geom_line(size = 1.2) +
geom_point(size = 2) +
labs(
title = "Top Issues Trend Across Congress 115–118",
x = "Congress",
y = "news number",
color = "issue"
) +
theme_minimal() +
scale_color_brewer(palette = "Paired") +
scale_y_break(c(400, 1250)) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
plot.title = element_text(hjust = 0.5)
)
ggsave("issue change most 115–118_news.png", plot = p, width = 8, height = 4, dpi = 300)
# 画全部 ----
ggplot(issue_trend, aes(x = as.numeric(congress), y = news_count, color = issue)) +
geom_line(size = 1) +
geom_point(size = 2) +
labs(
title = "issue change per Congress",
x = "Congress",
y = "news number",
color = "issue"
) +
theme_minimal() +
scale_color_viridis_d(palette = "turbo") +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
plot.title = element_text(hjust = 0.5)
)
# 画全部 ----
ggplot(issue_trend, aes(x = as.numeric(congress), y = news_count, color = issue)) +
geom_line(size = 1) +
geom_point(size = 2) +
labs(
title = "issue change per Congress",
x = "Congress",
y = "news number",
color = "issue"
) +
theme_minimal() +
scale_color_viridis_d(palette = "Dark2") +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
plot.title = element_text(hjust = 0.5)
)
library(randomcoloR)
install.packages("randomcoloR")
library(randomcoloR)
n_colors <- length(unique(issue_trend$issue)) # 获取议题数量
colors <- distinctColorPalette(n_colors)
ggplot(issue_trend, aes(x = as.numeric(congress), y = news_count, color = issue)) +
geom_line(size = 1) +
geom_point(size = 2) +
labs(
title = "issue change per Congress",
x = "Congress",
y = "news number",
color = "issue"
) +
theme_minimal() +
scale_color_viridis_d(palette = "Dark2") +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
plot.title = element_text(hjust = 0.5)
)
ggplot(issue_trend, aes(x = as.numeric(congress), y = news_count, color = issue)) +
geom_line(size = 1) +
geom_point(size = 2) +
labs(
title = "issue change per Congress",
x = "Congress",
y = "news number",
color = "issue"
) +
theme_minimal() +
scale_color_manual(values = colors) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
plot.title = element_text(hjust = 0.5)
)
ggplot(issue_trend, aes(x = as.numeric(congress), y = news_count)) +
geom_line() +
geom_point() +
facet_wrap(~issue, scales = "free_y") +
labs(x = "Congress", y = "新闻数量")
p <- ggplot(issue_trend, aes(x = as.numeric(congress), y = news_count)) +
geom_line() +
geom_point() +
facet_wrap(~issue, scales = "free_y") +
labs(x = "Congress", y = "新闻数量")
ggsave("issue change all 115–118_news.png", plot = p, width = 10, height = 8, dpi = 300)
p <- ggplot(issue_trend, aes(x = as.numeric(congress), y = news_count)) +
geom_line() +
geom_point() +
facet_wrap(~issue, scales = "free_y") +
labs(x = "Congress", y = "news number")
ggsave("issue change all 115–118_news.png", plot = p, width = 10, height = 8, dpi = 300)
issue_trend <- bills_data_aug %>%
group_by(congress, issue) %>%
summarise(news_count = n(), .groups = "drop")
p <- ggplot(issue_trend, aes(x = as.numeric(congress), y = news_count)) +
geom_line() +
geom_point() +
facet_wrap(~issue, scales = "free_y") +
labs(x = "Congress", y = "news number")
ggsave("issue change all 115–118_news.png", plot = p, width = 10, height = 8, dpi = 300)
p <- ggplot(issue_trend, aes(x = as.numeric(congress), y = news_count)) +
geom_line() +
geom_point() +
facet_wrap(~issue, scales = "free_y") +
labs(x = "Congress", y = "bills number")
ggsave("issue change all 115–118_bills.png", plot = p, width = 10, height = 8, dpi = 300)
issue_trend <- news_data_clean %>%
group_by(congress, issue) %>%
summarise(news_count = n(), .groups = "drop")
p <- ggplot(issue_trend, aes(x = as.numeric(congress), y = news_count)) +
geom_line() +
geom_point() +
facet_wrap(~issue, scales = "free_y") +
labs(x = "Congress", y = "news number")
ggsave("issue change all 115–118_news.png", plot = p, width = 10, height = 8, dpi = 300)
View(adver_cg)
news_data_aug <- news_data_filtered %>%
mutate(congress = as.integer(congress)) %>%
left_join(
adver_cg %>%
mutate(congress = as.integer(congress)) %>%
select(bioguide_id, congress, chamber, gender, party, committee_el),
by = c("mid" = "bioguide_id", "congress" = "congress")
)
news_data_filtered$congress <- as.character(news_data_filtered$congress)
missing_keys <- news_data_filtered %>%
select(mid, congress) %>%
distinct() %>%
anti_join(adver_sum %>% select(bioguide_id, congress) %>% distinct(),
by = c("mid" = "bioguide_id", "congress"))
news_data_clean <- news_data_aug %>%
filter(!is.na(chamber), !is.na(gender), !is.na(party))
# 1. 每个议员在每届对某议题的关注次数
issue_counts_mid <- news_data_clean %>%
group_by(congress, committee_el, mid, issue) %>%
summarise(n_issue_mentions = n(), .groups = "drop")
# 2. 聚合到党派层面
issue_counts_party <- issue_counts_mid %>%
group_by(congress, committee_el, issue) %>%
summarise(total_mentions = sum(n_issue_mentions), .groups = "drop")
# 3. 取每届每党 Top 5 议题
top_issues_committee_el <- issue_counts_party %>%
group_by(congress, committee_el) %>%
slice_max(order_by = total_mentions, n = 5, with_ties = FALSE) %>%
arrange(congress, committee_el, desc(total_mentions))
top_issues_committee_el
write.csv(top_issues_committee_el, "top_issues_party_committee.csv", row.names = FALSE)
bills_data_filtered <- bills_data %>%
filter(congress != 119)
bills_data_aug <- bills_data_filtered %>%
mutate(congress = as.integer(congress)) %>%
left_join(
legis_cg %>%
mutate(congress = as.integer(congress)) %>%
select(bioguide_id, congress, chamber, gender, party, committee_el),
by = c("mid" = "bioguide_id", "congress" = "congress")
)
summary(bills_data_aug)
sum(is.na(bills_data_aug$chamber))
# 1. 每个议员在每届对某议题的关注次数
issue_counts_mid <- bills_data_clean %>%
group_by(congress, committee_el, mid, issue) %>%
summarise(n_issue_mentions = n(), .groups = "drop")
# 1. 每个议员在每届对某议题的关注次数
issue_counts_mid <- bills_data_aug %>%
group_by(congress, committee_el, mid, issue) %>%
summarise(n_issue_mentions = n(), .groups = "drop")
# 2. 聚合到党派层面
issue_counts_committee_el <- issue_counts_mid %>%
group_by(congress, committee_el, issue) %>%
summarise(total_mentions = sum(n_issue_mentions), .groups = "drop")
# 3. 取每届每党 Top 5 议题
top_issues_committee_el <- issue_counts_party %>%
group_by(congress, committee_el) %>%
slice_max(order_by = total_mentions, n = 5, with_ties = FALSE) %>%
arrange(congress, committee_el, desc(total_mentions))
top_issues_committee_el
write.csv(top_issues_committee_el, "top_issues_party_committee_bills.csv", row.names = FALSE)
generate_decision_issues <- function(df, set_name = "all") {
# Step 1: Optional filter by dataset (train/test)
if (set_name %in% c("train", "test")) {
df <- df %>% filter(dataset == set_name)
}
# Step 2: Group by issue-congress level and summarize
df_clean <- df %>%
group_by(issue, congress, dataset) %>%  # 保留 dataset 信息
summarise(
label = sum(label, na.rm = TRUE),
pred = mean(pred, na.rm = TRUE),
importance_intl = sum(importance_intl, na.rm = TRUE),
importance_dom = sum(importance_dom, na.rm = TRUE),
importance_prof = sum(importance_prof, na.rm = TRUE),
.groups = 'drop'
) %>%
mutate(
total = importance_intl + importance_dom + importance_prof,
intl_percentage = ifelse(total > 0, importance_intl / total, NA_real_),
dom_percentage  = ifelse(total > 0, importance_dom  / total, NA_real_),
prof_percentage = ifelse(total > 0, importance_prof / total, NA_real_),
max_val = pmax(intl_percentage, dom_percentage, prof_percentage, na.rm = TRUE),
decision = case_when(
is.na(max_val) ~ NA_character_,
intl_percentage == max_val & dom_percentage != max_val & prof_percentage != max_val ~ "intl",
dom_percentage  == max_val & intl_percentage != max_val & prof_percentage != max_val ~ "dom",
prof_percentage == max_val & intl_percentage != max_val & dom_percentage  != max_val ~ "prof",
TRUE ~ "tie"
)
) %>%
select(-max_val, -total)
return(df_clean)
}
# adv
adver_tp <- generate_decision_issues(adver_sum)
# legis
legis_tp <- generate_decision_issues(legis_sum)
View(legis_tp)
generate_decision_issues <- function(df, set_name = "all") {
# Step 1: Optional filter by dataset (train/test)
if (set_name %in% c("train", "test")) {
df <- df %>% filter(dataset == set_name)
}
# Step 2: Group by issue-congress level and summarize
df_clean <- df %>%
group_by(issue, congress, dataset, committee_el) %>%  # 保留 dataset 信息
summarise(
label = sum(label, na.rm = TRUE),
pred = mean(pred, na.rm = TRUE),
importance_intl = sum(importance_intl, na.rm = TRUE),
importance_dom = sum(importance_dom, na.rm = TRUE),
importance_prof = sum(importance_prof, na.rm = TRUE),
.groups = 'drop'
) %>%
mutate(
total = importance_intl + importance_dom + importance_prof,
intl_percentage = ifelse(total > 0, importance_intl / total, NA_real_),
dom_percentage  = ifelse(total > 0, importance_dom  / total, NA_real_),
prof_percentage = ifelse(total > 0, importance_prof / total, NA_real_),
max_val = pmax(intl_percentage, dom_percentage, prof_percentage, na.rm = TRUE),
decision = case_when(
is.na(max_val) ~ NA_character_,
intl_percentage == max_val & dom_percentage != max_val & prof_percentage != max_val ~ "intl",
dom_percentage  == max_val & intl_percentage != max_val & prof_percentage != max_val ~ "dom",
prof_percentage == max_val & intl_percentage != max_val & dom_percentage  != max_val ~ "prof",
TRUE ~ "tie"
)
) %>%
select(-max_val, -total)
return(df_clean)
}
adver_tp <- generate_decision_issues(adver_sum)
# legis
legis_tp <- generate_decision_issues(legis_sum)
write.csv(adver_tp, "adver_tp.csv", row.names = FALSE)
write.csv(legis_tp, "legis_tp.csv", row.names = FALSE)
generate_decision_issues <- function(df, set_name = "all") {
# Step 1: Optional filter by dataset (train/test)
if (set_name %in% c("train", "test")) {
df <- df %>% filter(dataset == set_name)
}
# Step 2: Group by issue-congress level and summarize
df_clean <- df %>%
group_by(issue, congress, committee_el) %>%  # 保留 dataset 信息
summarise(
label = sum(label, na.rm = TRUE),
pred = mean(pred, na.rm = TRUE),
importance_intl = sum(importance_intl, na.rm = TRUE),
importance_dom = sum(importance_dom, na.rm = TRUE),
importance_prof = sum(importance_prof, na.rm = TRUE),
.groups = 'drop'
) %>%
mutate(
total = importance_intl + importance_dom + importance_prof,
intl_percentage = ifelse(total > 0, importance_intl / total, NA_real_),
dom_percentage  = ifelse(total > 0, importance_dom  / total, NA_real_),
prof_percentage = ifelse(total > 0, importance_prof / total, NA_real_),
max_val = pmax(intl_percentage, dom_percentage, prof_percentage, na.rm = TRUE),
decision = case_when(
is.na(max_val) ~ NA_character_,
intl_percentage == max_val & dom_percentage != max_val & prof_percentage != max_val ~ "intl",
dom_percentage  == max_val & intl_percentage != max_val & prof_percentage != max_val ~ "dom",
prof_percentage == max_val & intl_percentage != max_val & dom_percentage  != max_val ~ "prof",
TRUE ~ "tie"
)
) %>%
select(-max_val, -total)
return(df_clean)
}
adver_tp <- generate_decision_issues(adver_sum)
# legis
legis_tp <- generate_decision_issues(legis_sum)
write.csv(adver_tp, "adver_tp.csv", row.names = FALSE)
write.csv(legis_tp, "legis_tp.csv", row.names = FALSE)
# 1. 每个议员在每届对某议题的关注次数
issue_counts_mid <- news_data_clean %>%
group_by(congress, committee_el, mid, issue) %>%
summarise(n_issue_mentions = n(), .groups = "drop")
# 2. 聚合到党派层面
issue_counts_party <- issue_counts_mid %>%
group_by(congress, committee_el, issue) %>%
summarise(total_mentions = sum(n_issue_mentions), .groups = "drop")
# 3. 取每届每党 Top 5 议题
top_issues_committee_el <- issue_counts_party %>%
group_by(congress, committee_el) %>%
slice_max(order_by = total_mentions, n = 5, with_ties = FALSE) %>%
arrange(congress, committee_el, desc(total_mentions))
top_issues_committee_el
write.csv(top_issues_committee_el, "top_issues_party_committee.csv", row.names = FALSE)
# 1. 每个议员在每届对某议题的关注次数
issue_counts_mid <- bills_data_aug %>%
group_by(congress, committee_el, mid, issue) %>%
summarise(n_issue_mentions = n(), .groups = "drop")
# 2. 聚合到党派层面
issue_counts_committee_el <- issue_counts_mid %>%
group_by(congress, committee_el, issue) %>%
summarise(total_mentions = sum(n_issue_mentions), .groups = "drop")
# 3. 取每届每党 Top 5 议题
top_issues_committee_el <- issue_counts_party %>%
group_by(congress, committee_el) %>%
slice_max(order_by = total_mentions, n = 5, with_ties = FALSE) %>%
arrange(congress, committee_el, desc(total_mentions))
top_issues_committee_el
write.csv(top_issues_committee_el, "top_issues_party_committee_bills.csv", row.names = FALSE)
# 1. 每个议员在每届对某议题的关注次数
issue_counts_mid <- news_data_clean %>%
group_by(congress, committee_el, mid, issue) %>%
summarise(n_issue_mentions = n(), .groups = "drop")
# 2. 聚合到党派层面
issue_counts_party <- issue_counts_mid %>%
group_by(congress, committee_el, issue) %>%
summarise(total_mentions = sum(n_issue_mentions), .groups = "drop")
# 3. 取每届每党 Top 5 议题
top_issues_committee_el <- issue_counts_party %>%
group_by(congress, committee_el) %>%
slice_max(order_by = total_mentions, n = 5, with_ties = FALSE) %>%
arrange(congress, committee_el, desc(total_mentions))
top_issues_committee_el
write.csv(top_issues_committee_el, "top_issues_party_committee.csv", row.names = FALSE)
# 1. 每个议员在每届对某议题的关注次数
issue_counts_mid <- news_data_clean %>%
group_by(congress, committee_el, mid, issue) %>%
summarise(n_issue_mentions = n(), .groups = "drop")
# 2. 聚合到党派层面
issue_counts_party <- issue_counts_mid %>%
group_by(congress, committee_el, issue) %>%
summarise(total_mentions = sum(n_issue_mentions), .groups = "drop")
# 3. 取每届每党 Top 5 议题
top_issues_committee_el <- issue_counts_party %>%
group_by(congress, committee_el) %>%
slice_max(order_by = total_mentions, n = 5, with_ties = FALSE) %>%
arrange(congress, committee_el, desc(total_mentions))
top_issues_committee_el
write.csv(top_issues_committee_el, "top_issues_party_committee.csv", row.names = FALSE)
# 1. 每个议员在每届对某议题的关注次数
issue_counts_mid <- bills_data_aug %>%
group_by(congress, committee_el, mid, issue) %>%
summarise(n_issue_mentions = n(), .groups = "drop")
# 2. 聚合到党派层面
issue_counts_committee_el <- issue_counts_mid %>%
group_by(congress, committee_el, issue) %>%
summarise(total_mentions = sum(n_issue_mentions), .groups = "drop")
# 3. 取每届每党 Top 5 议题
top_issues_committee_el <- issue_counts_committee_el %>%
group_by(congress, committee_el) %>%
slice_max(order_by = total_mentions, n = 5, with_ties = FALSE) %>%
arrange(congress, committee_el, desc(total_mentions))
top_issues_committee_el
write.csv(top_issues_committee_el, "top_issues_party_committee_bills.csv", row.names = FALSE)
