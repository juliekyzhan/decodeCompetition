<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Kunya Zhan">
<meta name="dcterms.date" content="2025-12-20">

<title>robustness-analysis-bayesian</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="robustness_analysis_files/libs/clipboard/clipboard.min.js"></script>
<script src="robustness_analysis_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="robustness_analysis_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="robustness_analysis_files/libs/quarto-html/popper.min.js"></script>
<script src="robustness_analysis_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="robustness_analysis_files/libs/quarto-html/anchor.min.js"></script>
<link href="robustness_analysis_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="robustness_analysis_files/libs/quarto-html/quarto-syntax-highlighting-fe91322616dd2b9cea8bc6bfc6aa44e1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="robustness_analysis_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="robustness_analysis_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="robustness_analysis_files/libs/bootstrap/bootstrap-6f1071c4549ec1672fc8885a20292773.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<style>html{ scroll-behavior: smooth; }</style>
<link href="robustness_analysis_files/libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="robustness_analysis_files/libs/pagedtable-1.1/js/pagedtable.js"></script>


</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#robustness-analysis" id="toc-robustness-analysis" class="nav-link active" data-scroll-target="#robustness-analysis"><span class="header-section-number">1</span> Robustness Analysis</a>
  <ul class="collapse">
  <li><a href="#set-up" id="toc-set-up" class="nav-link" data-scroll-target="#set-up"><span class="header-section-number">1.1</span> set up</a></li>
  <li><a href="#packages-installing-if-not-already-installed" id="toc-packages-installing-if-not-already-installed" class="nav-link" data-scroll-target="#packages-installing-if-not-already-installed"><span class="header-section-number">1.2</span> Packages Installing if not already installed</a></li>
  </ul></li>
  <li><a href="#data-cleansing" id="toc-data-cleansing" class="nav-link" data-scroll-target="#data-cleansing"><span class="header-section-number">2</span> Data cleansing</a>
  <ul class="collapse">
  <li><a href="#data-acquisition" id="toc-data-acquisition" class="nav-link" data-scroll-target="#data-acquisition"><span class="header-section-number">2.1</span> data acquisition</a></li>
  <li><a href="#constructing-train-and-test-data" id="toc-constructing-train-and-test-data" class="nav-link" data-scroll-target="#constructing-train-and-test-data"><span class="header-section-number">2.2</span> constructing train and test data</a></li>
  </ul></li>
  <li><a href="#predictive-validity" id="toc-predictive-validity" class="nav-link" data-scroll-target="#predictive-validity"><span class="header-section-number">3</span> Predictive Validity</a>
  <ul class="collapse">
  <li><a href="#model-preparations" id="toc-model-preparations" class="nav-link" data-scroll-target="#model-preparations"><span class="header-section-number">3.1</span> model preparations</a></li>
  <li><a href="#legis" id="toc-legis" class="nav-link" data-scroll-target="#legis"><span class="header-section-number">3.2</span> Legis</a>
  <ul class="collapse">
  <li><a href="#model-training" id="toc-model-training" class="nav-link" data-scroll-target="#model-training"><span class="header-section-number">3.2.1</span> model training</a></li>
  <li><a href="#posterior-diagnosis" id="toc-posterior-diagnosis" class="nav-link" data-scroll-target="#posterior-diagnosis"><span class="header-section-number">3.2.2</span> posterior diagnosis</a></li>
  <li><a href="#auc-comparsion" id="toc-auc-comparsion" class="nav-link" data-scroll-target="#auc-comparsion"><span class="header-section-number">3.2.3</span> auc comparsion</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#discriminant-validity" id="toc-discriminant-validity" class="nav-link" data-scroll-target="#discriminant-validity"><span class="header-section-number">4</span> Discriminant Validity</a>
  <ul class="collapse">
  <li><a href="#model-setting" id="toc-model-setting" class="nav-link" data-scroll-target="#model-setting"><span class="header-section-number">4.1</span> model setting</a>
  <ul class="collapse">
  <li><a href="#comparions-with-shap-values-function" id="toc-comparions-with-shap-values-function" class="nav-link" data-scroll-target="#comparions-with-shap-values-function"><span class="header-section-number">4.1.1</span> comparions with shap values function</a></li>
  </ul></li>
  <li><a href="#legis-1" id="toc-legis-1" class="nav-link" data-scroll-target="#legis-1"><span class="header-section-number">4.2</span> Legis</a>
  <ul class="collapse">
  <li><a href="#model-training-1" id="toc-model-training-1" class="nav-link" data-scroll-target="#model-training-1"><span class="header-section-number">4.2.1</span> model training</a></li>
  <li><a href="#variables-importance-comparison" id="toc-variables-importance-comparison" class="nav-link" data-scroll-target="#variables-importance-comparison"><span class="header-section-number">4.2.2</span> variables importance comparison</a></li>
  <li><a href="#comparions-with-shap-values" id="toc-comparions-with-shap-values" class="nav-link" data-scroll-target="#comparions-with-shap-values"><span class="header-section-number">4.2.3</span> comparions with shap values</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">robustness-analysis-bayesian</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Kunya Zhan </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 20, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="robustness-analysis" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Robustness Analysis</h1>
<p>This quarto document aims at reorganizing the codes at ‘robustness-check-bayesian’. It serves two main purposes.</p>
<p>1. Evaluate whether the prediction of legislators’ issue-specific legistising and legislative behaviors is reliable (<strong>predictive validity</strong>).</p>
<p>2. Test whether the identification of the three decision-making modes is consistent and credible (<strong>discriminant validity</strong>)</p>
<p>Accordingly, the variables used in the robustness analysis are aligned with those in the final LightGBM model. However, given the structural characteristics of the dataset, the analysis further controls for the unobserved heterogeneity embedded in legislator, issue, and Congress-session levels. This allows for a cleaner assessment of how the proposed matching mechanism explains legislators’ legislative behaviors on specific issues.</p>
<section id="set-up" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="set-up"><span class="header-section-number">1.1</span> set up</h2>
</section>
<section id="packages-installing-if-not-already-installed" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="packages-installing-if-not-already-installed"><span class="header-section-number">1.2</span> Packages Installing if not already installed</h2>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           

[[2]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           

[[3]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           

[[4]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           

[[5]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           

[[6]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           

[[7]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           

[[8]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           

[[9]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           

[[10]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           

[[11]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           

[[12]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           

[[13]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           

[[14]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           

[[15]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           

[[16]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           

[[17]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           

[[18]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           

[[19]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           

[[20]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           

[[21]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           

[[22]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           

[[23]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           

[[24]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           </code></pre>
</div>
</div>
</section>
</section>
<section id="data-cleansing" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Data cleansing</h1>
<section id="data-acquisition" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="data-acquisition"><span class="header-section-number">2.1</span> data acquisition</h2>
</section>
<section id="constructing-train-and-test-data" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="constructing-train-and-test-data"><span class="header-section-number">2.2</span> constructing train and test data</h2>
</section>
</section>
<section id="predictive-validity" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Predictive Validity</h1>
<p>We compared three Bayesian models with progressively enriched feature sets.</p>
<p>The <strong>baseline model</strong> includes only legislators’ demographic and institutional characteristics (first-type features).</p>
<p>The <strong>raw model</strong> adds the original attributes of both legislators and issues (second-type features).</p>
<p>The <strong>match model</strong> incorporates the hypothesized mechanism-based matching features that capture the alignment between legislators and issues (third-type features).</p>
<p><strong>Predictive validity</strong> is evaluated by comparing the predictive performance of these three models. It is quantified using pseudo-R² based on posterior means, which reflects the extent to which the inclusion of different feature types improves model fit.</p>
<section id="model-preparations" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="model-preparations"><span class="header-section-number">3.1</span> model preparations</h2>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Rows containing NAs were excluded from the model.
Warning: Rows containing NAs were excluded from the model.</code></pre>
</div>
</div>
</section>
<section id="legis" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="legis"><span class="header-section-number">3.2</span> Legis</h2>
<section id="model-training" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="model-training"><span class="header-section-number">3.2.1</span> model training</h3>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Compiling Stan program...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Trying to compile a simple C file</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running /Library/Frameworks/R.framework/Resources/bin/R CMD SHLIB foo.c
using C compiler: ‘Apple clang version 16.0.0 (clang-1600.0.26.3)’
using SDK: ‘MacOSX15.0.sdk’
clang -arch arm64 -std=gnu2x -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG   -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/Rcpp/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/unsupported"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/BH/include" -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/src/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppParallel/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/rstan/include" -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DUSE_STANC3 -DSTRICT_R_HEADERS  -DBOOST_PHOENIX_NO_VARIADIC_EXPRESSION  -D_HAS_AUTO_PTR_ETC=0  -include '/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp'  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/opt/R/arm64/include    -fPIC  -falign-functions=64 -Wall -g -O2  -c foo.c -o foo.o
In file included from &lt;built-in&gt;:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp:22:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Dense:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Core:19:
/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:679:10: fatal error: 'cmath' file not found
  679 | #include &lt;cmath&gt;
      |          ^~~~~~~
1 error generated.
make: *** [foo.o] Error 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.002011 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 20.11 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 1: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 1: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 1: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 1: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 1: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 1: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 1: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 1: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 1: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 1: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 1: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 276.868 seconds (Warm-up)
Chain 1:                253.5 seconds (Sampling)
Chain 1:                530.368 seconds (Total)
Chain 1: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 2).
Chain 2: 
Chain 2: Gradient evaluation took 0.001354 seconds
Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 13.54 seconds.
Chain 2: Adjust your expectations accordingly!
Chain 2: 
Chain 2: 
Chain 2: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 2: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 2: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 2: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 2: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 2: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 2: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 2: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 2: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 2: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 2: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 2: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 249.54 seconds (Warm-up)
Chain 2:                167.298 seconds (Sampling)
Chain 2:                416.838 seconds (Total)
Chain 2: </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Rows containing NAs were excluded from the model.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Compiling Stan program...
Trying to compile a simple C file</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running /Library/Frameworks/R.framework/Resources/bin/R CMD SHLIB foo.c
using C compiler: ‘Apple clang version 16.0.0 (clang-1600.0.26.3)’
using SDK: ‘MacOSX15.0.sdk’
clang -arch arm64 -std=gnu2x -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG   -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/Rcpp/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/unsupported"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/BH/include" -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/src/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppParallel/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/rstan/include" -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DUSE_STANC3 -DSTRICT_R_HEADERS  -DBOOST_PHOENIX_NO_VARIADIC_EXPRESSION  -D_HAS_AUTO_PTR_ETC=0  -include '/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp'  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/opt/R/arm64/include    -fPIC  -falign-functions=64 -Wall -g -O2  -c foo.c -o foo.o
In file included from &lt;built-in&gt;:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp:22:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Dense:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Core:19:
/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:679:10: fatal error: 'cmath' file not found
  679 | #include &lt;cmath&gt;
      |          ^~~~~~~
1 error generated.
make: *** [foo.o] Error 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.001863 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 18.63 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 1: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 1: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 1: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 1: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 1: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 1: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 1: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 1: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 1: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 1: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 1: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 269.879 seconds (Warm-up)
Chain 1:                160.568 seconds (Sampling)
Chain 1:                430.447 seconds (Total)
Chain 1: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 2).
Chain 2: 
Chain 2: Gradient evaluation took 0.001409 seconds
Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 14.09 seconds.
Chain 2: Adjust your expectations accordingly!
Chain 2: 
Chain 2: 
Chain 2: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 2: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 2: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 2: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 2: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 2: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 2: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 2: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 2: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 2: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 2: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 2: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 1403.99 seconds (Warm-up)
Chain 2:                491.62 seconds (Sampling)
Chain 2:                1895.61 seconds (Total)
Chain 2: </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.
Running the chains for more iterations may help. See
https://mc-stan.org/misc/warnings.html#bulk-ess
Warning: Rows containing NAs were excluded from the model.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Compiling Stan program...
Trying to compile a simple C file</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running /Library/Frameworks/R.framework/Resources/bin/R CMD SHLIB foo.c
using C compiler: ‘Apple clang version 16.0.0 (clang-1600.0.26.3)’
using SDK: ‘MacOSX15.0.sdk’
clang -arch arm64 -std=gnu2x -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG   -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/Rcpp/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/unsupported"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/BH/include" -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/src/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppParallel/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/rstan/include" -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DUSE_STANC3 -DSTRICT_R_HEADERS  -DBOOST_PHOENIX_NO_VARIADIC_EXPRESSION  -D_HAS_AUTO_PTR_ETC=0  -include '/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp'  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/opt/R/arm64/include    -fPIC  -falign-functions=64 -Wall -g -O2  -c foo.c -o foo.o
In file included from &lt;built-in&gt;:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp:22:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Dense:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Core:19:
/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:679:10: fatal error: 'cmath' file not found
  679 | #include &lt;cmath&gt;
      |          ^~~~~~~
1 error generated.
make: *** [foo.o] Error 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.002801 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 28.01 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 1: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 1: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 1: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 1: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 1: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 1: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 1: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 1: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 1: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 1: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 1: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 656.304 seconds (Warm-up)
Chain 1:                533.417 seconds (Sampling)
Chain 1:                1189.72 seconds (Total)
Chain 1: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 2).
Chain 2: 
Chain 2: Gradient evaluation took 0.002175 seconds
Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 21.75 seconds.
Chain 2: Adjust your expectations accordingly!
Chain 2: 
Chain 2: 
Chain 2: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 2: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 2: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 2: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 2: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 2: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 2: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 2: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 2: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 2: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 2: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 2: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 655.745 seconds (Warm-up)
Chain 2:                531.3 seconds (Sampling)
Chain 2:                1187.05 seconds (Total)
Chain 2: </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.
Running the chains for more iterations may help. See
https://mc-stan.org/misc/warnings.html#bulk-ess</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Compiling Stan program...
Trying to compile a simple C file</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running /Library/Frameworks/R.framework/Resources/bin/R CMD SHLIB foo.c
using C compiler: ‘Apple clang version 16.0.0 (clang-1600.0.26.3)’
using SDK: ‘MacOSX15.0.sdk’
clang -arch arm64 -std=gnu2x -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG   -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/Rcpp/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/unsupported"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/BH/include" -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/src/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppParallel/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/rstan/include" -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DUSE_STANC3 -DSTRICT_R_HEADERS  -DBOOST_PHOENIX_NO_VARIADIC_EXPRESSION  -D_HAS_AUTO_PTR_ETC=0  -include '/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp'  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/opt/R/arm64/include    -fPIC  -falign-functions=64 -Wall -g -O2  -c foo.c -o foo.o
In file included from &lt;built-in&gt;:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp:22:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Dense:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Core:19:
/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:679:10: fatal error: 'cmath' file not found
  679 | #include &lt;cmath&gt;
      |          ^~~~~~~
1 error generated.
make: *** [foo.o] Error 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.002322 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 23.22 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 1: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 1: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 1: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 1: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 1: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 1: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 1: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 1: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 1: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 1: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 1: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 401.465 seconds (Warm-up)
Chain 1:                398.329 seconds (Sampling)
Chain 1:                799.794 seconds (Total)
Chain 1: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 2).
Chain 2: 
Chain 2: Gradient evaluation took 0.001656 seconds
Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 16.56 seconds.
Chain 2: Adjust your expectations accordingly!
Chain 2: 
Chain 2: 
Chain 2: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 2: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 2: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 2: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 2: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 2: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 2: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 2: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 2: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 2: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 2: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 2: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 418.991 seconds (Warm-up)
Chain 2:                330.41 seconds (Sampling)
Chain 2:                749.401 seconds (Total)
Chain 2: </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Found 23152 observations with a pareto_k &gt; 0.67 in model
'bayes_base_legis'. We recommend to run more iterations to get at least about
2200 posterior draws to improve LOO-CV approximation accuracy.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Found 18149 observations with a pareto_k &gt; 0.67 in model
'bayes_baseline_legis'. We recommend to run more iterations to get at least
about 2200 posterior draws to improve LOO-CV approximation accuracy.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Found 23418 observations with a pareto_k &gt; 0.67 in model
'bayes_raw_legis'. We recommend to run more iterations to get at least about
2200 posterior draws to improve LOO-CV approximation accuracy.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Found 21618 observations with a pareto_k &gt; 0.67 in model
'bayes_match_legis'. We recommend to run more iterations to get at least about
2200 posterior draws to improve LOO-CV approximation accuracy.</code></pre>
</div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Bayesian Model (legis) Comparison: LOOIC and Approximate Bayes-R2</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Model</th>
<th style="text-align: right;">LOOIC</th>
<th style="text-align: right;">Bayes_R2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Base-legis</td>
<td style="text-align: right;">3549.235</td>
<td style="text-align: right;">0.8072020</td>
</tr>
<tr class="even">
<td style="text-align: left;">Baseline-legis</td>
<td style="text-align: right;">3191.154</td>
<td style="text-align: right;">0.8128643</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Raw-legis</td>
<td style="text-align: right;">3485.638</td>
<td style="text-align: right;">0.8108141</td>
</tr>
<tr class="even">
<td style="text-align: left;">Match-legis</td>
<td style="text-align: right;">3549.503</td>
<td style="text-align: right;">0.8085644</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="posterior-diagnosis" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="posterior-diagnosis"><span class="header-section-number">3.2.2</span> posterior diagnosis</h3>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>------ BASE ------Rhat &gt; 1.01:
                                             b_Intercept 
                                                1.022416 
                                  sd_congress__Intercept 
                                                1.010351 
                                               Intercept 
                                                1.022416 
 r_full_name[Rep..Bilirakis,.Gus.M..[R-FL-12],Intercept] 
                                                1.010309 
     r_full_name[Rep..Gohmert,.Louie.[R-TX-1],Intercept] 
                                                1.010490 
       r_full_name[Rep..Hill,.Katie.[D-CA-25],Intercept] 
                                                1.013559 
     r_full_name[Rep..Jackson,.Jeff.[D-NC-14],Intercept] 
                                                1.010606 
        r_full_name[Rep..Mace,.Nancy.[R-SC-1],Intercept] 
                                                1.010423 
        r_full_name[Rep..Omar,.Ilhan.[D-MN-5],Intercept] 
                                                1.011757 
  r_full_name[Rep..Pittenger,.Robert.[R-NC-9],Intercept] 
                                                1.012045 
   r_full_name[Rep..Pressley,.Ayanna.[D-MA-7],Intercept] 
                                                1.019224 
     r_full_name[Rep..Rogers,.Harold.[R-KY-5],Intercept] 
                                                1.010576 
     r_full_name[Rep..Rush,.Bobby.L..[D-IL-1],Intercept] 
                                                1.011085 
         r_full_name[Rep..Ryan,.Tim.[D-OH-13],Intercept] 
                                                1.013539 
 r_full_name[Rep..Sánchez,.Linda.T..[D-CA-38],Intercept] 
                                                1.010311 
r_full_name[Rep..Toomey,.Patrick.J..[R-PA-15],Intercept] 
                                                1.014172 
  r_full_name[Rep..Wexton,.Jennifer.[D-VA-10],Intercept] 
                                                1.012862 
        r_full_name[Sen..Boozman,.John.[R-AR],Intercept] 
                                                1.012846 
                 r_issue[Agriculture.and.Food,Intercept] 
                                                1.024533 
     r_issue[Alliance.and.Collective.Security,Intercept] 
                                                1.019025 
                         r_issue[Armed.Forces,Intercept] 
                                                1.025324 
               r_issue[Art,.Culture,.Religion,Intercept] 
                                                1.023599 
                             r_issue[Commerce,Intercept] 
                                                1.022823 
   r_issue[Congressional.political.operations,Intercept] 
                                                1.023554 
            r_issue[Crime.and.Law.Enforcement,Intercept] 
                                                1.012687 
         r_issue[economics.and.public.finance,Intercept] 
                                                1.012135 
                 r_issue[emergency.management,Intercept] 
                                                1.010342 
                               r_issue[Energy,Intercept] 
                                                1.010423 
         r_issue[finance.and.financial.sector,Intercept] 
                                                1.014946 
    r_issue[Housing.and.Community.Development,Intercept] 
                                                1.022964 
                          r_issue[immigration,Intercept] 
                                                1.010114 
                    r_issue[National.Security,Intercept] 
                                                1.024697 

ESS &lt; 0.1:
named numeric(0)

Summary of Rhat:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.9984  1.0003  1.0018  1.0027  1.0037  1.0253 

Summary of ESS ratio:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.2309  0.6092  0.6924  0.6738  0.7581  0.9412 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>------ BASELINE ------Rhat &gt; 1.01:
                                        sd_congress__Intercept 
                                                      1.012903 
                                       sd_full_name__Intercept 
                                                      1.014556 
                                           sd_issue__Intercept 
                                                      1.014654 
     r_full_name[Rep..Arrington,.Jodey.C..[R-TX-19],Intercept] 
                                                      1.010367 
                r_full_name[Rep..Buck,.Ken.[R-CO-4],Intercept] 
                                                      1.010709 
           r_full_name[Rep..Gabbard,.Tulsi.[D-HI-2],Intercept] 
                                                      1.010732 
           r_full_name[Rep..Gohmert,.Louie.[R-TX-1],Intercept] 
                                                      1.010245 
      r_full_name[Rep..Hollingsworth,.Trey.[R-IN-9],Intercept] 
                                                      1.011104 
      r_full_name[Rep..Jeffries,.Hakeem.S..[D-NY-8],Intercept] 
                                                      1.010466 
         r_full_name[Rep..Luria,.Elaine.G..[D-VA-2],Intercept] 
                                                      1.014385 
r_full_name[Rep..Rosendale.Sr.,.Matthew.M..[R-MT-2],Intercept] 
                                                      1.011275 
           r_full_name[Rep..Schrader,.Kurt.[D-OR-5],Intercept] 
                                                      1.013835 
           r_full_name[Rep..Sherman,.Brad.[D-CA-32],Intercept] 
                                                      1.011106 
         r_full_name[Rep..Thornberry,.Mac.[R-TX-13],Intercept] 
                                                      1.010635 
            r_full_name[Rep..Womack,.Steve.[R-AR-3],Intercept] 
                                                      1.010253 
              r_full_name[Sen..Gardner,.Cory.[R-CO],Intercept] 
                                                      1.014024 
          r_full_name[Sen..Harris,.Kamala.D..[D-CA],Intercept] 
                                                      1.011830 
               r_issue[Finance.and.Financial.Sector,Intercept] 
                                                      1.014017 

ESS &lt; 0.1:
named numeric(0)

Summary of Rhat:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.9981  1.0002  1.0017  1.0024  1.0038  1.0147 

Summary of ESS ratio:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.1198  0.6416  0.7256  0.6968  0.7909  0.9430 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The ESS has been capped to avoid unstable estimates.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>------ RAW ------Rhat &gt; 1.01:
                                                   b_leverage6 
                                                      1.024444 
                                    b_payroll_mainConstruction 
                                                      1.015645 
                             b_payroll_mainFinanceandinsurance 
                                                      1.016197 
                   b_payroll_mainHealthcareandsocialassistance 
                                                      1.015910 
             b_payroll_mainManagementofcompaniesandenterprises 
                                                      1.013916 
                                   b_payroll_mainManufacturing 
                                                      1.017177 
           b_payroll_mainMiningquarryingandoilandgasextraction 
                                                      1.014399 
      b_payroll_mainProfessionalscientificandtechnicalservices 
                                                      1.014640 
                                       b_payroll_mainUtilities 
                                                      1.014587 
                       r_full_name[Claire.McCaskill,Intercept] 
                                                      1.018312 
                        r_full_name[Marjorie.Greene,Intercept] 
                                                      1.010173 
            r_full_name[Rep..Bergman,.Jack.[R-MI-1],Intercept] 
                                                      1.015615 
     r_full_name[Rep..Connolly,.Gerald.E..[D-VA-11],Intercept] 
                                                      1.010292 
              r_full_name[Rep..Ezell,.Mike.[R-MS-4],Intercept] 
                                                      1.013789 
              r_full_name[Rep..Gibbs,.Bob.[R-OH-18],Intercept] 
                                                      1.018771 
      r_full_name[Rep..Gimenez,.Carlos.A..[R-FL-26],Intercept] 
                                                      1.012904 
           r_full_name[Rep..Goodlatte,.Bob.[R-VA-6],Intercept] 
                                                      1.010789 
          r_full_name[Rep..Hudson,.Richard.[R-NC-9],Intercept] 
                                                      1.011338 
          r_full_name[Rep..Larson,.John.B..[D-CT-1],Intercept] 
                                                      1.011273 
             r_full_name[Rep..Levin,.Mike.[D-CA-49],Intercept] 
                                                      1.022457 
         r_full_name[Rep..McClain,.Lisa.C..[R-MI-9],Intercept] 
                                                      1.017694 
          r_full_name[Rep..Obernolte,.Jay.[R-CA-23],Intercept] 
                                                      1.022475 
       r_full_name[Rep..Palazzo,.Steven.M..[R-MS-4],Intercept] 
                                                      1.015870 
        r_full_name[Rep..Peters,.Scott.H..[D-CA-50],Intercept] 
                                                      1.011085 
        r_full_name[Rep..Ramirez,.Delia.C..[D-IL-3],Intercept] 
                                                      1.013902 
        r_full_name[Rep..Riggleman,.Denver.[R-VA-5],Intercept] 
                                                      1.011146 
               r_full_name[Rep..Rose,.Max.[D-NY-11],Intercept] 
                                                      1.010232 
           r_full_name[Rep..Rouda,.Harley.[D-CA-48],Intercept] 
                                                      1.016590 
r_full_name[Rep..Schneider,.Bradley.Scott.[D-IL-10],Intercept] 
                                                      1.011649 
         r_full_name[Rep..Sherrill,.Mikie.[D-NJ-11],Intercept] 
                                                      1.012393 
          r_full_name[Rep..Strong,.Dale.W..[R-AL-5],Intercept] 
                                                      1.014847 
             r_full_name[Rep..Walberg,.Tim.[R-MI-5],Intercept] 
                                                      1.016365 
       r_full_name[Rep..Williams,.Brandon.[R-NY-22],Intercept] 
                                                      1.016136 
         r_full_name[Rep..Williams,.Nikema.[D-GA-5],Intercept] 
                                                      1.012356 
            r_full_name[Sen..Loeffler,.Kelly.[R-GA],Intercept] 
                                                      1.010874 
             r_full_name[Sen..Lujan,.Ben.Ray.[D-NM],Intercept] 
                                                      1.010517 
            r_full_name[Sen..Risch,.James.E..[R-ID],Intercept] 
                                                      1.011059 
          r_full_name[Sen..Tuberville,.Tommy.[R-AL],Intercept] 
                                                      1.010192 
                            r_issue[foreign.affairs,Intercept] 
                                                      1.012572 
                      r_issue[International.Finance,Intercept] 
                                                      1.011162 

ESS &lt; 0.1:
named numeric(0)

Summary of Rhat:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  0.998   1.000   1.002   1.003   1.004   1.024 

Summary of ESS ratio:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.1316  0.6124  0.6863  0.6730  0.7564  0.9236 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>------ MATCH ------Rhat &gt; 1.01:
                                           sd_congress__Intercept 
                                                         1.013989 
                              r_full_name[Joe.Donnelly,Intercept] 
                                                         1.010897 
             r_full_name[Rep..Allen,.Rick.W..[R-GA-12],Intercept] 
                                                         1.011185 
          r_full_name[Rep..Bilirakis,.Gus.M..[R-FL-12],Intercept] 
                                                         1.010852 
             r_full_name[Rep..Cunningham,.Joe.[D-SC-1],Intercept] 
                                                         1.011564 
          r_full_name[Rep..Garcia,.Sylvia.R..[D-TX-29],Intercept] 
                                                         1.010553 
              r_full_name[Rep..Huffman,.Jared.[D-CA-2],Intercept] 
                                                         1.010972 
        r_full_name[Rep..Jackson.Lee,.Sheila.[D-TX-18],Intercept] 
                                                         1.011240 
              r_full_name[Rep..Jacobs,.Chris.[R-NY-27],Intercept] 
                                                         1.011418 
              r_full_name[Rep..LaHood,.Darin.[R-IL-16],Intercept] 
                                                         1.019481 
             r_full_name[Rep..McSally,.Martha.[R-AZ-2],Intercept] 
                                                         1.014521 
                 r_full_name[Rep..Ruiz,.Raul.[D-CA-25],Intercept] 
                                                         1.021104 
         r_full_name[Rep..Rutherford,.John.H..[R-FL-5],Intercept] 
                                                         1.010393 
r_full_name[Rep..Sensenbrenner,.F..James,.Jr..[R-WI-5],Intercept] 
                                                         1.020955 
               r_full_name[Rep..Womack,.Steve.[R-AR-3],Intercept] 
                                                         1.011226 
                r_full_name[Sen..Baldwin,.Tammy.[D-WI],Intercept] 
                                                         1.013849 
             r_full_name[Sen..Britt,.Katie.Boyd.[R-AL],Intercept] 
                                                         1.015372 
               r_full_name[Sen..Fetterman,.John.[D-PA],Intercept] 
                                                         1.013675 
                r_full_name[Sen..Klobuchar,.Amy.[D-MN],Intercept] 
                                                         1.011499 
                    r_full_name[Sen..Sasse,.Ben.[R-NE],Intercept] 
                                                         1.010037 
                 r_full_name[Sen..Schmitt,.Eric.[R-MO],Intercept] 
                                                         1.012054 
                   r_full_name[Sen..Scott,.Rick.[R-FL],Intercept] 
                                                         1.016615 
                                                             lp__ 
                                                         1.012281 

ESS &lt; 0.1:
named numeric(0)

Summary of Rhat:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.9983  1.0001  1.0018  1.0026  1.0043  1.0211 

Summary of ESS ratio:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.2282  0.6006  0.6811  0.6752  0.7531  0.9360 </code></pre>
</div>
</div>
</section>
<section id="auc-comparsion" class="level3" data-number="3.2.3">
<h3 data-number="3.2.3" class="anchored" data-anchor-id="auc-comparsion"><span class="header-section-number">3.2.3</span> auc comparsion</h3>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="./Users/kunyazhan/Documents/GitHub/decodeCompetition/output/robust_output/figureslegis_predictive%20auc%20comparison-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- AUC Bootstrap Tests ---
Base vs Baseline:
    Bootstrap test for two correlated ROC curves

data:  roc_list[[i]] and roc_list[[j]]
D = -0.85973, boot.n = 2000, boot.stratified = 1, p-value = 0.3899
alternative hypothesis: true difference in AUC is not equal to 0
sample estimates:
AUC of roc1 AUC of roc2 
  0.9906593   0.9908292 

Base vs Raw:
    Bootstrap test for two correlated ROC curves

data:  roc_list[[i]] and roc_list[[j]]
D = 0.77852, boot.n = 2000, boot.stratified = 1, p-value = 0.4363
alternative hypothesis: true difference in AUC is not equal to 0
sample estimates:
AUC of roc1 AUC of roc2 
  0.9906084   0.9904530 

Base vs Match:
    Bootstrap test for two correlated ROC curves

data:  roc_list[[i]] and roc_list[[j]]
D = -0.86289, boot.n = 2000, boot.stratified = 1, p-value = 0.3882
alternative hypothesis: true difference in AUC is not equal to 0
sample estimates:
AUC of roc1 AUC of roc2 
  0.9906084   0.9907111 

Baseline vs Raw:
    Bootstrap test for two correlated ROC curves

data:  roc_list[[i]] and roc_list[[j]]
D = 1.4646, boot.n = 2000, boot.stratified = 1, p-value = 0.143
alternative hypothesis: true difference in AUC is not equal to 0
sample estimates:
AUC of roc1 AUC of roc2 
  0.9908292   0.9904489 

Baseline vs Match:
    Bootstrap test for two correlated ROC curves

data:  roc_list[[i]] and roc_list[[j]]
D = 0.37223, boot.n = 2000, boot.stratified = 1, p-value = 0.7097
alternative hypothesis: true difference in AUC is not equal to 0
sample estimates:
AUC of roc1 AUC of roc2 
  0.9908292   0.9907522 

Raw vs Match:
    Bootstrap test for two correlated ROC curves

data:  roc_list[[i]] and roc_list[[j]]
D = -1.1894, boot.n = 2000, boot.stratified = 1, p-value = 0.2343
alternative hypothesis: true difference in AUC is not equal to 0
sample estimates:
AUC of roc1 AUC of roc2 
  0.9904530   0.9907111 



Table: AUC Comparison on Test Set

|Model    |   AUC|
|:--------|-----:|
|Base     | 0.991|
|Baseline | 0.991|
|Raw      | 0.990|
|Match    | 0.991|</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>$roc_list
$roc_list$Base

Call:
roc.default(response = test_data[[label_var]], predictor = pred_probs)

Data: pred_probs in 13162 controls (test_data[[label_var]] 0) &lt; 1154 cases (test_data[[label_var]] 1).
Area under the curve: 0.9906

$roc_list$Baseline

Call:
roc.default(response = test_data[[label_var]], predictor = pred_probs)

Data: pred_probs in 12353 controls (test_data[[label_var]] 0) &lt; 1092 cases (test_data[[label_var]] 1).
Area under the curve: 0.9908

$roc_list$Raw

Call:
roc.default(response = test_data[[label_var]], predictor = pred_probs)

Data: pred_probs in 13162 controls (test_data[[label_var]] 0) &lt; 1154 cases (test_data[[label_var]] 1).
Area under the curve: 0.9905

$roc_list$Match

Call:
roc.default(response = test_data[[label_var]], predictor = pred_probs)

Data: pred_probs in 13162 controls (test_data[[label_var]] 0) &lt; 1154 cases (test_data[[label_var]] 1).
Area under the curve: 0.9907


$auc_table
# A tibble: 4 × 2
  Model      AUC
  &lt;chr&gt;    &lt;dbl&gt;
1 Base     0.991
2 Baseline 0.991
3 Raw      0.990
4 Match    0.991</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="discriminant-validity" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Discriminant Validity</h1>
<p><strong>Discriminant validity</strong> is examined by assessing whether the incremental introduction of first-, second-, and third-type features yields consistent and significant improvements in model performance. This is quantified using expected log predictive density (ELPD) under WAIC or LOO-CV criteria.</p>
<section id="model-setting" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="model-setting"><span class="header-section-number">4.1</span> model setting</h2>
<section id="comparions-with-shap-values-function" class="level3" data-number="4.1.1">
<h3 data-number="4.1.1" class="anchored" data-anchor-id="comparions-with-shap-values-function"><span class="header-section-number">4.1.1</span> comparions with shap values function</h3>
<p>the following three functions was meant to complete: compares bayesian model coefficients with SHAP values from lgbm models, specifically</p>
<ol type="1">
<li>aligns variables and compares directionality (signs)</li>
<li>computes pearson correlation and direction match rate</li>
<li>visualizes SHAP vs bayesian coefficients in a scatter plot # major goal: assessing model interpretability consistenct across frameworks</li>
</ol>
</section>
</section>
<section id="legis-1" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="legis-1"><span class="header-section-number">4.2</span> Legis</h2>
<section id="model-training-1" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="model-training-1"><span class="header-section-number">4.2.1</span> model training</h3>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Compiling Stan program...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Trying to compile a simple C file</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running /Library/Frameworks/R.framework/Resources/bin/R CMD SHLIB foo.c
using C compiler: ‘Apple clang version 16.0.0 (clang-1600.0.26.3)’
using SDK: ‘MacOSX15.0.sdk’
clang -arch arm64 -std=gnu2x -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG   -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/Rcpp/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/unsupported"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/BH/include" -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/src/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppParallel/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/rstan/include" -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DUSE_STANC3 -DSTRICT_R_HEADERS  -DBOOST_PHOENIX_NO_VARIADIC_EXPRESSION  -D_HAS_AUTO_PTR_ETC=0  -include '/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp'  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/opt/R/arm64/include    -fPIC  -falign-functions=64 -Wall -g -O2  -c foo.c -o foo.o
In file included from &lt;built-in&gt;:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp:22:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Dense:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Core:19:
/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:679:10: fatal error: 'cmath' file not found
  679 | #include &lt;cmath&gt;
      |          ^~~~~~~
1 error generated.
make: *** [foo.o] Error 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.001952 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 19.52 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 1: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 1: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 1: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 1: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 1: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 1: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 1: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 1: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 1: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 1: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 1: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 306.912 seconds (Warm-up)
Chain 1:                177.166 seconds (Sampling)
Chain 1:                484.078 seconds (Total)
Chain 1: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 2).
Chain 2: 
Chain 2: Gradient evaluation took 0.001422 seconds
Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 14.22 seconds.
Chain 2: Adjust your expectations accordingly!
Chain 2: 
Chain 2: 
Chain 2: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 2: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 2: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 2: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 2: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 2: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 2: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 2: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 2: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 2: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 2: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 2: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 253.224 seconds (Warm-up)
Chain 2:                182.858 seconds (Sampling)
Chain 2:                436.082 seconds (Total)
Chain 2: </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.
Running the chains for more iterations may help. See
https://mc-stan.org/misc/warnings.html#bulk-ess</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Compiling Stan program...
Trying to compile a simple C file</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running /Library/Frameworks/R.framework/Resources/bin/R CMD SHLIB foo.c
using C compiler: ‘Apple clang version 16.0.0 (clang-1600.0.26.3)’
using SDK: ‘MacOSX15.0.sdk’
clang -arch arm64 -std=gnu2x -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG   -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/Rcpp/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/unsupported"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/BH/include" -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/src/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppParallel/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/rstan/include" -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DUSE_STANC3 -DSTRICT_R_HEADERS  -DBOOST_PHOENIX_NO_VARIADIC_EXPRESSION  -D_HAS_AUTO_PTR_ETC=0  -include '/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp'  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/opt/R/arm64/include    -fPIC  -falign-functions=64 -Wall -g -O2  -c foo.c -o foo.o
In file included from &lt;built-in&gt;:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp:22:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Dense:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Core:19:
/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:679:10: fatal error: 'cmath' file not found
  679 | #include &lt;cmath&gt;
      |          ^~~~~~~
1 error generated.
make: *** [foo.o] Error 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.002241 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 22.41 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 1: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 1: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 1: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 1: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 1: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 1: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 1: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 1: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 1: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 1: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 1: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 293.106 seconds (Warm-up)
Chain 1:                336.652 seconds (Sampling)
Chain 1:                629.758 seconds (Total)
Chain 1: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 2).
Chain 2: 
Chain 2: Gradient evaluation took 0.001453 seconds
Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 14.53 seconds.
Chain 2: Adjust your expectations accordingly!
Chain 2: 
Chain 2: 
Chain 2: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 2: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 2: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 2: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 2: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 2: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 2: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 2: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 2: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 2: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 2: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 2: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 305.24 seconds (Warm-up)
Chain 2:                307.139 seconds (Sampling)
Chain 2:                612.379 seconds (Total)
Chain 2: </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Compiling Stan program...
Trying to compile a simple C file</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running /Library/Frameworks/R.framework/Resources/bin/R CMD SHLIB foo.c
using C compiler: ‘Apple clang version 16.0.0 (clang-1600.0.26.3)’
using SDK: ‘MacOSX15.0.sdk’
clang -arch arm64 -std=gnu2x -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG   -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/Rcpp/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/unsupported"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/BH/include" -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/src/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppParallel/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/rstan/include" -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DUSE_STANC3 -DSTRICT_R_HEADERS  -DBOOST_PHOENIX_NO_VARIADIC_EXPRESSION  -D_HAS_AUTO_PTR_ETC=0  -include '/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp'  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/opt/R/arm64/include    -fPIC  -falign-functions=64 -Wall -g -O2  -c foo.c -o foo.o
In file included from &lt;built-in&gt;:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp:22:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Dense:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Core:19:
/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:679:10: fatal error: 'cmath' file not found
  679 | #include &lt;cmath&gt;
      |          ^~~~~~~
1 error generated.
make: *** [foo.o] Error 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.002297 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 22.97 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 1: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 1: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 1: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 1: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 1: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 1: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 1: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 1: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 1: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 1: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 1: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 345.677 seconds (Warm-up)
Chain 1:                188.077 seconds (Sampling)
Chain 1:                533.754 seconds (Total)
Chain 1: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 2).
Chain 2: 
Chain 2: Gradient evaluation took 0.001476 seconds
Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 14.76 seconds.
Chain 2: Adjust your expectations accordingly!
Chain 2: 
Chain 2: 
Chain 2: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 2: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 2: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 2: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 2: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 2: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 2: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 2: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 2: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 2: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 2: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 2: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 326.366 seconds (Warm-up)
Chain 2:                187.542 seconds (Sampling)
Chain 2:                513.908 seconds (Total)
Chain 2: </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.
Running the chains for more iterations may help. See
https://mc-stan.org/misc/warnings.html#bulk-ess</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Compiling Stan program...
Trying to compile a simple C file</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running /Library/Frameworks/R.framework/Resources/bin/R CMD SHLIB foo.c
using C compiler: ‘Apple clang version 16.0.0 (clang-1600.0.26.3)’
using SDK: ‘MacOSX15.0.sdk’
clang -arch arm64 -std=gnu2x -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG   -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/Rcpp/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/unsupported"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/BH/include" -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/src/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppParallel/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/rstan/include" -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DUSE_STANC3 -DSTRICT_R_HEADERS  -DBOOST_PHOENIX_NO_VARIADIC_EXPRESSION  -D_HAS_AUTO_PTR_ETC=0  -include '/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp'  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/opt/R/arm64/include    -fPIC  -falign-functions=64 -Wall -g -O2  -c foo.c -o foo.o
In file included from &lt;built-in&gt;:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp:22:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Dense:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Core:19:
/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:679:10: fatal error: 'cmath' file not found
  679 | #include &lt;cmath&gt;
      |          ^~~~~~~
1 error generated.
make: *** [foo.o] Error 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.002116 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 21.16 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 1: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 1: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 1: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 1: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 1: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 1: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 1: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 1: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 1: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 1: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 1: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 276.08 seconds (Warm-up)
Chain 1:                211.962 seconds (Sampling)
Chain 1:                488.042 seconds (Total)
Chain 1: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 2).
Chain 2: 
Chain 2: Gradient evaluation took 0.001469 seconds
Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 14.69 seconds.
Chain 2: Adjust your expectations accordingly!
Chain 2: 
Chain 2: 
Chain 2: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 2: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 2: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 2: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 2: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 2: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 2: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 2: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 2: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 2: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 2: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 2: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 288.593 seconds (Warm-up)
Chain 2:                184.88 seconds (Sampling)
Chain 2:                473.473 seconds (Total)
Chain 2: </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.
Running the chains for more iterations may help. See
https://mc-stan.org/misc/warnings.html#bulk-ess</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.
Running the chains for more iterations may help. See
https://mc-stan.org/misc/warnings.html#tail-ess</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Compiling Stan program...
Trying to compile a simple C file</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running /Library/Frameworks/R.framework/Resources/bin/R CMD SHLIB foo.c
using C compiler: ‘Apple clang version 16.0.0 (clang-1600.0.26.3)’
using SDK: ‘MacOSX15.0.sdk’
clang -arch arm64 -std=gnu2x -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG   -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/Rcpp/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/unsupported"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/BH/include" -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/src/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppParallel/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/rstan/include" -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DUSE_STANC3 -DSTRICT_R_HEADERS  -DBOOST_PHOENIX_NO_VARIADIC_EXPRESSION  -D_HAS_AUTO_PTR_ETC=0  -include '/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp'  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/opt/R/arm64/include    -fPIC  -falign-functions=64 -Wall -g -O2  -c foo.c -o foo.o
In file included from &lt;built-in&gt;:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp:22:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Dense:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Core:19:
/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:679:10: fatal error: 'cmath' file not found
  679 | #include &lt;cmath&gt;
      |          ^~~~~~~
1 error generated.
make: *** [foo.o] Error 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.001906 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 19.06 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 1: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 1: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 1: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 1: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 1: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 1: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 1: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 1: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 1: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 1: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 1: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 315.081 seconds (Warm-up)
Chain 1:                343.619 seconds (Sampling)
Chain 1:                658.7 seconds (Total)
Chain 1: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 2).
Chain 2: 
Chain 2: Gradient evaluation took 0.001376 seconds
Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 13.76 seconds.
Chain 2: Adjust your expectations accordingly!
Chain 2: 
Chain 2: 
Chain 2: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 2: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 2: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 2: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 2: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 2: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 2: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 2: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 2: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 2: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 2: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 2: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 299.849 seconds (Warm-up)
Chain 2:                334.131 seconds (Sampling)
Chain 2:                633.98 seconds (Total)
Chain 2: </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There were 1 divergent transitions after warmup. See
https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup
to find out why this is a problem and how to eliminate them.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Examine the pairs() plot to diagnose sampling problems</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Compiling Stan program...
Trying to compile a simple C file</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running /Library/Frameworks/R.framework/Resources/bin/R CMD SHLIB foo.c
using C compiler: ‘Apple clang version 16.0.0 (clang-1600.0.26.3)’
using SDK: ‘MacOSX15.0.sdk’
clang -arch arm64 -std=gnu2x -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG   -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/Rcpp/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/unsupported"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/BH/include" -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/src/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppParallel/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/rstan/include" -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DUSE_STANC3 -DSTRICT_R_HEADERS  -DBOOST_PHOENIX_NO_VARIADIC_EXPRESSION  -D_HAS_AUTO_PTR_ETC=0  -include '/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp'  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/opt/R/arm64/include    -fPIC  -falign-functions=64 -Wall -g -O2  -c foo.c -o foo.o
In file included from &lt;built-in&gt;:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp:22:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Dense:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Core:19:
/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:679:10: fatal error: 'cmath' file not found
  679 | #include &lt;cmath&gt;
      |          ^~~~~~~
1 error generated.
make: *** [foo.o] Error 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.002264 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 22.64 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 1: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 1: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 1: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 1: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 1: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 1: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 1: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 1: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 1: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 1: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 1: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 354.076 seconds (Warm-up)
Chain 1:                392.424 seconds (Sampling)
Chain 1:                746.5 seconds (Total)
Chain 1: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 2).
Chain 2: 
Chain 2: Gradient evaluation took 0.001566 seconds
Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 15.66 seconds.
Chain 2: Adjust your expectations accordingly!
Chain 2: 
Chain 2: 
Chain 2: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 2: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 2: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 2: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 2: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 2: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 2: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 2: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 2: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 2: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 2: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 2: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 359.15 seconds (Warm-up)
Chain 2:                396.361 seconds (Sampling)
Chain 2:                755.511 seconds (Total)
Chain 2: </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Found 23244 observations with a pareto_k &gt; 0.67 in model
'bayes_base_legis'. We recommend to run more iterations to get at least about
2200 posterior draws to improve LOO-CV approximation accuracy.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Found 22461 observations with a pareto_k &gt; 0.67 in model
'bayes_intl_legis'. We recommend to run more iterations to get at least about
2200 posterior draws to improve LOO-CV approximation accuracy.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Found 22700 observations with a pareto_k &gt; 0.67 in model
'bayes_intldom_legis'. We recommend to run more iterations to get at least
about 2200 posterior draws to improve LOO-CV approximation accuracy.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Found 22679 observations with a pareto_k &gt; 0.67 in model
'bayes_domprof_legis'. We recommend to run more iterations to get at least
about 2200 posterior draws to improve LOO-CV approximation accuracy.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Found 23704 observations with a pareto_k &gt; 0.67 in model
'bayes_intlprof_legis'. We recommend to run more iterations to get at least
about 2200 posterior draws to improve LOO-CV approximation accuracy.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Found 21031 observations with a pareto_k &gt; 0.67 in model
'bayes_match_legis'. We recommend to run more iterations to get at least about
2200 posterior draws to improve LOO-CV approximation accuracy.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -1776.596</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -1780.734</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -1774.581</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -1768.881</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -1775.919</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                     elpd_diff se_diff
bayes_intlprof_legis   0.0       0.0  
bayes_domprof_legis   -5.7       3.3  
bayes_base_legis      -6.8       3.9  
bayes_match_legis     -7.0       3.3  
bayes_intl_legis      -7.7       3.9  
bayes_intldom_legis  -11.9       5.1  </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in plot.window(...): "label_points" is not a graphical parameter</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in plot.xy(xy, type, ...): "label_points" is not a graphical parameter</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in axis(side = side, at = at, labels = labels, ...): "label_points" is
not a graphical parameter
Warning in axis(side = side, at = at, labels = labels, ...): "label_points" is
not a graphical parameter</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in box(...): "label_points" is not a graphical parameter</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in title(...): "label_points" is not a graphical parameter</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="./Users/kunyazhan/Documents/GitHub/decodeCompetition/output/robust_output/figureslegis_discriminant%20model%20results-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Bayesian Pseudo R² Comparison (Mechanism Models)</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Model</th>
<th style="text-align: right;">Pseudo_R2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">BASE-legis</td>
<td style="text-align: right;">0.8070569</td>
</tr>
<tr class="even">
<td style="text-align: left;">INTL-legis</td>
<td style="text-align: right;">0.8069484</td>
</tr>
<tr class="odd">
<td style="text-align: left;">INTLDOM-legis</td>
<td style="text-align: right;">0.8073191</td>
</tr>
<tr class="even">
<td style="text-align: left;">DOMPROF-legis</td>
<td style="text-align: right;">0.8084223</td>
</tr>
<tr class="odd">
<td style="text-align: left;">INTLPROF-legis</td>
<td style="text-align: right;">0.8083904</td>
</tr>
<tr class="even">
<td style="text-align: left;">MATCH-legis</td>
<td style="text-align: right;">0.8083245</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="variables-importance-comparison" class="level3" data-number="4.2.2">
<h3 data-number="4.2.2" class="anchored" data-anchor-id="variables-importance-comparison"><span class="header-section-number">4.2.2</span> variables importance comparison</h3>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>✅ plot saves to: /Users/kunyazhan/Documents/GitHub/decodeCompetition/output/robust_output/bayes_value_importance/bayes_coef_plot_BASE-legis.png</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>📄 tables saves to: /Users/kunyazhan/Documents/GitHub/decodeCompetition/output/robust_output/bayes_value_importance/bayes_coef_table_BASE-legis.csv</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✅ plot saves to: /Users/kunyazhan/Documents/GitHub/decodeCompetition/output/robust_output/bayes_value_importance/bayes_coef_plot_INTL-legis.png</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>📄 tables saves to: /Users/kunyazhan/Documents/GitHub/decodeCompetition/output/robust_output/bayes_value_importance/bayes_coef_table_INTL-legis.csv</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✅ plot saves to: /Users/kunyazhan/Documents/GitHub/decodeCompetition/output/robust_output/bayes_value_importance/bayes_coef_plot_INTLDOM-legis.png</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>📄 tables saves to: /Users/kunyazhan/Documents/GitHub/decodeCompetition/output/robust_output/bayes_value_importance/bayes_coef_table_INTLDOM-legis.csv</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✅ plot saves to: /Users/kunyazhan/Documents/GitHub/decodeCompetition/output/robust_output/bayes_value_importance/bayes_coef_plot_DOMPROF-legis.png</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>📄 tables saves to: /Users/kunyazhan/Documents/GitHub/decodeCompetition/output/robust_output/bayes_value_importance/bayes_coef_table_DOMPROF-legis.csv</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✅ plot saves to: /Users/kunyazhan/Documents/GitHub/decodeCompetition/output/robust_output/bayes_value_importance/bayes_coef_plot_INTLPROF-legis.png</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>📄 tables saves to: /Users/kunyazhan/Documents/GitHub/decodeCompetition/output/robust_output/bayes_value_importance/bayes_coef_table_INTLPROF-legis.csv</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✅ plot saves to: /Users/kunyazhan/Documents/GitHub/decodeCompetition/output/robust_output/bayes_value_importance/bayes_coef_plot_MATCH-legis.png</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>📄 tables saves to: /Users/kunyazhan/Documents/GitHub/decodeCompetition/output/robust_output/bayes_value_importance/bayes_coef_table_MATCH-legis.csv</code></pre>
</div>
</div>
</section>
<section id="comparions-with-shap-values" class="level3" data-number="4.2.3">
<h3 data-number="4.2.3" class="anchored" data-anchor-id="comparions-with-shap-values"><span class="header-section-number">4.2.3</span> comparions with shap values</h3>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
  Model    Direction_Match_Rate Pearson_Correlation Abs_Correlation
  &lt;chr&gt;                   &lt;dbl&gt;               &lt;dbl&gt;           &lt;dbl&gt;
1 INTL                    0.5                 1              -1    
2 INTLDOM                 0.417               0.133          -0.336
3 DOMPROF                 0.583               0.235          -0.197
4 INTLPROF                0.25               -0.544          -0.551
5 MATCH                   0.643               0.170          -0.277</code></pre>
</div>
</div>
<!-- -->

</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb103" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "robustness-analysis-bayesian"</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Kunya Zhan"</span></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "`r format(Sys.Date(), '%B %d, %Y')`"</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a><span class="co">   toc: true</span></span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a><span class="co">   toc-depth: 3</span></span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a><span class="co">   number-sections: true</span></span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a><span class="co">   code-fold: true</span></span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a><span class="co">   code-summary: "Show/Hide Code"</span></span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a><span class="co">   smooth-scroll: true</span></span>
<span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a><span class="co">   df-print: paged</span></span>
<span id="cb103-14"><a href="#cb103-14" aria-hidden="true" tabindex="-1"></a><span class="co">   code-tools: true</span></span>
<span id="cb103-15"><a href="#cb103-15" aria-hidden="true" tabindex="-1"></a><span class="co">   highlight-style: atom-one</span></span>
<span id="cb103-16"><a href="#cb103-16" aria-hidden="true" tabindex="-1"></a><span class="co">   toc-location: left</span></span>
<span id="cb103-17"><a href="#cb103-17" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb103-18"><a href="#cb103-18" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb103-19"><a href="#cb103-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-20"><a href="#cb103-20" aria-hidden="true" tabindex="-1"></a><span class="fu"># Robustness Analysis</span></span>
<span id="cb103-21"><a href="#cb103-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-22"><a href="#cb103-22" aria-hidden="true" tabindex="-1"></a>This quarto document aims at reorganizing the codes at 'robustness-check-bayesian'. It serves two main purposes.</span>
<span id="cb103-23"><a href="#cb103-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-24"><a href="#cb103-24" aria-hidden="true" tabindex="-1"></a>1<span class="sc">\.</span> Evaluate whether the prediction of legislators' issue-specific legistising and legislative behaviors is reliable (**predictive validity**).</span>
<span id="cb103-25"><a href="#cb103-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-26"><a href="#cb103-26" aria-hidden="true" tabindex="-1"></a>2<span class="sc">\.</span> Test whether the identification of the three decision-making modes is consistent and credible (**discriminant validity**)</span>
<span id="cb103-27"><a href="#cb103-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-28"><a href="#cb103-28" aria-hidden="true" tabindex="-1"></a>Accordingly, the variables used in the robustness analysis are aligned with those in the final LightGBM model. However, given the structural characteristics of the dataset, the analysis further controls for the unobserved heterogeneity embedded in legislator, issue, and Congress-session levels. This allows for a cleaner assessment of how the proposed matching mechanism explains legislators' legislative behaviors on specific issues.</span>
<span id="cb103-29"><a href="#cb103-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-30"><a href="#cb103-30" aria-hidden="true" tabindex="-1"></a><span class="fu">## set up</span></span>
<span id="cb103-31"><a href="#cb103-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-34"><a href="#cb103-34" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb103-35"><a href="#cb103-35" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: setup</span></span>
<span id="cb103-36"><a href="#cb103-36" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb103-37"><a href="#cb103-37" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb103-38"><a href="#cb103-38" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb103-39"><a href="#cb103-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-40"><a href="#cb103-40" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Prevent Mac from sleeping during long render ----</span></span>
<span id="cb103-41"><a href="#cb103-41" aria-hidden="true" tabindex="-1"></a><span class="fu">system</span>(<span class="st">"caffeinate -dimsu &amp;"</span>)</span>
<span id="cb103-42"><a href="#cb103-42" aria-hidden="true" tabindex="-1"></a><span class="fu">on.exit</span>(<span class="fu">system</span>(<span class="st">"killall caffeinate"</span>), <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb103-43"><a href="#cb103-43" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"☕ macOS sleep prevention active for this Quarto render...</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb103-44"><a href="#cb103-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-45"><a href="#cb103-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-46"><a href="#cb103-46" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Create a unified output directory ----</span></span>
<span id="cb103-47"><a href="#cb103-47" aria-hidden="true" tabindex="-1"></a>output_dir <span class="ot">&lt;-</span> <span class="st">"/Users/kunyazhan/Documents/GitHub/decodeCompetition/output/robust_output"</span></span>
<span id="cb103-48"><a href="#cb103-48" aria-hidden="true" tabindex="-1"></a>fig_dir <span class="ot">&lt;-</span> <span class="fu">file.path</span>(output_dir, <span class="st">"figures"</span>)</span>
<span id="cb103-49"><a href="#cb103-49" aria-hidden="true" tabindex="-1"></a>cache_dir <span class="ot">&lt;-</span> <span class="fu">file.path</span>(output_dir, <span class="st">"cache"</span>)</span>
<span id="cb103-50"><a href="#cb103-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-51"><a href="#cb103-51" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(</span>
<span id="cb103-52"><a href="#cb103-52" aria-hidden="true" tabindex="-1"></a>  <span class="at">echo =</span> <span class="cn">TRUE</span>,</span>
<span id="cb103-53"><a href="#cb103-53" aria-hidden="true" tabindex="-1"></a>  <span class="at">fig.path =</span> fig_dir,</span>
<span id="cb103-54"><a href="#cb103-54" aria-hidden="true" tabindex="-1"></a>  <span class="at">cache.path =</span> cache_dir</span>
<span id="cb103-55"><a href="#cb103-55" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb103-56"><a href="#cb103-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-57"><a href="#cb103-57" aria-hidden="true" tabindex="-1"></a><span class="co"># A helper function to save plots/data consistently</span></span>
<span id="cb103-58"><a href="#cb103-58" aria-hidden="true" tabindex="-1"></a>save_to_output <span class="ot">&lt;-</span> <span class="cf">function</span>(filename, <span class="at">plot =</span> <span class="cn">NULL</span>, ...) {</span>
<span id="cb103-59"><a href="#cb103-59" aria-hidden="true" tabindex="-1"></a>  full_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(output_dir, filename)</span>
<span id="cb103-60"><a href="#cb103-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-61"><a href="#cb103-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="fu">dirname</span>(full_path), <span class="at">recursive =</span> <span class="cn">TRUE</span>, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>)</span>
<span id="cb103-62"><a href="#cb103-62" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-63"><a href="#cb103-63" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(plot)) {</span>
<span id="cb103-64"><a href="#cb103-64" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(full_path, <span class="at">plot =</span> plot, ...)</span>
<span id="cb103-65"><a href="#cb103-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"✅ Saved plot to: "</span>, full_path)</span>
<span id="cb103-66"><a href="#cb103-66" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb103-67"><a href="#cb103-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"⚠️ No plot provided. Returning path only: "</span>, full_path)</span>
<span id="cb103-68"><a href="#cb103-68" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb103-69"><a href="#cb103-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-70"><a href="#cb103-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(full_path)</span>
<span id="cb103-71"><a href="#cb103-71" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb103-72"><a href="#cb103-72" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb103-73"><a href="#cb103-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-74"><a href="#cb103-74" aria-hidden="true" tabindex="-1"></a><span class="fu">## Packages Installing if not already installed</span></span>
<span id="cb103-75"><a href="#cb103-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-78"><a href="#cb103-78" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb103-79"><a href="#cb103-79" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: install_libraries</span></span>
<span id="cb103-80"><a href="#cb103-80" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb103-81"><a href="#cb103-81" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb103-82"><a href="#cb103-82" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb103-83"><a href="#cb103-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-84"><a href="#cb103-84" aria-hidden="true" tabindex="-1"></a><span class="co"># 设置默认 CRAN 源，防止未指定镜像导致 install.packages 报错</span></span>
<span id="cb103-85"><a href="#cb103-85" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">repos =</span> <span class="fu">c</span>(<span class="at">CRAN =</span> <span class="st">"https://cloud.r-project.org"</span>))</span>
<span id="cb103-86"><a href="#cb103-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-87"><a href="#cb103-87" aria-hidden="true" tabindex="-1"></a><span class="co"># 所需包列表</span></span>
<span id="cb103-88"><a href="#cb103-88" aria-hidden="true" tabindex="-1"></a>packages <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb103-89"><a href="#cb103-89" aria-hidden="true" tabindex="-1"></a>  <span class="st">"readxl"</span>, <span class="st">"readr"</span>, <span class="st">"dplyr"</span>, <span class="st">"tidyr"</span>, <span class="st">"lme4"</span>, <span class="st">"MuMIn"</span>, <span class="st">"pROC"</span>, </span>
<span id="cb103-90"><a href="#cb103-90" aria-hidden="true" tabindex="-1"></a>  <span class="st">"knitr"</span>, <span class="st">"broom"</span>, <span class="st">"kableExtra"</span>, <span class="st">"alpaca"</span>, <span class="st">"marginaleffects"</span>, </span>
<span id="cb103-91"><a href="#cb103-91" aria-hidden="true" tabindex="-1"></a>  <span class="st">"brms"</span>, <span class="st">"tibble"</span>, <span class="st">"forcats"</span>, <span class="st">"tidyverse"</span>, <span class="st">"bayesplot"</span>, <span class="st">"ggplot2"</span>, </span>
<span id="cb103-92"><a href="#cb103-92" aria-hidden="true" tabindex="-1"></a>  <span class="st">"loo"</span>, <span class="st">"posterior"</span>, <span class="st">"cowplot"</span>, <span class="st">"patchwork"</span>, <span class="st">"glue"</span>, <span class="st">"ggrepel"</span></span>
<span id="cb103-93"><a href="#cb103-93" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb103-94"><a href="#cb103-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-95"><a href="#cb103-95" aria-hidden="true" tabindex="-1"></a><span class="co"># Install only if missing</span></span>
<span id="cb103-96"><a href="#cb103-96" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (pkg <span class="cf">in</span> packages) {</span>
<span id="cb103-97"><a href="#cb103-97" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(pkg, <span class="at">character.only =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb103-98"><a href="#cb103-98" aria-hidden="true" tabindex="-1"></a>    <span class="fu">install.packages</span>(pkg)</span>
<span id="cb103-99"><a href="#cb103-99" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb103-100"><a href="#cb103-100" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb103-101"><a href="#cb103-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-102"><a href="#cb103-102" aria-hidden="true" tabindex="-1"></a><span class="co"># Load all packages</span></span>
<span id="cb103-103"><a href="#cb103-103" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(packages, library, <span class="at">character.only =</span> <span class="cn">TRUE</span>)</span>
<span id="cb103-104"><a href="#cb103-104" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb103-105"><a href="#cb103-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-106"><a href="#cb103-106" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data cleansing</span></span>
<span id="cb103-107"><a href="#cb103-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-108"><a href="#cb103-108" aria-hidden="true" tabindex="-1"></a><span class="fu">## data acquisition</span></span>
<span id="cb103-109"><a href="#cb103-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-112"><a href="#cb103-112" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb103-113"><a href="#cb103-113" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load_data</span></span>
<span id="cb103-114"><a href="#cb103-114" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb103-115"><a href="#cb103-115" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb103-116"><a href="#cb103-116" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb103-117"><a href="#cb103-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-118"><a href="#cb103-118" aria-hidden="true" tabindex="-1"></a><span class="co"># ----- main databases -----</span></span>
<span id="cb103-119"><a href="#cb103-119" aria-hidden="true" tabindex="-1"></a>legis_path <span class="ot">&lt;-</span> <span class="st">"/Users/kunyazhan/Documents/GitHub/decodeCompetition/output/LightGBM_output_1022/legis_analysis_all.xlsx"</span></span>
<span id="cb103-120"><a href="#cb103-120" aria-hidden="true" tabindex="-1"></a>legis_all <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(legis_path)</span>
<span id="cb103-121"><a href="#cb103-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-122"><a href="#cb103-122" aria-hidden="true" tabindex="-1"></a>legis_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"/Users/kunyazhan/Documents/GitHub/decodeCompetition/output/LightGBM_output_1022/legis_train_data.csv"</span>)</span>
<span id="cb103-123"><a href="#cb103-123" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb103-124"><a href="#cb103-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-125"><a href="#cb103-125" aria-hidden="true" tabindex="-1"></a><span class="fu">## constructing train and test data</span></span>
<span id="cb103-126"><a href="#cb103-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-129"><a href="#cb103-129" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb103-130"><a href="#cb103-130" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: data prep pipeline1</span></span>
<span id="cb103-131"><a href="#cb103-131" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb103-132"><a href="#cb103-132" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb103-133"><a href="#cb103-133" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb103-134"><a href="#cb103-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-135"><a href="#cb103-135" aria-hidden="true" tabindex="-1"></a>lump_low_freq_levels <span class="ot">&lt;-</span> <span class="cf">function</span>(train_df, test_df, vars, <span class="at">prop =</span> <span class="fl">0.05</span>, <span class="at">other_level =</span> <span class="st">"Other"</span>) {</span>
<span id="cb103-136"><a href="#cb103-136" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (v <span class="cf">in</span> vars) {</span>
<span id="cb103-137"><a href="#cb103-137" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (v <span class="sc">%in%</span> <span class="fu">names</span>(train_df) <span class="sc">&amp;&amp;</span> v <span class="sc">%in%</span> <span class="fu">names</span>(test_df)) {</span>
<span id="cb103-138"><a href="#cb103-138" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Handle NAs explicitly and lump infrequent categories</span></span>
<span id="cb103-139"><a href="#cb103-139" aria-hidden="true" tabindex="-1"></a>      train_df[[v]] <span class="ot">&lt;-</span> <span class="fu">fct_explicit_na</span>(train_df[[v]], <span class="at">na_level =</span> other_level)</span>
<span id="cb103-140"><a href="#cb103-140" aria-hidden="true" tabindex="-1"></a>      train_df[[v]] <span class="ot">&lt;-</span> <span class="fu">fct_lump</span>(train_df[[v]], <span class="at">prop =</span> prop, <span class="at">other_level =</span> other_level)</span>
<span id="cb103-141"><a href="#cb103-141" aria-hidden="true" tabindex="-1"></a>      train_df[[v]] <span class="ot">&lt;-</span> <span class="fu">droplevels</span>(train_df[[v]])</span>
<span id="cb103-142"><a href="#cb103-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-143"><a href="#cb103-143" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Apply same factor levels to test set</span></span>
<span id="cb103-144"><a href="#cb103-144" aria-hidden="true" tabindex="-1"></a>      allowed_levels <span class="ot">&lt;-</span> <span class="fu">levels</span>(train_df[[v]])</span>
<span id="cb103-145"><a href="#cb103-145" aria-hidden="true" tabindex="-1"></a>      test_vec <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">fct_explicit_na</span>(test_df[[v]], <span class="at">na_level =</span> other_level))</span>
<span id="cb103-146"><a href="#cb103-146" aria-hidden="true" tabindex="-1"></a>      test_vec[<span class="sc">!</span>test_vec <span class="sc">%in%</span> allowed_levels] <span class="ot">&lt;-</span> other_level</span>
<span id="cb103-147"><a href="#cb103-147" aria-hidden="true" tabindex="-1"></a>      test_df[[v]] <span class="ot">&lt;-</span> <span class="fu">factor</span>(test_vec, <span class="at">levels =</span> allowed_levels)</span>
<span id="cb103-148"><a href="#cb103-148" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb103-149"><a href="#cb103-149" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb103-150"><a href="#cb103-150" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">train =</span> train_df, <span class="at">test =</span> test_df)</span>
<span id="cb103-151"><a href="#cb103-151" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb103-152"><a href="#cb103-152" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb103-153"><a href="#cb103-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-156"><a href="#cb103-156" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb103-157"><a href="#cb103-157" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: data prep pipeline2</span></span>
<span id="cb103-158"><a href="#cb103-158" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb103-159"><a href="#cb103-159" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb103-160"><a href="#cb103-160" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb103-161"><a href="#cb103-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-162"><a href="#cb103-162" aria-hidden="true" tabindex="-1"></a>align_factor_levels <span class="ot">&lt;-</span> <span class="cf">function</span>(train, test) {</span>
<span id="cb103-163"><a href="#cb103-163" aria-hidden="true" tabindex="-1"></a>  factor_vars <span class="ot">&lt;-</span> <span class="fu">names</span>(train)[<span class="fu">sapply</span>(train, is.factor)]</span>
<span id="cb103-164"><a href="#cb103-164" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (v <span class="cf">in</span> factor_vars) {</span>
<span id="cb103-165"><a href="#cb103-165" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (v <span class="sc">%in%</span> <span class="fu">names</span>(test)) {</span>
<span id="cb103-166"><a href="#cb103-166" aria-hidden="true" tabindex="-1"></a>      test[[v]] <span class="ot">&lt;-</span> <span class="fu">factor</span>(test[[v]], <span class="at">levels =</span> <span class="fu">levels</span>(train[[v]]))</span>
<span id="cb103-167"><a href="#cb103-167" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb103-168"><a href="#cb103-168" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb103-169"><a href="#cb103-169" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(test)</span>
<span id="cb103-170"><a href="#cb103-170" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb103-171"><a href="#cb103-171" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb103-172"><a href="#cb103-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-175"><a href="#cb103-175" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb103-176"><a href="#cb103-176" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: data prep main pipeline</span></span>
<span id="cb103-177"><a href="#cb103-177" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb103-178"><a href="#cb103-178" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb103-179"><a href="#cb103-179" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb103-180"><a href="#cb103-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-181"><a href="#cb103-181" aria-hidden="true" tabindex="-1"></a>prepare_data_pipeline <span class="ot">&lt;-</span> <span class="cf">function</span>(legis_all, legis_data, match_vars, cat_vars_to_lump, numeric_vars) {</span>
<span id="cb103-182"><a href="#cb103-182" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb103-183"><a href="#cb103-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-184"><a href="#cb103-184" aria-hidden="true" tabindex="-1"></a>  <span class="co"># --- Step 1: Rename matching features before merging ---</span></span>
<span id="cb103-185"><a href="#cb103-185" aria-hidden="true" tabindex="-1"></a>  legis_data_raw <span class="ot">&lt;-</span> legis_data <span class="sc">%&gt;%</span></span>
<span id="cb103-186"><a href="#cb103-186" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="at">.cols =</span> <span class="fu">intersect</span>(<span class="fu">names</span>(.), match_vars), <span class="at">.fn =</span> <span class="sc">~</span> <span class="fu">paste0</span>(.x, <span class="st">"_raw"</span>))</span>
<span id="cb103-187"><a href="#cb103-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-188"><a href="#cb103-188" aria-hidden="true" tabindex="-1"></a>  <span class="co"># check whether raw vars were successfully created</span></span>
<span id="cb103-189"><a href="#cb103-189" aria-hidden="true" tabindex="-1"></a>  raw_vars <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"_raw$"</span>, <span class="fu">names</span>(legis_data_raw), <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb103-190"><a href="#cb103-190" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(raw_vars) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb103-191"><a href="#cb103-191" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"No '_raw' variables were created. Please check match_vars and legis_data column names."</span>)</span>
<span id="cb103-192"><a href="#cb103-192" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb103-193"><a href="#cb103-193" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-194"><a href="#cb103-194" aria-hidden="true" tabindex="-1"></a>  <span class="co"># merge into legis_all</span></span>
<span id="cb103-195"><a href="#cb103-195" aria-hidden="true" tabindex="-1"></a>  legis_all <span class="ot">&lt;-</span> legis_all <span class="sc">%&gt;%</span></span>
<span id="cb103-196"><a href="#cb103-196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb103-197"><a href="#cb103-197" aria-hidden="true" tabindex="-1"></a>    legis_data_raw <span class="sc">%&gt;%</span></span>
<span id="cb103-198"><a href="#cb103-198" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(full_name, issue, congress, <span class="fu">all_of</span>(raw_vars)),</span>
<span id="cb103-199"><a href="#cb103-199" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"full_name"</span>, <span class="st">"issue"</span>, <span class="st">"congress"</span>)</span>
<span id="cb103-200"><a href="#cb103-200" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb103-201"><a href="#cb103-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-202"><a href="#cb103-202" aria-hidden="true" tabindex="-1"></a>  <span class="co"># --- Step 1.5: Merge related category variables to reduce collinearity ---</span></span>
<span id="cb103-203"><a href="#cb103-203" aria-hidden="true" tabindex="-1"></a>  legis_all <span class="ot">&lt;-</span> legis_all <span class="sc">%&gt;%</span></span>
<span id="cb103-204"><a href="#cb103-204" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb103-205"><a href="#cb103-205" aria-hidden="true" tabindex="-1"></a>      <span class="at">industry_main =</span> <span class="fu">coalesce</span>(industry_tp1, industry_tp2, industry_tp3),</span>
<span id="cb103-206"><a href="#cb103-206" aria-hidden="true" tabindex="-1"></a>      <span class="at">industry_main =</span> <span class="fu">fct_lump</span>(<span class="fu">fct_explicit_na</span>(industry_main, <span class="at">na_level =</span> <span class="st">"NA"</span>), <span class="at">n =</span> <span class="dv">10</span>),</span>
<span id="cb103-207"><a href="#cb103-207" aria-hidden="true" tabindex="-1"></a>      <span class="at">ethnicity_tp_main =</span> <span class="fu">coalesce</span>(ethnicity_tp1, ethnicity_tp2, ethnicity_tp3),</span>
<span id="cb103-208"><a href="#cb103-208" aria-hidden="true" tabindex="-1"></a>      <span class="at">ethnicity_tp_main =</span> <span class="fu">fct_lump</span>(<span class="fu">fct_explicit_na</span>(ethnicity_tp_main, <span class="at">na_level =</span> <span class="st">"NA"</span>), <span class="at">n =</span> <span class="dv">8</span>),</span>
<span id="cb103-209"><a href="#cb103-209" aria-hidden="true" tabindex="-1"></a>      <span class="at">employ_main =</span> <span class="fu">coalesce</span>(employ1, employ2, employ3),</span>
<span id="cb103-210"><a href="#cb103-210" aria-hidden="true" tabindex="-1"></a>      <span class="at">payroll_main =</span> <span class="fu">coalesce</span>(payroll1, payroll2, payroll3),</span>
<span id="cb103-211"><a href="#cb103-211" aria-hidden="true" tabindex="-1"></a>      <span class="at">ethnicity_main =</span> <span class="fu">coalesce</span>(ethnicity1, ethnicity2, ethnicity3)</span>
<span id="cb103-212"><a href="#cb103-212" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb103-213"><a href="#cb103-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-214"><a href="#cb103-214" aria-hidden="true" tabindex="-1"></a>  <span class="co"># --- Step 2: Split the dataset into training and test subsets ---</span></span>
<span id="cb103-215"><a href="#cb103-215" aria-hidden="true" tabindex="-1"></a>  legis_all<span class="sc">$</span>pair_id <span class="ot">&lt;-</span> <span class="fu">paste</span>(legis_all<span class="sc">$</span>full_name, legis_all<span class="sc">$</span>issue, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb103-216"><a href="#cb103-216" aria-hidden="true" tabindex="-1"></a>  unique_pairs <span class="ot">&lt;-</span> <span class="fu">unique</span>(legis_all<span class="sc">$</span>pair_id)</span>
<span id="cb103-217"><a href="#cb103-217" aria-hidden="true" tabindex="-1"></a>  train_units <span class="ot">&lt;-</span> <span class="fu">sample</span>(unique_pairs, <span class="at">size =</span> <span class="fu">floor</span>(<span class="fl">0.7</span> <span class="sc">*</span> <span class="fu">length</span>(unique_pairs)))</span>
<span id="cb103-218"><a href="#cb103-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-219"><a href="#cb103-219" aria-hidden="true" tabindex="-1"></a>  legis_all <span class="ot">&lt;-</span> legis_all <span class="sc">%&gt;%</span></span>
<span id="cb103-220"><a href="#cb103-220" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">set =</span> <span class="fu">ifelse</span>(pair_id <span class="sc">%in%</span> train_units, <span class="st">"train"</span>, <span class="st">"test"</span>))</span>
<span id="cb103-221"><a href="#cb103-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-222"><a href="#cb103-222" aria-hidden="true" tabindex="-1"></a>  train_data <span class="ot">&lt;-</span> legis_all <span class="sc">%&gt;%</span> <span class="fu">filter</span>(set <span class="sc">==</span> <span class="st">"train"</span>)</span>
<span id="cb103-223"><a href="#cb103-223" aria-hidden="true" tabindex="-1"></a>  test_data <span class="ot">&lt;-</span> legis_all <span class="sc">%&gt;%</span></span>
<span id="cb103-224"><a href="#cb103-224" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(set <span class="sc">==</span> <span class="st">"test"</span> <span class="sc">&amp;</span> full_name <span class="sc">%in%</span> train_data<span class="sc">$</span>full_name <span class="sc">&amp;</span> issue <span class="sc">%in%</span> train_data<span class="sc">$</span>issue)</span>
<span id="cb103-225"><a href="#cb103-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-226"><a href="#cb103-226" aria-hidden="true" tabindex="-1"></a>  <span class="co"># --- Step 3: Convert character variables into factors ---</span></span>
<span id="cb103-227"><a href="#cb103-227" aria-hidden="true" tabindex="-1"></a>  vars_to_factor <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">names</span>(train_data)[<span class="fu">sapply</span>(train_data, is.character)], <span class="st">"leverage"</span>, <span class="st">"ppvi"</span>) <span class="sc">%&gt;%</span> <span class="fu">unique</span>()</span>
<span id="cb103-228"><a href="#cb103-228" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (v <span class="cf">in</span> vars_to_factor) {</span>
<span id="cb103-229"><a href="#cb103-229" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (v <span class="sc">%in%</span> <span class="fu">names</span>(train_data)) {</span>
<span id="cb103-230"><a href="#cb103-230" aria-hidden="true" tabindex="-1"></a>      train_data[[v]] <span class="ot">&lt;-</span> <span class="fu">factor</span>(train_data[[v]]) <span class="sc">|&gt;</span> <span class="fu">droplevels</span>()</span>
<span id="cb103-231"><a href="#cb103-231" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb103-232"><a href="#cb103-232" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (v <span class="sc">%in%</span> <span class="fu">names</span>(test_data)) {</span>
<span id="cb103-233"><a href="#cb103-233" aria-hidden="true" tabindex="-1"></a>      test_data[[v]] <span class="ot">&lt;-</span> <span class="fu">factor</span>(test_data[[v]], <span class="at">levels =</span> <span class="fu">levels</span>(train_data[[v]]))</span>
<span id="cb103-234"><a href="#cb103-234" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb103-235"><a href="#cb103-235" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb103-236"><a href="#cb103-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-237"><a href="#cb103-237" aria-hidden="true" tabindex="-1"></a>  <span class="co"># --- Step 4: Apply low-frequency lumping and explicit NA encoding ---</span></span>
<span id="cb103-238"><a href="#cb103-238" aria-hidden="true" tabindex="-1"></a>  lumped <span class="ot">&lt;-</span> <span class="fu">lump_low_freq_levels</span>(train_data, test_data, cat_vars_to_lump)</span>
<span id="cb103-239"><a href="#cb103-239" aria-hidden="true" tabindex="-1"></a>  train_data <span class="ot">&lt;-</span> lumped<span class="sc">$</span>train</span>
<span id="cb103-240"><a href="#cb103-240" aria-hidden="true" tabindex="-1"></a>  test_data <span class="ot">&lt;-</span> lumped<span class="sc">$</span>test</span>
<span id="cb103-241"><a href="#cb103-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-242"><a href="#cb103-242" aria-hidden="true" tabindex="-1"></a>  <span class="co"># --- Step 5: Align all factor levels between train/test ---</span></span>
<span id="cb103-243"><a href="#cb103-243" aria-hidden="true" tabindex="-1"></a>  test_data <span class="ot">&lt;-</span> <span class="fu">align_factor_levels</span>(train_data, test_data)</span>
<span id="cb103-244"><a href="#cb103-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-245"><a href="#cb103-245" aria-hidden="true" tabindex="-1"></a>  <span class="co"># --- Step 6: Median imputation and z-score normalization for numeric vars ---</span></span>
<span id="cb103-246"><a href="#cb103-246" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (v <span class="cf">in</span> numeric_vars) {</span>
<span id="cb103-247"><a href="#cb103-247" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (v <span class="sc">%in%</span> <span class="fu">names</span>(train_data)) {</span>
<span id="cb103-248"><a href="#cb103-248" aria-hidden="true" tabindex="-1"></a>      med <span class="ot">&lt;-</span> <span class="fu">median</span>(train_data[[v]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb103-249"><a href="#cb103-249" aria-hidden="true" tabindex="-1"></a>      train_data[[v]][<span class="fu">is.na</span>(train_data[[v]])] <span class="ot">&lt;-</span> med</span>
<span id="cb103-250"><a href="#cb103-250" aria-hidden="true" tabindex="-1"></a>      test_data[[v]][<span class="fu">is.na</span>(test_data[[v]])] <span class="ot">&lt;-</span> med</span>
<span id="cb103-251"><a href="#cb103-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-252"><a href="#cb103-252" aria-hidden="true" tabindex="-1"></a>      mean_v <span class="ot">&lt;-</span> <span class="fu">mean</span>(train_data[[v]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb103-253"><a href="#cb103-253" aria-hidden="true" tabindex="-1"></a>      sd_v <span class="ot">&lt;-</span> <span class="fu">sd</span>(train_data[[v]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb103-254"><a href="#cb103-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-255"><a href="#cb103-255" aria-hidden="true" tabindex="-1"></a>      train_data[[v]] <span class="ot">&lt;-</span> (train_data[[v]] <span class="sc">-</span> mean_v) <span class="sc">/</span> sd_v</span>
<span id="cb103-256"><a href="#cb103-256" aria-hidden="true" tabindex="-1"></a>      test_data[[v]] <span class="ot">&lt;-</span> (test_data[[v]] <span class="sc">-</span> mean_v) <span class="sc">/</span> sd_v</span>
<span id="cb103-257"><a href="#cb103-257" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb103-258"><a href="#cb103-258" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb103-259"><a href="#cb103-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-260"><a href="#cb103-260" aria-hidden="true" tabindex="-1"></a>  <span class="co"># --- Step 6.5: Convert '_raw' variables into factors ---</span></span>
<span id="cb103-261"><a href="#cb103-261" aria-hidden="true" tabindex="-1"></a>  match_features <span class="ot">&lt;-</span> <span class="fu">paste0</span>(match_vars, <span class="st">"_raw"</span>)</span>
<span id="cb103-262"><a href="#cb103-262" aria-hidden="true" tabindex="-1"></a>  cat_match_vars <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(match_features, <span class="fu">c</span>(<span class="st">"party_score_pl_raw"</span>, <span class="st">"party_score_ne_raw"</span>))</span>
<span id="cb103-263"><a href="#cb103-263" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (v <span class="cf">in</span> cat_match_vars) {</span>
<span id="cb103-264"><a href="#cb103-264" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (v <span class="sc">%in%</span> <span class="fu">names</span>(train_data)) {</span>
<span id="cb103-265"><a href="#cb103-265" aria-hidden="true" tabindex="-1"></a>      train_data[[v]] <span class="ot">&lt;-</span> <span class="fu">factor</span>(train_data[[v]]) <span class="sc">|&gt;</span> <span class="fu">droplevels</span>()</span>
<span id="cb103-266"><a href="#cb103-266" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb103-267"><a href="#cb103-267" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (v <span class="sc">%in%</span> <span class="fu">names</span>(test_data)) {</span>
<span id="cb103-268"><a href="#cb103-268" aria-hidden="true" tabindex="-1"></a>      test_data[[v]] <span class="ot">&lt;-</span> <span class="fu">factor</span>(test_data[[v]], <span class="at">levels =</span> <span class="fu">levels</span>(train_data[[v]]))</span>
<span id="cb103-269"><a href="#cb103-269" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb103-270"><a href="#cb103-270" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb103-271"><a href="#cb103-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-272"><a href="#cb103-272" aria-hidden="true" tabindex="-1"></a>  <span class="co"># --- Step 7: Ensure consistent data types across variables ---</span></span>
<span id="cb103-273"><a href="#cb103-273" aria-hidden="true" tabindex="-1"></a>  all_vars <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">c</span>(</span>
<span id="cb103-274"><a href="#cb103-274" aria-hidden="true" tabindex="-1"></a>    match_features, <span class="st">"leverage"</span>, <span class="st">"s_committee_tp1"</span>, <span class="st">"h_committee_tp1"</span>, <span class="st">"party_tp_type"</span>, </span>
<span id="cb103-275"><a href="#cb103-275" aria-hidden="true" tabindex="-1"></a>    <span class="st">"party_tp_score"</span>, <span class="st">"industry_main"</span>, <span class="st">"ethnicity_main"</span>, <span class="st">"employ_main"</span>, <span class="st">"payroll_main"</span>,</span>
<span id="cb103-276"><a href="#cb103-276" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ppvi"</span>, <span class="st">"npvi"</span>, <span class="st">"chamber"</span>, <span class="st">"gender"</span>, <span class="st">"party"</span>, <span class="st">"committee_el"</span>,</span>
<span id="cb103-277"><a href="#cb103-277" aria-hidden="true" tabindex="-1"></a>    <span class="st">"issue"</span>, <span class="st">"full_name"</span>, <span class="st">"congress"</span></span>
<span id="cb103-278"><a href="#cb103-278" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb103-279"><a href="#cb103-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-280"><a href="#cb103-280" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (v <span class="cf">in</span> all_vars) {</span>
<span id="cb103-281"><a href="#cb103-281" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (v <span class="sc">%in%</span> <span class="fu">names</span>(train_data) <span class="sc">&amp;&amp;</span> v <span class="sc">%in%</span> <span class="fu">names</span>(test_data)) {</span>
<span id="cb103-282"><a href="#cb103-282" aria-hidden="true" tabindex="-1"></a>      train_class <span class="ot">&lt;-</span> <span class="fu">class</span>(train_data[[v]])</span>
<span id="cb103-283"><a href="#cb103-283" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="st">"factor"</span> <span class="sc">%in%</span> train_class) {</span>
<span id="cb103-284"><a href="#cb103-284" aria-hidden="true" tabindex="-1"></a>        test_data[[v]] <span class="ot">&lt;-</span> <span class="fu">factor</span>(test_data[[v]], <span class="at">levels =</span> <span class="fu">levels</span>(train_data[[v]]))</span>
<span id="cb103-285"><a href="#cb103-285" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (<span class="st">"character"</span> <span class="sc">%in%</span> train_class) {</span>
<span id="cb103-286"><a href="#cb103-286" aria-hidden="true" tabindex="-1"></a>        train_data[[v]] <span class="ot">&lt;-</span> <span class="fu">factor</span>(train_data[[v]]) <span class="sc">|&gt;</span> <span class="fu">droplevels</span>()</span>
<span id="cb103-287"><a href="#cb103-287" aria-hidden="true" tabindex="-1"></a>        test_data[[v]] <span class="ot">&lt;-</span> <span class="fu">factor</span>(test_data[[v]], <span class="at">levels =</span> <span class="fu">levels</span>(train_data[[v]]))</span>
<span id="cb103-288"><a href="#cb103-288" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (<span class="st">"numeric"</span> <span class="sc">%in%</span> train_class <span class="sc">||</span> <span class="st">"integer"</span> <span class="sc">%in%</span> train_class) {</span>
<span id="cb103-289"><a href="#cb103-289" aria-hidden="true" tabindex="-1"></a>        test_data[[v]] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(test_data[[v]])</span>
<span id="cb103-290"><a href="#cb103-290" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb103-291"><a href="#cb103-291" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb103-292"><a href="#cb103-292" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb103-293"><a href="#cb103-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-294"><a href="#cb103-294" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">train =</span> train_data, <span class="at">test =</span> test_data)</span>
<span id="cb103-295"><a href="#cb103-295" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb103-296"><a href="#cb103-296" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb103-297"><a href="#cb103-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-300"><a href="#cb103-300" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb103-301"><a href="#cb103-301" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: execute pipeline</span></span>
<span id="cb103-302"><a href="#cb103-302" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb103-303"><a href="#cb103-303" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb103-304"><a href="#cb103-304" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb103-305"><a href="#cb103-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-306"><a href="#cb103-306" aria-hidden="true" tabindex="-1"></a><span class="co"># ----- prepare the variables categories -----</span></span>
<span id="cb103-307"><a href="#cb103-307" aria-hidden="true" tabindex="-1"></a>match_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb103-308"><a href="#cb103-308" aria-hidden="true" tabindex="-1"></a>  <span class="st">"leverage_pl"</span>, <span class="st">"leverage_ne"</span>, <span class="st">"committee_pl"</span>, <span class="st">"committee_ne"</span>,</span>
<span id="cb103-309"><a href="#cb103-309" aria-hidden="true" tabindex="-1"></a>  <span class="st">"employ_industry_pl"</span>, <span class="st">"employ_industry_ne"</span>, <span class="st">"payroll_industry_pl"</span>, <span class="st">"payroll_industry_ne"</span>,</span>
<span id="cb103-310"><a href="#cb103-310" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ethnicity_pl"</span>, <span class="st">"ethnicity_ne"</span>, <span class="st">"party_value_pl"</span>, <span class="st">"party_value_ne"</span>,</span>
<span id="cb103-311"><a href="#cb103-311" aria-hidden="true" tabindex="-1"></a>  <span class="st">"party_score_pl"</span>, <span class="st">"party_score_ne"</span></span>
<span id="cb103-312"><a href="#cb103-312" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb103-313"><a href="#cb103-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-314"><a href="#cb103-314" aria-hidden="true" tabindex="-1"></a>cat_vars_to_lump <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb103-315"><a href="#cb103-315" aria-hidden="true" tabindex="-1"></a>  <span class="st">"h_committee_tp1"</span>, <span class="st">"s_committee_tp1"</span>, <span class="st">"industry_tp1"</span>, <span class="st">"industry_tp2"</span>, <span class="st">"industry_tp3"</span>, </span>
<span id="cb103-316"><a href="#cb103-316" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ethnicity_tp1"</span>, <span class="st">"ethnicity_tp2"</span>, <span class="st">"ethnicity_tp3"</span>, <span class="st">"employ1"</span>, <span class="st">"employ2"</span>, <span class="st">"employ3"</span>, </span>
<span id="cb103-317"><a href="#cb103-317" aria-hidden="true" tabindex="-1"></a>  <span class="st">"payroll1"</span>, <span class="st">"payroll2"</span>, <span class="st">"payroll3"</span>, <span class="st">"ethnicity1"</span>, <span class="st">"ethnicity2"</span>, <span class="st">"ethnicity3"</span></span>
<span id="cb103-318"><a href="#cb103-318" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb103-319"><a href="#cb103-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-320"><a href="#cb103-320" aria-hidden="true" tabindex="-1"></a>numeric_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"party_tp_score"</span>, <span class="st">"npvi"</span>)</span>
<span id="cb103-321"><a href="#cb103-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-322"><a href="#cb103-322" aria-hidden="true" tabindex="-1"></a><span class="co"># ----- excute -----</span></span>
<span id="cb103-323"><a href="#cb103-323" aria-hidden="true" tabindex="-1"></a>processed_legis <span class="ot">&lt;-</span> <span class="fu">prepare_data_pipeline</span>(</span>
<span id="cb103-324"><a href="#cb103-324" aria-hidden="true" tabindex="-1"></a>  legis_all, </span>
<span id="cb103-325"><a href="#cb103-325" aria-hidden="true" tabindex="-1"></a>  legis_data, </span>
<span id="cb103-326"><a href="#cb103-326" aria-hidden="true" tabindex="-1"></a>  match_vars, </span>
<span id="cb103-327"><a href="#cb103-327" aria-hidden="true" tabindex="-1"></a>  cat_vars_to_lump, </span>
<span id="cb103-328"><a href="#cb103-328" aria-hidden="true" tabindex="-1"></a>  numeric_vars</span>
<span id="cb103-329"><a href="#cb103-329" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb103-330"><a href="#cb103-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-331"><a href="#cb103-331" aria-hidden="true" tabindex="-1"></a>train_data_legis <span class="ot">&lt;-</span> processed_legis<span class="sc">$</span>train</span>
<span id="cb103-332"><a href="#cb103-332" aria-hidden="true" tabindex="-1"></a>test_data_legis <span class="ot">&lt;-</span> processed_legis<span class="sc">$</span>test</span>
<span id="cb103-333"><a href="#cb103-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-334"><a href="#cb103-334" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb103-335"><a href="#cb103-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-336"><a href="#cb103-336" aria-hidden="true" tabindex="-1"></a><span class="fu"># Predictive Validity</span></span>
<span id="cb103-337"><a href="#cb103-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-338"><a href="#cb103-338" aria-hidden="true" tabindex="-1"></a>We compared three Bayesian models with progressively enriched feature sets.</span>
<span id="cb103-339"><a href="#cb103-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-340"><a href="#cb103-340" aria-hidden="true" tabindex="-1"></a>The **baseline model** includes only legislators’ demographic and institutional characteristics (first-type features).</span>
<span id="cb103-341"><a href="#cb103-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-342"><a href="#cb103-342" aria-hidden="true" tabindex="-1"></a>The **raw model** adds the original attributes of both legislators and issues (second-type features).</span>
<span id="cb103-343"><a href="#cb103-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-344"><a href="#cb103-344" aria-hidden="true" tabindex="-1"></a>The **match model** incorporates the hypothesized mechanism-based matching features that capture the alignment between legislators and issues (third-type features).</span>
<span id="cb103-345"><a href="#cb103-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-346"><a href="#cb103-346" aria-hidden="true" tabindex="-1"></a>**Predictive validity** is evaluated by comparing the predictive performance of these three models. It is quantified using pseudo-R² based on posterior means, which reflects the extent to which the inclusion of different feature types improves model fit.</span>
<span id="cb103-347"><a href="#cb103-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-348"><a href="#cb103-348" aria-hidden="true" tabindex="-1"></a><span class="fu">## model preparations</span></span>
<span id="cb103-349"><a href="#cb103-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-352"><a href="#cb103-352" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb103-353"><a href="#cb103-353" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: predictive model construction</span></span>
<span id="cb103-354"><a href="#cb103-354" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb103-355"><a href="#cb103-355" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true</span></span>
<span id="cb103-356"><a href="#cb103-356" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb103-357"><a href="#cb103-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-358"><a href="#cb103-358" aria-hidden="true" tabindex="-1"></a><span class="co"># ----- base model -----</span></span>
<span id="cb103-359"><a href="#cb103-359" aria-hidden="true" tabindex="-1"></a>formula_base <span class="ot">&lt;-</span> <span class="fu">bf</span>(label <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>issue) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>full_name) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>congress))</span>
<span id="cb103-360"><a href="#cb103-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-361"><a href="#cb103-361" aria-hidden="true" tabindex="-1"></a><span class="co"># ----- baseline model -----</span></span>
<span id="cb103-362"><a href="#cb103-362" aria-hidden="true" tabindex="-1"></a><span class="co"># baseline model </span></span>
<span id="cb103-363"><a href="#cb103-363" aria-hidden="true" tabindex="-1"></a>formula_baseline <span class="ot">&lt;-</span> <span class="fu">bf</span>(label <span class="sc">~</span> chamber <span class="sc">+</span> age <span class="sc">+</span> gender <span class="sc">+</span> party <span class="sc">+</span> seniority <span class="sc">+</span></span>
<span id="cb103-364"><a href="#cb103-364" aria-hidden="true" tabindex="-1"></a>                         ideology <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>issue) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>full_name) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>congress))</span>
<span id="cb103-365"><a href="#cb103-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-366"><a href="#cb103-366" aria-hidden="true" tabindex="-1"></a><span class="co"># ----- raw model -----</span></span>
<span id="cb103-367"><a href="#cb103-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-368"><a href="#cb103-368" aria-hidden="true" tabindex="-1"></a>formula_raw <span class="ot">&lt;-</span> <span class="fu">bf</span>(label <span class="sc">~</span> leverage <span class="sc">+</span> s_committee_tp1 <span class="sc">+</span> h_committee_tp1 </span>
<span id="cb103-369"><a href="#cb103-369" aria-hidden="true" tabindex="-1"></a>                  <span class="sc">+</span> party_tp_type <span class="sc">+</span> party_tp_score <span class="sc">+</span> industry_main </span>
<span id="cb103-370"><a href="#cb103-370" aria-hidden="true" tabindex="-1"></a>                  <span class="sc">+</span> ethnicity_tp_main <span class="sc">+</span> employ_main <span class="sc">+</span> payroll_main </span>
<span id="cb103-371"><a href="#cb103-371" aria-hidden="true" tabindex="-1"></a>                  <span class="sc">+</span> ethnicity_main <span class="sc">+</span> ppvi <span class="sc">+</span> npvi </span>
<span id="cb103-372"><a href="#cb103-372" aria-hidden="true" tabindex="-1"></a>                  <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>issue) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>full_name) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>congress))</span>
<span id="cb103-373"><a href="#cb103-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-374"><a href="#cb103-374" aria-hidden="true" tabindex="-1"></a><span class="co"># ----- match model -----</span></span>
<span id="cb103-375"><a href="#cb103-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-376"><a href="#cb103-376" aria-hidden="true" tabindex="-1"></a>match_features <span class="ot">&lt;-</span> <span class="fu">paste0</span>(match_vars, <span class="st">"_raw"</span>)</span>
<span id="cb103-377"><a href="#cb103-377" aria-hidden="true" tabindex="-1"></a>formula_match <span class="ot">&lt;-</span> <span class="fu">bf</span>(</span>
<span id="cb103-378"><a href="#cb103-378" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.formula</span>(<span class="fu">paste</span>(<span class="st">"label ~"</span>, <span class="fu">paste</span>(match_features, <span class="at">collapse =</span> <span class="st">" + "</span>), <span class="st">"+ (1|issue) + (1|full_name) + (1|congress)"</span>))</span>
<span id="cb103-379"><a href="#cb103-379" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb103-380"><a href="#cb103-380" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb103-381"><a href="#cb103-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-384"><a href="#cb103-384" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb103-385"><a href="#cb103-385" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: predictive check parameter</span></span>
<span id="cb103-386"><a href="#cb103-386" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb103-387"><a href="#cb103-387" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true</span></span>
<span id="cb103-388"><a href="#cb103-388" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb103-389"><a href="#cb103-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-390"><a href="#cb103-390" aria-hidden="true" tabindex="-1"></a><span class="co"># check parameters</span></span>
<span id="cb103-391"><a href="#cb103-391" aria-hidden="true" tabindex="-1"></a>priors_base_legis_check <span class="ot">&lt;-</span> <span class="fu">get_prior</span>(formula_base, <span class="at">data =</span> train_data_legis, <span class="at">family =</span> <span class="fu">bernoulli</span>())</span>
<span id="cb103-392"><a href="#cb103-392" aria-hidden="true" tabindex="-1"></a>priors_baseline_legis_check <span class="ot">&lt;-</span> <span class="fu">get_prior</span>(formula_baseline, <span class="at">data =</span> train_data_legis, <span class="at">family =</span> <span class="fu">bernoulli</span>())</span>
<span id="cb103-393"><a href="#cb103-393" aria-hidden="true" tabindex="-1"></a>priors_raw_legis_check  <span class="ot">&lt;-</span> <span class="fu">get_prior</span>(formula_raw, <span class="at">data =</span> train_data_legis, <span class="at">family =</span> <span class="fu">bernoulli</span>())</span>
<span id="cb103-394"><a href="#cb103-394" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb103-395"><a href="#cb103-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-398"><a href="#cb103-398" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb103-399"><a href="#cb103-399" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: predictive priors and iteration</span></span>
<span id="cb103-400"><a href="#cb103-400" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb103-401"><a href="#cb103-401" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true</span></span>
<span id="cb103-402"><a href="#cb103-402" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb103-403"><a href="#cb103-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-404"><a href="#cb103-404" aria-hidden="true" tabindex="-1"></a><span class="co"># - normal prior (mean=0, sd=2.5) for all fixed effect regression coefficients (class = "b")</span></span>
<span id="cb103-405"><a href="#cb103-405" aria-hidden="true" tabindex="-1"></a><span class="co"># reflecting the expection that most coefficients are centered around zero with moderate variability.</span></span>
<span id="cb103-406"><a href="#cb103-406" aria-hidden="true" tabindex="-1"></a><span class="co"># - heavy-tailed student-t prior (df=3, mean=0, scale=2.5) for the intercept (class = "Intercept")</span></span>
<span id="cb103-407"><a href="#cb103-407" aria-hidden="true" tabindex="-1"></a><span class="co"># and group-levels standard deviations (class = "sd")</span></span>
<span id="cb103-408"><a href="#cb103-408" aria-hidden="true" tabindex="-1"></a><span class="co"># which improves model robustness to outliers and enhances interpretability by allowing more flexibility</span></span>
<span id="cb103-409"><a href="#cb103-409" aria-hidden="true" tabindex="-1"></a><span class="co"># in the presence of extreme values</span></span>
<span id="cb103-410"><a href="#cb103-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-411"><a href="#cb103-411" aria-hidden="true" tabindex="-1"></a>priors_base <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb103-412"><a href="#cb103-412" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_prior</span>(<span class="st">"student_t(3, 0, 2.5)"</span>, <span class="at">class =</span> <span class="st">"Intercept"</span>),</span>
<span id="cb103-413"><a href="#cb103-413" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_prior</span>(<span class="st">"student_t(3, 0, 2.5)"</span>, <span class="at">class =</span> <span class="st">"sd"</span>)</span>
<span id="cb103-414"><a href="#cb103-414" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb103-415"><a href="#cb103-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-416"><a href="#cb103-416" aria-hidden="true" tabindex="-1"></a>priors_mechanism <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb103-417"><a href="#cb103-417" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_prior</span>(<span class="st">"normal(0, 2.5)"</span>, <span class="at">class =</span> <span class="st">"b"</span>),         </span>
<span id="cb103-418"><a href="#cb103-418" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_prior</span>(<span class="st">"student_t(3, 0, 2.5)"</span>, <span class="at">class =</span> <span class="st">"Intercept"</span>),</span>
<span id="cb103-419"><a href="#cb103-419" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_prior</span>(<span class="st">"student_t(3, 0, 2.5)"</span>, <span class="at">class =</span> <span class="st">"sd"</span>)</span>
<span id="cb103-420"><a href="#cb103-420" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb103-421"><a href="#cb103-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-422"><a href="#cb103-422" aria-hidden="true" tabindex="-1"></a><span class="co"># iteration parameters setting</span></span>
<span id="cb103-423"><a href="#cb103-423" aria-hidden="true" tabindex="-1"></a><span class="co"># n_iter = 1000 balances between sufficient exploration of the parameter space</span></span>
<span id="cb103-424"><a href="#cb103-424" aria-hidden="true" tabindex="-1"></a><span class="co"># and the computational efficienct</span></span>
<span id="cb103-425"><a href="#cb103-425" aria-hidden="true" tabindex="-1"></a><span class="co"># n_chains = 2 helps assess convergence and ensures robustness of the results,</span></span>
<span id="cb103-426"><a href="#cb103-426" aria-hidden="true" tabindex="-1"></a><span class="co"># while keeping computational cost manageable.</span></span>
<span id="cb103-427"><a href="#cb103-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-428"><a href="#cb103-428" aria-hidden="true" tabindex="-1"></a>n_iter <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb103-429"><a href="#cb103-429" aria-hidden="true" tabindex="-1"></a>n_chains <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb103-430"><a href="#cb103-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-431"><a href="#cb103-431" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb103-432"><a href="#cb103-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-435"><a href="#cb103-435" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb103-436"><a href="#cb103-436" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: posterior diagnosis function</span></span>
<span id="cb103-437"><a href="#cb103-437" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb103-438"><a href="#cb103-438" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true</span></span>
<span id="cb103-439"><a href="#cb103-439" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb103-440"><a href="#cb103-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-441"><a href="#cb103-441" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== Function: bayes_posterior_diagnosis() ====</span></span>
<span id="cb103-442"><a href="#cb103-442" aria-hidden="true" tabindex="-1"></a><span class="co"># this section defines a function to summarize bayesian models diagnostics and visualize posterior results:</span></span>
<span id="cb103-443"><a href="#cb103-443" aria-hidden="true" tabindex="-1"></a><span class="co"># - 1. checks convergence diagnostics (rhat, ess)</span></span>
<span id="cb103-444"><a href="#cb103-444" aria-hidden="true" tabindex="-1"></a><span class="co"># - 2. plots posterior distributions and trace plots</span></span>
<span id="cb103-445"><a href="#cb103-445" aria-hidden="true" tabindex="-1"></a><span class="co"># - 3. visualizes fixed effects estimates with 95% ci</span></span>
<span id="cb103-446"><a href="#cb103-446" aria-hidden="true" tabindex="-1"></a><span class="co"># - 4. optionally saves plots to file</span></span>
<span id="cb103-447"><a href="#cb103-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-448"><a href="#cb103-448" aria-hidden="true" tabindex="-1"></a>bayes_posterior_diagnosis <span class="ot">&lt;-</span> <span class="cf">function</span>(model, </span>
<span id="cb103-449"><a href="#cb103-449" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">model_name =</span> <span class="st">"MODEL"</span>,</span>
<span id="cb103-450"><a href="#cb103-450" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">n_trace =</span> <span class="dv">8</span>,</span>
<span id="cb103-451"><a href="#cb103-451" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">loo_list =</span> <span class="cn">NULL</span>,</span>
<span id="cb103-452"><a href="#cb103-452" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">save_path_prefix =</span> <span class="cn">NULL</span>) {</span>
<span id="cb103-453"><a href="#cb103-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-454"><a href="#cb103-454" aria-hidden="true" tabindex="-1"></a>  rhat_vals <span class="ot">&lt;-</span> <span class="fu">rhat</span>(model)</span>
<span id="cb103-455"><a href="#cb103-455" aria-hidden="true" tabindex="-1"></a>  ess_vals <span class="ot">&lt;-</span> <span class="fu">neff_ratio</span>(model)</span>
<span id="cb103-456"><a href="#cb103-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-457"><a href="#cb103-457" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">glue</span>(<span class="st">"------ {model_name} ------</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb103-458"><a href="#cb103-458" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Rhat &gt; 1.01:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb103-459"><a href="#cb103-459" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(rhat_vals[rhat_vals <span class="sc">&gt;</span> <span class="fl">1.01</span>])</span>
<span id="cb103-460"><a href="#cb103-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-461"><a href="#cb103-461" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">ESS &lt; 0.1:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb103-462"><a href="#cb103-462" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(ess_vals[ess_vals <span class="sc">&lt;</span> <span class="fl">0.1</span>])</span>
<span id="cb103-463"><a href="#cb103-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-464"><a href="#cb103-464" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Summary of Rhat:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb103-465"><a href="#cb103-465" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">summary</span>(rhat_vals))</span>
<span id="cb103-466"><a href="#cb103-466" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-467"><a href="#cb103-467" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Summary of ESS ratio:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb103-468"><a href="#cb103-468" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">summary</span>(ess_vals))</span>
<span id="cb103-469"><a href="#cb103-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-470"><a href="#cb103-470" aria-hidden="true" tabindex="-1"></a>posterior_plot <span class="ot">&lt;-</span> <span class="fu">mcmc_areas</span>(</span>
<span id="cb103-471"><a href="#cb103-471" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_draws_df</span>(model),</span>
<span id="cb103-472"><a href="#cb103-472" aria-hidden="true" tabindex="-1"></a>    <span class="at">regex_pars =</span> <span class="st">"^b_"</span>,</span>
<span id="cb103-473"><a href="#cb103-473" aria-hidden="true" tabindex="-1"></a>    <span class="at">prob =</span> <span class="fl">0.8</span>, <span class="at">prob_outer =</span> <span class="fl">0.95</span></span>
<span id="cb103-474"><a href="#cb103-474" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb103-475"><a href="#cb103-475" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">glue</span>(<span class="st">"Posterior Distributions with 95% CI ({model_name})"</span>))</span>
<span id="cb103-476"><a href="#cb103-476" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-477"><a href="#cb103-477" aria-hidden="true" tabindex="-1"></a>draw_vars <span class="ot">&lt;-</span> <span class="fu">variables</span>(<span class="fu">as_draws_df</span>(model))</span>
<span id="cb103-478"><a href="#cb103-478" aria-hidden="true" tabindex="-1"></a>trace_candidates <span class="ot">&lt;-</span> draw_vars[<span class="fu">grepl</span>(<span class="st">"^b_"</span>, draw_vars)]</span>
<span id="cb103-479"><a href="#cb103-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-480"><a href="#cb103-480" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(trace_candidates) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb103-481"><a href="#cb103-481" aria-hidden="true" tabindex="-1"></a>  <span class="fu">warning</span>(<span class="fu">glue</span>(<span class="st">"No traceable fixed effect parameters for model {model_name}"</span>))</span>
<span id="cb103-482"><a href="#cb103-482" aria-hidden="true" tabindex="-1"></a>  trace_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">glue</span>(<span class="st">"Trace Plot - {model_name} (No traceable parameters)"</span>))</span>
<span id="cb103-483"><a href="#cb103-483" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb103-484"><a href="#cb103-484" aria-hidden="true" tabindex="-1"></a>  pars_to_plot <span class="ot">&lt;-</span> <span class="fu">head</span>(trace_candidates, n_trace)</span>
<span id="cb103-485"><a href="#cb103-485" aria-hidden="true" tabindex="-1"></a>  trace_plot <span class="ot">&lt;-</span> <span class="fu">mcmc_trace</span>(<span class="fu">as_draws_df</span>(model), <span class="at">pars =</span> pars_to_plot) <span class="sc">+</span></span>
<span id="cb103-486"><a href="#cb103-486" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="fu">glue</span>(<span class="st">"Trace Plot - {model_name} (First {length(pars_to_plot)} parameters)"</span>))</span>
<span id="cb103-487"><a href="#cb103-487" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb103-488"><a href="#cb103-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-489"><a href="#cb103-489" aria-hidden="true" tabindex="-1"></a>  fixef_df <span class="ot">&lt;-</span> <span class="fu">fixef</span>(model) <span class="sc">%&gt;%</span></span>
<span id="cb103-490"><a href="#cb103-490" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb103-491"><a href="#cb103-491" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb103-492"><a href="#cb103-492" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="fu">abs</span>(Estimate)))</span>
<span id="cb103-493"><a href="#cb103-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-494"><a href="#cb103-494" aria-hidden="true" tabindex="-1"></a>  fixef_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(fixef_df, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(Variable, Estimate), <span class="at">y =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb103-495"><a href="#cb103-495" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb103-496"><a href="#cb103-496" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb103-497"><a href="#cb103-497" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb103-498"><a href="#cb103-498" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">glue</span>(<span class="st">"Fixed Effects Estimates with 95% CI ({model_name})"</span>),</span>
<span id="cb103-499"><a href="#cb103-499" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Estimate"</span>, <span class="at">x =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb103-500"><a href="#cb103-500" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb103-501"><a href="#cb103-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-502"><a href="#cb103-502" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(save_path_prefix)) {</span>
<span id="cb103-503"><a href="#cb103-503" aria-hidden="true" tabindex="-1"></a>  dir_path <span class="ot">&lt;-</span> <span class="fu">dirname</span>(save_path_prefix)</span>
<span id="cb103-504"><a href="#cb103-504" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(dir_path)) {</span>
<span id="cb103-505"><a href="#cb103-505" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dir.create</span>(dir_path, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb103-506"><a href="#cb103-506" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb103-507"><a href="#cb103-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-508"><a href="#cb103-508" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">paste0</span>(save_path_prefix, <span class="st">"_posterior.png"</span>), posterior_plot, <span class="at">width =</span> <span class="dv">6</span>, <span class="at">height =</span> <span class="dv">4</span>)</span>
<span id="cb103-509"><a href="#cb103-509" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">paste0</span>(save_path_prefix, <span class="st">"_trace.png"</span>), trace_plot, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">4</span>)</span>
<span id="cb103-510"><a href="#cb103-510" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">paste0</span>(save_path_prefix, <span class="st">"_fixef.png"</span>), fixef_plot, <span class="at">width =</span> <span class="dv">6</span>, <span class="at">height =</span> <span class="dv">4</span>)</span>
<span id="cb103-511"><a href="#cb103-511" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb103-512"><a href="#cb103-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-513"><a href="#cb103-513" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb103-514"><a href="#cb103-514" aria-hidden="true" tabindex="-1"></a>    <span class="at">posterior_plot =</span> posterior_plot,</span>
<span id="cb103-515"><a href="#cb103-515" aria-hidden="true" tabindex="-1"></a>    <span class="at">trace_plot =</span> trace_plot,</span>
<span id="cb103-516"><a href="#cb103-516" aria-hidden="true" tabindex="-1"></a>    <span class="at">fixef_plot =</span> fixef_plot</span>
<span id="cb103-517"><a href="#cb103-517" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb103-518"><a href="#cb103-518" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb103-519"><a href="#cb103-519" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb103-520"><a href="#cb103-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-523"><a href="#cb103-523" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb103-524"><a href="#cb103-524" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: auc comparsion function</span></span>
<span id="cb103-525"><a href="#cb103-525" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb103-526"><a href="#cb103-526" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true</span></span>
<span id="cb103-527"><a href="#cb103-527" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb103-528"><a href="#cb103-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-529"><a href="#cb103-529" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== Function: compare_bayes_auc() ====</span></span>
<span id="cb103-530"><a href="#cb103-530" aria-hidden="true" tabindex="-1"></a><span class="co"># this section defines a function to compare auc performance of multiple bayesian logistic models:</span></span>
<span id="cb103-531"><a href="#cb103-531" aria-hidden="true" tabindex="-1"></a><span class="co"># including:</span></span>
<span id="cb103-532"><a href="#cb103-532" aria-hidden="true" tabindex="-1"></a><span class="co"># - 1. computes predicted propabilities on test data</span></span>
<span id="cb103-533"><a href="#cb103-533" aria-hidden="true" tabindex="-1"></a><span class="co"># - 2. plots roc curves for visual comparison</span></span>
<span id="cb103-534"><a href="#cb103-534" aria-hidden="true" tabindex="-1"></a><span class="co"># - 3. performs pairwaise bootsrap tests of auc differences</span></span>
<span id="cb103-535"><a href="#cb103-535" aria-hidden="true" tabindex="-1"></a><span class="co"># - 4. outputs a summary table of auc values</span></span>
<span id="cb103-536"><a href="#cb103-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-537"><a href="#cb103-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-538"><a href="#cb103-538" aria-hidden="true" tabindex="-1"></a>compare_bayes_auc <span class="ot">&lt;-</span> <span class="cf">function</span>(models_named_list, </span>
<span id="cb103-539"><a href="#cb103-539" aria-hidden="true" tabindex="-1"></a>                              test_data, </span>
<span id="cb103-540"><a href="#cb103-540" aria-hidden="true" tabindex="-1"></a>                              <span class="at">label_var =</span> <span class="st">"label"</span>, </span>
<span id="cb103-541"><a href="#cb103-541" aria-hidden="true" tabindex="-1"></a>                              <span class="at">caption =</span> <span class="st">"AUC Comparison on Test Set"</span>,</span>
<span id="cb103-542"><a href="#cb103-542" aria-hidden="true" tabindex="-1"></a>                              <span class="at">colors =</span> <span class="cn">NULL</span>,</span>
<span id="cb103-543"><a href="#cb103-543" aria-hidden="true" tabindex="-1"></a>                              <span class="at">save_path =</span> <span class="cn">NULL</span>) {</span>
<span id="cb103-544"><a href="#cb103-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-545"><a href="#cb103-545" aria-hidden="true" tabindex="-1"></a>  model_names <span class="ot">&lt;-</span> <span class="fu">names</span>(models_named_list)</span>
<span id="cb103-546"><a href="#cb103-546" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(colors)) {</span>
<span id="cb103-547"><a href="#cb103-547" aria-hidden="true" tabindex="-1"></a>    colors <span class="ot">&lt;-</span> RColorBrewer<span class="sc">::</span><span class="fu">brewer.pal</span>(<span class="fu">min</span>(<span class="fu">length</span>(models_named_list), <span class="dv">8</span>), <span class="st">"Set1"</span>)</span>
<span id="cb103-548"><a href="#cb103-548" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb103-549"><a href="#cb103-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-550"><a href="#cb103-550" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 1. predicted probabilities &amp; roc</span></span>
<span id="cb103-551"><a href="#cb103-551" aria-hidden="true" tabindex="-1"></a>  roc_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb103-552"><a href="#cb103-552" aria-hidden="true" tabindex="-1"></a>  auc_list <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb103-553"><a href="#cb103-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-554"><a href="#cb103-554" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(models_named_list)) {</span>
<span id="cb103-555"><a href="#cb103-555" aria-hidden="true" tabindex="-1"></a>    model <span class="ot">&lt;-</span> models_named_list[[i]]</span>
<span id="cb103-556"><a href="#cb103-556" aria-hidden="true" tabindex="-1"></a>    name  <span class="ot">&lt;-</span> model_names[i]</span>
<span id="cb103-557"><a href="#cb103-557" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-558"><a href="#cb103-558" aria-hidden="true" tabindex="-1"></a>    <span class="co"># posterior mean of expected probabilities</span></span>
<span id="cb103-559"><a href="#cb103-559" aria-hidden="true" tabindex="-1"></a>    pred_probs <span class="ot">&lt;-</span> <span class="fu">posterior_epred</span>(model, <span class="at">newdata =</span> test_data, <span class="at">allow_new_levels =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">colMeans</span>()</span>
<span id="cb103-560"><a href="#cb103-560" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-561"><a href="#cb103-561" aria-hidden="true" tabindex="-1"></a>    test_data[[<span class="fu">paste0</span>(<span class="st">"pred_"</span>, name)]] <span class="ot">&lt;-</span> pred_probs</span>
<span id="cb103-562"><a href="#cb103-562" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-563"><a href="#cb103-563" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ROC</span></span>
<span id="cb103-564"><a href="#cb103-564" aria-hidden="true" tabindex="-1"></a>    roc_obj <span class="ot">&lt;-</span> <span class="fu">roc</span>(test_data[[label_var]], pred_probs)</span>
<span id="cb103-565"><a href="#cb103-565" aria-hidden="true" tabindex="-1"></a>    roc_list[[name]] <span class="ot">&lt;-</span> roc_obj</span>
<span id="cb103-566"><a href="#cb103-566" aria-hidden="true" tabindex="-1"></a>    auc_list[i] <span class="ot">&lt;-</span> <span class="fu">auc</span>(roc_obj)</span>
<span id="cb103-567"><a href="#cb103-567" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb103-568"><a href="#cb103-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-569"><a href="#cb103-569" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2. pic</span></span>
<span id="cb103-570"><a href="#cb103-570" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(roc_list[[<span class="dv">1</span>]], <span class="at">col =</span> colors[<span class="dv">1</span>], <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">main =</span> <span class="st">"Bayesian Logistic Models: ROC Comparison"</span>)</span>
<span id="cb103-571"><a href="#cb103-571" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(roc_list)) {</span>
<span id="cb103-572"><a href="#cb103-572" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines</span>(roc_list[[i]], <span class="at">col =</span> colors[i], <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb103-573"><a href="#cb103-573" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb103-574"><a href="#cb103-574" aria-hidden="true" tabindex="-1"></a>  <span class="fu">legend</span>(<span class="st">"bottomright"</span>, <span class="at">legend =</span> model_names, <span class="at">col =</span> colors[<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(roc_list)], <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb103-575"><a href="#cb103-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-576"><a href="#cb103-576" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(save_path)) {</span>
<span id="cb103-577"><a href="#cb103-577" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dev.copy</span>(png, <span class="at">filename =</span> save_path, <span class="at">width =</span> <span class="dv">800</span>, <span class="at">height =</span> <span class="dv">600</span>)</span>
<span id="cb103-578"><a href="#cb103-578" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dev.off</span>()</span>
<span id="cb103-579"><a href="#cb103-579" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb103-580"><a href="#cb103-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-581"><a href="#cb103-581" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. pairwise comparisons</span></span>
<span id="cb103-582"><a href="#cb103-582" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(roc_list) <span class="sc">&gt;=</span> <span class="dv">2</span>) {</span>
<span id="cb103-583"><a href="#cb103-583" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">--- AUC Bootstrap Tests ---</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb103-584"><a href="#cb103-584" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(roc_list) <span class="sc">-</span> <span class="dv">1</span>)) {</span>
<span id="cb103-585"><a href="#cb103-585" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> (i <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(roc_list)) {</span>
<span id="cb103-586"><a href="#cb103-586" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">{model_names[i]} vs {model_names[j]}:</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb103-587"><a href="#cb103-587" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(<span class="fu">roc.test</span>(roc_list[[i]], roc_list[[j]], <span class="at">method =</span> <span class="st">"bootstrap"</span>, <span class="at">paired =</span> <span class="cn">TRUE</span>))</span>
<span id="cb103-588"><a href="#cb103-588" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb103-589"><a href="#cb103-589" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb103-590"><a href="#cb103-590" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb103-591"><a href="#cb103-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-592"><a href="#cb103-592" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 4. AUC tables</span></span>
<span id="cb103-593"><a href="#cb103-593" aria-hidden="true" tabindex="-1"></a>  auc_table <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb103-594"><a href="#cb103-594" aria-hidden="true" tabindex="-1"></a>    <span class="at">Model =</span> model_names,</span>
<span id="cb103-595"><a href="#cb103-595" aria-hidden="true" tabindex="-1"></a>    <span class="at">AUC =</span> auc_list</span>
<span id="cb103-596"><a href="#cb103-596" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb103-597"><a href="#cb103-597" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-598"><a href="#cb103-598" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(knitr<span class="sc">::</span><span class="fu">kable</span>(auc_table, <span class="at">digits =</span> <span class="dv">3</span>, <span class="at">caption =</span> caption))</span>
<span id="cb103-599"><a href="#cb103-599" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-600"><a href="#cb103-600" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb103-601"><a href="#cb103-601" aria-hidden="true" tabindex="-1"></a>    <span class="at">roc_list =</span> roc_list,</span>
<span id="cb103-602"><a href="#cb103-602" aria-hidden="true" tabindex="-1"></a>    <span class="at">auc_table =</span> auc_table</span>
<span id="cb103-603"><a href="#cb103-603" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb103-604"><a href="#cb103-604" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb103-605"><a href="#cb103-605" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb103-606"><a href="#cb103-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-607"><a href="#cb103-607" aria-hidden="true" tabindex="-1"></a><span class="fu">## Legis</span></span>
<span id="cb103-608"><a href="#cb103-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-609"><a href="#cb103-609" aria-hidden="true" tabindex="-1"></a><span class="fu">### model training</span></span>
<span id="cb103-610"><a href="#cb103-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-613"><a href="#cb103-613" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb103-614"><a href="#cb103-614" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: legis_predictive model training</span></span>
<span id="cb103-615"><a href="#cb103-615" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false </span></span>
<span id="cb103-616"><a href="#cb103-616" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true </span></span>
<span id="cb103-617"><a href="#cb103-617" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb103-618"><a href="#cb103-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-619"><a href="#cb103-619" aria-hidden="true" tabindex="-1"></a>bayes_base_legis <span class="ot">&lt;-</span> <span class="fu">brm</span>(formula_base, <span class="at">data =</span> train_data_legis, <span class="at">family =</span> <span class="fu">bernoulli</span>(),</span>
<span id="cb103-620"><a href="#cb103-620" aria-hidden="true" tabindex="-1"></a>                  <span class="at">prior =</span> priors_base, <span class="at">iter =</span> n_iter, <span class="at">chains =</span> n_chains,</span>
<span id="cb103-621"><a href="#cb103-621" aria-hidden="true" tabindex="-1"></a>                  <span class="at">seed =</span> <span class="dv">123</span>, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.9</span>))</span>
<span id="cb103-622"><a href="#cb103-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-623"><a href="#cb103-623" aria-hidden="true" tabindex="-1"></a>bayes_baseline_legis <span class="ot">&lt;-</span> <span class="fu">brm</span>(formula_baseline, <span class="at">data =</span> train_data_legis, <span class="at">family =</span> <span class="fu">bernoulli</span>(),</span>
<span id="cb103-624"><a href="#cb103-624" aria-hidden="true" tabindex="-1"></a>                 <span class="at">prior =</span> priors_mechanism, <span class="at">iter =</span> n_iter, <span class="at">chains =</span> n_chains,</span>
<span id="cb103-625"><a href="#cb103-625" aria-hidden="true" tabindex="-1"></a>                 <span class="at">seed =</span> <span class="dv">123</span>, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.9</span>))</span>
<span id="cb103-626"><a href="#cb103-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-627"><a href="#cb103-627" aria-hidden="true" tabindex="-1"></a>bayes_raw_legis <span class="ot">&lt;-</span> <span class="fu">brm</span>(formula_raw, <span class="at">data =</span> train_data_legis, <span class="at">family =</span> <span class="fu">bernoulli</span>(),</span>
<span id="cb103-628"><a href="#cb103-628" aria-hidden="true" tabindex="-1"></a>                 <span class="at">prior =</span> priors_mechanism, <span class="at">iter =</span> n_iter, <span class="at">chains =</span> n_chains,</span>
<span id="cb103-629"><a href="#cb103-629" aria-hidden="true" tabindex="-1"></a>                 <span class="at">seed =</span> <span class="dv">123</span>, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.9</span>))</span>
<span id="cb103-630"><a href="#cb103-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-631"><a href="#cb103-631" aria-hidden="true" tabindex="-1"></a>bayes_match_legis <span class="ot">&lt;-</span> <span class="fu">brm</span>(formula_match, <span class="at">data =</span> train_data_legis, <span class="at">family =</span> <span class="fu">bernoulli</span>(),</span>
<span id="cb103-632"><a href="#cb103-632" aria-hidden="true" tabindex="-1"></a>                   <span class="at">prior =</span> priors_mechanism, <span class="at">iter =</span> n_iter, <span class="at">chains =</span> n_chains,</span>
<span id="cb103-633"><a href="#cb103-633" aria-hidden="true" tabindex="-1"></a>                   <span class="at">seed =</span> <span class="dv">123</span>, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.9</span>))</span>
<span id="cb103-634"><a href="#cb103-634" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb103-635"><a href="#cb103-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-638"><a href="#cb103-638" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb103-639"><a href="#cb103-639" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: legis_predictive model results</span></span>
<span id="cb103-640"><a href="#cb103-640" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false </span></span>
<span id="cb103-641"><a href="#cb103-641" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true </span></span>
<span id="cb103-642"><a href="#cb103-642" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb103-643"><a href="#cb103-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-644"><a href="#cb103-644" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. loo</span></span>
<span id="cb103-645"><a href="#cb103-645" aria-hidden="true" tabindex="-1"></a>loo_base_legis <span class="ot">&lt;-</span> <span class="fu">loo</span>(bayes_base_legis)</span>
<span id="cb103-646"><a href="#cb103-646" aria-hidden="true" tabindex="-1"></a>loo_baseline_legis <span class="ot">&lt;-</span> <span class="fu">loo</span>(bayes_baseline_legis)</span>
<span id="cb103-647"><a href="#cb103-647" aria-hidden="true" tabindex="-1"></a>loo_raw_legis <span class="ot">&lt;-</span> <span class="fu">loo</span>(bayes_raw_legis)</span>
<span id="cb103-648"><a href="#cb103-648" aria-hidden="true" tabindex="-1"></a>loo_match_legis <span class="ot">&lt;-</span> <span class="fu">loo</span>(bayes_match_legis)</span>
<span id="cb103-649"><a href="#cb103-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-650"><a href="#cb103-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-651"><a href="#cb103-651" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. bayes r2 </span></span>
<span id="cb103-652"><a href="#cb103-652" aria-hidden="true" tabindex="-1"></a>bayes_r2_brms <span class="ot">&lt;-</span> <span class="cf">function</span>(model) <span class="fu">bayes_R2</span>(model)[<span class="dv">1</span>]</span>
<span id="cb103-653"><a href="#cb103-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-654"><a href="#cb103-654" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb103-655"><a href="#cb103-655" aria-hidden="true" tabindex="-1"></a>  <span class="at">Model =</span> <span class="fu">c</span>(<span class="st">"Base-legis"</span>, <span class="st">"Baseline-legis"</span>, <span class="st">"Raw-legis"</span>, <span class="st">"Match-legis"</span>),</span>
<span id="cb103-656"><a href="#cb103-656" aria-hidden="true" tabindex="-1"></a>  <span class="at">LOOIC =</span> <span class="fu">c</span>(loo_base_legis<span class="sc">$</span>estimates[<span class="st">"looic"</span>, <span class="st">"Estimate"</span>],</span>
<span id="cb103-657"><a href="#cb103-657" aria-hidden="true" tabindex="-1"></a>            loo_baseline_legis<span class="sc">$</span>estimates[<span class="st">"looic"</span>, <span class="st">"Estimate"</span>],</span>
<span id="cb103-658"><a href="#cb103-658" aria-hidden="true" tabindex="-1"></a>            loo_raw_legis<span class="sc">$</span>estimates[<span class="st">"looic"</span>, <span class="st">"Estimate"</span>],</span>
<span id="cb103-659"><a href="#cb103-659" aria-hidden="true" tabindex="-1"></a>            loo_match_legis<span class="sc">$</span>estimates[<span class="st">"looic"</span>, <span class="st">"Estimate"</span>]),</span>
<span id="cb103-660"><a href="#cb103-660" aria-hidden="true" tabindex="-1"></a>  <span class="at">Bayes_R2 =</span> <span class="fu">c</span>(<span class="fu">bayes_r2_brms</span>(bayes_base_legis),</span>
<span id="cb103-661"><a href="#cb103-661" aria-hidden="true" tabindex="-1"></a>               <span class="fu">bayes_r2_brms</span>(bayes_baseline_legis),</span>
<span id="cb103-662"><a href="#cb103-662" aria-hidden="true" tabindex="-1"></a>               <span class="fu">bayes_r2_brms</span>(bayes_raw_legis),</span>
<span id="cb103-663"><a href="#cb103-663" aria-hidden="true" tabindex="-1"></a>               <span class="fu">bayes_r2_brms</span>(bayes_match_legis))</span>
<span id="cb103-664"><a href="#cb103-664" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb103-665"><a href="#cb103-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-666"><a href="#cb103-666" aria-hidden="true" tabindex="-1"></a>results <span class="sc">%&gt;%</span> <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"Bayesian Model (legis) Comparison: LOOIC and Approximate Bayes-R2"</span>)</span>
<span id="cb103-667"><a href="#cb103-667" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb103-668"><a href="#cb103-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-669"><a href="#cb103-669" aria-hidden="true" tabindex="-1"></a><span class="fu">### posterior diagnosis</span></span>
<span id="cb103-670"><a href="#cb103-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-673"><a href="#cb103-673" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb103-674"><a href="#cb103-674" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: legis_predictive posterior diagnosis</span></span>
<span id="cb103-675"><a href="#cb103-675" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false </span></span>
<span id="cb103-676"><a href="#cb103-676" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true </span></span>
<span id="cb103-677"><a href="#cb103-677" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb103-678"><a href="#cb103-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-679"><a href="#cb103-679" aria-hidden="true" tabindex="-1"></a>results_base_legis <span class="ot">&lt;-</span> <span class="fu">bayes_posterior_diagnosis</span>(</span>
<span id="cb103-680"><a href="#cb103-680" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> bayes_base_legis,</span>
<span id="cb103-681"><a href="#cb103-681" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_name =</span> <span class="st">"BASE"</span>,</span>
<span id="cb103-682"><a href="#cb103-682" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_trace =</span> <span class="dv">6</span>,</span>
<span id="cb103-683"><a href="#cb103-683" aria-hidden="true" tabindex="-1"></a>  <span class="at">save_path_prefix =</span> <span class="st">"outputs/bayes_base_diagnosis"</span></span>
<span id="cb103-684"><a href="#cb103-684" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb103-685"><a href="#cb103-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-686"><a href="#cb103-686" aria-hidden="true" tabindex="-1"></a>results_baseline_legis <span class="ot">&lt;-</span> <span class="fu">bayes_posterior_diagnosis</span>(</span>
<span id="cb103-687"><a href="#cb103-687" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> bayes_baseline_legis,</span>
<span id="cb103-688"><a href="#cb103-688" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_name =</span> <span class="st">"BASELINE"</span>,</span>
<span id="cb103-689"><a href="#cb103-689" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_trace =</span> <span class="dv">6</span>,</span>
<span id="cb103-690"><a href="#cb103-690" aria-hidden="true" tabindex="-1"></a>  <span class="at">save_path_prefix =</span> <span class="st">"outputs/bayes_base_diagnosis"</span></span>
<span id="cb103-691"><a href="#cb103-691" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb103-692"><a href="#cb103-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-693"><a href="#cb103-693" aria-hidden="true" tabindex="-1"></a>results_raw_legis <span class="ot">&lt;-</span> <span class="fu">bayes_posterior_diagnosis</span>(</span>
<span id="cb103-694"><a href="#cb103-694" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> bayes_raw_legis,</span>
<span id="cb103-695"><a href="#cb103-695" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_name =</span> <span class="st">"RAW"</span>,</span>
<span id="cb103-696"><a href="#cb103-696" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_trace =</span> <span class="dv">6</span>,</span>
<span id="cb103-697"><a href="#cb103-697" aria-hidden="true" tabindex="-1"></a>  <span class="at">save_path_prefix =</span> <span class="st">"outputs/bayes_raw_diagnosis"</span></span>
<span id="cb103-698"><a href="#cb103-698" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb103-699"><a href="#cb103-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-700"><a href="#cb103-700" aria-hidden="true" tabindex="-1"></a>results_match_legis <span class="ot">&lt;-</span> <span class="fu">bayes_posterior_diagnosis</span>(</span>
<span id="cb103-701"><a href="#cb103-701" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> bayes_match_legis,</span>
<span id="cb103-702"><a href="#cb103-702" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_name =</span> <span class="st">"MATCH"</span>,</span>
<span id="cb103-703"><a href="#cb103-703" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_trace =</span> <span class="dv">6</span>,</span>
<span id="cb103-704"><a href="#cb103-704" aria-hidden="true" tabindex="-1"></a>  <span class="at">save_path_prefix =</span> <span class="st">"outputs/bayes_match_diagnosis"</span></span>
<span id="cb103-705"><a href="#cb103-705" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb103-706"><a href="#cb103-706" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb103-707"><a href="#cb103-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-708"><a href="#cb103-708" aria-hidden="true" tabindex="-1"></a><span class="fu">### auc comparsion</span></span>
<span id="cb103-709"><a href="#cb103-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-712"><a href="#cb103-712" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb103-713"><a href="#cb103-713" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: legis_predictive auc comparison</span></span>
<span id="cb103-714"><a href="#cb103-714" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false </span></span>
<span id="cb103-715"><a href="#cb103-715" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true </span></span>
<span id="cb103-716"><a href="#cb103-716" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb103-717"><a href="#cb103-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-718"><a href="#cb103-718" aria-hidden="true" tabindex="-1"></a>models_legis_compare <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb103-719"><a href="#cb103-719" aria-hidden="true" tabindex="-1"></a>  <span class="at">Base =</span> bayes_base_legis,</span>
<span id="cb103-720"><a href="#cb103-720" aria-hidden="true" tabindex="-1"></a>  <span class="at">Baseline =</span> bayes_baseline_legis,</span>
<span id="cb103-721"><a href="#cb103-721" aria-hidden="true" tabindex="-1"></a>  <span class="at">Raw =</span> bayes_raw_legis,</span>
<span id="cb103-722"><a href="#cb103-722" aria-hidden="true" tabindex="-1"></a>  <span class="at">Match =</span> bayes_match_legis</span>
<span id="cb103-723"><a href="#cb103-723" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb103-724"><a href="#cb103-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-725"><a href="#cb103-725" aria-hidden="true" tabindex="-1"></a><span class="fu">compare_bayes_auc</span>(models_legis_compare, <span class="at">test_data =</span> test_data_legis)</span>
<span id="cb103-726"><a href="#cb103-726" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb103-727"><a href="#cb103-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-728"><a href="#cb103-728" aria-hidden="true" tabindex="-1"></a><span class="fu"># Discriminant Validity</span></span>
<span id="cb103-729"><a href="#cb103-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-730"><a href="#cb103-730" aria-hidden="true" tabindex="-1"></a>**Discriminant validity** is examined by assessing whether the incremental introduction of first-, second-, and third-type features yields consistent and significant improvements in model performance. This is quantified using expected log predictive density (ELPD) under WAIC or LOO-CV criteria.</span>
<span id="cb103-731"><a href="#cb103-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-732"><a href="#cb103-732" aria-hidden="true" tabindex="-1"></a><span class="fu">## model setting</span></span>
<span id="cb103-733"><a href="#cb103-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-736"><a href="#cb103-736" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb103-737"><a href="#cb103-737" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: discriminant model constuction</span></span>
<span id="cb103-738"><a href="#cb103-738" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false </span></span>
<span id="cb103-739"><a href="#cb103-739" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true </span></span>
<span id="cb103-740"><a href="#cb103-740" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb103-741"><a href="#cb103-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-742"><a href="#cb103-742" aria-hidden="true" tabindex="-1"></a>formula_base <span class="ot">&lt;-</span> <span class="fu">bf</span>(label <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>issue) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>full_name) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>congress))</span>
<span id="cb103-743"><a href="#cb103-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-744"><a href="#cb103-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-745"><a href="#cb103-745" aria-hidden="true" tabindex="-1"></a>formula_intl <span class="ot">&lt;-</span> <span class="fu">bf</span>(label <span class="sc">~</span> leverage_pl_raw <span class="sc">+</span> leverage_ne_raw <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>issue) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>full_name) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>congress))</span>
<span id="cb103-746"><a href="#cb103-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-747"><a href="#cb103-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-748"><a href="#cb103-748" aria-hidden="true" tabindex="-1"></a>formula_intldom <span class="ot">&lt;-</span> <span class="fu">bf</span>(label <span class="sc">~</span> leverage_pl_raw <span class="sc">+</span> leverage_ne_raw <span class="sc">+</span> ethnicity_pl_raw <span class="sc">+</span> ethnicity_ne_raw <span class="sc">+</span></span>
<span id="cb103-749"><a href="#cb103-749" aria-hidden="true" tabindex="-1"></a>                    payroll_industry_pl_raw <span class="sc">+</span> payroll_industry_ne_raw <span class="sc">+</span></span>
<span id="cb103-750"><a href="#cb103-750" aria-hidden="true" tabindex="-1"></a>                    party_value_pl_raw <span class="sc">+</span> party_value_ne_raw <span class="sc">+</span></span>
<span id="cb103-751"><a href="#cb103-751" aria-hidden="true" tabindex="-1"></a>                    party_score_pl_raw <span class="sc">+</span> party_score_ne_raw <span class="sc">+</span></span>
<span id="cb103-752"><a href="#cb103-752" aria-hidden="true" tabindex="-1"></a>                    employ_industry_pl_raw <span class="sc">+</span> employ_industry_ne_raw <span class="sc">+</span> </span>
<span id="cb103-753"><a href="#cb103-753" aria-hidden="true" tabindex="-1"></a>                    (<span class="dv">1</span><span class="sc">|</span>issue) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>full_name) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>congress))</span>
<span id="cb103-754"><a href="#cb103-754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-755"><a href="#cb103-755" aria-hidden="true" tabindex="-1"></a>formula_domprof <span class="ot">&lt;-</span> <span class="fu">bf</span>(label <span class="sc">~</span> committee_pl_raw <span class="sc">+</span> committee_ne_raw <span class="sc">+</span>  ethnicity_pl_raw <span class="sc">+</span> ethnicity_ne_raw <span class="sc">+</span></span>
<span id="cb103-756"><a href="#cb103-756" aria-hidden="true" tabindex="-1"></a>                    payroll_industry_pl_raw <span class="sc">+</span> payroll_industry_ne_raw <span class="sc">+</span></span>
<span id="cb103-757"><a href="#cb103-757" aria-hidden="true" tabindex="-1"></a>                    party_value_pl_raw <span class="sc">+</span> party_value_ne_raw <span class="sc">+</span></span>
<span id="cb103-758"><a href="#cb103-758" aria-hidden="true" tabindex="-1"></a>                    party_score_pl_raw <span class="sc">+</span> party_score_ne_raw <span class="sc">+</span></span>
<span id="cb103-759"><a href="#cb103-759" aria-hidden="true" tabindex="-1"></a>                    employ_industry_pl_raw <span class="sc">+</span> employ_industry_ne_raw <span class="sc">+</span> </span>
<span id="cb103-760"><a href="#cb103-760" aria-hidden="true" tabindex="-1"></a>                    (<span class="dv">1</span><span class="sc">|</span>issue) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>full_name) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>congress))</span>
<span id="cb103-761"><a href="#cb103-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-762"><a href="#cb103-762" aria-hidden="true" tabindex="-1"></a>formula_intlprof <span class="ot">&lt;-</span> <span class="fu">bf</span>(label <span class="sc">~</span> leverage_pl_raw <span class="sc">+</span> leverage_ne_raw <span class="sc">+</span> committee_pl_raw <span class="sc">+</span> committee_ne_raw <span class="sc">+</span> </span>
<span id="cb103-763"><a href="#cb103-763" aria-hidden="true" tabindex="-1"></a>                    (<span class="dv">1</span><span class="sc">|</span>issue) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>full_name) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>congress))</span>
<span id="cb103-764"><a href="#cb103-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-765"><a href="#cb103-765" aria-hidden="true" tabindex="-1"></a>formula_match <span class="ot">&lt;-</span> <span class="fu">bf</span>(</span>
<span id="cb103-766"><a href="#cb103-766" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.formula</span>(<span class="fu">paste</span>(<span class="st">"label ~"</span>, <span class="fu">paste</span>(match_features, <span class="at">collapse =</span> <span class="st">" + "</span>), <span class="st">"+ (1|issue) + (1|full_name) + (1|congress)"</span>))</span>
<span id="cb103-767"><a href="#cb103-767" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb103-768"><a href="#cb103-768" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb103-769"><a href="#cb103-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-772"><a href="#cb103-772" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb103-773"><a href="#cb103-773" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: discriminant prior setting </span></span>
<span id="cb103-774"><a href="#cb103-774" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false </span></span>
<span id="cb103-775"><a href="#cb103-775" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true </span></span>
<span id="cb103-776"><a href="#cb103-776" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb103-777"><a href="#cb103-777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-778"><a href="#cb103-778" aria-hidden="true" tabindex="-1"></a><span class="co"># keep prior_base</span></span>
<span id="cb103-779"><a href="#cb103-779" aria-hidden="true" tabindex="-1"></a>prior_base <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb103-780"><a href="#cb103-780" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_prior</span>(<span class="st">"student_t(3, 0, 2.5)"</span>, <span class="at">class =</span> <span class="st">"Intercept"</span>),</span>
<span id="cb103-781"><a href="#cb103-781" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_prior</span>(<span class="st">"student_t(3, 0, 2.5)"</span>, <span class="at">class =</span> <span class="st">"sd"</span>)</span>
<span id="cb103-782"><a href="#cb103-782" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb103-783"><a href="#cb103-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-784"><a href="#cb103-784" aria-hidden="true" tabindex="-1"></a><span class="co"># change prior_raw/match into prior_mechanism</span></span>
<span id="cb103-785"><a href="#cb103-785" aria-hidden="true" tabindex="-1"></a>prior_mechanism <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb103-786"><a href="#cb103-786" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_prior</span>(<span class="st">"normal(0, 2.5)"</span>, <span class="at">class =</span> <span class="st">"b"</span>),</span>
<span id="cb103-787"><a href="#cb103-787" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_prior</span>(<span class="st">"student_t(3, 0, 2.5)"</span>, <span class="at">class =</span> <span class="st">"Intercept"</span>),</span>
<span id="cb103-788"><a href="#cb103-788" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_prior</span>(<span class="st">"student_t(3, 0, 2.5)"</span>, <span class="at">class =</span> <span class="st">"sd"</span>)</span>
<span id="cb103-789"><a href="#cb103-789" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb103-790"><a href="#cb103-790" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb103-791"><a href="#cb103-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-794"><a href="#cb103-794" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb103-795"><a href="#cb103-795" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: variables importance comparison function</span></span>
<span id="cb103-796"><a href="#cb103-796" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false </span></span>
<span id="cb103-797"><a href="#cb103-797" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true </span></span>
<span id="cb103-798"><a href="#cb103-798" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb103-799"><a href="#cb103-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-800"><a href="#cb103-800" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== Function: bayes_value_importance_v2() ====</span></span>
<span id="cb103-801"><a href="#cb103-801" aria-hidden="true" tabindex="-1"></a><span class="co"># this section defines a function visualize and export posterior fixed effect estimates from bayes model</span></span>
<span id="cb103-802"><a href="#cb103-802" aria-hidden="true" tabindex="-1"></a><span class="co"># - 1. ranks predictions by absolute logit coefficient</span></span>
<span id="cb103-803"><a href="#cb103-803" aria-hidden="true" tabindex="-1"></a><span class="co"># - 2. plots estimates with 95% ci</span></span>
<span id="cb103-804"><a href="#cb103-804" aria-hidden="true" tabindex="-1"></a><span class="co"># - 3. optionally saves the plot and the table to disk</span></span>
<span id="cb103-805"><a href="#cb103-805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-806"><a href="#cb103-806" aria-hidden="true" tabindex="-1"></a>bayes_value_importance_v2 <span class="ot">&lt;-</span> <span class="cf">function</span>(model, <span class="at">model_name =</span> <span class="st">"Model"</span>, </span>
<span id="cb103-807"><a href="#cb103-807" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">save_dir =</span> <span class="fu">file.path</span>(output_dir, <span class="st">"bayes_value_importance"</span>), </span>
<span id="cb103-808"><a href="#cb103-808" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">save_plot =</span> <span class="cn">TRUE</span>, <span class="at">save_table =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb103-809"><a href="#cb103-809" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(save_dir)) <span class="fu">dir.create</span>(save_dir, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb103-810"><a href="#cb103-810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-811"><a href="#cb103-811" aria-hidden="true" tabindex="-1"></a>  effects <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">fixef</span>(model)) <span class="sc">%&gt;%</span></span>
<span id="cb103-812"><a href="#cb103-812" aria-hidden="true" tabindex="-1"></a>    tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb103-813"><a href="#cb103-813" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>(Variable <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"(Intercept)"</span>, <span class="st">"Intercept"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb103-814"><a href="#cb103-814" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="fu">abs</span>(Estimate)))</span>
<span id="cb103-815"><a href="#cb103-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-816"><a href="#cb103-816" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(effects, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(Variable, <span class="fu">abs</span>(Estimate)), <span class="at">y =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb103-817"><a href="#cb103-817" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"skyblue"</span>) <span class="sc">+</span></span>
<span id="cb103-818"><a href="#cb103-818" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb103-819"><a href="#cb103-819" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb103-820"><a href="#cb103-820" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb103-821"><a href="#cb103-821" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Posterior Estimates (with 95% CI) -"</span>, model_name),</span>
<span id="cb103-822"><a href="#cb103-822" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Logit Coefficient"</span></span>
<span id="cb103-823"><a href="#cb103-823" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb103-824"><a href="#cb103-824" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>)</span>
<span id="cb103-825"><a href="#cb103-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-826"><a href="#cb103-826" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (save_plot) {</span>
<span id="cb103-827"><a href="#cb103-827" aria-hidden="true" tabindex="-1"></a>    plot_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(save_dir, <span class="fu">paste0</span>(<span class="st">"bayes_coef_plot_"</span>, model_name, <span class="st">".png"</span>))</span>
<span id="cb103-828"><a href="#cb103-828" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggsave</span>(plot_path, p, <span class="at">width =</span> <span class="dv">7</span>, <span class="at">height =</span> <span class="dv">5</span>)</span>
<span id="cb103-829"><a href="#cb103-829" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"✅ plot saves to: {plot_path}"</span>))</span>
<span id="cb103-830"><a href="#cb103-830" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb103-831"><a href="#cb103-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-832"><a href="#cb103-832" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (save_table) {</span>
<span id="cb103-833"><a href="#cb103-833" aria-hidden="true" tabindex="-1"></a>    table_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(save_dir, <span class="fu">paste0</span>(<span class="st">"bayes_coef_table_"</span>, model_name, <span class="st">".csv"</span>))</span>
<span id="cb103-834"><a href="#cb103-834" aria-hidden="true" tabindex="-1"></a>    readr<span class="sc">::</span><span class="fu">write_csv</span>(effects, table_path)</span>
<span id="cb103-835"><a href="#cb103-835" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"📄 tables saves to: {table_path}"</span>))</span>
<span id="cb103-836"><a href="#cb103-836" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb103-837"><a href="#cb103-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-838"><a href="#cb103-838" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">plot =</span> p, <span class="at">data =</span> effects))</span>
<span id="cb103-839"><a href="#cb103-839" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb103-840"><a href="#cb103-840" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb103-841"><a href="#cb103-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-842"><a href="#cb103-842" aria-hidden="true" tabindex="-1"></a><span class="fu">### comparions with shap values function</span></span>
<span id="cb103-843"><a href="#cb103-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-844"><a href="#cb103-844" aria-hidden="true" tabindex="-1"></a>the following three functions was meant to complete: compares bayesian model coefficients with SHAP values from lgbm models, specifically</span>
<span id="cb103-845"><a href="#cb103-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-846"><a href="#cb103-846" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>aligns variables and compares directionality (signs)</span>
<span id="cb103-847"><a href="#cb103-847" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>computes pearson correlation and direction match rate</span>
<span id="cb103-848"><a href="#cb103-848" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>visualizes SHAP vs bayesian coefficients in a scatter plot <span class="sc">\#</span> major goal: assessing model interpretability consistenct across frameworks</span>
<span id="cb103-849"><a href="#cb103-849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-852"><a href="#cb103-852" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb103-853"><a href="#cb103-853" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: shap values comparison function1 </span></span>
<span id="cb103-854"><a href="#cb103-854" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false </span></span>
<span id="cb103-855"><a href="#cb103-855" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true </span></span>
<span id="cb103-856"><a href="#cb103-856" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb103-857"><a href="#cb103-857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-858"><a href="#cb103-858" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== Function 1: Extract &amp; Match Coefficients with SHAP (robust version) ====</span></span>
<span id="cb103-859"><a href="#cb103-859" aria-hidden="true" tabindex="-1"></a>compare_bayes_vs_shap_data <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb103-860"><a href="#cb103-860" aria-hidden="true" tabindex="-1"></a>  bayes_model,</span>
<span id="cb103-861"><a href="#cb103-861" aria-hidden="true" tabindex="-1"></a>  shap_data,</span>
<span id="cb103-862"><a href="#cb103-862" aria-hidden="true" tabindex="-1"></a>  <span class="at">set_name =</span> <span class="st">"test"</span>,</span>
<span id="cb103-863"><a href="#cb103-863" aria-hidden="true" tabindex="-1"></a>  <span class="at">match_vars =</span> <span class="cn">NULL</span>,</span>
<span id="cb103-864"><a href="#cb103-864" aria-hidden="true" tabindex="-1"></a>  <span class="at">suffix =</span> <span class="st">"_raw"</span></span>
<span id="cb103-865"><a href="#cb103-865" aria-hidden="true" tabindex="-1"></a>) {</span>
<span id="cb103-866"><a href="#cb103-866" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 1. extract coef names from brms model</span></span>
<span id="cb103-867"><a href="#cb103-867" aria-hidden="true" tabindex="-1"></a>  coef_bayes <span class="ot">&lt;-</span> <span class="fu">fixef</span>(bayes_model)[, <span class="st">"Estimate"</span>]</span>
<span id="cb103-868"><a href="#cb103-868" aria-hidden="true" tabindex="-1"></a>  coef_names <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(coef_bayes), <span class="fu">c</span>(<span class="st">"(Intercept)"</span>, <span class="st">"Intercept"</span>))</span>
<span id="cb103-869"><a href="#cb103-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-870"><a href="#cb103-870" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2. build matching list of coef names (fuzzy matching to capture dummy expansions)</span></span>
<span id="cb103-871"><a href="#cb103-871" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(match_vars)) {</span>
<span id="cb103-872"><a href="#cb103-872" aria-hidden="true" tabindex="-1"></a>    vars_in_model <span class="ot">&lt;-</span> <span class="fu">character</span>(<span class="dv">0</span>)</span>
<span id="cb103-873"><a href="#cb103-873" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (mv <span class="cf">in</span> match_vars) {</span>
<span id="cb103-874"><a href="#cb103-874" aria-hidden="true" tabindex="-1"></a>      <span class="co"># try patterns: with suffix (e.g. leverage_pl_raw) and without suffix (leverage_pl)</span></span>
<span id="cb103-875"><a href="#cb103-875" aria-hidden="true" tabindex="-1"></a>      pat1 <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"^"</span>, mv, suffix)   <span class="co"># e.g. ^leverage_pl_raw</span></span>
<span id="cb103-876"><a href="#cb103-876" aria-hidden="true" tabindex="-1"></a>      pat2 <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"^"</span>, mv)           <span class="co"># e.g. ^leverage_pl</span></span>
<span id="cb103-877"><a href="#cb103-877" aria-hidden="true" tabindex="-1"></a>      matched <span class="ot">&lt;-</span> coef_names[<span class="fu">grepl</span>(<span class="fu">paste0</span>(pat1, <span class="st">"|"</span>, pat2), coef_names)]</span>
<span id="cb103-878"><a href="#cb103-878" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">length</span>(matched) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb103-879"><a href="#cb103-879" aria-hidden="true" tabindex="-1"></a>        vars_in_model <span class="ot">&lt;-</span> <span class="fu">c</span>(vars_in_model, matched)</span>
<span id="cb103-880"><a href="#cb103-880" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb103-881"><a href="#cb103-881" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb103-882"><a href="#cb103-882" aria-hidden="true" tabindex="-1"></a>    vars_in_model <span class="ot">&lt;-</span> <span class="fu">unique</span>(vars_in_model)</span>
<span id="cb103-883"><a href="#cb103-883" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb103-884"><a href="#cb103-884" aria-hidden="true" tabindex="-1"></a>    vars_in_model <span class="ot">&lt;-</span> coef_names</span>
<span id="cb103-885"><a href="#cb103-885" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb103-886"><a href="#cb103-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-887"><a href="#cb103-887" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(vars_in_model) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb103-888"><a href="#cb103-888" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"No matched variables found in Bayesian model. Please check match_vars and suffix."</span>)</span>
<span id="cb103-889"><a href="#cb103-889" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb103-890"><a href="#cb103-890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-891"><a href="#cb103-891" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 3. construct table mapping each matched coef name back to its base variable (var_clean)</span></span>
<span id="cb103-892"><a href="#cb103-892" aria-hidden="true" tabindex="-1"></a>  <span class="co">#    e.g. leverage_pl_raw1 -&gt; leverage_pl</span></span>
<span id="cb103-893"><a href="#cb103-893" aria-hidden="true" tabindex="-1"></a>  map_var_to_base <span class="ot">&lt;-</span> <span class="cf">function</span>(coef_name, match_vars, suffix) {</span>
<span id="cb103-894"><a href="#cb103-894" aria-hidden="true" tabindex="-1"></a>    <span class="co"># remove trailing numeric indexes and optional suffix to recover base name</span></span>
<span id="cb103-895"><a href="#cb103-895" aria-hidden="true" tabindex="-1"></a>    base <span class="ot">&lt;-</span> coef_name</span>
<span id="cb103-896"><a href="#cb103-896" aria-hidden="true" tabindex="-1"></a>    base <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_remove</span>(base, <span class="fu">paste0</span>(suffix, <span class="st">"[0-9]*$"</span>))   <span class="co"># drop _raw1/_raw2/_raw etc</span></span>
<span id="cb103-897"><a href="#cb103-897" aria-hidden="true" tabindex="-1"></a>    base <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_remove</span>(base, <span class="st">"[0-9]+$"</span>)                  <span class="co"># drop trailing digits (safety)</span></span>
<span id="cb103-898"><a href="#cb103-898" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if still not matching, try to find the match_var that is prefix</span></span>
<span id="cb103-899"><a href="#cb103-899" aria-hidden="true" tabindex="-1"></a>    hit <span class="ot">&lt;-</span> match_vars[<span class="fu">vapply</span>(match_vars, <span class="cf">function</span>(mv) <span class="fu">grepl</span>(<span class="fu">paste0</span>(<span class="st">"^"</span>, mv), base), <span class="fu">logical</span>(<span class="dv">1</span>))]</span>
<span id="cb103-900"><a href="#cb103-900" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(hit) <span class="sc">&gt;=</span> <span class="dv">1</span>) {</span>
<span id="cb103-901"><a href="#cb103-901" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(hit[<span class="dv">1</span>])</span>
<span id="cb103-902"><a href="#cb103-902" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb103-903"><a href="#cb103-903" aria-hidden="true" tabindex="-1"></a>      <span class="co"># fallback: drop numeric suffix after last underscore</span></span>
<span id="cb103-904"><a href="#cb103-904" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(stringr<span class="sc">::</span><span class="fu">str_remove</span>(base, <span class="st">"_[0-9]+$"</span>))</span>
<span id="cb103-905"><a href="#cb103-905" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb103-906"><a href="#cb103-906" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb103-907"><a href="#cb103-907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-908"><a href="#cb103-908" aria-hidden="true" tabindex="-1"></a>  var_clean_vec <span class="ot">&lt;-</span> <span class="fu">vapply</span>(vars_in_model, map_var_to_base, <span class="at">FUN.VALUE =</span> <span class="fu">character</span>(<span class="dv">1</span>), <span class="at">match_vars =</span> match_vars, <span class="at">suffix =</span> suffix)</span>
<span id="cb103-909"><a href="#cb103-909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-910"><a href="#cb103-910" aria-hidden="true" tabindex="-1"></a>  coef_bayes_tbl <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb103-911"><a href="#cb103-911" aria-hidden="true" tabindex="-1"></a>    <span class="at">var =</span> vars_in_model,</span>
<span id="cb103-912"><a href="#cb103-912" aria-hidden="true" tabindex="-1"></a>    <span class="at">coef_logit =</span> <span class="fu">as.numeric</span>(coef_bayes[vars_in_model]),</span>
<span id="cb103-913"><a href="#cb103-913" aria-hidden="true" tabindex="-1"></a>    <span class="at">var_clean =</span> var_clean_vec</span>
<span id="cb103-914"><a href="#cb103-914" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb103-915"><a href="#cb103-915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-916"><a href="#cb103-916" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 4. aggregate coefficients per var_clean (平均化各个 dummy 的系数)</span></span>
<span id="cb103-917"><a href="#cb103-917" aria-hidden="true" tabindex="-1"></a>  coef_bayes_agg <span class="ot">&lt;-</span> coef_bayes_tbl <span class="sc">%&gt;%</span></span>
<span id="cb103-918"><a href="#cb103-918" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">group_by</span>(var_clean) <span class="sc">%&gt;%</span></span>
<span id="cb103-919"><a href="#cb103-919" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb103-920"><a href="#cb103-920" aria-hidden="true" tabindex="-1"></a>      <span class="at">coef_logit =</span> <span class="fu">mean</span>(coef_logit, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb103-921"><a href="#cb103-921" aria-hidden="true" tabindex="-1"></a>      <span class="at">n_coefs =</span> dplyr<span class="sc">::</span><span class="fu">n</span>(),</span>
<span id="cb103-922"><a href="#cb103-922" aria-hidden="true" tabindex="-1"></a>      <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb103-923"><a href="#cb103-923" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb103-924"><a href="#cb103-924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-925"><a href="#cb103-925" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 5. ensure shap_data has 'set' column</span></span>
<span id="cb103-926"><a href="#cb103-926" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="st">"set"</span> <span class="sc">%in%</span> <span class="fu">names</span>(shap_data)) shap_data<span class="sc">$</span>set <span class="ot">&lt;-</span> set_name</span>
<span id="cb103-927"><a href="#cb103-927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-928"><a href="#cb103-928" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 6. prepare shap variables list (should correspond to var_clean)</span></span>
<span id="cb103-929"><a href="#cb103-929" aria-hidden="true" tabindex="-1"></a>  vars_shap <span class="ot">&lt;-</span> <span class="fu">unique</span>(coef_bayes_agg<span class="sc">$</span>var_clean)</span>
<span id="cb103-930"><a href="#cb103-930" aria-hidden="true" tabindex="-1"></a>  missing_vars <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(vars_shap, <span class="fu">colnames</span>(shap_data))</span>
<span id="cb103-931"><a href="#cb103-931" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(missing_vars) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb103-932"><a href="#cb103-932" aria-hidden="true" tabindex="-1"></a>    <span class="fu">warning</span>(glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"⚠️ Missing vars in shap_data and will be skipped: {paste(missing_vars, collapse = ', ')}"</span>))</span>
<span id="cb103-933"><a href="#cb103-933" aria-hidden="true" tabindex="-1"></a>    vars_shap <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(vars_shap, missing_vars)</span>
<span id="cb103-934"><a href="#cb103-934" aria-hidden="true" tabindex="-1"></a>    coef_bayes_agg <span class="ot">&lt;-</span> coef_bayes_agg <span class="sc">%&gt;%</span> <span class="fu">filter</span>(var_clean <span class="sc">%in%</span> vars_shap)</span>
<span id="cb103-935"><a href="#cb103-935" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb103-936"><a href="#cb103-936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-937"><a href="#cb103-937" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(vars_shap) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb103-938"><a href="#cb103-938" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"After checking shap_data, no overlapping variables remain for comparison."</span>)</span>
<span id="cb103-939"><a href="#cb103-939" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb103-940"><a href="#cb103-940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-941"><a href="#cb103-941" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 7. compute mean SHAP per variable (use new across lambda syntax to avoid deprecation warnings)</span></span>
<span id="cb103-942"><a href="#cb103-942" aria-hidden="true" tabindex="-1"></a>  shap_values <span class="ot">&lt;-</span> shap_data <span class="sc">%&gt;%</span></span>
<span id="cb103-943"><a href="#cb103-943" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(.data<span class="sc">$</span>set <span class="sc">==</span> set_name) <span class="sc">%&gt;%</span></span>
<span id="cb103-944"><a href="#cb103-944" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarise</span>(dplyr<span class="sc">::</span><span class="fu">across</span>(<span class="fu">all_of</span>(vars_shap), \(x) <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb103-945"><a href="#cb103-945" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"shap_var"</span>, <span class="at">values_to =</span> <span class="st">"shap_value"</span>)</span>
<span id="cb103-946"><a href="#cb103-946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-947"><a href="#cb103-947" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 8. combine aggregated bayes coefs with shap means</span></span>
<span id="cb103-948"><a href="#cb103-948" aria-hidden="true" tabindex="-1"></a>  comparison <span class="ot">&lt;-</span> coef_bayes_agg <span class="sc">%&gt;%</span></span>
<span id="cb103-949"><a href="#cb103-949" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">left_join</span>(shap_values, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"var_clean"</span> <span class="ot">=</span> <span class="st">"shap_var"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb103-950"><a href="#cb103-950" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb103-951"><a href="#cb103-951" aria-hidden="true" tabindex="-1"></a>      <span class="at">abs_coef_logit =</span> <span class="fu">abs</span>(coef_logit),</span>
<span id="cb103-952"><a href="#cb103-952" aria-hidden="true" tabindex="-1"></a>      <span class="at">abs_shap_value =</span> <span class="fu">abs</span>(shap_value),</span>
<span id="cb103-953"><a href="#cb103-953" aria-hidden="true" tabindex="-1"></a>      <span class="at">dir_logit =</span> <span class="fu">sign</span>(coef_logit),</span>
<span id="cb103-954"><a href="#cb103-954" aria-hidden="true" tabindex="-1"></a>      <span class="at">dir_shap =</span> dplyr<span class="sc">::</span><span class="fu">if_else</span>(shap_value <span class="sc">==</span> <span class="dv">0</span>, <span class="cn">NA_real_</span>, <span class="fu">sign</span>(shap_value)),</span>
<span id="cb103-955"><a href="#cb103-955" aria-hidden="true" tabindex="-1"></a>      <span class="at">direction_match =</span> (dir_logit <span class="sc">==</span> dir_shap),</span>
<span id="cb103-956"><a href="#cb103-956" aria-hidden="true" tabindex="-1"></a>      <span class="at">direction_mismatch =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(direction_match), <span class="cn">NA</span>, <span class="sc">!</span>direction_match)</span>
<span id="cb103-957"><a href="#cb103-957" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb103-958"><a href="#cb103-958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-959"><a href="#cb103-959" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 9. summary statistics (handle possible NA in correlations)</span></span>
<span id="cb103-960"><a href="#cb103-960" aria-hidden="true" tabindex="-1"></a>  pearson_cor <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(<span class="fu">cor</span>(comparison<span class="sc">$</span>coef_logit, comparison<span class="sc">$</span>shap_value, <span class="at">use =</span> <span class="st">"complete.obs"</span>), <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NA_real_</span>)</span>
<span id="cb103-961"><a href="#cb103-961" aria-hidden="true" tabindex="-1"></a>  abs_cor <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(<span class="fu">cor</span>(comparison<span class="sc">$</span>abs_coef_logit, comparison<span class="sc">$</span>abs_shap_value, <span class="at">use =</span> <span class="st">"complete.obs"</span>), <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NA_real_</span>)</span>
<span id="cb103-962"><a href="#cb103-962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-963"><a href="#cb103-963" aria-hidden="true" tabindex="-1"></a>  summary_stats <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb103-964"><a href="#cb103-964" aria-hidden="true" tabindex="-1"></a>    <span class="at">Direction_Match_Rate =</span> <span class="fu">mean</span>(comparison<span class="sc">$</span>direction_match, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb103-965"><a href="#cb103-965" aria-hidden="true" tabindex="-1"></a>    <span class="at">Pearson_Correlation =</span> pearson_cor,</span>
<span id="cb103-966"><a href="#cb103-966" aria-hidden="true" tabindex="-1"></a>    <span class="at">Abs_Value_Correlation =</span> abs_cor</span>
<span id="cb103-967"><a href="#cb103-967" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb103-968"><a href="#cb103-968" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-969"><a href="#cb103-969" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">summary =</span> summary_stats, <span class="at">detail =</span> comparison))</span>
<span id="cb103-970"><a href="#cb103-970" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb103-971"><a href="#cb103-971" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb103-972"><a href="#cb103-972" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-975"><a href="#cb103-975" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb103-976"><a href="#cb103-976" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: shap values comparison function2 </span></span>
<span id="cb103-977"><a href="#cb103-977" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false </span></span>
<span id="cb103-978"><a href="#cb103-978" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true </span></span>
<span id="cb103-979"><a href="#cb103-979" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb103-980"><a href="#cb103-980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-981"><a href="#cb103-981" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== Function 2: Plot SHAP vs Coefficients (adjusted) ====</span></span>
<span id="cb103-982"><a href="#cb103-982" aria-hidden="true" tabindex="-1"></a>plot_bayes_vs_shap <span class="ot">&lt;-</span> <span class="cf">function</span>(comparison_df, <span class="at">model_name =</span> <span class="cn">NULL</span>) {</span>
<span id="cb103-983"><a href="#cb103-983" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ensure expected cols exist</span></span>
<span id="cb103-984"><a href="#cb103-984" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(<span class="fu">c</span>(<span class="st">"coef_logit"</span>, <span class="st">"shap_value"</span>, <span class="st">"var_clean"</span>, <span class="st">"abs_shap_value"</span>, <span class="st">"direction_mismatch"</span>) <span class="sc">%in%</span> <span class="fu">colnames</span>(comparison_df))) {</span>
<span id="cb103-985"><a href="#cb103-985" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"comparison_df must contain columns: coef_logit, shap_value, var_clean, abs_shap_value, direction_mismatch"</span>)</span>
<span id="cb103-986"><a href="#cb103-986" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb103-987"><a href="#cb103-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-988"><a href="#cb103-988" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(comparison_df, ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> coef_logit, <span class="at">y =</span> shap_value, <span class="at">label =</span> var_clean)) <span class="sc">+</span></span>
<span id="cb103-989"><a href="#cb103-989" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">color =</span> abs_shap_value, <span class="at">shape =</span> direction_mismatch), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb103-990"><a href="#cb103-990" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(<span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.8</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb103-991"><a href="#cb103-991" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_color_gradient</span>(<span class="at">low =</span> <span class="st">"orange"</span>, <span class="at">high =</span> <span class="st">"red"</span>, <span class="at">name =</span> <span class="st">"Mean |SHAP|"</span>) <span class="sc">+</span></span>
<span id="cb103-992"><a href="#cb103-992" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">FALSE</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">16</span>, <span class="st">`</span><span class="at">TRUE</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">17</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Match"</span>, <span class="st">"Mismatch"</span>), <span class="at">name =</span> <span class="st">"Direction Match"</span>) <span class="sc">+</span></span>
<span id="cb103-993"><a href="#cb103-993" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray60"</span>) <span class="sc">+</span></span>
<span id="cb103-994"><a href="#cb103-994" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray60"</span>) <span class="sc">+</span></span>
<span id="cb103-995"><a href="#cb103-995" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb103-996"><a href="#cb103-996" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Posterior Mean (Bayesian logit)"</span>,</span>
<span id="cb103-997"><a href="#cb103-997" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Average SHAP Value (LGBM)"</span>,</span>
<span id="cb103-998"><a href="#cb103-998" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"SHAP vs Bayesian Coefficient Directions"</span>, <span class="fu">ifelse</span>(<span class="fu">is.null</span>(model_name), <span class="st">""</span>, <span class="fu">paste0</span>(<span class="st">" - "</span>, model_name)))</span>
<span id="cb103-999"><a href="#cb103-999" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb103-1000"><a href="#cb103-1000" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_minimal</span>()</span>
<span id="cb103-1001"><a href="#cb103-1001" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-1002"><a href="#cb103-1002" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(p)</span>
<span id="cb103-1003"><a href="#cb103-1003" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb103-1004"><a href="#cb103-1004" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb103-1005"><a href="#cb103-1005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-1008"><a href="#cb103-1008" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb103-1009"><a href="#cb103-1009" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: shap values comparison function3</span></span>
<span id="cb103-1010"><a href="#cb103-1010" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false </span></span>
<span id="cb103-1011"><a href="#cb103-1011" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true </span></span>
<span id="cb103-1012"><a href="#cb103-1012" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb103-1013"><a href="#cb103-1013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-1014"><a href="#cb103-1014" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== Function 3: Run batch comparisons safely (unchanged interface) ====</span></span>
<span id="cb103-1015"><a href="#cb103-1015" aria-hidden="true" tabindex="-1"></a>run_bayes_shap_all_models <span class="ot">&lt;-</span> <span class="cf">function</span>(model_list, shap_data, match_vars, <span class="at">set_name =</span> <span class="st">"test"</span>, <span class="at">suffix =</span> <span class="st">"_raw"</span>) {</span>
<span id="cb103-1016"><a href="#cb103-1016" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">imap</span>(model_list, <span class="sc">~</span>{</span>
<span id="cb103-1017"><a href="#cb103-1017" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tryCatch</span>({</span>
<span id="cb103-1018"><a href="#cb103-1018" aria-hidden="true" tabindex="-1"></a>      result <span class="ot">&lt;-</span> <span class="fu">compare_bayes_vs_shap_data</span>(</span>
<span id="cb103-1019"><a href="#cb103-1019" aria-hidden="true" tabindex="-1"></a>        <span class="at">bayes_model =</span> .x,</span>
<span id="cb103-1020"><a href="#cb103-1020" aria-hidden="true" tabindex="-1"></a>        <span class="at">shap_data   =</span> shap_data,</span>
<span id="cb103-1021"><a href="#cb103-1021" aria-hidden="true" tabindex="-1"></a>        <span class="at">set_name    =</span> set_name,</span>
<span id="cb103-1022"><a href="#cb103-1022" aria-hidden="true" tabindex="-1"></a>        <span class="at">match_vars  =</span> match_vars,</span>
<span id="cb103-1023"><a href="#cb103-1023" aria-hidden="true" tabindex="-1"></a>        <span class="at">suffix      =</span> suffix</span>
<span id="cb103-1024"><a href="#cb103-1024" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb103-1025"><a href="#cb103-1025" aria-hidden="true" tabindex="-1"></a>      result<span class="sc">$</span>plot <span class="ot">&lt;-</span> <span class="fu">plot_bayes_vs_shap</span>(result<span class="sc">$</span>detail, <span class="at">model_name =</span> .y)</span>
<span id="cb103-1026"><a href="#cb103-1026" aria-hidden="true" tabindex="-1"></a>      result</span>
<span id="cb103-1027"><a href="#cb103-1027" aria-hidden="true" tabindex="-1"></a>    }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb103-1028"><a href="#cb103-1028" aria-hidden="true" tabindex="-1"></a>      <span class="fu">message</span>(glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"❌ Model {.y} error: {e$message}"</span>))</span>
<span id="cb103-1029"><a href="#cb103-1029" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb103-1030"><a href="#cb103-1030" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb103-1031"><a href="#cb103-1031" aria-hidden="true" tabindex="-1"></a>  }) <span class="sc">%&gt;%</span> purrr<span class="sc">::</span><span class="fu">compact</span>()</span>
<span id="cb103-1032"><a href="#cb103-1032" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb103-1033"><a href="#cb103-1033" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb103-1034"><a href="#cb103-1034" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-1035"><a href="#cb103-1035" aria-hidden="true" tabindex="-1"></a><span class="fu">## Legis</span></span>
<span id="cb103-1036"><a href="#cb103-1036" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-1037"><a href="#cb103-1037" aria-hidden="true" tabindex="-1"></a><span class="fu">### model training</span></span>
<span id="cb103-1038"><a href="#cb103-1038" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-1041"><a href="#cb103-1041" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb103-1042"><a href="#cb103-1042" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: legis_discriminant model training</span></span>
<span id="cb103-1043"><a href="#cb103-1043" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false </span></span>
<span id="cb103-1044"><a href="#cb103-1044" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true </span></span>
<span id="cb103-1045"><a href="#cb103-1045" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb103-1046"><a href="#cb103-1046" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-1047"><a href="#cb103-1047" aria-hidden="true" tabindex="-1"></a>bayes_base_legis <span class="ot">&lt;-</span> <span class="fu">brm</span>(formula_base, <span class="at">data =</span> train_data_legis, <span class="at">family =</span> <span class="fu">bernoulli</span>(),</span>
<span id="cb103-1048"><a href="#cb103-1048" aria-hidden="true" tabindex="-1"></a>                        <span class="at">prior =</span> prior_base, <span class="at">iter =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">2</span>, <span class="at">seed =</span> <span class="dv">123</span>)</span>
<span id="cb103-1049"><a href="#cb103-1049" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-1050"><a href="#cb103-1050" aria-hidden="true" tabindex="-1"></a>bayes_intl_legis <span class="ot">&lt;-</span> <span class="fu">brm</span>(formula_intl, <span class="at">data =</span> train_data_legis, <span class="at">family =</span> <span class="fu">bernoulli</span>(),</span>
<span id="cb103-1051"><a href="#cb103-1051" aria-hidden="true" tabindex="-1"></a>                        <span class="at">prior =</span> prior_mechanism, <span class="at">iter =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">2</span>, <span class="at">seed =</span> <span class="dv">123</span>)</span>
<span id="cb103-1052"><a href="#cb103-1052" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-1053"><a href="#cb103-1053" aria-hidden="true" tabindex="-1"></a>bayes_intldom_legis <span class="ot">&lt;-</span> <span class="fu">brm</span>(formula_intldom, <span class="at">data =</span> train_data_legis, <span class="at">family =</span> <span class="fu">bernoulli</span>(),</span>
<span id="cb103-1054"><a href="#cb103-1054" aria-hidden="true" tabindex="-1"></a>                           <span class="at">prior =</span> prior_mechanism, <span class="at">iter =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">2</span>, <span class="at">seed =</span> <span class="dv">123</span>)</span>
<span id="cb103-1055"><a href="#cb103-1055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-1056"><a href="#cb103-1056" aria-hidden="true" tabindex="-1"></a>bayes_domprof_legis <span class="ot">&lt;-</span> <span class="fu">brm</span>(formula_domprof, <span class="at">data =</span> train_data_legis, <span class="at">family =</span> <span class="fu">bernoulli</span>(),</span>
<span id="cb103-1057"><a href="#cb103-1057" aria-hidden="true" tabindex="-1"></a>                           <span class="at">prior =</span> prior_mechanism, <span class="at">iter =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">2</span>, <span class="at">seed =</span> <span class="dv">123</span>)</span>
<span id="cb103-1058"><a href="#cb103-1058" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-1059"><a href="#cb103-1059" aria-hidden="true" tabindex="-1"></a>bayes_intlprof_legis <span class="ot">&lt;-</span> <span class="fu">brm</span>(formula_intlprof, <span class="at">data =</span> train_data_legis, <span class="at">family =</span> <span class="fu">bernoulli</span>(),</span>
<span id="cb103-1060"><a href="#cb103-1060" aria-hidden="true" tabindex="-1"></a>                            <span class="at">prior =</span> prior_mechanism, <span class="at">iter =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">2</span>, <span class="at">seed =</span> <span class="dv">123</span>)</span>
<span id="cb103-1061"><a href="#cb103-1061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-1062"><a href="#cb103-1062" aria-hidden="true" tabindex="-1"></a>bayes_match_legis <span class="ot">&lt;-</span> <span class="fu">brm</span>(formula_match, <span class="at">data =</span> train_data_legis, <span class="at">family =</span> <span class="fu">bernoulli</span>(),</span>
<span id="cb103-1063"><a href="#cb103-1063" aria-hidden="true" tabindex="-1"></a>                         <span class="at">prior =</span> prior_mechanism, <span class="at">iter =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">2</span>, <span class="at">seed =</span> <span class="dv">123</span>)</span>
<span id="cb103-1064"><a href="#cb103-1064" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb103-1065"><a href="#cb103-1065" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-1068"><a href="#cb103-1068" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb103-1069"><a href="#cb103-1069" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: legis_discriminant model results</span></span>
<span id="cb103-1070"><a href="#cb103-1070" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false </span></span>
<span id="cb103-1071"><a href="#cb103-1071" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true </span></span>
<span id="cb103-1072"><a href="#cb103-1072" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb103-1073"><a href="#cb103-1073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-1074"><a href="#cb103-1074" aria-hidden="true" tabindex="-1"></a><span class="co"># ----- LOO-CV -----</span></span>
<span id="cb103-1075"><a href="#cb103-1075" aria-hidden="true" tabindex="-1"></a>loo_legis_base     <span class="ot">&lt;-</span> <span class="fu">loo</span>(bayes_base_legis)</span>
<span id="cb103-1076"><a href="#cb103-1076" aria-hidden="true" tabindex="-1"></a>loo_legis_intl     <span class="ot">&lt;-</span> <span class="fu">loo</span>(bayes_intl_legis)</span>
<span id="cb103-1077"><a href="#cb103-1077" aria-hidden="true" tabindex="-1"></a>loo_legis_intldom  <span class="ot">&lt;-</span> <span class="fu">loo</span>(bayes_intldom_legis)</span>
<span id="cb103-1078"><a href="#cb103-1078" aria-hidden="true" tabindex="-1"></a>loo_legis_domprof  <span class="ot">&lt;-</span> <span class="fu">loo</span>(bayes_domprof_legis)</span>
<span id="cb103-1079"><a href="#cb103-1079" aria-hidden="true" tabindex="-1"></a>loo_legis_intlprof <span class="ot">&lt;-</span> <span class="fu">loo</span>(bayes_intlprof_legis)</span>
<span id="cb103-1080"><a href="#cb103-1080" aria-hidden="true" tabindex="-1"></a>loo_legis_match    <span class="ot">&lt;-</span> <span class="fu">loo</span>(bayes_match_legis)</span>
<span id="cb103-1081"><a href="#cb103-1081" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-1082"><a href="#cb103-1082" aria-hidden="true" tabindex="-1"></a><span class="co"># elpd_loo</span></span>
<span id="cb103-1083"><a href="#cb103-1083" aria-hidden="true" tabindex="-1"></a>loo_legis_intl<span class="sc">$</span>estimates[<span class="st">"elpd_loo"</span>, <span class="st">"Estimate"</span>]</span>
<span id="cb103-1084"><a href="#cb103-1084" aria-hidden="true" tabindex="-1"></a>loo_legis_intldom<span class="sc">$</span>estimates[<span class="st">"elpd_loo"</span>, <span class="st">"Estimate"</span>]</span>
<span id="cb103-1085"><a href="#cb103-1085" aria-hidden="true" tabindex="-1"></a>loo_legis_domprof<span class="sc">$</span>estimates[<span class="st">"elpd_loo"</span>, <span class="st">"Estimate"</span>]</span>
<span id="cb103-1086"><a href="#cb103-1086" aria-hidden="true" tabindex="-1"></a>loo_legis_intlprof<span class="sc">$</span>estimates[<span class="st">"elpd_loo"</span>, <span class="st">"Estimate"</span>]</span>
<span id="cb103-1087"><a href="#cb103-1087" aria-hidden="true" tabindex="-1"></a>loo_legis_match<span class="sc">$</span>estimates[<span class="st">"elpd_loo"</span>, <span class="st">"Estimate"</span>]</span>
<span id="cb103-1088"><a href="#cb103-1088" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-1089"><a href="#cb103-1089" aria-hidden="true" tabindex="-1"></a><span class="co"># comparison</span></span>
<span id="cb103-1090"><a href="#cb103-1090" aria-hidden="true" tabindex="-1"></a>loo_compare_legis <span class="ot">&lt;-</span> <span class="fu">loo_compare</span>(</span>
<span id="cb103-1091"><a href="#cb103-1091" aria-hidden="true" tabindex="-1"></a>  loo_legis_base, loo_legis_intl, loo_legis_intldom,</span>
<span id="cb103-1092"><a href="#cb103-1092" aria-hidden="true" tabindex="-1"></a>  loo_legis_domprof, loo_legis_intlprof, loo_legis_match</span>
<span id="cb103-1093"><a href="#cb103-1093" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb103-1094"><a href="#cb103-1094" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(loo_compare_legis)</span>
<span id="cb103-1095"><a href="#cb103-1095" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-1096"><a href="#cb103-1096" aria-hidden="true" tabindex="-1"></a><span class="co"># visualization</span></span>
<span id="cb103-1097"><a href="#cb103-1097" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(loo_compare_legis, <span class="at">label_points =</span> <span class="cn">TRUE</span>, <span class="at">main =</span> <span class="st">"Bayesian Legis Models: LOOIC Comparison"</span>)</span>
<span id="cb103-1098"><a href="#cb103-1098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-1099"><a href="#cb103-1099" aria-hidden="true" tabindex="-1"></a><span class="co"># ----- Bayesian R² -----</span></span>
<span id="cb103-1100"><a href="#cb103-1100" aria-hidden="true" tabindex="-1"></a>r2_mechanism_models_legis <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb103-1101"><a href="#cb103-1101" aria-hidden="true" tabindex="-1"></a>  <span class="at">Model =</span> <span class="fu">c</span>(<span class="st">"BASE-legis"</span>, <span class="st">"INTL-legis"</span>, <span class="st">"INTLDOM-legis"</span>, <span class="st">"DOMPROF-legis"</span>, <span class="st">"INTLPROF-legis"</span>, <span class="st">"MATCH-legis"</span>),</span>
<span id="cb103-1102"><a href="#cb103-1102" aria-hidden="true" tabindex="-1"></a>  <span class="at">Pseudo_R2 =</span> <span class="fu">c</span>(<span class="fu">bayes_r2_brms</span>(bayes_base_legis),</span>
<span id="cb103-1103"><a href="#cb103-1103" aria-hidden="true" tabindex="-1"></a>                <span class="fu">bayes_r2_brms</span>(bayes_intl_legis),</span>
<span id="cb103-1104"><a href="#cb103-1104" aria-hidden="true" tabindex="-1"></a>                <span class="fu">bayes_r2_brms</span>(bayes_intldom_legis),</span>
<span id="cb103-1105"><a href="#cb103-1105" aria-hidden="true" tabindex="-1"></a>                <span class="fu">bayes_r2_brms</span>(bayes_domprof_legis),</span>
<span id="cb103-1106"><a href="#cb103-1106" aria-hidden="true" tabindex="-1"></a>                <span class="fu">bayes_r2_brms</span>(bayes_intlprof_legis),</span>
<span id="cb103-1107"><a href="#cb103-1107" aria-hidden="true" tabindex="-1"></a>                <span class="fu">bayes_r2_brms</span>(bayes_match_legis))</span>
<span id="cb103-1108"><a href="#cb103-1108" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb103-1109"><a href="#cb103-1109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-1110"><a href="#cb103-1110" aria-hidden="true" tabindex="-1"></a><span class="co"># tables outprint</span></span>
<span id="cb103-1111"><a href="#cb103-1111" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(r2_mechanism_models_legis, <span class="at">caption =</span> <span class="st">"Bayesian Pseudo R² Comparison (Mechanism Models)"</span>)</span>
<span id="cb103-1112"><a href="#cb103-1112" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb103-1113"><a href="#cb103-1113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-1114"><a href="#cb103-1114" aria-hidden="true" tabindex="-1"></a><span class="fu">### variables importance comparison</span></span>
<span id="cb103-1115"><a href="#cb103-1115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-1118"><a href="#cb103-1118" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb103-1119"><a href="#cb103-1119" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: legis_discriminant variables importance comparison</span></span>
<span id="cb103-1120"><a href="#cb103-1120" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false </span></span>
<span id="cb103-1121"><a href="#cb103-1121" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true </span></span>
<span id="cb103-1122"><a href="#cb103-1122" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb103-1123"><a href="#cb103-1123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-1124"><a href="#cb103-1124" aria-hidden="true" tabindex="-1"></a>base_result     <span class="ot">&lt;-</span> <span class="fu">bayes_value_importance_v2</span>(bayes_base_legis, <span class="at">model_name =</span> <span class="st">"BASE-legis"</span>)</span>
<span id="cb103-1125"><a href="#cb103-1125" aria-hidden="true" tabindex="-1"></a>intl_result     <span class="ot">&lt;-</span> <span class="fu">bayes_value_importance_v2</span>(bayes_intl_legis, <span class="at">model_name =</span> <span class="st">"INTL-legis"</span>)</span>
<span id="cb103-1126"><a href="#cb103-1126" aria-hidden="true" tabindex="-1"></a>intldom_result  <span class="ot">&lt;-</span> <span class="fu">bayes_value_importance_v2</span>(bayes_intldom_legis, <span class="at">model_name =</span> <span class="st">"INTLDOM-legis"</span>)</span>
<span id="cb103-1127"><a href="#cb103-1127" aria-hidden="true" tabindex="-1"></a>domprof_result  <span class="ot">&lt;-</span> <span class="fu">bayes_value_importance_v2</span>(bayes_domprof_legis, <span class="at">model_name =</span> <span class="st">"DOMPROF-legis"</span>)</span>
<span id="cb103-1128"><a href="#cb103-1128" aria-hidden="true" tabindex="-1"></a>intlprof_result <span class="ot">&lt;-</span> <span class="fu">bayes_value_importance_v2</span>(bayes_intlprof_legis, <span class="at">model_name =</span> <span class="st">"INTLPROF-legis"</span>)</span>
<span id="cb103-1129"><a href="#cb103-1129" aria-hidden="true" tabindex="-1"></a>match_result    <span class="ot">&lt;-</span> <span class="fu">bayes_value_importance_v2</span>(bayes_match_legis, <span class="at">model_name =</span> <span class="st">"MATCH-legis"</span>)</span>
<span id="cb103-1130"><a href="#cb103-1130" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb103-1131"><a href="#cb103-1131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-1132"><a href="#cb103-1132" aria-hidden="true" tabindex="-1"></a><span class="fu">### comparions with shap values</span></span>
<span id="cb103-1133"><a href="#cb103-1133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-1136"><a href="#cb103-1136" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb103-1137"><a href="#cb103-1137" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: legis_discriminant comparions with shap values</span></span>
<span id="cb103-1138"><a href="#cb103-1138" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false </span></span>
<span id="cb103-1139"><a href="#cb103-1139" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true </span></span>
<span id="cb103-1140"><a href="#cb103-1140" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb103-1141"><a href="#cb103-1141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-1142"><a href="#cb103-1142" aria-hidden="true" tabindex="-1"></a>legis_model_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb103-1143"><a href="#cb103-1143" aria-hidden="true" tabindex="-1"></a>  <span class="at">INTL      =</span> bayes_intl_legis,</span>
<span id="cb103-1144"><a href="#cb103-1144" aria-hidden="true" tabindex="-1"></a>  <span class="at">INTLDOM   =</span> bayes_intldom_legis,</span>
<span id="cb103-1145"><a href="#cb103-1145" aria-hidden="true" tabindex="-1"></a>  <span class="at">DOMPROF   =</span> bayes_domprof_legis,</span>
<span id="cb103-1146"><a href="#cb103-1146" aria-hidden="true" tabindex="-1"></a>  <span class="at">INTLPROF  =</span> bayes_intlprof_legis,</span>
<span id="cb103-1147"><a href="#cb103-1147" aria-hidden="true" tabindex="-1"></a>  <span class="at">MATCH     =</span> bayes_match_legis</span>
<span id="cb103-1148"><a href="#cb103-1148" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb103-1149"><a href="#cb103-1149" aria-hidden="true" tabindex="-1"></a>results_legis <span class="ot">&lt;-</span> <span class="fu">run_bayes_shap_all_models</span>(legis_model_list, legis_all, match_vars)</span>
<span id="cb103-1150"><a href="#cb103-1150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-1151"><a href="#cb103-1151" aria-hidden="true" tabindex="-1"></a>summary_legis_shap <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">imap_dfr</span>(results_legis, <span class="sc">~</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb103-1152"><a href="#cb103-1152" aria-hidden="true" tabindex="-1"></a>  <span class="at">Model =</span> .y,</span>
<span id="cb103-1153"><a href="#cb103-1153" aria-hidden="true" tabindex="-1"></a>  <span class="at">Direction_Match_Rate =</span> .x<span class="sc">$</span>summary<span class="sc">$</span>Direction_Match_Rate,</span>
<span id="cb103-1154"><a href="#cb103-1154" aria-hidden="true" tabindex="-1"></a>  <span class="at">Pearson_Correlation   =</span> .x<span class="sc">$</span>summary<span class="sc">$</span>Pearson_Correlation,</span>
<span id="cb103-1155"><a href="#cb103-1155" aria-hidden="true" tabindex="-1"></a>  <span class="at">Abs_Correlation       =</span> .x<span class="sc">$</span>summary<span class="sc">$</span>Abs_Value_Correlation</span>
<span id="cb103-1156"><a href="#cb103-1156" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb103-1157"><a href="#cb103-1157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-1158"><a href="#cb103-1158" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(summary_legis_shap)</span>
<span id="cb103-1159"><a href="#cb103-1159" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




<script src="robustness_analysis_files/libs/quarto-html/zenscroll-min.js"></script>
</body></html>