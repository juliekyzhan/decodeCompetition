dem_model2 <- lm(prof_percentage ~ ideology +  gender + chamber + seniority +
high_edu_share +  foreign_born_ratio + asian_ratio +
white_ratio + black_or_african_american_ratio + agriculture_share + factor(congress),
data = dem_legis
)
summary(dem_model2)
tidy(dem_model2, conf.int = TRUE)
# 四、模型诊断与比较
# 1. 检查多重共线性
vif(dem_model1)
vif(dem_model2)
# 2. 模型比较表
modelsummary(
list(
"Model 1: Simple-ideology" = dem_model,
"Model 2: Individual controls" = dem_model1,
"Model 3: District controls(age)" = dem_model2
),
fmt = 3,
stars = TRUE,
output = file.path(output_dir, "linear_legis_dem_ideology_prof.html"),
escape = FALSE
)
# 五、可视化：边际效应（Marginal Effects）
ideology_effect2 <- ggpredict(dem_model2, terms = "seniority [all]")
plot(ideology_effect2) +
labs(
title = "Marginal Effect (control district)",
x = "Seniority",
y = "Prof_percentage"
) +
theme_minimal(base_size = 14)
#| label: individual_analysis_linear_dem_ideology_dom
#| echo: false
# 初始模型
dem_model <- lm(dom_percentage ~ ideology + factor(congress),
data = dem_legis)
summary(dem_model)
tidy(dem_model, conf.int = TRUE)
# 加入个人特质作为控制变量
dem_model1 <- lm(dom_percentage ~ ideology +  gender + chamber + age + factor(congress),
data = dem_legis)
summary(dem_model1)
tidy(dem_model, conf.int = TRUE)
# 加入选区变量作为控制变量
dem_model2 <- lm(dom_percentage ~ ideology +  gender + chamber + seniority +
high_edu_share +  foreign_born_ratio + asian_ratio +
white_ratio + black_or_african_american_ratio + agriculture_share + factor(congress),
data = dem_legis
)
summary(dem_model2)
tidy(dem_model2, conf.int = TRUE)
# 四、模型诊断与比较
# 1. 检查多重共线性
vif(dem_model1)
vif(dem_model2)
# 2. 模型比较表
modelsummary(
list(
"Model 1: Simple-ideology" = dem_model,
"Model 2: Individual controls" = dem_model1,
"Model 3: District controls(age)" = dem_model2
),
fmt = 3,
stars = TRUE,
output = file.path(output_dir, "linear_legis_dem_ideology_dom.html"),
escape = FALSE
)
# 五、可视化：边际效应（Marginal Effects）
ideology_effect2 <- ggpredict(dem_model2, terms = "seniority [all]")
plot(ideology_effect2) +
labs(
title = "Marginal Effect (control district)",
x = "Seniority",
y = "Dom_percentage"
) +
theme_minimal(base_size = 14)
#| label: individual_analysis_linear_seniority_and_party
#| echo: false
# 初始模型
model1 <- lm(dom_percentage ~ party * seniority + factor(congress),
data = legis_merged)
# 加入个人特质作为控制变量
model2 <- lm(dom_percentage ~  party * seniority + gender  + chamber + factor(congress),
data = legis_merged)
# 加入选区变量作为控制变量
model3 <- lm(dom_percentage ~ party * seniority + gender  + chamber +
high_edu_share +  foreign_born_ratio + asian_ratio +
white_ratio + black_or_african_american_ratio + agriculture_share + factor(congress),
data = legis_merged
)
# 模型比较表
modelsummary(
list(
"Model 1: Party&Seniority interaction" = dem_model,
"Model 2: Individual controls" = dem_model1,
"Model 3: District controls" = dem_model2
),
fmt = 3,
stars = TRUE,
output = file.path(output_dir, "linear_legis_party_seniority_interaction.html"),
escape = FALSE
)
#| label: individual_analysis_linear_seniority_and_party
#| echo: false
# 初始模型
model1 <- lm(dom_percentage ~ party * seniority + factor(congress),
data = legis_merged)
# 加入个人特质作为控制变量
model2 <- lm(dom_percentage ~  party * seniority + gender  + chamber + factor(congress),
data = legis_merged)
# 加入选区变量作为控制变量
model3 <- lm(dom_percentage ~ party * seniority + gender  + chamber +
high_edu_share +  foreign_born_ratio + asian_ratio +
white_ratio + black_or_african_american_ratio + agriculture_share + factor(congress),
data = legis_merged
)
# 模型比较表
modelsummary(
list(
"Model 1: Party&Seniority interaction" = model1,
"Model 2: Individual controls" = model2,
"Model 3: District controls" = model3
),
fmt = 3,
stars = TRUE,
output = file.path(output_dir, "linear_legis_party_seniority_interaction.html"),
escape = FALSE
)
names(legis_cg)
names(legis_sum1)
#| label: party based committees prof_percentage difference
#| echo: false
# 1. 计算每个委员会中民主党议员的占比
committee_party_ratio <- legis_sum1 %>%
group_by(committee_el, party) %>%
summarise(
party_count = n(),
total_count = n_distinct(full_name),
party_ratio = party_count / total_count,
.groups = "drop"
) %>%
filter(party == "Democratic")
# 2. 筛选出民主党议员占比多的委员会（可以设定一个阈值）
democratic_committees <- committee_party_ratio %>%
filter(party_ratio > 0.5)  # 这里阈值可以调整，比如选取民主党占比大于50%的委员会
# 3. 对每个委员会计算专业模式占比（importance_prof）
committee_prof_percentage <- legis_sum1 %>%
group_by(committee_el) %>%
summarise(
avg_prof_percentage = mean(importance_prof, na.rm = TRUE),
.groups = "drop"
)
# 4. 合并民主党占比高的委员会与其专业模式占比
democratic_committees_with_prof <- democratic_committees %>%
left_join(committee_prof_percentage, by = "committee_el")
# 5. 对比民主党议员占比高的委员会和共和党占比高的委员会在专业模式占比上的差异
# 计算共和党议员占比高的委员会
republican_committees <- committee_party_ratio %>%
filter(party == "Republican" & party_ratio > 0.5)
# 6. 计算共和党占比高的委员会的专业模式占比
republican_committees_with_prof <- republican_committees %>%
left_join(committee_prof_percentage, by = "committee_el")
# 7. 合并两部分数据
all_committees_prof <- bind_rows(
democratic_committees_with_prof %>% mutate(party_group = "Democratic"),
republican_committees_with_prof %>% mutate(party_group = "Republican")
)
# 8. 可视化：比较两类委员会的专业模式占比
ggplot(all_committees_prof, aes(x = party_group, y = avg_prof_percentage, fill = party_group)) +
geom_bar(stat = "identity", position = "dodge", color = "black") +
labs(
title = "Professional Mode Percentage by Party in Committees with High Party Representation",
x = "Party Group",
y = "Average Professional Mode Percentage"
) +
theme_minimal(base_size = 13) +
scale_fill_manual(values = c("Democratic" = "#2E74C0", "Republican" = "#CB454A"))
# 9. 对比两组的显著性，使用 t 检验
t_test_result <- t.test(
avg_prof_percentage ~ party_group, data = all_committees_prof
)
View(all_committees_prof)
View(republican_committees)
#| label: party based committees prof_percentage difference
#| echo: false
# 1. 计算每个委员会中民主党议员的占比
committee_party_ratio <- legis_sum1 %>%
group_by(committee_el, party) %>%
summarise(
party_count = n(),
total_count = n_distinct(full_name),
party_ratio = party_count / total_count,
.groups = "drop"
)
# 2. 筛选出民主党议员占比多的委员会（可以设定一个阈值）
democratic_committees <- committee_party_ratio %>%
filter(party_ratio > 0.5)  # 这里阈值可以调整，比如选取民主党占比大于50%的委员会
# 3. 对每个委员会计算专业模式占比（importance_prof）
committee_prof_percentage <- legis_sum1 %>%
group_by(committee_el) %>%
summarise(
avg_prof_percentage = mean(importance_prof, na.rm = TRUE),
.groups = "drop"
)
# 4. 合并民主党占比高的委员会与其专业模式占比
democratic_committees_with_prof <- democratic_committees %>%
left_join(committee_prof_percentage, by = "committee_el")
# 5. 对比民主党议员占比高的委员会和共和党占比高的委员会在专业模式占比上的差异
# 计算共和党议员占比高的委员会
republican_committees <- committee_party_ratio %>%
filter(party == "Republican" & party_ratio > 0.5)
# 6. 计算共和党占比高的委员会的专业模式占比
republican_committees_with_prof <- republican_committees %>%
left_join(committee_prof_percentage, by = "committee_el")
# 7. 合并两部分数据
all_committees_prof <- bind_rows(
democratic_committees_with_prof %>% mutate(party_group = "Democratic"),
republican_committees_with_prof %>% mutate(party_group = "Republican")
)
# 8. 可视化：比较两类委员会的专业模式占比
ggplot(all_committees_prof, aes(x = party_group, y = avg_prof_percentage, fill = party_group)) +
geom_bar(stat = "identity", position = "dodge", color = "black") +
labs(
title = "Professional Mode Percentage by Party in Committees with High Party Representation",
x = "Party Group",
y = "Average Professional Mode Percentage"
) +
theme_minimal(base_size = 13) +
scale_fill_manual(values = c("Democratic" = "#2E74C0", "Republican" = "#CB454A"))
# 9. 对比两组的显著性，使用 t 检验
t_test_result <- t.test(
avg_prof_percentage ~ party_group, data = all_committees_prof
)
# 查看 t 检验结果
print(t_test_result)
View(committee_party_ratio)
names(committee_party_ratio)
#| label: party based committees prof_percentage difference
#| echo: false
# 1. 计算每个委员会中民主党和共和党议员的占比
committee_party_ratio <- legis_sum1 %>%
group_by(committee_el, party) %>%
summarise(
party_count = n(),
total_count = n_distinct(full_name),
party_ratio = party_count / total_count,
.groups = "drop"
)
# 2. 计算每个委员会中民主党和共和党的占比
democratic_committees <- committee_party_ratio %>%
filter(party == "Democratic") %>%
left_join(
committee_party_ratio %>% filter(party == "Republican"),
by = "committee_el",
suffix = c("_dem", "_rep")
) %>%
# 3. 筛选出民主党占比大于共和党占比的委员会
filter(party_ratio_dem > party_ratio_rep) %>%
select(committee_el, party_ratio_dem, party_ratio_rep)  # 只保留委员会和两党的占比
#| label: party based committees prof_percentage difference
#| echo: false
# 1. 计算每个委员会中民主党和共和党议员的占比
committee_party_ratio <- legis_sum1 %>%
group_by(committee_el, party) %>%
summarise(
party_count = n(),
total_count = n_distinct(full_name),
party_ratio = party_count / total_count,
.groups = "drop"
)
# 2. 计算每个委员会中民主党和共和党的占比
democratic_committees <- committee_party_ratio %>%
filter(party == "Democratic") %>%
left_join(
committee_party_ratio %>% filter(party == "Republican"),
by = "committee_el",
suffix = c("_dem", "_rep")
) %>%
# 3. 筛选出民主党占比大于共和党占比的委员会
filter(party_ratio_dem > party_ratio_rep) %>%
dylpr::select(committee_el, party_ratio_dem, party_ratio_rep)  # 只保留委员会和两党的占比
#| label: party based committees prof_percentage difference
#| echo: false
# 1. 计算每个委员会中民主党和共和党议员的占比
committee_party_ratio <- legis_sum1 %>%
group_by(committee_el, party) %>%
summarise(
party_count = n(),
total_count = n_distinct(full_name),
party_ratio = party_count / total_count,
.groups = "drop"
)
# 2. 计算每个委员会中民主党和共和党的占比
democratic_committees <- committee_party_ratio %>%
filter(party == "Democratic") %>%
left_join(
committee_party_ratio %>% filter(party == "Republican"),
by = "committee_el",
suffix = c("_dem", "_rep")
) %>%
# 3. 筛选出民主党占比大于共和党占比的委员会
filter(party_ratio_dem > party_ratio_rep) %>%
dplyr::select(committee_el, party_ratio_dem, party_ratio_rep)  # 只保留委员会和两党的占比
# 查看筛选结果
print(democratic_committees)
# 4. 计算这些委员会的专业模式占比
committee_prof_percentage <- legis_sum1 %>%
filter(committee_el %in% democratic_committees$committee_el) %>%
group_by(committee_el) %>%
summarise(
avg_prof_percentage = mean(importance_prof, na.rm = TRUE),
.groups = "drop"
)
# 5. 可视化民主党占比高的委员会在专业模式中的占比
ggplot(committee_prof_percentage, aes(x = committee_el, y = avg_prof_percentage, fill = "Democratic")) +
geom_bar(stat = "identity", position = "dodge", color = "black") +
coord_flip() +
labs(
title = "Professional Mode Percentage in Committees with Higher Democratic Representation",
x = "Committee",
y = "Average Professional Mode Percentage"
) +
theme_minimal(base_size = 13) +
scale_fill_manual(values = c("Democratic" = "#2E74C0"))
# 9. 对比两组的显著性，使用 t 检验
t_test_result <- t.test(
avg_prof_percentage ~ party_group, data = all_committees_prof
)
# 查看 t 检验结果
print(t_test_result)
#| label: party based committees prof_percentage difference
#| echo: false
# 1. 计算每个委员会中民主党和共和党议员的占比
committee_party_ratio <- legis_sum1 %>%
group_by(committee_el, party) %>%
summarise(
party_count = n(),
total_count = n_distinct(full_name),
party_ratio = party_count / total_count,
.groups = "drop"
)
# 2. 计算每个委员会中民主党和共和党的占比，并比较
committee_party_comparison <- committee_party_ratio %>%
filter(party %in% c("Democratic", "Republican")) %>%
spread(key = party, value = party_ratio) %>%
rename(
party_ratio_dem = Democratic,
party_ratio_rep = Republican
) %>%
# 3. 筛选出民主党占比大于共和党占比的委员会
filter(party_ratio_dem > party_ratio_rep)
# 查看筛选结果
print(committee_party_comparison)
# 4. 计算这些委员会的专业模式占比（包括两党）
committee_prof_percentage <- legis_sum1 %>%
filter(committee_el %in% committee_party_comparison$committee_el) %>%
group_by(committee_el, party) %>%
summarise(
avg_prof_percentage = mean(importance_prof, na.rm = TRUE),
.groups = "drop"
)
# 5. 可视化民主党和共和党在这些委员会中的专业模式占比
ggplot(committee_prof_percentage, aes(x = committee_el, y = avg_prof_percentage, fill = party)) +
geom_bar(stat = "identity", position = "dodge", color = "black") +
coord_flip() +
labs(
title = "Professional Mode Percentage by Party in Committees with Higher Democratic Representation",
x = "Committee",
y = "Average Professional Mode Percentage"
) +
theme_minimal(base_size = 13) +
scale_fill_manual(values = c("Democratic" = "#2E74C0", "Republican" = "#CB454A"))
# 6. 对比两组的显著性，使用 t 检验
# 创建一个新的数据框来比较民主党和共和党的专业模式占比
all_committees_prof <- legis_sum1 %>%
filter(committee_el %in% committee_party_comparison$committee_el) %>%
mutate(party_group = ifelse(party == "Democratic", "Democratic", "Republican"))
# 进行 t 检验
t_test_result <- t.test(
avg_prof_percentage ~ party_group, data = committee_prof_percentage
)
View(committee_party_comparison)
# 1. 计算每个委员会中民主党和共和党议员的占比
committee_party_ratio <- legis_sum1 %>%
group_by(committee_el, party) %>%
summarise(
party_count = n(),
total_count = n_distinct(full_name),
party_ratio = party_count / total_count,
.groups = "drop"
)
# 2. 计算每个委员会中民主党和共和党的占比，并比较
committee_party_comparison <- committee_party_ratio %>%
filter(party %in% c("Democratic", "Republican")) %>%
# 使用 pivot_wider 来替代 spread
pivot_wider(names_from = party, values_from = party_ratio) %>%
rename(
party_ratio_dem = Democratic,
party_ratio_rep = Republican
) %>%
# 3. 筛选出民主党占比大于共和党占比的委员会
filter(party_ratio_dem > party_ratio_rep)
names(committee_party_ratio)
# 1. 计算每个委员会中民主党和共和党议员的占比
committee_party_ratio <- legis_sum1 %>%
group_by(committee_el, party) %>%
summarise(
party_count = n(),
total_count = n_distinct(full_name),
party_ratio = party_count / total_count,
.groups = "drop"
)
# 2. 计算每个委员会中民主党和共和党的占比，并比较
committee_party_comparison <- committee_party_ratio %>%
filter(party %in% c("Democratic", "Republican")) %>%
pivot_wider(
names_from = party,  # 将 party 列的值变为列名
values_from = party_ratio,  # 将 party_ratio 值填充到相应列
values_fn = list(party_ratio = mean),  # 处理重复数据（如果有）时，取平均
values_fill = list(party_ratio = 0)  # 如果某个党派没有出现，填充0
) %>%
rename(
party_ratio_dem = Democratic,
party_ratio_rep = Republican
) %>%
# 3. 筛选出民主党占比大于共和党占比的委员会
filter(party_ratio_dem > party_ratio_rep)
# 查看筛选结果
print(committee_party_comparison)
#| label: party based committees prof_percentage difference
#| echo: false
# 1. 计算每个委员会中民主党和共和党议员的占比
committee_party_ratio <- legis_sum1 %>%
group_by(committee_el, party) %>%
summarise(
party_count = n(),
total_count = n_distinct(full_name),
party_ratio = party_count / total_count,
.groups = "drop"
)
# 2. 计算每个委员会中民主党和共和党的占比，并比较
committee_party_comparison <- committee_party_ratio %>%
filter(party %in% c("Democratic", "Republican")) %>%
pivot_wider(
names_from = party,  # 将 party 列的值变为列名
values_from = party_ratio,  # 将 party_ratio 值填充到相应列
values_fn = list(party_ratio = mean),  # 处理重复数据（如果有）时，取平均
values_fill = list(party_ratio = 0)  # 如果某个党派没有出现，填充0
) %>%
rename(
party_ratio_dem = Democratic,
party_ratio_rep = Republican
)
# 查看筛选结果
print(committee_party_comparison)
# 4. 计算这些委员会的专业模式占比（包括两党）
committee_prof_percentage <- legis_sum1 %>%
filter(committee_el %in% committee_party_comparison$committee_el) %>%
group_by(committee_el, party) %>%
summarise(
avg_prof_percentage = mean(importance_prof, na.rm = TRUE),
.groups = "drop"
)
# 5. 可视化民主党和共和党在这些委员会中的专业模式占比
ggplot(committee_prof_percentage, aes(x = committee_el, y = avg_prof_percentage, fill = party)) +
geom_bar(stat = "identity", position = "dodge", color = "black") +
coord_flip() +
labs(
title = "Professional Mode Percentage by Party in Committees with Higher Democratic Representation",
x = "Committee",
y = "Average Professional Mode Percentage"
) +
theme_minimal(base_size = 13) +
scale_fill_manual(values = c("Democratic" = "#2E74C0", "Republican" = "#CB454A"))
# 6. 对比两组的显著性，使用 t 检验
# 创建一个新的数据框来比较民主党和共和党的专业模式占比
all_committees_prof <- legis_sum1 %>%
filter(committee_el %in% committee_party_comparison$committee_el) %>%
mutate(party_group = ifelse(party == "Democratic", "Democratic", "Republican"))
# 进行 t 检验
t_test_result <- t.test(
avg_prof_percentage ~ party_group, data = committee_prof_percentage
)
# 1. 计算每个委员会中民主党和共和党议员的占比
committee_party_ratio <- legis_sum1 %>%
group_by(committee_el, party) %>%
summarise(
party_count = n(),
total_count = n_distinct(full_name),
party_ratio = party_count / total_count,
.groups = "drop"
)
# 2. 计算每个委员会中民主党和共和党的占比，并比较
committee_party_comparison <- committee_party_ratio %>%
filter(party %in% c("Democratic", "Republican")) %>%
pivot_wider(
names_from = party,  # 将 party 列的值变为列名
values_from = party_ratio,  # 将 party_ratio 值填充到相应列
values_fn = list(party_ratio = mean),  # 处理重复数据（如果有）时，取平均
values_fill = list(party_ratio = 0)  # 如果某个党派没有出现，填充0
) %>%
rename(
party_ratio_dem = Democratic,
party_ratio_rep = Republican
) %>%
# 3. 筛选出民主党占比大于共和党占比的委员会
filter(party_ratio_dem > party_ratio_rep)
View(committee_prof_percentage)
View(bills_data)
View(legis_cg)
View(bills_data)
