<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Kunya Zhan">
<meta name="dcterms.date" content="2025-10-31">

<title>robustness-analysis-bayesian</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="robustness_analysis_files/libs/clipboard/clipboard.min.js"></script>
<script src="robustness_analysis_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="robustness_analysis_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="robustness_analysis_files/libs/quarto-html/popper.min.js"></script>
<script src="robustness_analysis_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="robustness_analysis_files/libs/quarto-html/anchor.min.js"></script>
<link href="robustness_analysis_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="robustness_analysis_files/libs/quarto-html/quarto-syntax-highlighting-fe91322616dd2b9cea8bc6bfc6aa44e1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="robustness_analysis_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="robustness_analysis_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="robustness_analysis_files/libs/bootstrap/bootstrap-6f1071c4549ec1672fc8885a20292773.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<style>html{ scroll-behavior: smooth; }</style>
<link href="robustness_analysis_files/libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="robustness_analysis_files/libs/pagedtable-1.1/js/pagedtable.js"></script>


</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#robustness-analysis" id="toc-robustness-analysis" class="nav-link active" data-scroll-target="#robustness-analysis"><span class="header-section-number">1</span> Robustness Analysis</a>
  <ul class="collapse">
  <li><a href="#set-up" id="toc-set-up" class="nav-link" data-scroll-target="#set-up"><span class="header-section-number">1.1</span> set up</a></li>
  <li><a href="#packages-installing-if-not-already-installed" id="toc-packages-installing-if-not-already-installed" class="nav-link" data-scroll-target="#packages-installing-if-not-already-installed"><span class="header-section-number">1.2</span> Packages Installing if not already installed</a></li>
  </ul></li>
  <li><a href="#data-cleansing" id="toc-data-cleansing" class="nav-link" data-scroll-target="#data-cleansing"><span class="header-section-number">2</span> Data cleansing</a>
  <ul class="collapse">
  <li><a href="#data-acquisition" id="toc-data-acquisition" class="nav-link" data-scroll-target="#data-acquisition"><span class="header-section-number">2.1</span> data acquisition</a></li>
  <li><a href="#constructing-train-and-test-data" id="toc-constructing-train-and-test-data" class="nav-link" data-scroll-target="#constructing-train-and-test-data"><span class="header-section-number">2.2</span> constructing train and test data</a></li>
  </ul></li>
  <li><a href="#predictive-validity" id="toc-predictive-validity" class="nav-link" data-scroll-target="#predictive-validity"><span class="header-section-number">3</span> Predictive Validity</a>
  <ul class="collapse">
  <li><a href="#model-preparations" id="toc-model-preparations" class="nav-link" data-scroll-target="#model-preparations"><span class="header-section-number">3.1</span> model preparations</a></li>
  <li><a href="#adver" id="toc-adver" class="nav-link" data-scroll-target="#adver"><span class="header-section-number">3.2</span> Adver</a>
  <ul class="collapse">
  <li><a href="#model-training" id="toc-model-training" class="nav-link" data-scroll-target="#model-training"><span class="header-section-number">3.2.1</span> model training</a></li>
  <li><a href="#posterior-diagnosis" id="toc-posterior-diagnosis" class="nav-link" data-scroll-target="#posterior-diagnosis"><span class="header-section-number">3.2.2</span> posterior diagnosis</a></li>
  <li><a href="#auc-comparison" id="toc-auc-comparison" class="nav-link" data-scroll-target="#auc-comparison"><span class="header-section-number">3.2.3</span> auc comparison</a></li>
  </ul></li>
  <li><a href="#legis" id="toc-legis" class="nav-link" data-scroll-target="#legis"><span class="header-section-number">3.3</span> Legis</a>
  <ul class="collapse">
  <li><a href="#model-training-1" id="toc-model-training-1" class="nav-link" data-scroll-target="#model-training-1"><span class="header-section-number">3.3.1</span> model training</a></li>
  <li><a href="#posterior-diagnosis-1" id="toc-posterior-diagnosis-1" class="nav-link" data-scroll-target="#posterior-diagnosis-1"><span class="header-section-number">3.3.2</span> posterior diagnosis</a></li>
  <li><a href="#auc-comparsion" id="toc-auc-comparsion" class="nav-link" data-scroll-target="#auc-comparsion"><span class="header-section-number">3.3.3</span> auc comparsion</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#discriminant-validity" id="toc-discriminant-validity" class="nav-link" data-scroll-target="#discriminant-validity"><span class="header-section-number">4</span> Discriminant Validity</a>
  <ul class="collapse">
  <li><a href="#model-setting" id="toc-model-setting" class="nav-link" data-scroll-target="#model-setting"><span class="header-section-number">4.1</span> model setting</a>
  <ul class="collapse">
  <li><a href="#comparions-with-shap-values-function" id="toc-comparions-with-shap-values-function" class="nav-link" data-scroll-target="#comparions-with-shap-values-function"><span class="header-section-number">4.1.1</span> comparions with shap values function</a></li>
  </ul></li>
  <li><a href="#adver-1" id="toc-adver-1" class="nav-link" data-scroll-target="#adver-1"><span class="header-section-number">4.2</span> Adver</a>
  <ul class="collapse">
  <li><a href="#model-training-2" id="toc-model-training-2" class="nav-link" data-scroll-target="#model-training-2"><span class="header-section-number">4.2.1</span> model training</a></li>
  <li><a href="#variables-importance-comparison" id="toc-variables-importance-comparison" class="nav-link" data-scroll-target="#variables-importance-comparison"><span class="header-section-number">4.2.2</span> variables importance comparison</a></li>
  <li><a href="#comparions-with-shap-values" id="toc-comparions-with-shap-values" class="nav-link" data-scroll-target="#comparions-with-shap-values"><span class="header-section-number">4.2.3</span> comparions with shap values</a></li>
  </ul></li>
  <li><a href="#legis-1" id="toc-legis-1" class="nav-link" data-scroll-target="#legis-1"><span class="header-section-number">4.3</span> Legis</a>
  <ul class="collapse">
  <li><a href="#model-training-3" id="toc-model-training-3" class="nav-link" data-scroll-target="#model-training-3"><span class="header-section-number">4.3.1</span> model training</a></li>
  <li><a href="#variables-importance-comparison-1" id="toc-variables-importance-comparison-1" class="nav-link" data-scroll-target="#variables-importance-comparison-1"><span class="header-section-number">4.3.2</span> variables importance comparison</a></li>
  <li><a href="#comparions-with-shap-values-1" id="toc-comparions-with-shap-values-1" class="nav-link" data-scroll-target="#comparions-with-shap-values-1"><span class="header-section-number">4.3.3</span> comparions with shap values</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">robustness-analysis-bayesian</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Kunya Zhan </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 31, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="robustness-analysis" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Robustness Analysis</h1>
<p>This quarto document aims at reorganizing the codes at ‘robustness-check-bayesian’. It serves two main purposes.</p>
<p>1. Evaluate whether the prediction of legislators’ issue-specific advertising and legislative behaviors is reliable (<strong>predictive validity</strong>).</p>
<p>2. Test whether the identification of the three decision-making modes is consistent and credible (<strong>discriminant validity</strong>)</p>
<p>Accordingly, the variables used in the robustness analysis are aligned with those in the final LightGBM model. However, given the structural characteristics of the dataset, the analysis further controls for the unobserved heterogeneity embedded in legislator, issue, and Congress-session levels. This allows for a cleaner assessment of how the proposed matching mechanism explains legislators’ advertising and legislative behaviors on specific issues.</p>
<section id="set-up" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="set-up"><span class="header-section-number">1.1</span> set up</h2>
</section>
<section id="packages-installing-if-not-already-installed" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="packages-installing-if-not-already-installed"><span class="header-section-number">1.2</span> Packages Installing if not already installed</h2>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           

[[2]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           

[[3]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           

[[4]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           

[[5]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           

[[6]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           

[[7]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           

[[8]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           

[[9]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           

[[10]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           

[[11]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           

[[12]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           

[[13]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           

[[14]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           

[[15]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           

[[16]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           

[[17]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           

[[18]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           

[[19]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           

[[20]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           

[[21]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           

[[22]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           

[[23]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           

[[24]]
 [1] "ggrepel"         "glue"            "patchwork"       "cowplot"        
 [5] "posterior"       "loo"             "bayesplot"       "lubridate"      
 [9] "stringr"         "purrr"           "ggplot2"         "tidyverse"      
[13] "forcats"         "tibble"          "brms"            "Rcpp"           
[17] "marginaleffects" "alpaca"          "kableExtra"      "broom"          
[21] "knitr"           "pROC"            "MuMIn"           "lme4"           
[25] "Matrix"          "tidyr"           "dplyr"           "readr"          
[29] "readxl"          "stats"           "graphics"        "grDevices"      
[33] "utils"           "datasets"        "methods"         "base"           </code></pre>
</div>
</div>
</section>
</section>
<section id="data-cleansing" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Data cleansing</h1>
<section id="data-acquisition" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="data-acquisition"><span class="header-section-number">2.1</span> data acquisition</h2>
</section>
<section id="constructing-train-and-test-data" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="constructing-train-and-test-data"><span class="header-section-number">2.2</span> constructing train and test data</h2>
</section>
</section>
<section id="predictive-validity" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Predictive Validity</h1>
<p>We compared three Bayesian models with progressively enriched feature sets.</p>
<p>The <strong>baseline model</strong> includes only legislators’ demographic and institutional characteristics (first-type features).</p>
<p>The <strong>raw model</strong> adds the original attributes of both legislators and issues (second-type features).</p>
<p>The <strong>match model</strong> incorporates the hypothesized mechanism-based matching features that capture the alignment between legislators and issues (third-type features).</p>
<p><strong>Predictive validity</strong> is evaluated by comparing the predictive performance of these three models. It is quantified using pseudo-R² based on posterior means, which reflects the extent to which the inclusion of different feature types improves model fit.</p>
<section id="model-preparations" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="model-preparations"><span class="header-section-number">3.1</span> model preparations</h2>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Rows containing NAs were excluded from the model.
Warning: Rows containing NAs were excluded from the model.
Warning: Rows containing NAs were excluded from the model.
Warning: Rows containing NAs were excluded from the model.
Warning: Rows containing NAs were excluded from the model.
Warning: Rows containing NAs were excluded from the model.</code></pre>
</div>
</div>
</section>
<section id="adver" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="adver"><span class="header-section-number">3.2</span> Adver</h2>
<section id="model-training" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="model-training"><span class="header-section-number">3.2.1</span> model training</h3>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Rows containing NAs were excluded from the model.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Compiling Stan program...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Trying to compile a simple C file</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running /Library/Frameworks/R.framework/Resources/bin/R CMD SHLIB foo.c
using C compiler: ‘Apple clang version 16.0.0 (clang-1600.0.26.3)’
using SDK: ‘MacOSX15.0.sdk’
clang -arch arm64 -std=gnu2x -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG   -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/Rcpp/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/unsupported"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/BH/include" -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/src/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppParallel/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/rstan/include" -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DUSE_STANC3 -DSTRICT_R_HEADERS  -DBOOST_PHOENIX_NO_VARIADIC_EXPRESSION  -D_HAS_AUTO_PTR_ETC=0  -include '/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp'  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/opt/R/arm64/include    -fPIC  -falign-functions=64 -Wall -g -O2  -c foo.c -o foo.o
In file included from &lt;built-in&gt;:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp:22:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Dense:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Core:19:
/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:679:10: fatal error: 'cmath' file not found
  679 | #include &lt;cmath&gt;
      |          ^~~~~~~
1 error generated.
make: *** [foo.o] Error 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.005438 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 54.38 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 1: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 1: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 1: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 1: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 1: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 1: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 1: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 1: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 1: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 1: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 1: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 203.034 seconds (Warm-up)
Chain 1:                169.443 seconds (Sampling)
Chain 1:                372.477 seconds (Total)
Chain 1: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 2).
Chain 2: 
Chain 2: Gradient evaluation took 0.002865 seconds
Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 28.65 seconds.
Chain 2: Adjust your expectations accordingly!
Chain 2: 
Chain 2: 
Chain 2: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 2: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 2: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 2: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 2: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 2: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 2: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 2: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 2: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 2: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 2: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 2: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 254.814 seconds (Warm-up)
Chain 2:                170.951 seconds (Sampling)
Chain 2:                425.765 seconds (Total)
Chain 2: </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There were 6 divergent transitions after warmup. See
https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup
to find out why this is a problem and how to eliminate them.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Examine the pairs() plot to diagnose sampling problems</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.
Running the chains for more iterations may help. See
https://mc-stan.org/misc/warnings.html#bulk-ess</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.
Running the chains for more iterations may help. See
https://mc-stan.org/misc/warnings.html#tail-ess</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Rows containing NAs were excluded from the model.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Compiling Stan program...
Trying to compile a simple C file</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running /Library/Frameworks/R.framework/Resources/bin/R CMD SHLIB foo.c
using C compiler: ‘Apple clang version 16.0.0 (clang-1600.0.26.3)’
using SDK: ‘MacOSX15.0.sdk’
clang -arch arm64 -std=gnu2x -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG   -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/Rcpp/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/unsupported"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/BH/include" -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/src/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppParallel/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/rstan/include" -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DUSE_STANC3 -DSTRICT_R_HEADERS  -DBOOST_PHOENIX_NO_VARIADIC_EXPRESSION  -D_HAS_AUTO_PTR_ETC=0  -include '/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp'  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/opt/R/arm64/include    -fPIC  -falign-functions=64 -Wall -g -O2  -c foo.c -o foo.o
In file included from &lt;built-in&gt;:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp:22:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Dense:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Core:19:
/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:679:10: fatal error: 'cmath' file not found
  679 | #include &lt;cmath&gt;
      |          ^~~~~~~
1 error generated.
make: *** [foo.o] Error 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.003748 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 37.48 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 1: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 1: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 1: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 1: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 1: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 1: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 1: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 1: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 1: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 1: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 1: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 373.826 seconds (Warm-up)
Chain 1:                166.938 seconds (Sampling)
Chain 1:                540.764 seconds (Total)
Chain 1: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 2).
Chain 2: 
Chain 2: Gradient evaluation took 0.003063 seconds
Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 30.63 seconds.
Chain 2: Adjust your expectations accordingly!
Chain 2: 
Chain 2: 
Chain 2: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 2: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 2: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 2: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 2: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 2: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 2: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 2: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 2: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 2: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 2: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 2: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 379.313 seconds (Warm-up)
Chain 2:                169.329 seconds (Sampling)
Chain 2:                548.642 seconds (Total)
Chain 2: </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There were 1 divergent transitions after warmup. See
https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup
to find out why this is a problem and how to eliminate them.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Examine the pairs() plot to diagnose sampling problems</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.
Running the chains for more iterations may help. See
https://mc-stan.org/misc/warnings.html#bulk-ess</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.
Running the chains for more iterations may help. See
https://mc-stan.org/misc/warnings.html#tail-ess</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Rows containing NAs were excluded from the model.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Compiling Stan program...
Trying to compile a simple C file</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running /Library/Frameworks/R.framework/Resources/bin/R CMD SHLIB foo.c
using C compiler: ‘Apple clang version 16.0.0 (clang-1600.0.26.3)’
using SDK: ‘MacOSX15.0.sdk’
clang -arch arm64 -std=gnu2x -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG   -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/Rcpp/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/unsupported"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/BH/include" -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/src/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppParallel/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/rstan/include" -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DUSE_STANC3 -DSTRICT_R_HEADERS  -DBOOST_PHOENIX_NO_VARIADIC_EXPRESSION  -D_HAS_AUTO_PTR_ETC=0  -include '/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp'  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/opt/R/arm64/include    -fPIC  -falign-functions=64 -Wall -g -O2  -c foo.c -o foo.o
In file included from &lt;built-in&gt;:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp:22:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Dense:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Core:19:
/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:679:10: fatal error: 'cmath' file not found
  679 | #include &lt;cmath&gt;
      |          ^~~~~~~
1 error generated.
make: *** [foo.o] Error 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.007382 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 73.82 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 1: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 1: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 1: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 1: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 1: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 1: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 1: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 1: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 1: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 1: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 1: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 697.969 seconds (Warm-up)
Chain 1:                545.23 seconds (Sampling)
Chain 1:                1243.2 seconds (Total)
Chain 1: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 2).
Chain 2: 
Chain 2: Gradient evaluation took 0.004615 seconds
Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 46.15 seconds.
Chain 2: Adjust your expectations accordingly!
Chain 2: 
Chain 2: 
Chain 2: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 2: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 2: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 2: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 2: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 2: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 2: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 2: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 2: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 2: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 2: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 2: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 737.854 seconds (Warm-up)
Chain 2:                639.007 seconds (Sampling)
Chain 2:                1376.86 seconds (Total)
Chain 2: </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There were 1 transitions after warmup that exceeded the maximum treedepth. Increase max_treedepth above 10. See
https://mc-stan.org/misc/warnings.html#maximum-treedepth-exceeded</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Examine the pairs() plot to diagnose sampling problems</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.
Running the chains for more iterations may help. See
https://mc-stan.org/misc/warnings.html#bulk-ess</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Rows containing NAs were excluded from the model.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Compiling Stan program...
Trying to compile a simple C file</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running /Library/Frameworks/R.framework/Resources/bin/R CMD SHLIB foo.c
using C compiler: ‘Apple clang version 16.0.0 (clang-1600.0.26.3)’
using SDK: ‘MacOSX15.0.sdk’
clang -arch arm64 -std=gnu2x -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG   -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/Rcpp/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/unsupported"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/BH/include" -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/src/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppParallel/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/rstan/include" -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DUSE_STANC3 -DSTRICT_R_HEADERS  -DBOOST_PHOENIX_NO_VARIADIC_EXPRESSION  -D_HAS_AUTO_PTR_ETC=0  -include '/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp'  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/opt/R/arm64/include    -fPIC  -falign-functions=64 -Wall -g -O2  -c foo.c -o foo.o
In file included from &lt;built-in&gt;:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp:22:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Dense:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Core:19:
/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:679:10: fatal error: 'cmath' file not found
  679 | #include &lt;cmath&gt;
      |          ^~~~~~~
1 error generated.
make: *** [foo.o] Error 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.00458 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 45.8 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 1: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 1: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 1: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 1: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 1: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 1: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 1: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 1: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 1: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 1: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 1: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 512.828 seconds (Warm-up)
Chain 1:                391.18 seconds (Sampling)
Chain 1:                904.008 seconds (Total)
Chain 1: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 2).
Chain 2: 
Chain 2: Gradient evaluation took 0.003371 seconds
Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 33.71 seconds.
Chain 2: Adjust your expectations accordingly!
Chain 2: 
Chain 2: 
Chain 2: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 2: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 2: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 2: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 2: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 2: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 2: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 2: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 2: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 2: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 2: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 2: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 551.753 seconds (Warm-up)
Chain 2:                778.246 seconds (Sampling)
Chain 2:                1330 seconds (Total)
Chain 2: </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.
Running the chains for more iterations may help. See
https://mc-stan.org/misc/warnings.html#bulk-ess</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.
Running the chains for more iterations may help. See
https://mc-stan.org/misc/warnings.html#tail-ess</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Found 1 observations with a pareto_k &gt; 0.7 in model 'bayes_match'. We
recommend to set 'moment_match = TRUE' in order to perform moment matching for
problematic observations.</code></pre>
</div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Bayesian Model Comparison: LOOIC and Approximate Pseudo-R2</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Model</th>
<th style="text-align: right;">LOOIC</th>
<th style="text-align: right;">Bayes_R2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Base</td>
<td style="text-align: right;">24009.61</td>
<td style="text-align: right;">0.3070770</td>
</tr>
<tr class="even">
<td style="text-align: left;">Baseline</td>
<td style="text-align: right;">21829.35</td>
<td style="text-align: right;">0.2971051</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Raw</td>
<td style="text-align: right;">23829.28</td>
<td style="text-align: right;">0.3110489</td>
</tr>
<tr class="even">
<td style="text-align: left;">Match</td>
<td style="text-align: right;">23819.24</td>
<td style="text-align: right;">0.3136022</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="posterior-diagnosis" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="posterior-diagnosis"><span class="header-section-number">3.2.2</span> posterior diagnosis</h3>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>------ BASE ------Rhat &gt; 1.01:
                                                   b_Intercept 
                                                      1.014139 
                                       sd_full_name__Intercept 
                                                      1.023947 
                                                     Intercept 
                                                      1.014139 
             r_full_name[Rep..Bishop,.Mike.[R-MI-8],Intercept] 
                                                      1.013635 
            r_full_name[Rep..Coffman,.Mike.[R-CO-6],Intercept] 
                                                      1.010693 
         r_full_name[Rep..Dingell,.Debbie.[D-MI-12],Intercept] 
                                                      1.012227 
              r_full_name[Rep..Fallon,.Pat.[R-TX-4],Intercept] 
                                                      1.010589 
       r_full_name[Rep..Farenthold,.Blake.[R-TX-27],Intercept] 
                                                      1.010520 
          r_full_name[Rep..Jackson,.Ronny.[R-TX-13],Intercept] 
                                                      1.015760 
         r_full_name[Rep..Jones,.Mondaire.[D-NY-17],Intercept] 
                                                      1.010114 
  r_full_name[Rep..Kennedy,.Joseph.P.,.III.[D-MA-4],Intercept] 
                                                      1.011335 
           r_full_name[Rep..Maloy,.Celeste.[R-UT-2],Intercept] 
                                                      1.010048 
           r_full_name[Rep..Miller,.Max.L..[R-OH-7],Intercept] 
                                                      1.019266 
              r_full_name[Rep..Mills,.Cory.[R-FL-7],Intercept] 
                                                      1.011539 
       r_full_name[Rep..Moolenaar,.John.R..[R-MI-2],Intercept] 
                                                      1.014881 
            r_full_name[Rep..Ogles,.Andrew.[R-TN-5],Intercept] 
                                                      1.016174 
             r_full_name[Rep..Schrier,.Kim.[D-WA-8],Intercept] 
                                                      1.025432 
 r_full_name[Rep..Scott,.Robert.C.."Bobby".[D-VA-3],Intercept] 
                                                      1.021301 
      r_full_name[Rep..Simpson,.Michael.K..[R-ID-2],Intercept] 
                                                      1.011187 
     r_full_name[Rep..Strickland,.Marilyn.[D-WA-10],Intercept] 
                                                      1.010836 
           r_full_name[Rep..Thompson,.Mike.[D-CA-4],Intercept] 
                                                      1.014926 
         r_full_name[Rep..Yarmuth,.John.A..[D-KY-3],Intercept] 
                                                      1.012708 
                 r_full_name[Sen..Banks,.Jim.[R-IN],Intercept] 
                                                      1.010235 
             r_full_name[Sen..Gallego,.Ruben.[D-AZ],Intercept] 
                                                      1.012419 
                r_full_name[Sen..Ossoff,.Jon.[D-GA],Intercept] 
                                                      1.011322 
                       r_issue[Agriculture.and.Food,Intercept] 
                                                      1.013617 
           r_issue[Alliance.and.Collective.Security,Intercept] 
                                                      1.013090 
                               r_issue[Armed.Forces,Intercept] 
                                                      1.016168 
                     r_issue[Art,.Culture,.Religion,Intercept] 
                                                      1.012906 
r_issue[Civil.Rights.and.Liberties,.Minority.Issues,Intercept] 
                                                      1.016270 
                                   r_issue[Commerce,Intercept] 
                                                      1.014752 
         r_issue[Congressional.political.operations,Intercept] 
                                                      1.017088 
                  r_issue[Crime.and.Law.Enforcement,Intercept] 
                                                      1.017172 
               r_issue[Economics.and.Public.Finance,Intercept] 
                                                      1.015419 
                                  r_issue[Education,Intercept] 
                                                      1.010885 
                       r_issue[Emergency.Management,Intercept] 
                                                      1.016715 
                                     r_issue[Energy,Intercept] 
                                                      1.019029 
                   r_issue[Environmental.Protection,Intercept] 
                                                      1.012458 
               r_issue[Finance.and.Financial.Sector,Intercept] 
                                                      1.015052 
                            r_issue[Foreign.Affairs,Intercept] 
                                                      1.016605 
         r_issue[Government.Operations.and.Politics,Intercept] 
                                                      1.017449 
                                     r_issue[Health,Intercept] 
                                                      1.020358 
                               r_issue[Human.Rights,Intercept] 
                                                      1.015030 
                                r_issue[Immigration,Intercept] 
                                                      1.016167 
                      r_issue[International.Finance,Intercept] 
                                                      1.011903 
                        r_issue[International.Trade,Intercept] 
                                                      1.017027 
                       r_issue[Labor.and.Employment,Intercept] 
                                                      1.015054 
                                        r_issue[Law,Intercept] 
                                                      1.012924 
                          r_issue[National.Security,Intercept] 
                                                      1.016778 
        r_issue[Science,.Technology,.Communications,Intercept] 
                                                      1.011750 
                             r_issue[Social.Welfare,Intercept] 
                                                      1.011359 
                                   r_issue[Taxation,Intercept] 
                                                      1.016944 
            r_issue[Transportation.and.Public.Works,Intercept] 
                                                      1.014817 
                                                        lprior 
                                                      1.013796 
                                                          lp__ 
                                                      1.021272 

ESS &lt; 0.1:
                                                   b_Intercept 
                                                    0.08545431 
                                           sd_issue__Intercept 
                                                    0.08691169 
                                                     Intercept 
                                                    0.08545431 
                       r_issue[Agriculture.and.Food,Intercept] 
                                                    0.06479786 
           r_issue[Alliance.and.Collective.Security,Intercept] 
                                                    0.06236906 
                               r_issue[Armed.Forces,Intercept] 
                                                    0.05800941 
                     r_issue[Art,.Culture,.Religion,Intercept] 
                                                    0.06301821 
r_issue[Civil.Rights.and.Liberties,.Minority.Issues,Intercept] 
                                                    0.05683878 
                                   r_issue[Commerce,Intercept] 
                                                    0.05970490 
         r_issue[Congressional.political.operations,Intercept] 
                                                    0.05781821 
                  r_issue[Crime.and.Law.Enforcement,Intercept] 
                                                    0.06076832 
               r_issue[Economics.and.Public.Finance,Intercept] 
                                                    0.06098934 
                                  r_issue[Education,Intercept] 
                                                    0.07086048 
                       r_issue[Emergency.Management,Intercept] 
                                                    0.06530560 
                                     r_issue[Energy,Intercept] 
                                                    0.06181953 
                   r_issue[Environmental.Protection,Intercept] 
                                                    0.06069079 
               r_issue[Finance.and.Financial.Sector,Intercept] 
                                                    0.05875391 
                            r_issue[Foreign.Affairs,Intercept] 
                                                    0.05730872 
         r_issue[Government.Operations.and.Politics,Intercept] 
                                                    0.05830222 
                                     r_issue[Health,Intercept] 
                                                    0.05741833 
          r_issue[Housing.and.Community.Development,Intercept] 
                                                    0.08580761 
                               r_issue[Human.Rights,Intercept] 
                                                    0.05901477 
                                r_issue[Immigration,Intercept] 
                                                    0.05953549 
                      r_issue[International.Finance,Intercept] 
                                                    0.06733063 
                        r_issue[International.Trade,Intercept] 
                                                    0.05828913 
                       r_issue[Labor.and.Employment,Intercept] 
                                                    0.06443611 
                                        r_issue[Law,Intercept] 
                                                    0.06212799 
                          r_issue[National.Security,Intercept] 
                                                    0.05947651 
         r_issue[Public.Lands.and.Natural.Resources,Intercept] 
                                                    0.07479542 
        r_issue[Science,.Technology,.Communications,Intercept] 
                                                    0.06019439 
                             r_issue[Social.Welfare,Intercept] 
                                                    0.07370400 
                                   r_issue[Taxation,Intercept] 
                                                    0.06279927 
            r_issue[Transportation.and.Public.Works,Intercept] 
                                                    0.06199676 

Summary of Rhat:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.9982  1.0001  1.0017  1.0031  1.0049  1.0254 

Summary of ESS ratio:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
0.05684 0.60505 0.68461 0.65048 0.74755 0.98483 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>------ BASELINE ------Rhat &gt; 1.01:
                                                   b_Intercept 
                                                      1.023561 
                                               b_chamberSenate 
                                                      1.014681 
                                                   b_seniority 
                                                      1.010409 
                                           sd_issue__Intercept 
                                                      1.010392 
                                                     Intercept 
                                                      1.019175 
             r_full_name[Rep..Alford,.Mark.[R-MO-4],Intercept] 
                                                      1.010860 
         r_full_name[Rep..Beyer,.Donald.S..[D-VA-8],Intercept] 
                                                      1.010829 
       r_full_name[Rep..Bice,.Stephanie.I..[R-OK-5],Intercept] 
                                                      1.011483 
             r_full_name[Rep..Casten,.Sean.[D-IL-6],Intercept] 
                                                      1.015026 
              r_full_name[Rep..Cooper,.Jim.[D-TN-4],Intercept] 
                                                      1.013661 
             r_full_name[Rep..Duncan,.Jeff.[R-SC-3],Intercept] 
                                                      1.010041 
       r_full_name[Rep..Gonzalez,.Vicente.[D-TX-34],Intercept] 
                                                      1.015320 
           r_full_name[Rep..Gosar,.Paul.A..[R-AZ-9],Intercept] 
                                                      1.010435 
         r_full_name[Rep..Gottheimer,.Josh.[D-NJ-5],Intercept] 
                                                      1.010869 
        r_full_name[Rep..Houlahan,.Chrissy.[D-PA-6],Intercept] 
                                                      1.012772 
            r_full_name[Rep..Jacobs,.Sara.[D-CA-53],Intercept] 
                                                      1.019282 
  r_full_name[Rep..Leger.Fernandez,.Teresa.[D-NM-3],Intercept] 
                                                      1.013721 
               r_full_name[Rep..Lieu,.Ted.[D-CA-36],Intercept] 
                                                      1.010627 
           r_full_name[Rep..Meuser,.Daniel.[R-PA-9],Intercept] 
                                                      1.010569 
              r_full_name[Rep..Moore,.Gwen.[D-WI-4],Intercept] 
                                                      1.015036 
           r_full_name[Rep..Phillips,.Dean.[D-MN-3],Intercept] 
                                                      1.013839 
        r_full_name[Rep..Tipton,.Scott..R..[R-CO-3],Intercept] 
                                                      1.010034 
           r_full_name[Rep..Zinke,.Ryan.K..[R-MT-1],Intercept] 
                                                      1.022319 
           r_full_name[Sen..Enzi,.Michael.B..[R-WY],Intercept] 
                                                      1.010862 
               r_full_name[Sen..Johnson,.Ron.[R-WI],Intercept] 
                                                      1.010770 
                       r_issue[Agriculture.and.Food,Intercept] 
                                                      1.025821 
           r_issue[Alliance.and.Collective.Security,Intercept] 
                                                      1.022943 
                               r_issue[Armed.Forces,Intercept] 
                                                      1.028275 
                     r_issue[Art,.Culture,.Religion,Intercept] 
                                                      1.020576 
r_issue[Civil.Rights.and.Liberties,.Minority.Issues,Intercept] 
                                                      1.024415 
                                   r_issue[Commerce,Intercept] 
                                                      1.024279 
         r_issue[Congressional.political.operations,Intercept] 
                                                      1.026273 
                  r_issue[Crime.and.Law.Enforcement,Intercept] 
                                                      1.032980 
               r_issue[Economics.and.Public.Finance,Intercept] 
                                                      1.025448 
                                  r_issue[Education,Intercept] 
                                                      1.022410 
                       r_issue[Emergency.Management,Intercept] 
                                                      1.022249 
                                     r_issue[Energy,Intercept] 
                                                      1.029886 
                   r_issue[Environmental.Protection,Intercept] 
                                                      1.020792 
               r_issue[Finance.and.Financial.Sector,Intercept] 
                                                      1.024262 
                            r_issue[Foreign.Affairs,Intercept] 
                                                      1.022982 
         r_issue[Government.Operations.and.Politics,Intercept] 
                                                      1.026753 
                                     r_issue[Health,Intercept] 
                                                      1.023608 
          r_issue[Housing.and.Community.Development,Intercept] 
                                                      1.011669 
                               r_issue[Human.Rights,Intercept] 
                                                      1.026698 
                                r_issue[Immigration,Intercept] 
                                                      1.022651 
                      r_issue[International.Finance,Intercept] 
                                                      1.024571 
                        r_issue[International.Trade,Intercept] 
                                                      1.022829 
                       r_issue[Labor.and.Employment,Intercept] 
                                                      1.025297 
                                        r_issue[Law,Intercept] 
                                                      1.024562 
                          r_issue[National.Security,Intercept] 
                                                      1.022987 
         r_issue[Public.Lands.and.Natural.Resources,Intercept] 
                                                      1.016761 
        r_issue[Science,.Technology,.Communications,Intercept] 
                                                      1.024025 
                 r_issue[Social.Science.and.History,Intercept] 
                                                      1.013770 
                             r_issue[Social.Welfare,Intercept] 
                                                      1.017449 
                                   r_issue[Taxation,Intercept] 
                                                      1.024047 
            r_issue[Transportation.and.Public.Works,Intercept] 
                                                      1.025612 

ESS &lt; 0.1:
                                                   b_Intercept 
                                                    0.07066529 
                                                     Intercept 
                                                    0.04645830 
                       r_issue[Agriculture.and.Food,Intercept] 
                                                    0.03553246 
           r_issue[Alliance.and.Collective.Security,Intercept] 
                                                    0.03499849 
                               r_issue[Armed.Forces,Intercept] 
                                                    0.03407255 
                     r_issue[Art,.Culture,.Religion,Intercept] 
                                                    0.03876488 
r_issue[Civil.Rights.and.Liberties,.Minority.Issues,Intercept] 
                                                    0.03300369 
                                   r_issue[Commerce,Intercept] 
                                                    0.03346607 
         r_issue[Congressional.political.operations,Intercept] 
                                                    0.03373088 
                  r_issue[Crime.and.Law.Enforcement,Intercept] 
                                                    0.03311257 
               r_issue[Economics.and.Public.Finance,Intercept] 
                                                    0.03350795 
                                  r_issue[Education,Intercept] 
                                                    0.04067630 
                       r_issue[Emergency.Management,Intercept] 
                                                    0.03723789 
                                     r_issue[Energy,Intercept] 
                                                    0.03619452 
                   r_issue[Environmental.Protection,Intercept] 
                                                    0.03553735 
               r_issue[Finance.and.Financial.Sector,Intercept] 
                                                    0.03320541 
                            r_issue[Foreign.Affairs,Intercept] 
                                                    0.03381552 
         r_issue[Government.Operations.and.Politics,Intercept] 
                                                    0.03328723 
                                     r_issue[Health,Intercept] 
                                                    0.03282997 
          r_issue[Housing.and.Community.Development,Intercept] 
                                                    0.06239542 
                               r_issue[Human.Rights,Intercept] 
                                                    0.03386006 
                                r_issue[Immigration,Intercept] 
                                                    0.03467070 
                      r_issue[International.Finance,Intercept] 
                                                    0.03763474 
                        r_issue[International.Trade,Intercept] 
                                                    0.03401074 
                       r_issue[Labor.and.Employment,Intercept] 
                                                    0.03507130 
                                        r_issue[Law,Intercept] 
                                                    0.03497197 
                          r_issue[National.Security,Intercept] 
                                                    0.03379907 
         r_issue[Public.Lands.and.Natural.Resources,Intercept] 
                                                    0.04274847 
        r_issue[Science,.Technology,.Communications,Intercept] 
                                                    0.03492988 
                 r_issue[Social.Science.and.History,Intercept] 
                                                    0.05875445 
                             r_issue[Social.Welfare,Intercept] 
                                                    0.04712053 
                                   r_issue[Taxation,Intercept] 
                                                    0.03602138 
            r_issue[Transportation.and.Public.Works,Intercept] 
                                                    0.03502826 
                                                        lprior 
                                                    0.08461846 

Summary of Rhat:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.9982  1.0002  1.0017  1.0035  1.0045  1.0330 

Summary of ESS ratio:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
0.03283 0.61696 0.68875 0.65664 0.76190 0.93884 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>------ RAW ------Rhat &gt; 1.01:
                             b_industry_mainEducationalservices 
                                                       1.010292 
                                      b_employ_mainConstruction 
                                                       1.016680 
                     b_employ_mainHealthcareandsocialassistance 
                                                       1.022964 
                                       b_employ_mainInformation 
                                                       1.018290 
                                     b_employ_mainManufacturing 
                                                       1.033902 
        b_employ_mainProfessionalscientificandtechnicalservices 
                                                       1.024160 
                                       b_employ_mainRetailtrade 
                                                       1.011845 
                              b_payroll_mainFinanceandinsurance 
                                                       1.011272 
                    b_payroll_mainHealthcareandsocialassistance 
                                                       1.013049 
                                      b_payroll_mainInformation 
                                                       1.015619 
              b_payroll_mainManagementofcompaniesandenterprises 
                                                       1.014731 
                                    b_payroll_mainManufacturing 
                                                       1.018641 
       b_payroll_mainProfessionalscientificandtechnicalservices 
                                                       1.015364 
                                        b_payroll_mainUtilities 
                                                       1.017032 
                                                        b_ppviR 
                                                       1.017621 
             r_full_name[Rep..Amash,.Justin.[R-MI-3],Intercept] 
                                                       1.010839 
              r_full_name[Rep..Bass,.Karen.[D-CA-37],Intercept] 
                                                       1.013980 
                  r_full_name[Rep..Case,.Ed.[D-HI-1],Intercept] 
                                                       1.017370 
              r_full_name[Rep..Ellzey,.Jake.[R-TX-6],Intercept] 
                                                       1.010244 
               r_full_name[Rep..Hurd,.Will.[R-TX-23],Intercept] 
                                                       1.010199 
              r_full_name[Rep..Lewis,.Jason.[R-MN-2],Intercept] 
                                                       1.016950 
          r_full_name[Rep..McClain,.Lisa.C..[R-MI-9],Intercept] 
                                                       1.010778 
               r_full_name[Rep..Mills,.Cory.[R-FL-7],Intercept] 
                                                       1.015126 
            r_full_name[Rep..Mullin,.Kevin.[D-CA-15],Intercept] 
                                                       1.010700 
              r_full_name[Rep..Olson,.Pete.[R-TX-22],Intercept] 
                                                       1.011179 
  r_full_name[Rep..Perez,.Marie.Gluesenkamp.[D-WA-3],Intercept] 
                                                       1.011719 
              r_full_name[Rep..Rokita,.Todd.[R-IN-4],Intercept] 
                                                       1.011192 
       r_full_name[Rep..Timmons,.William.R..[R-SC-4],Intercept] 
                                                       1.014571 
       r_full_name[Rep..Toomey,.Patrick.J..[R-PA-15],Intercept] 
                                                       1.010887 
r_full_name[Rep..Wasserman.Schultz,.Debbie.[D-FL-23],Intercept] 
                                                       1.010067 
            r_full_name[Rep..Watkins,.Steve.[R-KS-2],Intercept] 
                                                       1.010403 
             r_full_name[Sen..Cantwell,.Maria.[D-WA],Intercept] 
                                                       1.010801 
            r_full_name[Sen..Hirono,.Mazie.K..[D-HI],Intercept] 
                                                       1.014486 
 r_issue[Civil.Rights.and.Liberties,.Minority.Issues,Intercept] 
                                                       1.011137 
                r_issue[Finance.and.Financial.Sector,Intercept] 
                                                       1.011793 
                       r_issue[International.Finance,Intercept] 
                                                       1.011743 

ESS &lt; 0.1:
b_payroll_mainProfessionalscientificandtechnicalservices 
                                              0.09663352 

Summary of Rhat:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.9982  1.0003  1.0018  1.0027  1.0038  1.0339 

Summary of ESS ratio:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
0.09663 0.58972 0.68119 0.65410 0.76084 0.96214 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The ESS has been capped to avoid unstable estimates.
Warning: The ESS has been capped to avoid unstable estimates.
Warning: The ESS has been capped to avoid unstable estimates.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>------ MATCH ------Rhat &gt; 1.01:
                                                     Intercept 
                                                      1.019488 
                                     r_congress[115,Intercept] 
                                                      1.014610 
                                     r_congress[116,Intercept] 
                                                      1.013751 
                                     r_congress[117,Intercept] 
                                                      1.014146 
                                     r_congress[118,Intercept] 
                                                      1.015409 
                r_full_name[Rep..Bera,.Ami.[D-CA-6],Intercept] 
                                                      1.010626 
  r_full_name[Rep..Bishop,.Sanford.D.,.Jr..[D-GA-2],Intercept] 
                                                      1.010068 
          r_full_name[Rep..Boebert,.Lauren.[R-CO-4],Intercept] 
                                                      1.020558 
              r_full_name[Rep..Bost,.Mike.[R-IL-12],Intercept] 
                                                      1.010492 
         r_full_name[Rep..Brady,.Robert.A..[D-PA-1],Intercept] 
                                                      1.011314 
              r_full_name[Rep..Cooper,.Jim.[D-TN-4],Intercept] 
                                                      1.015057 
        r_full_name[Rep..Costello,.Ryan.A..[R-PA-6],Intercept] 
                                                      1.011840 
            r_full_name[Rep..Crenshaw,.Dan.[R-TX-2],Intercept] 
                                                      1.011640 
         r_full_name[Rep..Davis,.Susan.A..[D-CA-49],Intercept] 
                                                      1.010474 
     r_full_name[Rep..Deutch,.Theodore.E..[D-FL-22],Intercept] 
                                                      1.010484 
             r_full_name[Rep..Ellzey,.Jake.[R-TX-6],Intercept] 
                                                      1.010111 
           r_full_name[Rep..Goodlatte,.Bob.[R-VA-6],Intercept] 
                                                      1.015353 
              r_full_name[Rep..Graves,.Sam.[R-MO-6],Intercept] 
                                                      1.011108 
   r_full_name[Rep..Herrera.Beutler,.Jaime.[R-WA-3],Intercept] 
                                                      1.013044 
           r_full_name[Rep..Hice,.Jody.B..[R-GA-10],Intercept] 
                                                      1.011413 
          r_full_name[Rep..Himes,.James.A..[D-CT-4],Intercept] 
                                                      1.016491 
             r_full_name[Rep..James,.John.[R-MI-10],Intercept] 
                                                      1.011309 
            r_full_name[Rep..Johnson,.Bill.[R-OH-6],Intercept] 
                                                      1.014101 
       r_full_name[Rep..Langevin,.James.R..[D-RI-2],Intercept] 
                                                      1.011806 
             r_full_name[Rep..Lewis,.Jason.[R-MN-2],Intercept] 
                                                      1.011413 
        r_full_name[Rep..Meeks,.Gregory.W..[D-NY-5],Intercept] 
                                                      1.016333 
r_full_name[Rep..Miller-Meeks,.Mariannette.[R-IA-2],Intercept] 
                                                      1.016868 
 r_full_name[Rep..Perez,.Marie.Gluesenkamp.[D-WA-3],Intercept] 
                                                      1.010002 
         r_full_name[Rep..Pingree,.Chellie.[D-ME-1],Intercept] 
                                                      1.010318 
        r_full_name[Rep..Pittenger,.Robert.[R-NC-9],Intercept] 
                                                      1.013984 
          r_full_name[Rep..Rogers,.Mike.D..[R-AL-3],Intercept] 
                                                      1.010537 
           r_full_name[Rep..Rouda,.Harley.[D-CA-48],Intercept] 
                                                      1.011270 
     r_full_name[Rep..Scholten,.Hillary.J..[D-MI-3],Intercept] 
                                                      1.012843 
         r_full_name[Rep..Spartz,.Victoria.[R-IN-5],Intercept] 
                                                      1.012346 
      r_full_name[Rep..Stefanik,.Elise.M..[R-NY-21],Intercept] 
                                                      1.012467 
        r_full_name[Rep..Tipton,.Scott..R..[R-CO-3],Intercept] 
                                                      1.014204 
              r_full_name[Rep..Wilson,.Joe.[R-SC-2],Intercept] 
                                                      1.013312 
            r_full_name[Sen..Cantwell,.Maria.[D-WA],Intercept] 
                                                      1.011179 
            r_full_name[Sen..Curtis,.John.R..[R-UT],Intercept] 
                                                      1.017600 
             r_full_name[Sen..Lujan,.Ben.Ray.[D-NM],Intercept] 
                                                      1.010366 
                       r_issue[Emergency.Management,Intercept] 
                                                      1.010555 
                r_issue[Water.Resources.Development,Intercept] 
                                                      1.011551 

ESS &lt; 0.1:
named numeric(0)

Summary of Rhat:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.9982  1.0002  1.0018  1.0028  1.0044  1.0206 

Summary of ESS ratio:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.1727  0.5967  0.6784  0.6558  0.7458  0.9898 </code></pre>
</div>
</div>
</section>
<section id="auc-comparison" class="level3" data-number="3.2.3">
<h3 data-number="3.2.3" class="anchored" data-anchor-id="auc-comparison"><span class="header-section-number">3.2.3</span> auc comparison</h3>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="output/adver_predictive%20auc%20compasion-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- AUC Bootstrap Tests ---
Base vs Baseline:
    Bootstrap test for two correlated ROC curves

data:  roc_list[[i]] and roc_list[[j]]
D = -8.743, boot.n = 2000, boot.stratified = 1, p-value &lt; 2.2e-16
alternative hypothesis: true difference in AUC is not equal to 0
sample estimates:
AUC of roc1 AUC of roc2 
  0.8257042   0.8373575 

Base vs Raw:
    Bootstrap test for two correlated ROC curves

data:  roc_list[[i]] and roc_list[[j]]
D = -0.68894, boot.n = 2000, boot.stratified = 1, p-value = 0.4909
alternative hypothesis: true difference in AUC is not equal to 0
sample estimates:
AUC of roc1 AUC of roc2 
  0.8263109   0.8266253 

Base vs Match:
    Bootstrap test for two correlated ROC curves

data:  roc_list[[i]] and roc_list[[j]]
D = -1.8565, boot.n = 2000, boot.stratified = 1, p-value = 0.06338
alternative hypothesis: true difference in AUC is not equal to 0
sample estimates:
AUC of roc1 AUC of roc2 
  0.8263109   0.8276047 

Baseline vs Raw:
    Bootstrap test for two correlated ROC curves

data:  roc_list[[i]] and roc_list[[j]]
D = 8.0526, boot.n = 2000, boot.stratified = 1, p-value = 8.105e-16
alternative hypothesis: true difference in AUC is not equal to 0
sample estimates:
AUC of roc1 AUC of roc2 
  0.8373575   0.8264943 

Baseline vs Match:
    Bootstrap test for two correlated ROC curves

data:  roc_list[[i]] and roc_list[[j]]
D = 6.5874, boot.n = 2000, boot.stratified = 1, p-value = 4.475e-11
alternative hypothesis: true difference in AUC is not equal to 0
sample estimates:
AUC of roc1 AUC of roc2 
  0.8373575   0.8270681 

Raw vs Match:
    Bootstrap test for two correlated ROC curves

data:  roc_list[[i]] and roc_list[[j]]
D = -1.1885, boot.n = 2000, boot.stratified = 1, p-value = 0.2346
alternative hypothesis: true difference in AUC is not equal to 0
sample estimates:
AUC of roc1 AUC of roc2 
  0.8266253   0.8276047 



Table: AUC Comparison on Test Set

|Model    |   AUC|
|:--------|-----:|
|Base     | 0.826|
|Baseline | 0.837|
|Raw      | 0.827|
|Match    | 0.828|</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>$roc_list
$roc_list$Base

Call:
roc.default(response = test_data[[label_var]], predictor = pred_probs)

Data: pred_probs in 17186 controls (test_data[[label_var]] 0) &lt; 3704 cases (test_data[[label_var]] 1).
Area under the curve: 0.8263

$roc_list$Baseline

Call:
roc.default(response = test_data[[label_var]], predictor = pred_probs)

Data: pred_probs in 15534 controls (test_data[[label_var]] 0) &lt; 3137 cases (test_data[[label_var]] 1).
Area under the curve: 0.8374

$roc_list$Raw

Call:
roc.default(response = test_data[[label_var]], predictor = pred_probs)

Data: pred_probs in 17186 controls (test_data[[label_var]] 0) &lt; 3704 cases (test_data[[label_var]] 1).
Area under the curve: 0.8266

$roc_list$Match

Call:
roc.default(response = test_data[[label_var]], predictor = pred_probs)

Data: pred_probs in 17186 controls (test_data[[label_var]] 0) &lt; 3704 cases (test_data[[label_var]] 1).
Area under the curve: 0.8276


$auc_table
# A tibble: 4 × 2
  Model      AUC
  &lt;chr&gt;    &lt;dbl&gt;
1 Base     0.826
2 Baseline 0.837
3 Raw      0.827
4 Match    0.828</code></pre>
</div>
</div>
</section>
</section>
<section id="legis" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="legis"><span class="header-section-number">3.3</span> Legis</h2>
<section id="model-training-1" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="model-training-1"><span class="header-section-number">3.3.1</span> model training</h3>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Compiling Stan program...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Trying to compile a simple C file</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running /Library/Frameworks/R.framework/Resources/bin/R CMD SHLIB foo.c
using C compiler: ‘Apple clang version 16.0.0 (clang-1600.0.26.3)’
using SDK: ‘MacOSX15.0.sdk’
clang -arch arm64 -std=gnu2x -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG   -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/Rcpp/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/unsupported"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/BH/include" -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/src/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppParallel/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/rstan/include" -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DUSE_STANC3 -DSTRICT_R_HEADERS  -DBOOST_PHOENIX_NO_VARIADIC_EXPRESSION  -D_HAS_AUTO_PTR_ETC=0  -include '/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp'  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/opt/R/arm64/include    -fPIC  -falign-functions=64 -Wall -g -O2  -c foo.c -o foo.o
In file included from &lt;built-in&gt;:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp:22:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Dense:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Core:19:
/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:679:10: fatal error: 'cmath' file not found
  679 | #include &lt;cmath&gt;
      |          ^~~~~~~
1 error generated.
make: *** [foo.o] Error 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.003629 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 36.29 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 1: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 1: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 1: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 1: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 1: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 1: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 1: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 1: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 1: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 1: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 1: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 552.395 seconds (Warm-up)
Chain 1:                491.16 seconds (Sampling)
Chain 1:                1043.56 seconds (Total)
Chain 1: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 2).
Chain 2: 
Chain 2: Gradient evaluation took 0.002461 seconds
Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 24.61 seconds.
Chain 2: Adjust your expectations accordingly!
Chain 2: 
Chain 2: 
Chain 2: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 2: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 2: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 2: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 2: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 2: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 2: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 2: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 2: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 2: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 2: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 2: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 464.852 seconds (Warm-up)
Chain 2:                304.122 seconds (Sampling)
Chain 2:                768.974 seconds (Total)
Chain 2: </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Rows containing NAs were excluded from the model.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Compiling Stan program...
Trying to compile a simple C file</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running /Library/Frameworks/R.framework/Resources/bin/R CMD SHLIB foo.c
using C compiler: ‘Apple clang version 16.0.0 (clang-1600.0.26.3)’
using SDK: ‘MacOSX15.0.sdk’
clang -arch arm64 -std=gnu2x -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG   -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/Rcpp/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/unsupported"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/BH/include" -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/src/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppParallel/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/rstan/include" -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DUSE_STANC3 -DSTRICT_R_HEADERS  -DBOOST_PHOENIX_NO_VARIADIC_EXPRESSION  -D_HAS_AUTO_PTR_ETC=0  -include '/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp'  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/opt/R/arm64/include    -fPIC  -falign-functions=64 -Wall -g -O2  -c foo.c -o foo.o
In file included from &lt;built-in&gt;:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp:22:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Dense:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Core:19:
/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:679:10: fatal error: 'cmath' file not found
  679 | #include &lt;cmath&gt;
      |          ^~~~~~~
1 error generated.
make: *** [foo.o] Error 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.003392 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 33.92 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 1: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 1: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 1: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 1: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 1: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 1: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 1: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 1: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 1: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 1: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 1: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 467.351 seconds (Warm-up)
Chain 1:                280.442 seconds (Sampling)
Chain 1:                747.793 seconds (Total)
Chain 1: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 2).
Chain 2: 
Chain 2: Gradient evaluation took 0.002472 seconds
Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 24.72 seconds.
Chain 2: Adjust your expectations accordingly!
Chain 2: 
Chain 2: 
Chain 2: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 2: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 2: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 2: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 2: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 2: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 2: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 2: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 2: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 2: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 2: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 2: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 462.951 seconds (Warm-up)
Chain 2:                278.376 seconds (Sampling)
Chain 2:                741.327 seconds (Total)
Chain 2: </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.
Running the chains for more iterations may help. See
https://mc-stan.org/misc/warnings.html#bulk-ess
Warning: Rows containing NAs were excluded from the model.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Compiling Stan program...
Trying to compile a simple C file</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running /Library/Frameworks/R.framework/Resources/bin/R CMD SHLIB foo.c
using C compiler: ‘Apple clang version 16.0.0 (clang-1600.0.26.3)’
using SDK: ‘MacOSX15.0.sdk’
clang -arch arm64 -std=gnu2x -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG   -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/Rcpp/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/unsupported"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/BH/include" -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/src/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppParallel/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/rstan/include" -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DUSE_STANC3 -DSTRICT_R_HEADERS  -DBOOST_PHOENIX_NO_VARIADIC_EXPRESSION  -D_HAS_AUTO_PTR_ETC=0  -include '/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp'  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/opt/R/arm64/include    -fPIC  -falign-functions=64 -Wall -g -O2  -c foo.c -o foo.o
In file included from &lt;built-in&gt;:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp:22:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Dense:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Core:19:
/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:679:10: fatal error: 'cmath' file not found
  679 | #include &lt;cmath&gt;
      |          ^~~~~~~
1 error generated.
make: *** [foo.o] Error 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.005365 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 53.65 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 1: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 1: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 1: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 1: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 1: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 1: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 1: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 1: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 1: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 1: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 1: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 1076.64 seconds (Warm-up)
Chain 1:                888.583 seconds (Sampling)
Chain 1:                1965.22 seconds (Total)
Chain 1: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 2).
Chain 2: 
Chain 2: Gradient evaluation took 0.003649 seconds
Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 36.49 seconds.
Chain 2: Adjust your expectations accordingly!
Chain 2: 
Chain 2: 
Chain 2: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 2: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 2: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 2: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 2: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 2: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 2: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 2: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 2: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 2: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 2: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 2: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 1083.35 seconds (Warm-up)
Chain 2:                883.934 seconds (Sampling)
Chain 2:                1967.28 seconds (Total)
Chain 2: </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.
Running the chains for more iterations may help. See
https://mc-stan.org/misc/warnings.html#bulk-ess</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Compiling Stan program...
Trying to compile a simple C file</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running /Library/Frameworks/R.framework/Resources/bin/R CMD SHLIB foo.c
using C compiler: ‘Apple clang version 16.0.0 (clang-1600.0.26.3)’
using SDK: ‘MacOSX15.0.sdk’
clang -arch arm64 -std=gnu2x -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG   -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/Rcpp/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/unsupported"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/BH/include" -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/src/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppParallel/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/rstan/include" -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DUSE_STANC3 -DSTRICT_R_HEADERS  -DBOOST_PHOENIX_NO_VARIADIC_EXPRESSION  -D_HAS_AUTO_PTR_ETC=0  -include '/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp'  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/opt/R/arm64/include    -fPIC  -falign-functions=64 -Wall -g -O2  -c foo.c -o foo.o
In file included from &lt;built-in&gt;:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp:22:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Dense:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Core:19:
/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:679:10: fatal error: 'cmath' file not found
  679 | #include &lt;cmath&gt;
      |          ^~~~~~~
1 error generated.
make: *** [foo.o] Error 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.004319 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 43.19 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 1: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 1: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 1: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 1: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 1: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 1: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 1: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 1: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 1: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 1: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 1: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 662.161 seconds (Warm-up)
Chain 1:                660.452 seconds (Sampling)
Chain 1:                1322.61 seconds (Total)
Chain 1: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 2).
Chain 2: 
Chain 2: Gradient evaluation took 0.0027 seconds
Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 27 seconds.
Chain 2: Adjust your expectations accordingly!
Chain 2: 
Chain 2: 
Chain 2: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 2: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 2: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 2: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 2: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 2: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 2: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 2: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 2: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 2: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 2: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 2: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 702.36 seconds (Warm-up)
Chain 2:                555.979 seconds (Sampling)
Chain 2:                1258.34 seconds (Total)
Chain 2: </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Found 23152 observations with a pareto_k &gt; 0.67 in model
'bayes_base_legis'. We recommend to run more iterations to get at least about
2200 posterior draws to improve LOO-CV approximation accuracy.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Found 18149 observations with a pareto_k &gt; 0.67 in model
'bayes_baseline_legis'. We recommend to run more iterations to get at least
about 2200 posterior draws to improve LOO-CV approximation accuracy.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Found 23418 observations with a pareto_k &gt; 0.67 in model
'bayes_raw_legis'. We recommend to run more iterations to get at least about
2200 posterior draws to improve LOO-CV approximation accuracy.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Found 21618 observations with a pareto_k &gt; 0.67 in model
'bayes_match_legis'. We recommend to run more iterations to get at least about
2200 posterior draws to improve LOO-CV approximation accuracy.</code></pre>
</div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Bayesian Model (legis) Comparison: LOOIC and Approximate Bayes-R2</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Model</th>
<th style="text-align: right;">LOOIC</th>
<th style="text-align: right;">Bayes_R2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Base-legis</td>
<td style="text-align: right;">3549.235</td>
<td style="text-align: right;">0.8072020</td>
</tr>
<tr class="even">
<td style="text-align: left;">Baseline-legis</td>
<td style="text-align: right;">3191.154</td>
<td style="text-align: right;">0.8128643</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Raw-legis</td>
<td style="text-align: right;">3485.638</td>
<td style="text-align: right;">0.8108141</td>
</tr>
<tr class="even">
<td style="text-align: left;">Match-legis</td>
<td style="text-align: right;">3549.503</td>
<td style="text-align: right;">0.8085644</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="posterior-diagnosis-1" class="level3" data-number="3.3.2">
<h3 data-number="3.3.2" class="anchored" data-anchor-id="posterior-diagnosis-1"><span class="header-section-number">3.3.2</span> posterior diagnosis</h3>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>------ BASE ------Rhat &gt; 1.01:
                                             b_Intercept 
                                                1.022416 
                                  sd_congress__Intercept 
                                                1.010351 
                                               Intercept 
                                                1.022416 
 r_full_name[Rep..Bilirakis,.Gus.M..[R-FL-12],Intercept] 
                                                1.010309 
     r_full_name[Rep..Gohmert,.Louie.[R-TX-1],Intercept] 
                                                1.010490 
       r_full_name[Rep..Hill,.Katie.[D-CA-25],Intercept] 
                                                1.013559 
     r_full_name[Rep..Jackson,.Jeff.[D-NC-14],Intercept] 
                                                1.010606 
        r_full_name[Rep..Mace,.Nancy.[R-SC-1],Intercept] 
                                                1.010423 
        r_full_name[Rep..Omar,.Ilhan.[D-MN-5],Intercept] 
                                                1.011757 
  r_full_name[Rep..Pittenger,.Robert.[R-NC-9],Intercept] 
                                                1.012045 
   r_full_name[Rep..Pressley,.Ayanna.[D-MA-7],Intercept] 
                                                1.019224 
     r_full_name[Rep..Rogers,.Harold.[R-KY-5],Intercept] 
                                                1.010576 
     r_full_name[Rep..Rush,.Bobby.L..[D-IL-1],Intercept] 
                                                1.011085 
         r_full_name[Rep..Ryan,.Tim.[D-OH-13],Intercept] 
                                                1.013539 
 r_full_name[Rep..Sánchez,.Linda.T..[D-CA-38],Intercept] 
                                                1.010311 
r_full_name[Rep..Toomey,.Patrick.J..[R-PA-15],Intercept] 
                                                1.014172 
  r_full_name[Rep..Wexton,.Jennifer.[D-VA-10],Intercept] 
                                                1.012862 
        r_full_name[Sen..Boozman,.John.[R-AR],Intercept] 
                                                1.012846 
                 r_issue[Agriculture.and.Food,Intercept] 
                                                1.024533 
     r_issue[Alliance.and.Collective.Security,Intercept] 
                                                1.019025 
                         r_issue[Armed.Forces,Intercept] 
                                                1.025324 
               r_issue[Art,.Culture,.Religion,Intercept] 
                                                1.023599 
                             r_issue[Commerce,Intercept] 
                                                1.022823 
   r_issue[Congressional.political.operations,Intercept] 
                                                1.023554 
            r_issue[Crime.and.Law.Enforcement,Intercept] 
                                                1.012687 
         r_issue[economics.and.public.finance,Intercept] 
                                                1.012135 
                 r_issue[emergency.management,Intercept] 
                                                1.010342 
                               r_issue[Energy,Intercept] 
                                                1.010423 
         r_issue[finance.and.financial.sector,Intercept] 
                                                1.014946 
    r_issue[Housing.and.Community.Development,Intercept] 
                                                1.022964 
                          r_issue[immigration,Intercept] 
                                                1.010114 
                    r_issue[National.Security,Intercept] 
                                                1.024697 

ESS &lt; 0.1:
named numeric(0)

Summary of Rhat:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.9984  1.0003  1.0018  1.0027  1.0037  1.0253 

Summary of ESS ratio:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.2309  0.6092  0.6924  0.6738  0.7581  0.9412 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>------ BASELINE ------Rhat &gt; 1.01:
                                        sd_congress__Intercept 
                                                      1.012903 
                                       sd_full_name__Intercept 
                                                      1.014556 
                                           sd_issue__Intercept 
                                                      1.014654 
     r_full_name[Rep..Arrington,.Jodey.C..[R-TX-19],Intercept] 
                                                      1.010367 
                r_full_name[Rep..Buck,.Ken.[R-CO-4],Intercept] 
                                                      1.010709 
           r_full_name[Rep..Gabbard,.Tulsi.[D-HI-2],Intercept] 
                                                      1.010732 
           r_full_name[Rep..Gohmert,.Louie.[R-TX-1],Intercept] 
                                                      1.010245 
      r_full_name[Rep..Hollingsworth,.Trey.[R-IN-9],Intercept] 
                                                      1.011104 
      r_full_name[Rep..Jeffries,.Hakeem.S..[D-NY-8],Intercept] 
                                                      1.010466 
         r_full_name[Rep..Luria,.Elaine.G..[D-VA-2],Intercept] 
                                                      1.014385 
r_full_name[Rep..Rosendale.Sr.,.Matthew.M..[R-MT-2],Intercept] 
                                                      1.011275 
           r_full_name[Rep..Schrader,.Kurt.[D-OR-5],Intercept] 
                                                      1.013835 
           r_full_name[Rep..Sherman,.Brad.[D-CA-32],Intercept] 
                                                      1.011106 
         r_full_name[Rep..Thornberry,.Mac.[R-TX-13],Intercept] 
                                                      1.010635 
            r_full_name[Rep..Womack,.Steve.[R-AR-3],Intercept] 
                                                      1.010253 
              r_full_name[Sen..Gardner,.Cory.[R-CO],Intercept] 
                                                      1.014024 
          r_full_name[Sen..Harris,.Kamala.D..[D-CA],Intercept] 
                                                      1.011830 
               r_issue[Finance.and.Financial.Sector,Intercept] 
                                                      1.014017 

ESS &lt; 0.1:
named numeric(0)

Summary of Rhat:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.9981  1.0002  1.0017  1.0024  1.0038  1.0147 

Summary of ESS ratio:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.1198  0.6416  0.7256  0.6968  0.7909  0.9430 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The ESS has been capped to avoid unstable estimates.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>------ RAW ------Rhat &gt; 1.01:
                                                   b_leverage6 
                                                      1.024444 
                                    b_payroll_mainConstruction 
                                                      1.015645 
                             b_payroll_mainFinanceandinsurance 
                                                      1.016197 
                   b_payroll_mainHealthcareandsocialassistance 
                                                      1.015910 
             b_payroll_mainManagementofcompaniesandenterprises 
                                                      1.013916 
                                   b_payroll_mainManufacturing 
                                                      1.017177 
           b_payroll_mainMiningquarryingandoilandgasextraction 
                                                      1.014399 
      b_payroll_mainProfessionalscientificandtechnicalservices 
                                                      1.014640 
                                       b_payroll_mainUtilities 
                                                      1.014587 
                       r_full_name[Claire.McCaskill,Intercept] 
                                                      1.018312 
                        r_full_name[Marjorie.Greene,Intercept] 
                                                      1.010173 
            r_full_name[Rep..Bergman,.Jack.[R-MI-1],Intercept] 
                                                      1.015615 
     r_full_name[Rep..Connolly,.Gerald.E..[D-VA-11],Intercept] 
                                                      1.010292 
              r_full_name[Rep..Ezell,.Mike.[R-MS-4],Intercept] 
                                                      1.013789 
              r_full_name[Rep..Gibbs,.Bob.[R-OH-18],Intercept] 
                                                      1.018771 
      r_full_name[Rep..Gimenez,.Carlos.A..[R-FL-26],Intercept] 
                                                      1.012904 
           r_full_name[Rep..Goodlatte,.Bob.[R-VA-6],Intercept] 
                                                      1.010789 
          r_full_name[Rep..Hudson,.Richard.[R-NC-9],Intercept] 
                                                      1.011338 
          r_full_name[Rep..Larson,.John.B..[D-CT-1],Intercept] 
                                                      1.011273 
             r_full_name[Rep..Levin,.Mike.[D-CA-49],Intercept] 
                                                      1.022457 
         r_full_name[Rep..McClain,.Lisa.C..[R-MI-9],Intercept] 
                                                      1.017694 
          r_full_name[Rep..Obernolte,.Jay.[R-CA-23],Intercept] 
                                                      1.022475 
       r_full_name[Rep..Palazzo,.Steven.M..[R-MS-4],Intercept] 
                                                      1.015870 
        r_full_name[Rep..Peters,.Scott.H..[D-CA-50],Intercept] 
                                                      1.011085 
        r_full_name[Rep..Ramirez,.Delia.C..[D-IL-3],Intercept] 
                                                      1.013902 
        r_full_name[Rep..Riggleman,.Denver.[R-VA-5],Intercept] 
                                                      1.011146 
               r_full_name[Rep..Rose,.Max.[D-NY-11],Intercept] 
                                                      1.010232 
           r_full_name[Rep..Rouda,.Harley.[D-CA-48],Intercept] 
                                                      1.016590 
r_full_name[Rep..Schneider,.Bradley.Scott.[D-IL-10],Intercept] 
                                                      1.011649 
         r_full_name[Rep..Sherrill,.Mikie.[D-NJ-11],Intercept] 
                                                      1.012393 
          r_full_name[Rep..Strong,.Dale.W..[R-AL-5],Intercept] 
                                                      1.014847 
             r_full_name[Rep..Walberg,.Tim.[R-MI-5],Intercept] 
                                                      1.016365 
       r_full_name[Rep..Williams,.Brandon.[R-NY-22],Intercept] 
                                                      1.016136 
         r_full_name[Rep..Williams,.Nikema.[D-GA-5],Intercept] 
                                                      1.012356 
            r_full_name[Sen..Loeffler,.Kelly.[R-GA],Intercept] 
                                                      1.010874 
             r_full_name[Sen..Lujan,.Ben.Ray.[D-NM],Intercept] 
                                                      1.010517 
            r_full_name[Sen..Risch,.James.E..[R-ID],Intercept] 
                                                      1.011059 
          r_full_name[Sen..Tuberville,.Tommy.[R-AL],Intercept] 
                                                      1.010192 
                            r_issue[foreign.affairs,Intercept] 
                                                      1.012572 
                      r_issue[International.Finance,Intercept] 
                                                      1.011162 

ESS &lt; 0.1:
named numeric(0)

Summary of Rhat:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  0.998   1.000   1.002   1.003   1.004   1.024 

Summary of ESS ratio:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.1316  0.6124  0.6863  0.6730  0.7564  0.9236 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>------ MATCH ------Rhat &gt; 1.01:
                                           sd_congress__Intercept 
                                                         1.013989 
                              r_full_name[Joe.Donnelly,Intercept] 
                                                         1.010897 
             r_full_name[Rep..Allen,.Rick.W..[R-GA-12],Intercept] 
                                                         1.011185 
          r_full_name[Rep..Bilirakis,.Gus.M..[R-FL-12],Intercept] 
                                                         1.010852 
             r_full_name[Rep..Cunningham,.Joe.[D-SC-1],Intercept] 
                                                         1.011564 
          r_full_name[Rep..Garcia,.Sylvia.R..[D-TX-29],Intercept] 
                                                         1.010553 
              r_full_name[Rep..Huffman,.Jared.[D-CA-2],Intercept] 
                                                         1.010972 
        r_full_name[Rep..Jackson.Lee,.Sheila.[D-TX-18],Intercept] 
                                                         1.011240 
              r_full_name[Rep..Jacobs,.Chris.[R-NY-27],Intercept] 
                                                         1.011418 
              r_full_name[Rep..LaHood,.Darin.[R-IL-16],Intercept] 
                                                         1.019481 
             r_full_name[Rep..McSally,.Martha.[R-AZ-2],Intercept] 
                                                         1.014521 
                 r_full_name[Rep..Ruiz,.Raul.[D-CA-25],Intercept] 
                                                         1.021104 
         r_full_name[Rep..Rutherford,.John.H..[R-FL-5],Intercept] 
                                                         1.010393 
r_full_name[Rep..Sensenbrenner,.F..James,.Jr..[R-WI-5],Intercept] 
                                                         1.020955 
               r_full_name[Rep..Womack,.Steve.[R-AR-3],Intercept] 
                                                         1.011226 
                r_full_name[Sen..Baldwin,.Tammy.[D-WI],Intercept] 
                                                         1.013849 
             r_full_name[Sen..Britt,.Katie.Boyd.[R-AL],Intercept] 
                                                         1.015372 
               r_full_name[Sen..Fetterman,.John.[D-PA],Intercept] 
                                                         1.013675 
                r_full_name[Sen..Klobuchar,.Amy.[D-MN],Intercept] 
                                                         1.011499 
                    r_full_name[Sen..Sasse,.Ben.[R-NE],Intercept] 
                                                         1.010037 
                 r_full_name[Sen..Schmitt,.Eric.[R-MO],Intercept] 
                                                         1.012054 
                   r_full_name[Sen..Scott,.Rick.[R-FL],Intercept] 
                                                         1.016615 
                                                             lp__ 
                                                         1.012281 

ESS &lt; 0.1:
named numeric(0)

Summary of Rhat:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.9983  1.0001  1.0018  1.0026  1.0043  1.0211 

Summary of ESS ratio:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.2282  0.6006  0.6811  0.6752  0.7531  0.9360 </code></pre>
</div>
</div>
</section>
<section id="auc-comparsion" class="level3" data-number="3.3.3">
<h3 data-number="3.3.3" class="anchored" data-anchor-id="auc-comparsion"><span class="header-section-number">3.3.3</span> auc comparsion</h3>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="output/legis_predictive%20auc%20comparison-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- AUC Bootstrap Tests ---
Base vs Baseline:
    Bootstrap test for two correlated ROC curves

data:  roc_list[[i]] and roc_list[[j]]
D = -0.88282, boot.n = 2000, boot.stratified = 1, p-value = 0.3773
alternative hypothesis: true difference in AUC is not equal to 0
sample estimates:
AUC of roc1 AUC of roc2 
  0.9906593   0.9908292 

Base vs Raw:
    Bootstrap test for two correlated ROC curves

data:  roc_list[[i]] and roc_list[[j]]
D = 0.76237, boot.n = 2000, boot.stratified = 1, p-value = 0.4458
alternative hypothesis: true difference in AUC is not equal to 0
sample estimates:
AUC of roc1 AUC of roc2 
  0.9906084   0.9904507 

Base vs Match:
    Bootstrap test for two correlated ROC curves

data:  roc_list[[i]] and roc_list[[j]]
D = -0.88281, boot.n = 2000, boot.stratified = 1, p-value = 0.3773
alternative hypothesis: true difference in AUC is not equal to 0
sample estimates:
AUC of roc1 AUC of roc2 
  0.9906084   0.9907111 

Baseline vs Raw:
    Bootstrap test for two correlated ROC curves

data:  roc_list[[i]] and roc_list[[j]]
D = 1.5269, boot.n = 2000, boot.stratified = 1, p-value = 0.1268
alternative hypothesis: true difference in AUC is not equal to 0
sample estimates:
AUC of roc1 AUC of roc2 
  0.9908292   0.9904464 

Baseline vs Match:
    Bootstrap test for two correlated ROC curves

data:  roc_list[[i]] and roc_list[[j]]
D = 0.36271, boot.n = 2000, boot.stratified = 1, p-value = 0.7168
alternative hypothesis: true difference in AUC is not equal to 0
sample estimates:
AUC of roc1 AUC of roc2 
  0.9908292   0.9907522 

Raw vs Match:
    Bootstrap test for two correlated ROC curves

data:  roc_list[[i]] and roc_list[[j]]
D = -1.1724, boot.n = 2000, boot.stratified = 1, p-value = 0.2411
alternative hypothesis: true difference in AUC is not equal to 0
sample estimates:
AUC of roc1 AUC of roc2 
  0.9904507   0.9907111 



Table: AUC Comparison on Test Set

|Model    |   AUC|
|:--------|-----:|
|Base     | 0.991|
|Baseline | 0.991|
|Raw      | 0.990|
|Match    | 0.991|</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>$roc_list
$roc_list$Base

Call:
roc.default(response = test_data[[label_var]], predictor = pred_probs)

Data: pred_probs in 13162 controls (test_data[[label_var]] 0) &lt; 1154 cases (test_data[[label_var]] 1).
Area under the curve: 0.9906

$roc_list$Baseline

Call:
roc.default(response = test_data[[label_var]], predictor = pred_probs)

Data: pred_probs in 12353 controls (test_data[[label_var]] 0) &lt; 1092 cases (test_data[[label_var]] 1).
Area under the curve: 0.9908

$roc_list$Raw

Call:
roc.default(response = test_data[[label_var]], predictor = pred_probs)

Data: pred_probs in 13162 controls (test_data[[label_var]] 0) &lt; 1154 cases (test_data[[label_var]] 1).
Area under the curve: 0.9905

$roc_list$Match

Call:
roc.default(response = test_data[[label_var]], predictor = pred_probs)

Data: pred_probs in 13162 controls (test_data[[label_var]] 0) &lt; 1154 cases (test_data[[label_var]] 1).
Area under the curve: 0.9907


$auc_table
# A tibble: 4 × 2
  Model      AUC
  &lt;chr&gt;    &lt;dbl&gt;
1 Base     0.991
2 Baseline 0.991
3 Raw      0.990
4 Match    0.991</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="discriminant-validity" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Discriminant Validity</h1>
<p><strong>Discriminant validity</strong> is examined by assessing whether the incremental introduction of first-, second-, and third-type features yields consistent and significant improvements in model performance. This is quantified using expected log predictive density (ELPD) under WAIC or LOO-CV criteria.</p>
<section id="model-setting" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="model-setting"><span class="header-section-number">4.1</span> model setting</h2>
<section id="comparions-with-shap-values-function" class="level3" data-number="4.1.1">
<h3 data-number="4.1.1" class="anchored" data-anchor-id="comparions-with-shap-values-function"><span class="header-section-number">4.1.1</span> comparions with shap values function</h3>
<p>the following three functions was meant to complete: compares bayesian model coefficients with SHAP values from lgbm models, specifically</p>
<ol type="1">
<li>aligns variables and compares directionality (signs)</li>
<li>computes pearson correlation and direction match rate</li>
<li>visualizes SHAP vs bayesian coefficients in a scatter plot # major goal: assessing model interpretability consistenct across frameworks</li>
</ol>
</section>
</section>
<section id="adver-1" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="adver-1"><span class="header-section-number">4.2</span> Adver</h2>
<section id="model-training-2" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="model-training-2"><span class="header-section-number">4.2.1</span> model training</h3>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Rows containing NAs were excluded from the model.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Compiling Stan program...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Trying to compile a simple C file</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running /Library/Frameworks/R.framework/Resources/bin/R CMD SHLIB foo.c
using C compiler: ‘Apple clang version 16.0.0 (clang-1600.0.26.3)’
using SDK: ‘MacOSX15.0.sdk’
clang -arch arm64 -std=gnu2x -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG   -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/Rcpp/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/unsupported"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/BH/include" -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/src/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppParallel/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/rstan/include" -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DUSE_STANC3 -DSTRICT_R_HEADERS  -DBOOST_PHOENIX_NO_VARIADIC_EXPRESSION  -D_HAS_AUTO_PTR_ETC=0  -include '/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp'  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/opt/R/arm64/include    -fPIC  -falign-functions=64 -Wall -g -O2  -c foo.c -o foo.o
In file included from &lt;built-in&gt;:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp:22:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Dense:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Core:19:
/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:679:10: fatal error: 'cmath' file not found
  679 | #include &lt;cmath&gt;
      |          ^~~~~~~
1 error generated.
make: *** [foo.o] Error 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.004137 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 41.37 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 1: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 1: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 1: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 1: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 1: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 1: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 1: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 1: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 1: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 1: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 1: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 208.289 seconds (Warm-up)
Chain 1:                169.547 seconds (Sampling)
Chain 1:                377.836 seconds (Total)
Chain 1: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 2).
Chain 2: 
Chain 2: Gradient evaluation took 0.002774 seconds
Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 27.74 seconds.
Chain 2: Adjust your expectations accordingly!
Chain 2: 
Chain 2: 
Chain 2: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 2: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 2: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 2: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 2: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 2: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 2: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 2: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 2: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 2: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 2: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 2: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 212.377 seconds (Warm-up)
Chain 2:                170.513 seconds (Sampling)
Chain 2:                382.89 seconds (Total)
Chain 2: </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There were 1 divergent transitions after warmup. See
https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup
to find out why this is a problem and how to eliminate them.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Examine the pairs() plot to diagnose sampling problems</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.
Running the chains for more iterations may help. See
https://mc-stan.org/misc/warnings.html#bulk-ess</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.
Running the chains for more iterations may help. See
https://mc-stan.org/misc/warnings.html#tail-ess</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Rows containing NAs were excluded from the model.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Compiling Stan program...
Trying to compile a simple C file</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running /Library/Frameworks/R.framework/Resources/bin/R CMD SHLIB foo.c
using C compiler: ‘Apple clang version 16.0.0 (clang-1600.0.26.3)’
using SDK: ‘MacOSX15.0.sdk’
clang -arch arm64 -std=gnu2x -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG   -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/Rcpp/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/unsupported"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/BH/include" -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/src/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppParallel/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/rstan/include" -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DUSE_STANC3 -DSTRICT_R_HEADERS  -DBOOST_PHOENIX_NO_VARIADIC_EXPRESSION  -D_HAS_AUTO_PTR_ETC=0  -include '/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp'  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/opt/R/arm64/include    -fPIC  -falign-functions=64 -Wall -g -O2  -c foo.c -o foo.o
In file included from &lt;built-in&gt;:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp:22:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Dense:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Core:19:
/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:679:10: fatal error: 'cmath' file not found
  679 | #include &lt;cmath&gt;
      |          ^~~~~~~
1 error generated.
make: *** [foo.o] Error 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.004278 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 42.78 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 1: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 1: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 1: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 1: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 1: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 1: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 1: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 1: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 1: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 1: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 1: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 338.631 seconds (Warm-up)
Chain 1:                355.114 seconds (Sampling)
Chain 1:                693.745 seconds (Total)
Chain 1: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 2).
Chain 2: 
Chain 2: Gradient evaluation took 0.002849 seconds
Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 28.49 seconds.
Chain 2: Adjust your expectations accordingly!
Chain 2: 
Chain 2: 
Chain 2: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 2: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 2: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 2: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 2: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 2: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 2: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 2: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 2: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 2: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 2: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 2: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 302.807 seconds (Warm-up)
Chain 2:                320.684 seconds (Sampling)
Chain 2:                623.491 seconds (Total)
Chain 2: </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.
Running the chains for more iterations may help. See
https://mc-stan.org/misc/warnings.html#bulk-ess
Warning: Rows containing NAs were excluded from the model.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Compiling Stan program...
Trying to compile a simple C file</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running /Library/Frameworks/R.framework/Resources/bin/R CMD SHLIB foo.c
using C compiler: ‘Apple clang version 16.0.0 (clang-1600.0.26.3)’
using SDK: ‘MacOSX15.0.sdk’
clang -arch arm64 -std=gnu2x -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG   -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/Rcpp/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/unsupported"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/BH/include" -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/src/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppParallel/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/rstan/include" -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DUSE_STANC3 -DSTRICT_R_HEADERS  -DBOOST_PHOENIX_NO_VARIADIC_EXPRESSION  -D_HAS_AUTO_PTR_ETC=0  -include '/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp'  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/opt/R/arm64/include    -fPIC  -falign-functions=64 -Wall -g -O2  -c foo.c -o foo.o
In file included from &lt;built-in&gt;:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp:22:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Dense:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Core:19:
/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:679:10: fatal error: 'cmath' file not found
  679 | #include &lt;cmath&gt;
      |          ^~~~~~~
1 error generated.
make: *** [foo.o] Error 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.005 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 50 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 1: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 1: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 1: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 1: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 1: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 1: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 1: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 1: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 1: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 1: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 1: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 505.052 seconds (Warm-up)
Chain 1:                482.624 seconds (Sampling)
Chain 1:                987.676 seconds (Total)
Chain 1: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 2).
Chain 2: 
Chain 2: Gradient evaluation took 0.003206 seconds
Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 32.06 seconds.
Chain 2: Adjust your expectations accordingly!
Chain 2: 
Chain 2: 
Chain 2: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 2: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 2: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 2: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 2: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 2: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 2: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 2: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 2: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 2: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 2: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 2: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 495.2 seconds (Warm-up)
Chain 2:                405.784 seconds (Sampling)
Chain 2:                900.984 seconds (Total)
Chain 2: </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.
Running the chains for more iterations may help. See
https://mc-stan.org/misc/warnings.html#bulk-ess
Warning: Rows containing NAs were excluded from the model.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Compiling Stan program...
Trying to compile a simple C file</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running /Library/Frameworks/R.framework/Resources/bin/R CMD SHLIB foo.c
using C compiler: ‘Apple clang version 16.0.0 (clang-1600.0.26.3)’
using SDK: ‘MacOSX15.0.sdk’
clang -arch arm64 -std=gnu2x -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG   -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/Rcpp/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/unsupported"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/BH/include" -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/src/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppParallel/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/rstan/include" -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DUSE_STANC3 -DSTRICT_R_HEADERS  -DBOOST_PHOENIX_NO_VARIADIC_EXPRESSION  -D_HAS_AUTO_PTR_ETC=0  -include '/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp'  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/opt/R/arm64/include    -fPIC  -falign-functions=64 -Wall -g -O2  -c foo.c -o foo.o
In file included from &lt;built-in&gt;:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp:22:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Dense:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Core:19:
/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:679:10: fatal error: 'cmath' file not found
  679 | #include &lt;cmath&gt;
      |          ^~~~~~~
1 error generated.
make: *** [foo.o] Error 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.00503 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 50.3 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 1: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 1: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 1: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 1: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 1: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 1: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 1: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 1: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 1: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 1: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 1: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 495.006 seconds (Warm-up)
Chain 1:                379.235 seconds (Sampling)
Chain 1:                874.241 seconds (Total)
Chain 1: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 2).
Chain 2: 
Chain 2: Gradient evaluation took 0.003108 seconds
Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 31.08 seconds.
Chain 2: Adjust your expectations accordingly!
Chain 2: 
Chain 2: 
Chain 2: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 2: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 2: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 2: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 2: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 2: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 2: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 2: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 2: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 2: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 2: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 2: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 444.274 seconds (Warm-up)
Chain 2:                376.012 seconds (Sampling)
Chain 2:                820.286 seconds (Total)
Chain 2: </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.
Running the chains for more iterations may help. See
https://mc-stan.org/misc/warnings.html#bulk-ess</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.
Running the chains for more iterations may help. See
https://mc-stan.org/misc/warnings.html#tail-ess</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Rows containing NAs were excluded from the model.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Compiling Stan program...
Trying to compile a simple C file</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running /Library/Frameworks/R.framework/Resources/bin/R CMD SHLIB foo.c
using C compiler: ‘Apple clang version 16.0.0 (clang-1600.0.26.3)’
using SDK: ‘MacOSX15.0.sdk’
clang -arch arm64 -std=gnu2x -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG   -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/Rcpp/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/unsupported"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/BH/include" -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/src/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppParallel/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/rstan/include" -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DUSE_STANC3 -DSTRICT_R_HEADERS  -DBOOST_PHOENIX_NO_VARIADIC_EXPRESSION  -D_HAS_AUTO_PTR_ETC=0  -include '/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp'  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/opt/R/arm64/include    -fPIC  -falign-functions=64 -Wall -g -O2  -c foo.c -o foo.o
In file included from &lt;built-in&gt;:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp:22:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Dense:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Core:19:
/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:679:10: fatal error: 'cmath' file not found
  679 | #include &lt;cmath&gt;
      |          ^~~~~~~
1 error generated.
make: *** [foo.o] Error 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.004876 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 48.76 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 1: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 1: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 1: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 1: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 1: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 1: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 1: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 1: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 1: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 1: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 1: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 328.862 seconds (Warm-up)
Chain 1:                356.419 seconds (Sampling)
Chain 1:                685.281 seconds (Total)
Chain 1: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 2).
Chain 2: 
Chain 2: Gradient evaluation took 0.002842 seconds
Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 28.42 seconds.
Chain 2: Adjust your expectations accordingly!
Chain 2: 
Chain 2: 
Chain 2: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 2: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 2: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 2: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 2: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 2: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 2: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 2: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 2: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 2: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 2: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 2: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 319.817 seconds (Warm-up)
Chain 2:                356.555 seconds (Sampling)
Chain 2:                676.372 seconds (Total)
Chain 2: </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.
Running the chains for more iterations may help. See
https://mc-stan.org/misc/warnings.html#bulk-ess
Warning: Rows containing NAs were excluded from the model.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Compiling Stan program...
Trying to compile a simple C file</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running /Library/Frameworks/R.framework/Resources/bin/R CMD SHLIB foo.c
using C compiler: ‘Apple clang version 16.0.0 (clang-1600.0.26.3)’
using SDK: ‘MacOSX15.0.sdk’
clang -arch arm64 -std=gnu2x -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG   -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/Rcpp/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/unsupported"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/BH/include" -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/src/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppParallel/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/rstan/include" -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DUSE_STANC3 -DSTRICT_R_HEADERS  -DBOOST_PHOENIX_NO_VARIADIC_EXPRESSION  -D_HAS_AUTO_PTR_ETC=0  -include '/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp'  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/opt/R/arm64/include    -fPIC  -falign-functions=64 -Wall -g -O2  -c foo.c -o foo.o
In file included from &lt;built-in&gt;:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp:22:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Dense:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Core:19:
/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:679:10: fatal error: 'cmath' file not found
  679 | #include &lt;cmath&gt;
      |          ^~~~~~~
1 error generated.
make: *** [foo.o] Error 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.005074 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 50.74 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 1: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 1: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 1: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 1: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 1: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 1: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 1: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 1: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 1: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 1: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 1: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 469.18 seconds (Warm-up)
Chain 1:                393.349 seconds (Sampling)
Chain 1:                862.529 seconds (Total)
Chain 1: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 2).
Chain 2: 
Chain 2: Gradient evaluation took 0.00334 seconds
Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 33.4 seconds.
Chain 2: Adjust your expectations accordingly!
Chain 2: 
Chain 2: 
Chain 2: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 2: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 2: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 2: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 2: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 2: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 2: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 2: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 2: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 2: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 2: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 2: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 521.655 seconds (Warm-up)
Chain 2:                433.037 seconds (Sampling)
Chain 2:                954.692 seconds (Total)
Chain 2: </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.
Running the chains for more iterations may help. See
https://mc-stan.org/misc/warnings.html#bulk-ess</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.
Running the chains for more iterations may help. See
https://mc-stan.org/misc/warnings.html#tail-ess</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Found 1 observations with a pareto_k &gt; 0.67 in model 'bayes_base'. We
recommend to run more iterations to get at least about 2200 posterior draws to
improve LOO-CV approximation accuracy.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Found 1 observations with a pareto_k &gt; 0.7 in model 'bayes_intldom'.
We recommend to set 'moment_match = TRUE' in order to perform moment matching
for problematic observations.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Found 2 observations with a pareto_k &gt; 0.67 in model 'bayes_match'. We
recommend to run more iterations to get at least about 2200 posterior draws to
improve LOO-CV approximation accuracy.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -12002.13</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -11992.19</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -11908.86</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -11919.71</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -11909.75</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>               elpd_diff se_diff
bayes_domprof    0.0       0.0  
bayes_match     -0.9       1.3  
bayes_intlprof -10.8       6.7  
bayes_intldom  -83.3      14.2  
bayes_intl     -93.3      15.6  
bayes_base     -95.0      15.6  </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in plot.window(...): "label_points" is not a graphical parameter</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in plot.xy(xy, type, ...): "label_points" is not a graphical parameter</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in axis(side = side, at = at, labels = labels, ...): "label_points" is
not a graphical parameter
Warning in axis(side = side, at = at, labels = labels, ...): "label_points" is
not a graphical parameter</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in box(...): "label_points" is not a graphical parameter</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in title(...): "label_points" is not a graphical parameter</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="output/adver_discriminant%20results-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Bayesian Pseudo R² Comparison (Mechanism Models)</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Model</th>
<th style="text-align: right;">Pseudo_R2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">BASE</td>
<td style="text-align: right;">0.3068203</td>
</tr>
<tr class="even">
<td style="text-align: left;">INTL</td>
<td style="text-align: right;">0.3068295</td>
</tr>
<tr class="odd">
<td style="text-align: left;">INTLDOM</td>
<td style="text-align: right;">0.3082570</td>
</tr>
<tr class="even">
<td style="text-align: left;">DOMPROF</td>
<td style="text-align: right;">0.3138699</td>
</tr>
<tr class="odd">
<td style="text-align: left;">INTLPROF</td>
<td style="text-align: right;">0.3124632</td>
</tr>
<tr class="even">
<td style="text-align: left;">ALL</td>
<td style="text-align: right;">0.3137047</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="variables-importance-comparison" class="level3" data-number="4.2.2">
<h3 data-number="4.2.2" class="anchored" data-anchor-id="variables-importance-comparison"><span class="header-section-number">4.2.2</span> variables importance comparison</h3>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>✅ plot saves to: output/bayes_value_importance/bayes_coef_plot_BASE.png</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>📄 tables saves to: output/bayes_value_importance/bayes_coef_table_BASE.csv</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✅ plot saves to: output/bayes_value_importance/bayes_coef_plot_INTL.png</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>📄 tables saves to: output/bayes_value_importance/bayes_coef_table_INTL.csv</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✅ plot saves to: output/bayes_value_importance/bayes_coef_plot_INTLDOM.png</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>📄 tables saves to: output/bayes_value_importance/bayes_coef_table_INTLDOM.csv</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✅ plot saves to: output/bayes_value_importance/bayes_coef_plot_DOMPROF.png</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>📄 tables saves to: output/bayes_value_importance/bayes_coef_table_DOMPROF.csv</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✅ plot saves to: output/bayes_value_importance/bayes_coef_plot_INTLPROF.png</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>📄 tables saves to: output/bayes_value_importance/bayes_coef_table_INTLPROF.csv</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✅ plot saves to: output/bayes_value_importance/bayes_coef_plot_MATCH.png</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>📄 tables saves to: output/bayes_value_importance/bayes_coef_table_MATCH.csv</code></pre>
</div>
</div>
</section>
<section id="comparions-with-shap-values" class="level3" data-number="4.2.3">
<h3 data-number="4.2.3" class="anchored" data-anchor-id="comparions-with-shap-values"><span class="header-section-number">4.2.3</span> comparions with shap values</h3>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>$INTL
$INTL$summary
# A tibble: 1 × 3
  Direction_Match_Rate Pearson_Correlation Abs_Value_Correlation
                 &lt;dbl&gt;               &lt;dbl&gt;                 &lt;dbl&gt;
1                  0.5                  -1                     1

$INTL$detail
# A tibble: 2 × 10
  var_clean   coef_logit n_coefs shap_value abs_coef_logit abs_shap_value
  &lt;chr&gt;            &lt;dbl&gt;   &lt;int&gt;      &lt;dbl&gt;          &lt;dbl&gt;          &lt;dbl&gt;
1 leverage_ne    -0.639        3    0.00796         0.639         0.00796
2 leverage_pl    -0.0332       3   -0.00744         0.0332        0.00744
# ℹ 4 more variables: dir_logit &lt;dbl&gt;, dir_shap &lt;dbl&gt;, direction_match &lt;lgl&gt;,
#   direction_mismatch &lt;lgl&gt;

$INTL$plot</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="output/adver_discriminant%20with%20shap%20values%20adver-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>

$INTLDOM
$INTLDOM$summary
# A tibble: 1 × 3
  Direction_Match_Rate Pearson_Correlation Abs_Value_Correlation
                 &lt;dbl&gt;               &lt;dbl&gt;                 &lt;dbl&gt;
1                0.583             -0.0951               -0.0568

$INTLDOM$detail
# A tibble: 12 × 10
   var_clean         coef_logit n_coefs shap_value abs_coef_logit abs_shap_value
   &lt;chr&gt;                  &lt;dbl&gt;   &lt;int&gt;      &lt;dbl&gt;          &lt;dbl&gt;          &lt;dbl&gt;
 1 employ_industry_…     0.624        1   0.000291         0.624        0.000291
 2 employ_industry_…     0.0976       3   0.00217          0.0976       0.00217 
 3 ethnicity_ne         -0.0359       1   0.00424          0.0359       0.00424 
 4 ethnicity_pl          0.0869       3   0.00434          0.0869       0.00434 
 5 leverage_ne          -0.716        3   0.00796          0.716        0.00796 
 6 leverage_pl          -0.0437       3  -0.00744          0.0437       0.00744 
 7 party_score_ne        0.0408       1  -0.0281           0.0408       0.0281  
 8 party_score_pl        0.215        1   0.0128           0.215        0.0128  
 9 party_value_ne       -0.143        1   0.000349         0.143        0.000349
10 party_value_pl        0.0558       1   0.000477         0.0558       0.000477
11 payroll_industry…     0.0225       1   0.000168         0.0225       0.000168
12 payroll_industry…    -0.0179       3   0.00114          0.0179       0.00114 
# ℹ 4 more variables: dir_logit &lt;dbl&gt;, dir_shap &lt;dbl&gt;, direction_match &lt;lgl&gt;,
#   direction_mismatch &lt;lgl&gt;

$INTLDOM$plot</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="output/adver_discriminant%20with%20shap%20values%20adver-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>

$DOMPROF
$DOMPROF$summary
# A tibble: 1 × 3
  Direction_Match_Rate Pearson_Correlation Abs_Value_Correlation
                 &lt;dbl&gt;               &lt;dbl&gt;                 &lt;dbl&gt;
1                0.667               0.163                -0.222

$DOMPROF$detail
# A tibble: 12 × 10
   var_clean         coef_logit n_coefs shap_value abs_coef_logit abs_shap_value
   &lt;chr&gt;                  &lt;dbl&gt;   &lt;int&gt;      &lt;dbl&gt;          &lt;dbl&gt;          &lt;dbl&gt;
 1 committee_ne         0.347         1 -0.0000547        0.347        0.0000547
 2 committee_pl         0.130         3  0.0000479        0.130        0.0000479
 3 employ_industry_…    0.438         1  0.000291         0.438        0.000291 
 4 employ_industry_…    0.234         3  0.00217          0.234        0.00217  
 5 ethnicity_ne         0.0351        1  0.00424          0.0351       0.00424  
 6 ethnicity_pl         0.00929       3  0.00434          0.00929      0.00434  
 7 party_score_ne       0.0428        1 -0.0281           0.0428       0.0281   
 8 party_score_pl       0.212         1  0.0128           0.212        0.0128   
 9 party_value_ne      -0.0557        1  0.000349         0.0557       0.000349 
10 party_value_pl       0.145         1  0.000477         0.145        0.000477 
11 payroll_industry…    0.0318        1  0.000168         0.0318       0.000168 
12 payroll_industry…   -0.0276        3  0.00114          0.0276       0.00114  
# ℹ 4 more variables: dir_logit &lt;dbl&gt;, dir_shap &lt;dbl&gt;, direction_match &lt;lgl&gt;,
#   direction_mismatch &lt;lgl&gt;

$DOMPROF$plot</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="output/adver_discriminant%20with%20shap%20values%20adver-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>

$INTLPROF
$INTLPROF$summary
# A tibble: 1 × 3
  Direction_Match_Rate Pearson_Correlation Abs_Value_Correlation
                 &lt;dbl&gt;               &lt;dbl&gt;                 &lt;dbl&gt;
1                  0.5              -0.546                 0.351

$INTLPROF$detail
# A tibble: 4 × 10
  var_clean    coef_logit n_coefs shap_value abs_coef_logit abs_shap_value
  &lt;chr&gt;             &lt;dbl&gt;   &lt;int&gt;      &lt;dbl&gt;          &lt;dbl&gt;          &lt;dbl&gt;
1 committee_ne     0.414        1 -0.0000547         0.414       0.0000547
2 committee_pl     0.0634       3  0.0000479         0.0634      0.0000479
3 leverage_ne     -0.699        3  0.00796           0.699       0.00796  
4 leverage_pl     -0.101        3 -0.00744           0.101       0.00744  
# ℹ 4 more variables: dir_logit &lt;dbl&gt;, dir_shap &lt;dbl&gt;, direction_match &lt;lgl&gt;,
#   direction_mismatch &lt;lgl&gt;

$INTLPROF$plot</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="output/adver_discriminant%20with%20shap%20values%20adver-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>

$MATCH
$MATCH$summary
# A tibble: 1 × 3
  Direction_Match_Rate Pearson_Correlation Abs_Value_Correlation
                 &lt;dbl&gt;               &lt;dbl&gt;                 &lt;dbl&gt;
1                  0.5             -0.0597               -0.0871

$MATCH$detail
# A tibble: 14 × 10
   var_clean         coef_logit n_coefs shap_value abs_coef_logit abs_shap_value
   &lt;chr&gt;                  &lt;dbl&gt;   &lt;int&gt;      &lt;dbl&gt;          &lt;dbl&gt;          &lt;dbl&gt;
 1 committee_ne         0.403         1 -0.0000547        0.403        0.0000547
 2 committee_pl         0.0756        3  0.0000479        0.0756       0.0000479
 3 employ_industry_…    0.432         1  0.000291         0.432        0.000291 
 4 employ_industry_…    0.203         3  0.00217          0.203        0.00217  
 5 ethnicity_ne        -0.176         1  0.00424          0.176        0.00424  
 6 ethnicity_pl         0.219         3  0.00434          0.219        0.00434  
 7 leverage_ne         -0.739         3  0.00796          0.739        0.00796  
 8 leverage_pl         -0.180         3 -0.00744          0.180        0.00744  
 9 party_score_ne       0.0414        1 -0.0281           0.0414       0.0281   
10 party_score_pl       0.214         1  0.0128           0.214        0.0128   
11 party_value_ne      -0.209         1  0.000349         0.209        0.000349 
12 party_value_pl      -0.00933       1  0.000477         0.00933      0.000477 
13 payroll_industry…   -0.0749        1  0.000168         0.0749       0.000168 
14 payroll_industry…    0.102         3  0.00114          0.102        0.00114  
# ℹ 4 more variables: dir_logit &lt;dbl&gt;, dir_shap &lt;dbl&gt;, direction_match &lt;lgl&gt;,
#   direction_mismatch &lt;lgl&gt;

$MATCH$plot</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="output/adver_discriminant%20with%20shap%20values%20adver-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
  Model    Direction_Match_Rate Pearson_Correlation Abs_Correlation
  &lt;chr&gt;                   &lt;dbl&gt;               &lt;dbl&gt;           &lt;dbl&gt;
1 INTL                    0.5               -1               1     
2 INTLDOM                 0.583             -0.0951         -0.0568
3 DOMPROF                 0.667              0.163          -0.222 
4 INTLPROF                0.5               -0.546           0.351 
5 MATCH                   0.5               -0.0597         -0.0871</code></pre>
</div>
</div>
</section>
</section>
<section id="legis-1" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="legis-1"><span class="header-section-number">4.3</span> Legis</h2>
<section id="model-training-3" class="level3" data-number="4.3.1">
<h3 data-number="4.3.1" class="anchored" data-anchor-id="model-training-3"><span class="header-section-number">4.3.1</span> model training</h3>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Compiling Stan program...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Trying to compile a simple C file</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running /Library/Frameworks/R.framework/Resources/bin/R CMD SHLIB foo.c
using C compiler: ‘Apple clang version 16.0.0 (clang-1600.0.26.3)’
using SDK: ‘MacOSX15.0.sdk’
clang -arch arm64 -std=gnu2x -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG   -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/Rcpp/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/unsupported"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/BH/include" -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/src/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppParallel/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/rstan/include" -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DUSE_STANC3 -DSTRICT_R_HEADERS  -DBOOST_PHOENIX_NO_VARIADIC_EXPRESSION  -D_HAS_AUTO_PTR_ETC=0  -include '/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp'  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/opt/R/arm64/include    -fPIC  -falign-functions=64 -Wall -g -O2  -c foo.c -o foo.o
In file included from &lt;built-in&gt;:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp:22:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Dense:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Core:19:
/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:679:10: fatal error: 'cmath' file not found
  679 | #include &lt;cmath&gt;
      |          ^~~~~~~
1 error generated.
make: *** [foo.o] Error 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.004081 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 40.81 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 1: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 1: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 1: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 1: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 1: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 1: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 1: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 1: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 1: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 1: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 1: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 488.152 seconds (Warm-up)
Chain 1:                284.988 seconds (Sampling)
Chain 1:                773.14 seconds (Total)
Chain 1: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 2).
Chain 2: 
Chain 2: Gradient evaluation took 0.002335 seconds
Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 23.35 seconds.
Chain 2: Adjust your expectations accordingly!
Chain 2: 
Chain 2: 
Chain 2: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 2: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 2: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 2: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 2: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 2: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 2: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 2: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 2: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 2: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 2: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 2: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 403.432 seconds (Warm-up)
Chain 2:                286.852 seconds (Sampling)
Chain 2:                690.284 seconds (Total)
Chain 2: </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.
Running the chains for more iterations may help. See
https://mc-stan.org/misc/warnings.html#bulk-ess</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Compiling Stan program...
Trying to compile a simple C file</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running /Library/Frameworks/R.framework/Resources/bin/R CMD SHLIB foo.c
using C compiler: ‘Apple clang version 16.0.0 (clang-1600.0.26.3)’
using SDK: ‘MacOSX15.0.sdk’
clang -arch arm64 -std=gnu2x -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG   -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/Rcpp/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/unsupported"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/BH/include" -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/src/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppParallel/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/rstan/include" -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DUSE_STANC3 -DSTRICT_R_HEADERS  -DBOOST_PHOENIX_NO_VARIADIC_EXPRESSION  -D_HAS_AUTO_PTR_ETC=0  -include '/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp'  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/opt/R/arm64/include    -fPIC  -falign-functions=64 -Wall -g -O2  -c foo.c -o foo.o
In file included from &lt;built-in&gt;:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp:22:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Dense:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Core:19:
/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:679:10: fatal error: 'cmath' file not found
  679 | #include &lt;cmath&gt;
      |          ^~~~~~~
1 error generated.
make: *** [foo.o] Error 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.003553 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 35.53 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 1: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 1: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 1: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 1: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 1: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 1: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 1: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 1: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 1: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 1: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 1: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 524.265 seconds (Warm-up)
Chain 1:                602.525 seconds (Sampling)
Chain 1:                1126.79 seconds (Total)
Chain 1: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 2).
Chain 2: 
Chain 2: Gradient evaluation took 0.002415 seconds
Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 24.15 seconds.
Chain 2: Adjust your expectations accordingly!
Chain 2: 
Chain 2: 
Chain 2: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 2: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 2: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 2: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 2: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 2: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 2: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 2: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 2: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 2: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 2: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 2: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 551.329 seconds (Warm-up)
Chain 2:                549.207 seconds (Sampling)
Chain 2:                1100.54 seconds (Total)
Chain 2: </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Compiling Stan program...
Trying to compile a simple C file</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running /Library/Frameworks/R.framework/Resources/bin/R CMD SHLIB foo.c
using C compiler: ‘Apple clang version 16.0.0 (clang-1600.0.26.3)’
using SDK: ‘MacOSX15.0.sdk’
clang -arch arm64 -std=gnu2x -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG   -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/Rcpp/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/unsupported"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/BH/include" -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/src/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppParallel/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/rstan/include" -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DUSE_STANC3 -DSTRICT_R_HEADERS  -DBOOST_PHOENIX_NO_VARIADIC_EXPRESSION  -D_HAS_AUTO_PTR_ETC=0  -include '/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp'  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/opt/R/arm64/include    -fPIC  -falign-functions=64 -Wall -g -O2  -c foo.c -o foo.o
In file included from &lt;built-in&gt;:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp:22:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Dense:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Core:19:
/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:679:10: fatal error: 'cmath' file not found
  679 | #include &lt;cmath&gt;
      |          ^~~~~~~
1 error generated.
make: *** [foo.o] Error 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.00376 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 37.6 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 1: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 1: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 1: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 1: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 1: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 1: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 1: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 1: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 1: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 1: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 1: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 606.562 seconds (Warm-up)
Chain 1:                332.032 seconds (Sampling)
Chain 1:                938.594 seconds (Total)
Chain 1: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 2).
Chain 2: 
Chain 2: Gradient evaluation took 0.002678 seconds
Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 26.78 seconds.
Chain 2: Adjust your expectations accordingly!
Chain 2: 
Chain 2: 
Chain 2: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 2: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 2: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 2: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 2: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 2: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 2: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 2: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 2: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 2: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 2: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 2: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 579.484 seconds (Warm-up)
Chain 2:                333.462 seconds (Sampling)
Chain 2:                912.946 seconds (Total)
Chain 2: </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.
Running the chains for more iterations may help. See
https://mc-stan.org/misc/warnings.html#bulk-ess</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Compiling Stan program...
Trying to compile a simple C file</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running /Library/Frameworks/R.framework/Resources/bin/R CMD SHLIB foo.c
using C compiler: ‘Apple clang version 16.0.0 (clang-1600.0.26.3)’
using SDK: ‘MacOSX15.0.sdk’
clang -arch arm64 -std=gnu2x -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG   -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/Rcpp/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/unsupported"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/BH/include" -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/src/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppParallel/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/rstan/include" -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DUSE_STANC3 -DSTRICT_R_HEADERS  -DBOOST_PHOENIX_NO_VARIADIC_EXPRESSION  -D_HAS_AUTO_PTR_ETC=0  -include '/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp'  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/opt/R/arm64/include    -fPIC  -falign-functions=64 -Wall -g -O2  -c foo.c -o foo.o
In file included from &lt;built-in&gt;:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp:22:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Dense:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Core:19:
/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:679:10: fatal error: 'cmath' file not found
  679 | #include &lt;cmath&gt;
      |          ^~~~~~~
1 error generated.
make: *** [foo.o] Error 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.003501 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 35.01 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 1: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 1: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 1: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 1: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 1: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 1: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 1: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 1: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 1: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 1: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 1: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 488.389 seconds (Warm-up)
Chain 1:                374.22 seconds (Sampling)
Chain 1:                862.609 seconds (Total)
Chain 1: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 2).
Chain 2: 
Chain 2: Gradient evaluation took 0.002689 seconds
Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 26.89 seconds.
Chain 2: Adjust your expectations accordingly!
Chain 2: 
Chain 2: 
Chain 2: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 2: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 2: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 2: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 2: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 2: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 2: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 2: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 2: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 2: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 2: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 2: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 522.697 seconds (Warm-up)
Chain 2:                337.22 seconds (Sampling)
Chain 2:                859.917 seconds (Total)
Chain 2: </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.
Running the chains for more iterations may help. See
https://mc-stan.org/misc/warnings.html#bulk-ess</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.
Running the chains for more iterations may help. See
https://mc-stan.org/misc/warnings.html#tail-ess</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Compiling Stan program...
Trying to compile a simple C file</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running /Library/Frameworks/R.framework/Resources/bin/R CMD SHLIB foo.c
using C compiler: ‘Apple clang version 16.0.0 (clang-1600.0.26.3)’
using SDK: ‘MacOSX15.0.sdk’
clang -arch arm64 -std=gnu2x -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG   -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/Rcpp/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/unsupported"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/BH/include" -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/src/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppParallel/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/rstan/include" -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DUSE_STANC3 -DSTRICT_R_HEADERS  -DBOOST_PHOENIX_NO_VARIADIC_EXPRESSION  -D_HAS_AUTO_PTR_ETC=0  -include '/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp'  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/opt/R/arm64/include    -fPIC  -falign-functions=64 -Wall -g -O2  -c foo.c -o foo.o
In file included from &lt;built-in&gt;:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp:22:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Dense:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Core:19:
/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:679:10: fatal error: 'cmath' file not found
  679 | #include &lt;cmath&gt;
      |          ^~~~~~~
1 error generated.
make: *** [foo.o] Error 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.003463 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 34.63 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 1: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 1: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 1: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 1: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 1: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 1: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 1: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 1: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 1: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 1: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 1: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 577.818 seconds (Warm-up)
Chain 1:                635.483 seconds (Sampling)
Chain 1:                1213.3 seconds (Total)
Chain 1: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 2).
Chain 2: 
Chain 2: Gradient evaluation took 0.002524 seconds
Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 25.24 seconds.
Chain 2: Adjust your expectations accordingly!
Chain 2: 
Chain 2: 
Chain 2: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 2: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 2: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 2: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 2: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 2: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 2: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 2: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 2: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 2: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 2: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 2: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 552.186 seconds (Warm-up)
Chain 2:                601.335 seconds (Sampling)
Chain 2:                1153.52 seconds (Total)
Chain 2: </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There were 1 divergent transitions after warmup. See
https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup
to find out why this is a problem and how to eliminate them.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Examine the pairs() plot to diagnose sampling problems</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Compiling Stan program...
Trying to compile a simple C file</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running /Library/Frameworks/R.framework/Resources/bin/R CMD SHLIB foo.c
using C compiler: ‘Apple clang version 16.0.0 (clang-1600.0.26.3)’
using SDK: ‘MacOSX15.0.sdk’
clang -arch arm64 -std=gnu2x -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG   -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/Rcpp/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/unsupported"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/BH/include" -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/src/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppParallel/include/"  -I"/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/rstan/include" -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DUSE_STANC3 -DSTRICT_R_HEADERS  -DBOOST_PHOENIX_NO_VARIADIC_EXPRESSION  -D_HAS_AUTO_PTR_ETC=0  -include '/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp'  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/opt/R/arm64/include    -fPIC  -falign-functions=64 -Wall -g -O2  -c foo.c -o foo.o
In file included from &lt;built-in&gt;:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp:22:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Dense:1:
In file included from /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/Core:19:
/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:679:10: fatal error: 'cmath' file not found
  679 | #include &lt;cmath&gt;
      |          ^~~~~~~
1 error generated.
make: *** [foo.o] Error 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.003779 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 37.79 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 1: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 1: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 1: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 1: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 1: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 1: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 1: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 1: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 1: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 1: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 1: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 599.746 seconds (Warm-up)
Chain 1:                655.141 seconds (Sampling)
Chain 1:                1254.89 seconds (Total)
Chain 1: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 2).
Chain 2: 
Chain 2: Gradient evaluation took 0.002981 seconds
Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 29.81 seconds.
Chain 2: Adjust your expectations accordingly!
Chain 2: 
Chain 2: 
Chain 2: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 2: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 2: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 2: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 2: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 2: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 2: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 2: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 2: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 2: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 2: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 2: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 451.246 seconds (Warm-up)
Chain 2:                387.224 seconds (Sampling)
Chain 2:                838.47 seconds (Total)
Chain 2: </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Found 23244 observations with a pareto_k &gt; 0.67 in model
'bayes_base_legis'. We recommend to run more iterations to get at least about
2200 posterior draws to improve LOO-CV approximation accuracy.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Found 22461 observations with a pareto_k &gt; 0.67 in model
'bayes_intl_legis'. We recommend to run more iterations to get at least about
2200 posterior draws to improve LOO-CV approximation accuracy.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Found 22700 observations with a pareto_k &gt; 0.67 in model
'bayes_intldom_legis'. We recommend to run more iterations to get at least
about 2200 posterior draws to improve LOO-CV approximation accuracy.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Found 22679 observations with a pareto_k &gt; 0.67 in model
'bayes_domprof_legis'. We recommend to run more iterations to get at least
about 2200 posterior draws to improve LOO-CV approximation accuracy.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Found 23704 observations with a pareto_k &gt; 0.67 in model
'bayes_intlprof_legis'. We recommend to run more iterations to get at least
about 2200 posterior draws to improve LOO-CV approximation accuracy.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Found 21031 observations with a pareto_k &gt; 0.67 in model
'bayes_match_legis'. We recommend to run more iterations to get at least about
2200 posterior draws to improve LOO-CV approximation accuracy.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -1776.596</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -1780.734</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -1774.581</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -1768.881</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -1775.919</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                     elpd_diff se_diff
bayes_intlprof_legis   0.0       0.0  
bayes_domprof_legis   -5.7       3.3  
bayes_base_legis      -6.8       3.9  
bayes_match_legis     -7.0       3.3  
bayes_intl_legis      -7.7       3.9  
bayes_intldom_legis  -11.9       5.1  </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in plot.window(...): "label_points" is not a graphical parameter</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in plot.xy(xy, type, ...): "label_points" is not a graphical parameter</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in axis(side = side, at = at, labels = labels, ...): "label_points" is
not a graphical parameter
Warning in axis(side = side, at = at, labels = labels, ...): "label_points" is
not a graphical parameter</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in box(...): "label_points" is not a graphical parameter</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in title(...): "label_points" is not a graphical parameter</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="output/legis_discriminant%20model%20results-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Bayesian Pseudo R² Comparison (Mechanism Models)</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Model</th>
<th style="text-align: right;">Pseudo_R2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">BASE-legis</td>
<td style="text-align: right;">0.8070569</td>
</tr>
<tr class="even">
<td style="text-align: left;">INTL-legis</td>
<td style="text-align: right;">0.8069484</td>
</tr>
<tr class="odd">
<td style="text-align: left;">INTLDOM-legis</td>
<td style="text-align: right;">0.8073191</td>
</tr>
<tr class="even">
<td style="text-align: left;">DOMPROF-legis</td>
<td style="text-align: right;">0.8084223</td>
</tr>
<tr class="odd">
<td style="text-align: left;">INTLPROF-legis</td>
<td style="text-align: right;">0.8083904</td>
</tr>
<tr class="even">
<td style="text-align: left;">MATCH-legis</td>
<td style="text-align: right;">0.8083245</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="variables-importance-comparison-1" class="level3" data-number="4.3.2">
<h3 data-number="4.3.2" class="anchored" data-anchor-id="variables-importance-comparison-1"><span class="header-section-number">4.3.2</span> variables importance comparison</h3>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>✅ plot saves to: output/bayes_value_importance/bayes_coef_plot_BASE-legis.png</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>📄 tables saves to: output/bayes_value_importance/bayes_coef_table_BASE-legis.csv</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✅ plot saves to: output/bayes_value_importance/bayes_coef_plot_INTL-legis.png</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>📄 tables saves to: output/bayes_value_importance/bayes_coef_table_INTL-legis.csv</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✅ plot saves to: output/bayes_value_importance/bayes_coef_plot_INTLDOM-legis.png</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>📄 tables saves to: output/bayes_value_importance/bayes_coef_table_INTLDOM-legis.csv</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✅ plot saves to: output/bayes_value_importance/bayes_coef_plot_DOMPROF-legis.png</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>📄 tables saves to: output/bayes_value_importance/bayes_coef_table_DOMPROF-legis.csv</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✅ plot saves to: output/bayes_value_importance/bayes_coef_plot_INTLPROF-legis.png</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>📄 tables saves to: output/bayes_value_importance/bayes_coef_table_INTLPROF-legis.csv</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✅ plot saves to: output/bayes_value_importance/bayes_coef_plot_MATCH-legis.png</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>📄 tables saves to: output/bayes_value_importance/bayes_coef_table_MATCH-legis.csv</code></pre>
</div>
</div>
</section>
<section id="comparions-with-shap-values-1" class="level3" data-number="4.3.3">
<h3 data-number="4.3.3" class="anchored" data-anchor-id="comparions-with-shap-values-1"><span class="header-section-number">4.3.3</span> comparions with shap values</h3>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
  Model    Direction_Match_Rate Pearson_Correlation Abs_Correlation
  &lt;chr&gt;                   &lt;dbl&gt;               &lt;dbl&gt;           &lt;dbl&gt;
1 INTL                    0.5                 1              -1    
2 INTLDOM                 0.417               0.133          -0.336
3 DOMPROF                 0.583               0.235          -0.197
4 INTLPROF                0.25               -0.544          -0.551
5 MATCH                   0.643               0.170          -0.277</code></pre>
</div>
</div>
<!-- -->

</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb224" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "robustness-analysis-bayesian"</span></span>
<span id="cb224-3"><a href="#cb224-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Kunya Zhan"</span></span>
<span id="cb224-4"><a href="#cb224-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "`r format(Sys.Date(), '%B %d, %Y')`"</span></span>
<span id="cb224-5"><a href="#cb224-5" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb224-6"><a href="#cb224-6" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb224-7"><a href="#cb224-7" aria-hidden="true" tabindex="-1"></a><span class="co">   toc: true</span></span>
<span id="cb224-8"><a href="#cb224-8" aria-hidden="true" tabindex="-1"></a><span class="co">   toc-depth: 3</span></span>
<span id="cb224-9"><a href="#cb224-9" aria-hidden="true" tabindex="-1"></a><span class="co">   number-sections: true</span></span>
<span id="cb224-10"><a href="#cb224-10" aria-hidden="true" tabindex="-1"></a><span class="co">   code-fold: true</span></span>
<span id="cb224-11"><a href="#cb224-11" aria-hidden="true" tabindex="-1"></a><span class="co">   code-summary: "Show/Hide Code"</span></span>
<span id="cb224-12"><a href="#cb224-12" aria-hidden="true" tabindex="-1"></a><span class="co">   smooth-scroll: true</span></span>
<span id="cb224-13"><a href="#cb224-13" aria-hidden="true" tabindex="-1"></a><span class="co">   df-print: paged</span></span>
<span id="cb224-14"><a href="#cb224-14" aria-hidden="true" tabindex="-1"></a><span class="co">   code-tools: true</span></span>
<span id="cb224-15"><a href="#cb224-15" aria-hidden="true" tabindex="-1"></a><span class="co">   highlight-style: atom-one</span></span>
<span id="cb224-16"><a href="#cb224-16" aria-hidden="true" tabindex="-1"></a><span class="co">   toc-location: left</span></span>
<span id="cb224-17"><a href="#cb224-17" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb224-18"><a href="#cb224-18" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb224-19"><a href="#cb224-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-20"><a href="#cb224-20" aria-hidden="true" tabindex="-1"></a><span class="fu"># Robustness Analysis</span></span>
<span id="cb224-21"><a href="#cb224-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-22"><a href="#cb224-22" aria-hidden="true" tabindex="-1"></a>This quarto document aims at reorganizing the codes at 'robustness-check-bayesian'. It serves two main purposes.</span>
<span id="cb224-23"><a href="#cb224-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-24"><a href="#cb224-24" aria-hidden="true" tabindex="-1"></a>1<span class="sc">\.</span> Evaluate whether the prediction of legislators' issue-specific advertising and legislative behaviors is reliable (**predictive validity**).</span>
<span id="cb224-25"><a href="#cb224-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-26"><a href="#cb224-26" aria-hidden="true" tabindex="-1"></a>2<span class="sc">\.</span> Test whether the identification of the three decision-making modes is consistent and credible (**discriminant validity**)</span>
<span id="cb224-27"><a href="#cb224-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-28"><a href="#cb224-28" aria-hidden="true" tabindex="-1"></a>Accordingly, the variables used in the robustness analysis are aligned with those in the final LightGBM model. However, given the structural characteristics of the dataset, the analysis further controls for the unobserved heterogeneity embedded in legislator, issue, and Congress-session levels. This allows for a cleaner assessment of how the proposed matching mechanism explains legislators' advertising and legislative behaviors on specific issues.</span>
<span id="cb224-29"><a href="#cb224-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-30"><a href="#cb224-30" aria-hidden="true" tabindex="-1"></a><span class="fu">## set up</span></span>
<span id="cb224-31"><a href="#cb224-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-34"><a href="#cb224-34" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-35"><a href="#cb224-35" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: setup</span></span>
<span id="cb224-36"><a href="#cb224-36" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb224-37"><a href="#cb224-37" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb224-38"><a href="#cb224-38" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb224-39"><a href="#cb224-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-40"><a href="#cb224-40" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Prevent Mac from sleeping during long render ----</span></span>
<span id="cb224-41"><a href="#cb224-41" aria-hidden="true" tabindex="-1"></a><span class="fu">system</span>(<span class="st">"caffeinate -dimsu &amp;"</span>)</span>
<span id="cb224-42"><a href="#cb224-42" aria-hidden="true" tabindex="-1"></a><span class="fu">on.exit</span>(<span class="fu">system</span>(<span class="st">"killall caffeinate"</span>), <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb224-43"><a href="#cb224-43" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"☕ macOS sleep prevention active for this Quarto render...</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb224-44"><a href="#cb224-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-45"><a href="#cb224-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-46"><a href="#cb224-46" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Create a unified output directory ----</span></span>
<span id="cb224-47"><a href="#cb224-47" aria-hidden="true" tabindex="-1"></a>output_dir <span class="ot">&lt;-</span> <span class="st">"output"</span></span>
<span id="cb224-48"><a href="#cb224-48" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(output_dir)) <span class="fu">dir.create</span>(output_dir)</span>
<span id="cb224-49"><a href="#cb224-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-50"><a href="#cb224-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Default chunk options</span></span>
<span id="cb224-51"><a href="#cb224-51" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(</span>
<span id="cb224-52"><a href="#cb224-52" aria-hidden="true" tabindex="-1"></a>  <span class="at">echo =</span> <span class="cn">TRUE</span>,</span>
<span id="cb224-53"><a href="#cb224-53" aria-hidden="true" tabindex="-1"></a>  <span class="at">fig.path =</span> <span class="fu">file.path</span>(output_dir, <span class="st">""</span>),   <span class="co"># figures from chunks</span></span>
<span id="cb224-54"><a href="#cb224-54" aria-hidden="true" tabindex="-1"></a>  <span class="at">cache.path =</span> <span class="fu">file.path</span>(output_dir, <span class="st">"cache/"</span>)</span>
<span id="cb224-55"><a href="#cb224-55" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb224-56"><a href="#cb224-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-57"><a href="#cb224-57" aria-hidden="true" tabindex="-1"></a><span class="co"># A helper function to save plots/data consistently</span></span>
<span id="cb224-58"><a href="#cb224-58" aria-hidden="true" tabindex="-1"></a>save_to_output <span class="ot">&lt;-</span> <span class="cf">function</span>(filename, <span class="at">plot =</span> <span class="cn">NULL</span>, ...) {</span>
<span id="cb224-59"><a href="#cb224-59" aria-hidden="true" tabindex="-1"></a>  full_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(output_dir, filename)</span>
<span id="cb224-60"><a href="#cb224-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb224-61"><a href="#cb224-61" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 如果提供了 plot，则用 ggsave 保存</span></span>
<span id="cb224-62"><a href="#cb224-62" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(plot)) {</span>
<span id="cb224-63"><a href="#cb224-63" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(<span class="at">filename =</span> full_path, <span class="at">plot =</span> plot, ...)</span>
<span id="cb224-64"><a href="#cb224-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"✅ Saved plot to: "</span>, full_path)</span>
<span id="cb224-65"><a href="#cb224-65" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb224-66"><a href="#cb224-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"⚠️ No plot provided. Returning path only: "</span>, full_path)</span>
<span id="cb224-67"><a href="#cb224-67" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb224-68"><a href="#cb224-68" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb224-69"><a href="#cb224-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(full_path)</span>
<span id="cb224-70"><a href="#cb224-70" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb224-71"><a href="#cb224-71" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-72"><a href="#cb224-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-73"><a href="#cb224-73" aria-hidden="true" tabindex="-1"></a><span class="fu">## Packages Installing if not already installed</span></span>
<span id="cb224-74"><a href="#cb224-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-77"><a href="#cb224-77" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-78"><a href="#cb224-78" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: install_libraries</span></span>
<span id="cb224-79"><a href="#cb224-79" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb224-80"><a href="#cb224-80" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb224-81"><a href="#cb224-81" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb224-82"><a href="#cb224-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-83"><a href="#cb224-83" aria-hidden="true" tabindex="-1"></a><span class="co"># 设置默认 CRAN 源，防止未指定镜像导致 install.packages 报错</span></span>
<span id="cb224-84"><a href="#cb224-84" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">repos =</span> <span class="fu">c</span>(<span class="at">CRAN =</span> <span class="st">"https://cloud.r-project.org"</span>))</span>
<span id="cb224-85"><a href="#cb224-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-86"><a href="#cb224-86" aria-hidden="true" tabindex="-1"></a><span class="co"># 所需包列表</span></span>
<span id="cb224-87"><a href="#cb224-87" aria-hidden="true" tabindex="-1"></a>packages <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb224-88"><a href="#cb224-88" aria-hidden="true" tabindex="-1"></a>  <span class="st">"readxl"</span>, <span class="st">"readr"</span>, <span class="st">"dplyr"</span>, <span class="st">"tidyr"</span>, <span class="st">"lme4"</span>, <span class="st">"MuMIn"</span>, <span class="st">"pROC"</span>, </span>
<span id="cb224-89"><a href="#cb224-89" aria-hidden="true" tabindex="-1"></a>  <span class="st">"knitr"</span>, <span class="st">"broom"</span>, <span class="st">"kableExtra"</span>, <span class="st">"alpaca"</span>, <span class="st">"marginaleffects"</span>, </span>
<span id="cb224-90"><a href="#cb224-90" aria-hidden="true" tabindex="-1"></a>  <span class="st">"brms"</span>, <span class="st">"tibble"</span>, <span class="st">"forcats"</span>, <span class="st">"tidyverse"</span>, <span class="st">"bayesplot"</span>, <span class="st">"ggplot2"</span>, </span>
<span id="cb224-91"><a href="#cb224-91" aria-hidden="true" tabindex="-1"></a>  <span class="st">"loo"</span>, <span class="st">"posterior"</span>, <span class="st">"cowplot"</span>, <span class="st">"patchwork"</span>, <span class="st">"glue"</span>, <span class="st">"ggrepel"</span></span>
<span id="cb224-92"><a href="#cb224-92" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb224-93"><a href="#cb224-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-94"><a href="#cb224-94" aria-hidden="true" tabindex="-1"></a><span class="co"># Install only if missing</span></span>
<span id="cb224-95"><a href="#cb224-95" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (pkg <span class="cf">in</span> packages) {</span>
<span id="cb224-96"><a href="#cb224-96" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(pkg, <span class="at">character.only =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb224-97"><a href="#cb224-97" aria-hidden="true" tabindex="-1"></a>    <span class="fu">install.packages</span>(pkg)</span>
<span id="cb224-98"><a href="#cb224-98" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb224-99"><a href="#cb224-99" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb224-100"><a href="#cb224-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-101"><a href="#cb224-101" aria-hidden="true" tabindex="-1"></a><span class="co"># Load all packages</span></span>
<span id="cb224-102"><a href="#cb224-102" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(packages, library, <span class="at">character.only =</span> <span class="cn">TRUE</span>)</span>
<span id="cb224-103"><a href="#cb224-103" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-104"><a href="#cb224-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-105"><a href="#cb224-105" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data cleansing</span></span>
<span id="cb224-106"><a href="#cb224-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-107"><a href="#cb224-107" aria-hidden="true" tabindex="-1"></a><span class="fu">## data acquisition</span></span>
<span id="cb224-108"><a href="#cb224-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-111"><a href="#cb224-111" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-112"><a href="#cb224-112" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load_data</span></span>
<span id="cb224-113"><a href="#cb224-113" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb224-114"><a href="#cb224-114" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb224-115"><a href="#cb224-115" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb224-116"><a href="#cb224-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-117"><a href="#cb224-117" aria-hidden="true" tabindex="-1"></a><span class="co"># ----- main databases -----</span></span>
<span id="cb224-118"><a href="#cb224-118" aria-hidden="true" tabindex="-1"></a>adver_path <span class="ot">&lt;-</span> <span class="st">"/Users/kunyazhan/Documents/GitHub/decodeCompetition/descriptive analysis/input/1022data/adver_analysis_all.xlsx"</span></span>
<span id="cb224-119"><a href="#cb224-119" aria-hidden="true" tabindex="-1"></a>legis_path <span class="ot">&lt;-</span> <span class="st">"/Users/kunyazhan/Documents/GitHub/decodeCompetition/descriptive analysis/input/1022data/legis_analysis_all.xlsx"</span></span>
<span id="cb224-120"><a href="#cb224-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-121"><a href="#cb224-121" aria-hidden="true" tabindex="-1"></a>adver_all <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(adver_path)</span>
<span id="cb224-122"><a href="#cb224-122" aria-hidden="true" tabindex="-1"></a>legis_all <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(legis_path)</span>
<span id="cb224-123"><a href="#cb224-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-124"><a href="#cb224-124" aria-hidden="true" tabindex="-1"></a>adver_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"/Users/kunyazhan/Documents/GitHub/decodeCompetition/descriptive analysis/input/1022data/adver_train_data.csv"</span>)</span>
<span id="cb224-125"><a href="#cb224-125" aria-hidden="true" tabindex="-1"></a>legis_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"/Users/kunyazhan/Documents/GitHub/decodeCompetition/descriptive analysis/input/1022data/legis_train_data.csv"</span>)</span>
<span id="cb224-126"><a href="#cb224-126" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-127"><a href="#cb224-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-128"><a href="#cb224-128" aria-hidden="true" tabindex="-1"></a><span class="fu">## constructing train and test data</span></span>
<span id="cb224-129"><a href="#cb224-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-132"><a href="#cb224-132" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-133"><a href="#cb224-133" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: data prep pipeline1</span></span>
<span id="cb224-134"><a href="#cb224-134" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb224-135"><a href="#cb224-135" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb224-136"><a href="#cb224-136" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb224-137"><a href="#cb224-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-138"><a href="#cb224-138" aria-hidden="true" tabindex="-1"></a>lump_low_freq_levels <span class="ot">&lt;-</span> <span class="cf">function</span>(train_df, test_df, vars, <span class="at">prop =</span> <span class="fl">0.05</span>, <span class="at">other_level =</span> <span class="st">"Other"</span>) {</span>
<span id="cb224-139"><a href="#cb224-139" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (v <span class="cf">in</span> vars) {</span>
<span id="cb224-140"><a href="#cb224-140" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (v <span class="sc">%in%</span> <span class="fu">names</span>(train_df) <span class="sc">&amp;&amp;</span> v <span class="sc">%in%</span> <span class="fu">names</span>(test_df)) {</span>
<span id="cb224-141"><a href="#cb224-141" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Handle NAs explicitly and lump infrequent categories</span></span>
<span id="cb224-142"><a href="#cb224-142" aria-hidden="true" tabindex="-1"></a>      train_df[[v]] <span class="ot">&lt;-</span> <span class="fu">fct_explicit_na</span>(train_df[[v]], <span class="at">na_level =</span> other_level)</span>
<span id="cb224-143"><a href="#cb224-143" aria-hidden="true" tabindex="-1"></a>      train_df[[v]] <span class="ot">&lt;-</span> <span class="fu">fct_lump</span>(train_df[[v]], <span class="at">prop =</span> prop, <span class="at">other_level =</span> other_level)</span>
<span id="cb224-144"><a href="#cb224-144" aria-hidden="true" tabindex="-1"></a>      train_df[[v]] <span class="ot">&lt;-</span> <span class="fu">droplevels</span>(train_df[[v]])</span>
<span id="cb224-145"><a href="#cb224-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-146"><a href="#cb224-146" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Apply same factor levels to test set</span></span>
<span id="cb224-147"><a href="#cb224-147" aria-hidden="true" tabindex="-1"></a>      allowed_levels <span class="ot">&lt;-</span> <span class="fu">levels</span>(train_df[[v]])</span>
<span id="cb224-148"><a href="#cb224-148" aria-hidden="true" tabindex="-1"></a>      test_vec <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">fct_explicit_na</span>(test_df[[v]], <span class="at">na_level =</span> other_level))</span>
<span id="cb224-149"><a href="#cb224-149" aria-hidden="true" tabindex="-1"></a>      test_vec[<span class="sc">!</span>test_vec <span class="sc">%in%</span> allowed_levels] <span class="ot">&lt;-</span> other_level</span>
<span id="cb224-150"><a href="#cb224-150" aria-hidden="true" tabindex="-1"></a>      test_df[[v]] <span class="ot">&lt;-</span> <span class="fu">factor</span>(test_vec, <span class="at">levels =</span> allowed_levels)</span>
<span id="cb224-151"><a href="#cb224-151" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb224-152"><a href="#cb224-152" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb224-153"><a href="#cb224-153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">train =</span> train_df, <span class="at">test =</span> test_df)</span>
<span id="cb224-154"><a href="#cb224-154" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb224-155"><a href="#cb224-155" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-156"><a href="#cb224-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-159"><a href="#cb224-159" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-160"><a href="#cb224-160" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: data prep pipeline2</span></span>
<span id="cb224-161"><a href="#cb224-161" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb224-162"><a href="#cb224-162" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb224-163"><a href="#cb224-163" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb224-164"><a href="#cb224-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-165"><a href="#cb224-165" aria-hidden="true" tabindex="-1"></a>align_factor_levels <span class="ot">&lt;-</span> <span class="cf">function</span>(train, test) {</span>
<span id="cb224-166"><a href="#cb224-166" aria-hidden="true" tabindex="-1"></a>  factor_vars <span class="ot">&lt;-</span> <span class="fu">names</span>(train)[<span class="fu">sapply</span>(train, is.factor)]</span>
<span id="cb224-167"><a href="#cb224-167" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (v <span class="cf">in</span> factor_vars) {</span>
<span id="cb224-168"><a href="#cb224-168" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (v <span class="sc">%in%</span> <span class="fu">names</span>(test)) {</span>
<span id="cb224-169"><a href="#cb224-169" aria-hidden="true" tabindex="-1"></a>      test[[v]] <span class="ot">&lt;-</span> <span class="fu">factor</span>(test[[v]], <span class="at">levels =</span> <span class="fu">levels</span>(train[[v]]))</span>
<span id="cb224-170"><a href="#cb224-170" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb224-171"><a href="#cb224-171" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb224-172"><a href="#cb224-172" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(test)</span>
<span id="cb224-173"><a href="#cb224-173" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb224-174"><a href="#cb224-174" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-175"><a href="#cb224-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-178"><a href="#cb224-178" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-179"><a href="#cb224-179" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: data prep main pipeline</span></span>
<span id="cb224-180"><a href="#cb224-180" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb224-181"><a href="#cb224-181" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb224-182"><a href="#cb224-182" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb224-183"><a href="#cb224-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-184"><a href="#cb224-184" aria-hidden="true" tabindex="-1"></a>prepare_data_pipeline <span class="ot">&lt;-</span> <span class="cf">function</span>(adver_all, adver_data, match_vars, cat_vars_to_lump, numeric_vars) {</span>
<span id="cb224-185"><a href="#cb224-185" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb224-186"><a href="#cb224-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-187"><a href="#cb224-187" aria-hidden="true" tabindex="-1"></a>  <span class="co"># --- Step 1: Rename matching features before merging ---</span></span>
<span id="cb224-188"><a href="#cb224-188" aria-hidden="true" tabindex="-1"></a>  adver_data_raw <span class="ot">&lt;-</span> adver_data <span class="sc">%&gt;%</span></span>
<span id="cb224-189"><a href="#cb224-189" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="at">.cols =</span> <span class="fu">intersect</span>(<span class="fu">names</span>(.), match_vars), <span class="at">.fn =</span> <span class="sc">~</span> <span class="fu">paste0</span>(.x, <span class="st">"_raw"</span>))</span>
<span id="cb224-190"><a href="#cb224-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-191"><a href="#cb224-191" aria-hidden="true" tabindex="-1"></a>  <span class="co"># check whether raw vars were successfully created</span></span>
<span id="cb224-192"><a href="#cb224-192" aria-hidden="true" tabindex="-1"></a>  raw_vars <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"_raw$"</span>, <span class="fu">names</span>(adver_data_raw), <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb224-193"><a href="#cb224-193" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(raw_vars) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb224-194"><a href="#cb224-194" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"No '_raw' variables were created. Please check match_vars and adver_data column names."</span>)</span>
<span id="cb224-195"><a href="#cb224-195" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb224-196"><a href="#cb224-196" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb224-197"><a href="#cb224-197" aria-hidden="true" tabindex="-1"></a>  <span class="co"># merge into adver_all</span></span>
<span id="cb224-198"><a href="#cb224-198" aria-hidden="true" tabindex="-1"></a>  adver_all <span class="ot">&lt;-</span> adver_all <span class="sc">%&gt;%</span></span>
<span id="cb224-199"><a href="#cb224-199" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb224-200"><a href="#cb224-200" aria-hidden="true" tabindex="-1"></a>    adver_data_raw <span class="sc">%&gt;%</span></span>
<span id="cb224-201"><a href="#cb224-201" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(full_name, issue, congress, <span class="fu">all_of</span>(raw_vars)),</span>
<span id="cb224-202"><a href="#cb224-202" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"full_name"</span>, <span class="st">"issue"</span>, <span class="st">"congress"</span>)</span>
<span id="cb224-203"><a href="#cb224-203" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb224-204"><a href="#cb224-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-205"><a href="#cb224-205" aria-hidden="true" tabindex="-1"></a>  <span class="co"># --- Step 1.5: Merge related category variables to reduce collinearity ---</span></span>
<span id="cb224-206"><a href="#cb224-206" aria-hidden="true" tabindex="-1"></a>  adver_all <span class="ot">&lt;-</span> adver_all <span class="sc">%&gt;%</span></span>
<span id="cb224-207"><a href="#cb224-207" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb224-208"><a href="#cb224-208" aria-hidden="true" tabindex="-1"></a>      <span class="at">industry_main =</span> <span class="fu">coalesce</span>(industry_tp1, industry_tp2, industry_tp3),</span>
<span id="cb224-209"><a href="#cb224-209" aria-hidden="true" tabindex="-1"></a>      <span class="at">industry_main =</span> <span class="fu">fct_lump</span>(<span class="fu">fct_explicit_na</span>(industry_main, <span class="at">na_level =</span> <span class="st">"NA"</span>), <span class="at">n =</span> <span class="dv">10</span>),</span>
<span id="cb224-210"><a href="#cb224-210" aria-hidden="true" tabindex="-1"></a>      <span class="at">ethnicity_tp_main =</span> <span class="fu">coalesce</span>(ethnicity_tp1, ethnicity_tp2, ethnicity_tp3),</span>
<span id="cb224-211"><a href="#cb224-211" aria-hidden="true" tabindex="-1"></a>      <span class="at">ethnicity_tp_main =</span> <span class="fu">fct_lump</span>(<span class="fu">fct_explicit_na</span>(ethnicity_tp_main, <span class="at">na_level =</span> <span class="st">"NA"</span>), <span class="at">n =</span> <span class="dv">8</span>),</span>
<span id="cb224-212"><a href="#cb224-212" aria-hidden="true" tabindex="-1"></a>      <span class="at">employ_main =</span> <span class="fu">coalesce</span>(employ1, employ2, employ3),</span>
<span id="cb224-213"><a href="#cb224-213" aria-hidden="true" tabindex="-1"></a>      <span class="at">payroll_main =</span> <span class="fu">coalesce</span>(payroll1, payroll2, payroll3),</span>
<span id="cb224-214"><a href="#cb224-214" aria-hidden="true" tabindex="-1"></a>      <span class="at">ethnicity_main =</span> <span class="fu">coalesce</span>(ethnicity1, ethnicity2, ethnicity3)</span>
<span id="cb224-215"><a href="#cb224-215" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb224-216"><a href="#cb224-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-217"><a href="#cb224-217" aria-hidden="true" tabindex="-1"></a>  <span class="co"># --- Step 2: Split the dataset into training and test subsets ---</span></span>
<span id="cb224-218"><a href="#cb224-218" aria-hidden="true" tabindex="-1"></a>  adver_all<span class="sc">$</span>pair_id <span class="ot">&lt;-</span> <span class="fu">paste</span>(adver_all<span class="sc">$</span>full_name, adver_all<span class="sc">$</span>issue, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb224-219"><a href="#cb224-219" aria-hidden="true" tabindex="-1"></a>  unique_pairs <span class="ot">&lt;-</span> <span class="fu">unique</span>(adver_all<span class="sc">$</span>pair_id)</span>
<span id="cb224-220"><a href="#cb224-220" aria-hidden="true" tabindex="-1"></a>  train_units <span class="ot">&lt;-</span> <span class="fu">sample</span>(unique_pairs, <span class="at">size =</span> <span class="fu">floor</span>(<span class="fl">0.7</span> <span class="sc">*</span> <span class="fu">length</span>(unique_pairs)))</span>
<span id="cb224-221"><a href="#cb224-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-222"><a href="#cb224-222" aria-hidden="true" tabindex="-1"></a>  adver_all <span class="ot">&lt;-</span> adver_all <span class="sc">%&gt;%</span></span>
<span id="cb224-223"><a href="#cb224-223" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">set =</span> <span class="fu">ifelse</span>(pair_id <span class="sc">%in%</span> train_units, <span class="st">"train"</span>, <span class="st">"test"</span>))</span>
<span id="cb224-224"><a href="#cb224-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-225"><a href="#cb224-225" aria-hidden="true" tabindex="-1"></a>  train_data <span class="ot">&lt;-</span> adver_all <span class="sc">%&gt;%</span> <span class="fu">filter</span>(set <span class="sc">==</span> <span class="st">"train"</span>)</span>
<span id="cb224-226"><a href="#cb224-226" aria-hidden="true" tabindex="-1"></a>  test_data <span class="ot">&lt;-</span> adver_all <span class="sc">%&gt;%</span></span>
<span id="cb224-227"><a href="#cb224-227" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(set <span class="sc">==</span> <span class="st">"test"</span> <span class="sc">&amp;</span> full_name <span class="sc">%in%</span> train_data<span class="sc">$</span>full_name <span class="sc">&amp;</span> issue <span class="sc">%in%</span> train_data<span class="sc">$</span>issue)</span>
<span id="cb224-228"><a href="#cb224-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-229"><a href="#cb224-229" aria-hidden="true" tabindex="-1"></a>  <span class="co"># --- Step 3: Convert character variables into factors ---</span></span>
<span id="cb224-230"><a href="#cb224-230" aria-hidden="true" tabindex="-1"></a>  vars_to_factor <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">names</span>(train_data)[<span class="fu">sapply</span>(train_data, is.character)], <span class="st">"leverage"</span>, <span class="st">"ppvi"</span>) <span class="sc">%&gt;%</span> <span class="fu">unique</span>()</span>
<span id="cb224-231"><a href="#cb224-231" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (v <span class="cf">in</span> vars_to_factor) {</span>
<span id="cb224-232"><a href="#cb224-232" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (v <span class="sc">%in%</span> <span class="fu">names</span>(train_data)) {</span>
<span id="cb224-233"><a href="#cb224-233" aria-hidden="true" tabindex="-1"></a>      train_data[[v]] <span class="ot">&lt;-</span> <span class="fu">factor</span>(train_data[[v]]) <span class="sc">|&gt;</span> <span class="fu">droplevels</span>()</span>
<span id="cb224-234"><a href="#cb224-234" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb224-235"><a href="#cb224-235" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (v <span class="sc">%in%</span> <span class="fu">names</span>(test_data)) {</span>
<span id="cb224-236"><a href="#cb224-236" aria-hidden="true" tabindex="-1"></a>      test_data[[v]] <span class="ot">&lt;-</span> <span class="fu">factor</span>(test_data[[v]], <span class="at">levels =</span> <span class="fu">levels</span>(train_data[[v]]))</span>
<span id="cb224-237"><a href="#cb224-237" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb224-238"><a href="#cb224-238" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb224-239"><a href="#cb224-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-240"><a href="#cb224-240" aria-hidden="true" tabindex="-1"></a>  <span class="co"># --- Step 4: Apply low-frequency lumping and explicit NA encoding ---</span></span>
<span id="cb224-241"><a href="#cb224-241" aria-hidden="true" tabindex="-1"></a>  lumped <span class="ot">&lt;-</span> <span class="fu">lump_low_freq_levels</span>(train_data, test_data, cat_vars_to_lump)</span>
<span id="cb224-242"><a href="#cb224-242" aria-hidden="true" tabindex="-1"></a>  train_data <span class="ot">&lt;-</span> lumped<span class="sc">$</span>train</span>
<span id="cb224-243"><a href="#cb224-243" aria-hidden="true" tabindex="-1"></a>  test_data <span class="ot">&lt;-</span> lumped<span class="sc">$</span>test</span>
<span id="cb224-244"><a href="#cb224-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-245"><a href="#cb224-245" aria-hidden="true" tabindex="-1"></a>  <span class="co"># --- Step 5: Align all factor levels between train/test ---</span></span>
<span id="cb224-246"><a href="#cb224-246" aria-hidden="true" tabindex="-1"></a>  test_data <span class="ot">&lt;-</span> <span class="fu">align_factor_levels</span>(train_data, test_data)</span>
<span id="cb224-247"><a href="#cb224-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-248"><a href="#cb224-248" aria-hidden="true" tabindex="-1"></a>  <span class="co"># --- Step 6: Median imputation and z-score normalization for numeric vars ---</span></span>
<span id="cb224-249"><a href="#cb224-249" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (v <span class="cf">in</span> numeric_vars) {</span>
<span id="cb224-250"><a href="#cb224-250" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (v <span class="sc">%in%</span> <span class="fu">names</span>(train_data)) {</span>
<span id="cb224-251"><a href="#cb224-251" aria-hidden="true" tabindex="-1"></a>      med <span class="ot">&lt;-</span> <span class="fu">median</span>(train_data[[v]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb224-252"><a href="#cb224-252" aria-hidden="true" tabindex="-1"></a>      train_data[[v]][<span class="fu">is.na</span>(train_data[[v]])] <span class="ot">&lt;-</span> med</span>
<span id="cb224-253"><a href="#cb224-253" aria-hidden="true" tabindex="-1"></a>      test_data[[v]][<span class="fu">is.na</span>(test_data[[v]])] <span class="ot">&lt;-</span> med</span>
<span id="cb224-254"><a href="#cb224-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-255"><a href="#cb224-255" aria-hidden="true" tabindex="-1"></a>      mean_v <span class="ot">&lt;-</span> <span class="fu">mean</span>(train_data[[v]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb224-256"><a href="#cb224-256" aria-hidden="true" tabindex="-1"></a>      sd_v <span class="ot">&lt;-</span> <span class="fu">sd</span>(train_data[[v]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb224-257"><a href="#cb224-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-258"><a href="#cb224-258" aria-hidden="true" tabindex="-1"></a>      train_data[[v]] <span class="ot">&lt;-</span> (train_data[[v]] <span class="sc">-</span> mean_v) <span class="sc">/</span> sd_v</span>
<span id="cb224-259"><a href="#cb224-259" aria-hidden="true" tabindex="-1"></a>      test_data[[v]] <span class="ot">&lt;-</span> (test_data[[v]] <span class="sc">-</span> mean_v) <span class="sc">/</span> sd_v</span>
<span id="cb224-260"><a href="#cb224-260" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb224-261"><a href="#cb224-261" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb224-262"><a href="#cb224-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-263"><a href="#cb224-263" aria-hidden="true" tabindex="-1"></a>  <span class="co"># --- Step 6.5: Convert '_raw' variables into factors ---</span></span>
<span id="cb224-264"><a href="#cb224-264" aria-hidden="true" tabindex="-1"></a>  match_features <span class="ot">&lt;-</span> <span class="fu">paste0</span>(match_vars, <span class="st">"_raw"</span>)</span>
<span id="cb224-265"><a href="#cb224-265" aria-hidden="true" tabindex="-1"></a>  cat_match_vars <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(match_features, <span class="fu">c</span>(<span class="st">"party_score_pl_raw"</span>, <span class="st">"party_score_ne_raw"</span>))</span>
<span id="cb224-266"><a href="#cb224-266" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (v <span class="cf">in</span> cat_match_vars) {</span>
<span id="cb224-267"><a href="#cb224-267" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (v <span class="sc">%in%</span> <span class="fu">names</span>(train_data)) {</span>
<span id="cb224-268"><a href="#cb224-268" aria-hidden="true" tabindex="-1"></a>      train_data[[v]] <span class="ot">&lt;-</span> <span class="fu">factor</span>(train_data[[v]]) <span class="sc">|&gt;</span> <span class="fu">droplevels</span>()</span>
<span id="cb224-269"><a href="#cb224-269" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb224-270"><a href="#cb224-270" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (v <span class="sc">%in%</span> <span class="fu">names</span>(test_data)) {</span>
<span id="cb224-271"><a href="#cb224-271" aria-hidden="true" tabindex="-1"></a>      test_data[[v]] <span class="ot">&lt;-</span> <span class="fu">factor</span>(test_data[[v]], <span class="at">levels =</span> <span class="fu">levels</span>(train_data[[v]]))</span>
<span id="cb224-272"><a href="#cb224-272" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb224-273"><a href="#cb224-273" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb224-274"><a href="#cb224-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-275"><a href="#cb224-275" aria-hidden="true" tabindex="-1"></a>  <span class="co"># --- Step 7: Ensure consistent data types across variables ---</span></span>
<span id="cb224-276"><a href="#cb224-276" aria-hidden="true" tabindex="-1"></a>  all_vars <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">c</span>(</span>
<span id="cb224-277"><a href="#cb224-277" aria-hidden="true" tabindex="-1"></a>    match_features, <span class="st">"leverage"</span>, <span class="st">"s_committee_tp1"</span>, <span class="st">"h_committee_tp1"</span>, <span class="st">"party_tp_type"</span>, </span>
<span id="cb224-278"><a href="#cb224-278" aria-hidden="true" tabindex="-1"></a>    <span class="st">"party_tp_score"</span>, <span class="st">"industry_main"</span>, <span class="st">"ethnicity_main"</span>, <span class="st">"employ_main"</span>, <span class="st">"payroll_main"</span>,</span>
<span id="cb224-279"><a href="#cb224-279" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ppvi"</span>, <span class="st">"npvi"</span>, <span class="st">"chamber"</span>, <span class="st">"gender"</span>, <span class="st">"party"</span>, <span class="st">"committee_el"</span>,</span>
<span id="cb224-280"><a href="#cb224-280" aria-hidden="true" tabindex="-1"></a>    <span class="st">"issue"</span>, <span class="st">"full_name"</span>, <span class="st">"congress"</span></span>
<span id="cb224-281"><a href="#cb224-281" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb224-282"><a href="#cb224-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-283"><a href="#cb224-283" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (v <span class="cf">in</span> all_vars) {</span>
<span id="cb224-284"><a href="#cb224-284" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (v <span class="sc">%in%</span> <span class="fu">names</span>(train_data) <span class="sc">&amp;&amp;</span> v <span class="sc">%in%</span> <span class="fu">names</span>(test_data)) {</span>
<span id="cb224-285"><a href="#cb224-285" aria-hidden="true" tabindex="-1"></a>      train_class <span class="ot">&lt;-</span> <span class="fu">class</span>(train_data[[v]])</span>
<span id="cb224-286"><a href="#cb224-286" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="st">"factor"</span> <span class="sc">%in%</span> train_class) {</span>
<span id="cb224-287"><a href="#cb224-287" aria-hidden="true" tabindex="-1"></a>        test_data[[v]] <span class="ot">&lt;-</span> <span class="fu">factor</span>(test_data[[v]], <span class="at">levels =</span> <span class="fu">levels</span>(train_data[[v]]))</span>
<span id="cb224-288"><a href="#cb224-288" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (<span class="st">"character"</span> <span class="sc">%in%</span> train_class) {</span>
<span id="cb224-289"><a href="#cb224-289" aria-hidden="true" tabindex="-1"></a>        train_data[[v]] <span class="ot">&lt;-</span> <span class="fu">factor</span>(train_data[[v]]) <span class="sc">|&gt;</span> <span class="fu">droplevels</span>()</span>
<span id="cb224-290"><a href="#cb224-290" aria-hidden="true" tabindex="-1"></a>        test_data[[v]] <span class="ot">&lt;-</span> <span class="fu">factor</span>(test_data[[v]], <span class="at">levels =</span> <span class="fu">levels</span>(train_data[[v]]))</span>
<span id="cb224-291"><a href="#cb224-291" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (<span class="st">"numeric"</span> <span class="sc">%in%</span> train_class <span class="sc">||</span> <span class="st">"integer"</span> <span class="sc">%in%</span> train_class) {</span>
<span id="cb224-292"><a href="#cb224-292" aria-hidden="true" tabindex="-1"></a>        test_data[[v]] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(test_data[[v]])</span>
<span id="cb224-293"><a href="#cb224-293" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb224-294"><a href="#cb224-294" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb224-295"><a href="#cb224-295" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb224-296"><a href="#cb224-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-297"><a href="#cb224-297" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">train =</span> train_data, <span class="at">test =</span> test_data)</span>
<span id="cb224-298"><a href="#cb224-298" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb224-299"><a href="#cb224-299" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-300"><a href="#cb224-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-303"><a href="#cb224-303" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-304"><a href="#cb224-304" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: execute pipeline</span></span>
<span id="cb224-305"><a href="#cb224-305" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb224-306"><a href="#cb224-306" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb224-307"><a href="#cb224-307" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb224-308"><a href="#cb224-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-309"><a href="#cb224-309" aria-hidden="true" tabindex="-1"></a><span class="co"># ----- prepare the variables categories -----</span></span>
<span id="cb224-310"><a href="#cb224-310" aria-hidden="true" tabindex="-1"></a>match_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb224-311"><a href="#cb224-311" aria-hidden="true" tabindex="-1"></a>  <span class="st">"leverage_pl"</span>, <span class="st">"leverage_ne"</span>, <span class="st">"committee_pl"</span>, <span class="st">"committee_ne"</span>,</span>
<span id="cb224-312"><a href="#cb224-312" aria-hidden="true" tabindex="-1"></a>  <span class="st">"employ_industry_pl"</span>, <span class="st">"employ_industry_ne"</span>, <span class="st">"payroll_industry_pl"</span>, <span class="st">"payroll_industry_ne"</span>,</span>
<span id="cb224-313"><a href="#cb224-313" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ethnicity_pl"</span>, <span class="st">"ethnicity_ne"</span>, <span class="st">"party_value_pl"</span>, <span class="st">"party_value_ne"</span>,</span>
<span id="cb224-314"><a href="#cb224-314" aria-hidden="true" tabindex="-1"></a>  <span class="st">"party_score_pl"</span>, <span class="st">"party_score_ne"</span></span>
<span id="cb224-315"><a href="#cb224-315" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb224-316"><a href="#cb224-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-317"><a href="#cb224-317" aria-hidden="true" tabindex="-1"></a>cat_vars_to_lump <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb224-318"><a href="#cb224-318" aria-hidden="true" tabindex="-1"></a>  <span class="st">"h_committee_tp1"</span>, <span class="st">"s_committee_tp1"</span>, <span class="st">"industry_tp1"</span>, <span class="st">"industry_tp2"</span>, <span class="st">"industry_tp3"</span>, </span>
<span id="cb224-319"><a href="#cb224-319" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ethnicity_tp1"</span>, <span class="st">"ethnicity_tp2"</span>, <span class="st">"ethnicity_tp3"</span>, <span class="st">"employ1"</span>, <span class="st">"employ2"</span>, <span class="st">"employ3"</span>, </span>
<span id="cb224-320"><a href="#cb224-320" aria-hidden="true" tabindex="-1"></a>  <span class="st">"payroll1"</span>, <span class="st">"payroll2"</span>, <span class="st">"payroll3"</span>, <span class="st">"ethnicity1"</span>, <span class="st">"ethnicity2"</span>, <span class="st">"ethnicity3"</span></span>
<span id="cb224-321"><a href="#cb224-321" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb224-322"><a href="#cb224-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-323"><a href="#cb224-323" aria-hidden="true" tabindex="-1"></a>numeric_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"party_tp_score"</span>, <span class="st">"npvi"</span>)</span>
<span id="cb224-324"><a href="#cb224-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-325"><a href="#cb224-325" aria-hidden="true" tabindex="-1"></a><span class="co"># ----- excute -----</span></span>
<span id="cb224-326"><a href="#cb224-326" aria-hidden="true" tabindex="-1"></a><span class="co"># adver</span></span>
<span id="cb224-327"><a href="#cb224-327" aria-hidden="true" tabindex="-1"></a>processed_adver <span class="ot">&lt;-</span> <span class="fu">prepare_data_pipeline</span>(</span>
<span id="cb224-328"><a href="#cb224-328" aria-hidden="true" tabindex="-1"></a>  adver_all, </span>
<span id="cb224-329"><a href="#cb224-329" aria-hidden="true" tabindex="-1"></a>  adver_data, </span>
<span id="cb224-330"><a href="#cb224-330" aria-hidden="true" tabindex="-1"></a>  match_vars, </span>
<span id="cb224-331"><a href="#cb224-331" aria-hidden="true" tabindex="-1"></a>  cat_vars_to_lump, </span>
<span id="cb224-332"><a href="#cb224-332" aria-hidden="true" tabindex="-1"></a>  numeric_vars)</span>
<span id="cb224-333"><a href="#cb224-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-334"><a href="#cb224-334" aria-hidden="true" tabindex="-1"></a>train_data_adver <span class="ot">&lt;-</span> processed_adver<span class="sc">$</span>train</span>
<span id="cb224-335"><a href="#cb224-335" aria-hidden="true" tabindex="-1"></a>test_data_adver  <span class="ot">&lt;-</span> processed_adver<span class="sc">$</span>test</span>
<span id="cb224-336"><a href="#cb224-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-337"><a href="#cb224-337" aria-hidden="true" tabindex="-1"></a><span class="co"># legis</span></span>
<span id="cb224-338"><a href="#cb224-338" aria-hidden="true" tabindex="-1"></a>processed_legis <span class="ot">&lt;-</span> <span class="fu">prepare_data_pipeline</span>(</span>
<span id="cb224-339"><a href="#cb224-339" aria-hidden="true" tabindex="-1"></a>  legis_all, </span>
<span id="cb224-340"><a href="#cb224-340" aria-hidden="true" tabindex="-1"></a>  legis_data, </span>
<span id="cb224-341"><a href="#cb224-341" aria-hidden="true" tabindex="-1"></a>  match_vars, </span>
<span id="cb224-342"><a href="#cb224-342" aria-hidden="true" tabindex="-1"></a>  cat_vars_to_lump, </span>
<span id="cb224-343"><a href="#cb224-343" aria-hidden="true" tabindex="-1"></a>  numeric_vars</span>
<span id="cb224-344"><a href="#cb224-344" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb224-345"><a href="#cb224-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-346"><a href="#cb224-346" aria-hidden="true" tabindex="-1"></a>train_data_legis <span class="ot">&lt;-</span> processed_legis<span class="sc">$</span>train</span>
<span id="cb224-347"><a href="#cb224-347" aria-hidden="true" tabindex="-1"></a>test_data_legis <span class="ot">&lt;-</span> processed_legis<span class="sc">$</span>test</span>
<span id="cb224-348"><a href="#cb224-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-349"><a href="#cb224-349" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-350"><a href="#cb224-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-351"><a href="#cb224-351" aria-hidden="true" tabindex="-1"></a><span class="fu"># Predictive Validity</span></span>
<span id="cb224-352"><a href="#cb224-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-353"><a href="#cb224-353" aria-hidden="true" tabindex="-1"></a>We compared three Bayesian models with progressively enriched feature sets.</span>
<span id="cb224-354"><a href="#cb224-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-355"><a href="#cb224-355" aria-hidden="true" tabindex="-1"></a>The **baseline model** includes only legislators’ demographic and institutional characteristics (first-type features).</span>
<span id="cb224-356"><a href="#cb224-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-357"><a href="#cb224-357" aria-hidden="true" tabindex="-1"></a>The **raw model** adds the original attributes of both legislators and issues (second-type features).</span>
<span id="cb224-358"><a href="#cb224-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-359"><a href="#cb224-359" aria-hidden="true" tabindex="-1"></a>The **match model** incorporates the hypothesized mechanism-based matching features that capture the alignment between legislators and issues (third-type features).</span>
<span id="cb224-360"><a href="#cb224-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-361"><a href="#cb224-361" aria-hidden="true" tabindex="-1"></a>**Predictive validity** is evaluated by comparing the predictive performance of these three models. It is quantified using pseudo-R² based on posterior means, which reflects the extent to which the inclusion of different feature types improves model fit.</span>
<span id="cb224-362"><a href="#cb224-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-363"><a href="#cb224-363" aria-hidden="true" tabindex="-1"></a><span class="fu">## model preparations</span></span>
<span id="cb224-364"><a href="#cb224-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-367"><a href="#cb224-367" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-368"><a href="#cb224-368" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: predictive model construction</span></span>
<span id="cb224-369"><a href="#cb224-369" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb224-370"><a href="#cb224-370" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true</span></span>
<span id="cb224-371"><a href="#cb224-371" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb224-372"><a href="#cb224-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-373"><a href="#cb224-373" aria-hidden="true" tabindex="-1"></a><span class="co"># ----- base model -----</span></span>
<span id="cb224-374"><a href="#cb224-374" aria-hidden="true" tabindex="-1"></a>formula_base <span class="ot">&lt;-</span> <span class="fu">bf</span>(label <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>issue) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>full_name) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>congress))</span>
<span id="cb224-375"><a href="#cb224-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-376"><a href="#cb224-376" aria-hidden="true" tabindex="-1"></a><span class="co"># ----- baseline model -----</span></span>
<span id="cb224-377"><a href="#cb224-377" aria-hidden="true" tabindex="-1"></a><span class="co"># baseline model </span></span>
<span id="cb224-378"><a href="#cb224-378" aria-hidden="true" tabindex="-1"></a>formula_baseline <span class="ot">&lt;-</span> <span class="fu">bf</span>(label <span class="sc">~</span> chamber <span class="sc">+</span> age <span class="sc">+</span> gender <span class="sc">+</span> party <span class="sc">+</span> seniority <span class="sc">+</span></span>
<span id="cb224-379"><a href="#cb224-379" aria-hidden="true" tabindex="-1"></a>                         ideology <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>issue) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>full_name) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>congress))</span>
<span id="cb224-380"><a href="#cb224-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-381"><a href="#cb224-381" aria-hidden="true" tabindex="-1"></a><span class="co"># ----- raw model -----</span></span>
<span id="cb224-382"><a href="#cb224-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-383"><a href="#cb224-383" aria-hidden="true" tabindex="-1"></a>formula_raw <span class="ot">&lt;-</span> <span class="fu">bf</span>(label <span class="sc">~</span> leverage <span class="sc">+</span> s_committee_tp1 <span class="sc">+</span> h_committee_tp1 </span>
<span id="cb224-384"><a href="#cb224-384" aria-hidden="true" tabindex="-1"></a>                  <span class="sc">+</span> party_tp_type <span class="sc">+</span> party_tp_score <span class="sc">+</span> industry_main </span>
<span id="cb224-385"><a href="#cb224-385" aria-hidden="true" tabindex="-1"></a>                  <span class="sc">+</span> ethnicity_tp_main <span class="sc">+</span> employ_main <span class="sc">+</span> payroll_main </span>
<span id="cb224-386"><a href="#cb224-386" aria-hidden="true" tabindex="-1"></a>                  <span class="sc">+</span> ethnicity_main <span class="sc">+</span> ppvi <span class="sc">+</span> npvi </span>
<span id="cb224-387"><a href="#cb224-387" aria-hidden="true" tabindex="-1"></a>                  <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>issue) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>full_name) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>congress))</span>
<span id="cb224-388"><a href="#cb224-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-389"><a href="#cb224-389" aria-hidden="true" tabindex="-1"></a><span class="co"># ----- match model -----</span></span>
<span id="cb224-390"><a href="#cb224-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-391"><a href="#cb224-391" aria-hidden="true" tabindex="-1"></a>match_features <span class="ot">&lt;-</span> <span class="fu">paste0</span>(match_vars, <span class="st">"_raw"</span>)</span>
<span id="cb224-392"><a href="#cb224-392" aria-hidden="true" tabindex="-1"></a>formula_match <span class="ot">&lt;-</span> <span class="fu">bf</span>(</span>
<span id="cb224-393"><a href="#cb224-393" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.formula</span>(<span class="fu">paste</span>(<span class="st">"label ~"</span>, <span class="fu">paste</span>(match_features, <span class="at">collapse =</span> <span class="st">" + "</span>), <span class="st">"+ (1|issue) + (1|full_name) + (1|congress)"</span>))</span>
<span id="cb224-394"><a href="#cb224-394" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb224-395"><a href="#cb224-395" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-396"><a href="#cb224-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-399"><a href="#cb224-399" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-400"><a href="#cb224-400" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: predictive check parameter</span></span>
<span id="cb224-401"><a href="#cb224-401" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb224-402"><a href="#cb224-402" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true</span></span>
<span id="cb224-403"><a href="#cb224-403" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb224-404"><a href="#cb224-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-405"><a href="#cb224-405" aria-hidden="true" tabindex="-1"></a><span class="co"># adver</span></span>
<span id="cb224-406"><a href="#cb224-406" aria-hidden="true" tabindex="-1"></a>priors_base_check <span class="ot">&lt;-</span> <span class="fu">get_prior</span>(formula_base, <span class="at">data =</span> train_data_adver, <span class="at">family =</span> <span class="fu">bernoulli</span>())</span>
<span id="cb224-407"><a href="#cb224-407" aria-hidden="true" tabindex="-1"></a>priors_baseline_check <span class="ot">&lt;-</span> <span class="fu">get_prior</span>(formula_baseline, <span class="at">data =</span> train_data_adver, <span class="at">family =</span> <span class="fu">bernoulli</span>())</span>
<span id="cb224-408"><a href="#cb224-408" aria-hidden="true" tabindex="-1"></a>priors_raw_check  <span class="ot">&lt;-</span> <span class="fu">get_prior</span>(formula_raw, <span class="at">data =</span> train_data_adver, <span class="at">family =</span> <span class="fu">bernoulli</span>())</span>
<span id="cb224-409"><a href="#cb224-409" aria-hidden="true" tabindex="-1"></a>priors_match_check <span class="ot">&lt;-</span> <span class="fu">get_prior</span>(formula_match, <span class="at">data =</span> train_data_adver, <span class="at">family =</span> <span class="fu">bernoulli</span>())</span>
<span id="cb224-410"><a href="#cb224-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-411"><a href="#cb224-411" aria-hidden="true" tabindex="-1"></a><span class="co"># check parameters legis</span></span>
<span id="cb224-412"><a href="#cb224-412" aria-hidden="true" tabindex="-1"></a>priors_base_legis_check <span class="ot">&lt;-</span> <span class="fu">get_prior</span>(formula_base, <span class="at">data =</span> train_data_legis, <span class="at">family =</span> <span class="fu">bernoulli</span>())</span>
<span id="cb224-413"><a href="#cb224-413" aria-hidden="true" tabindex="-1"></a>priors_baseline_legis_check <span class="ot">&lt;-</span> <span class="fu">get_prior</span>(formula_baseline, <span class="at">data =</span> train_data_legis, <span class="at">family =</span> <span class="fu">bernoulli</span>())</span>
<span id="cb224-414"><a href="#cb224-414" aria-hidden="true" tabindex="-1"></a>priors_raw_legis_check  <span class="ot">&lt;-</span> <span class="fu">get_prior</span>(formula_raw, <span class="at">data =</span> train_data_legis, <span class="at">family =</span> <span class="fu">bernoulli</span>())</span>
<span id="cb224-415"><a href="#cb224-415" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-416"><a href="#cb224-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-419"><a href="#cb224-419" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-420"><a href="#cb224-420" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: predictive priors and iteration</span></span>
<span id="cb224-421"><a href="#cb224-421" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb224-422"><a href="#cb224-422" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true</span></span>
<span id="cb224-423"><a href="#cb224-423" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb224-424"><a href="#cb224-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-425"><a href="#cb224-425" aria-hidden="true" tabindex="-1"></a><span class="co"># - normal prior (mean=0, sd=2.5) for all fixed effect regression coefficients (class = "b")</span></span>
<span id="cb224-426"><a href="#cb224-426" aria-hidden="true" tabindex="-1"></a><span class="co"># reflecting the expection that most coefficients are centered around zero with moderate variability.</span></span>
<span id="cb224-427"><a href="#cb224-427" aria-hidden="true" tabindex="-1"></a><span class="co"># - heavy-tailed student-t prior (df=3, mean=0, scale=2.5) for the intercept (class = "Intercept")</span></span>
<span id="cb224-428"><a href="#cb224-428" aria-hidden="true" tabindex="-1"></a><span class="co"># and group-levels standard deviations (class = "sd")</span></span>
<span id="cb224-429"><a href="#cb224-429" aria-hidden="true" tabindex="-1"></a><span class="co"># which improves model robustness to outliers and enhances interpretability by allowing more flexibility</span></span>
<span id="cb224-430"><a href="#cb224-430" aria-hidden="true" tabindex="-1"></a><span class="co"># in the presence of extreme values</span></span>
<span id="cb224-431"><a href="#cb224-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-432"><a href="#cb224-432" aria-hidden="true" tabindex="-1"></a>priors_base <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb224-433"><a href="#cb224-433" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_prior</span>(<span class="st">"student_t(3, 0, 2.5)"</span>, <span class="at">class =</span> <span class="st">"Intercept"</span>),</span>
<span id="cb224-434"><a href="#cb224-434" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_prior</span>(<span class="st">"student_t(3, 0, 2.5)"</span>, <span class="at">class =</span> <span class="st">"sd"</span>)</span>
<span id="cb224-435"><a href="#cb224-435" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb224-436"><a href="#cb224-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-437"><a href="#cb224-437" aria-hidden="true" tabindex="-1"></a>priors_mechanism <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb224-438"><a href="#cb224-438" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_prior</span>(<span class="st">"normal(0, 2.5)"</span>, <span class="at">class =</span> <span class="st">"b"</span>),         </span>
<span id="cb224-439"><a href="#cb224-439" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_prior</span>(<span class="st">"student_t(3, 0, 2.5)"</span>, <span class="at">class =</span> <span class="st">"Intercept"</span>),</span>
<span id="cb224-440"><a href="#cb224-440" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_prior</span>(<span class="st">"student_t(3, 0, 2.5)"</span>, <span class="at">class =</span> <span class="st">"sd"</span>)</span>
<span id="cb224-441"><a href="#cb224-441" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb224-442"><a href="#cb224-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-443"><a href="#cb224-443" aria-hidden="true" tabindex="-1"></a><span class="co"># iteration parameters setting</span></span>
<span id="cb224-444"><a href="#cb224-444" aria-hidden="true" tabindex="-1"></a><span class="co"># n_iter = 1000 balances between sufficient exploration of the parameter space</span></span>
<span id="cb224-445"><a href="#cb224-445" aria-hidden="true" tabindex="-1"></a><span class="co"># and the computational efficienct</span></span>
<span id="cb224-446"><a href="#cb224-446" aria-hidden="true" tabindex="-1"></a><span class="co"># n_chains = 2 helps assess convergence and ensures robustness of the results,</span></span>
<span id="cb224-447"><a href="#cb224-447" aria-hidden="true" tabindex="-1"></a><span class="co"># while keeping computational cost manageable.</span></span>
<span id="cb224-448"><a href="#cb224-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-449"><a href="#cb224-449" aria-hidden="true" tabindex="-1"></a>n_iter <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb224-450"><a href="#cb224-450" aria-hidden="true" tabindex="-1"></a>n_chains <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb224-451"><a href="#cb224-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-452"><a href="#cb224-452" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-453"><a href="#cb224-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-456"><a href="#cb224-456" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-457"><a href="#cb224-457" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: posterior diagnosis function</span></span>
<span id="cb224-458"><a href="#cb224-458" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb224-459"><a href="#cb224-459" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true</span></span>
<span id="cb224-460"><a href="#cb224-460" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb224-461"><a href="#cb224-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-462"><a href="#cb224-462" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== Function: bayes_posterior_diagnosis() ====</span></span>
<span id="cb224-463"><a href="#cb224-463" aria-hidden="true" tabindex="-1"></a><span class="co"># this section defines a function to summarize bayesian models diagnostics and visualize posterior results:</span></span>
<span id="cb224-464"><a href="#cb224-464" aria-hidden="true" tabindex="-1"></a><span class="co"># - 1. checks convergence diagnostics (rhat, ess)</span></span>
<span id="cb224-465"><a href="#cb224-465" aria-hidden="true" tabindex="-1"></a><span class="co"># - 2. plots posterior distributions and trace plots</span></span>
<span id="cb224-466"><a href="#cb224-466" aria-hidden="true" tabindex="-1"></a><span class="co"># - 3. visualizes fixed effects estimates with 95% ci</span></span>
<span id="cb224-467"><a href="#cb224-467" aria-hidden="true" tabindex="-1"></a><span class="co"># - 4. optionally saves plots to file</span></span>
<span id="cb224-468"><a href="#cb224-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-469"><a href="#cb224-469" aria-hidden="true" tabindex="-1"></a>bayes_posterior_diagnosis <span class="ot">&lt;-</span> <span class="cf">function</span>(model, </span>
<span id="cb224-470"><a href="#cb224-470" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">model_name =</span> <span class="st">"MODEL"</span>,</span>
<span id="cb224-471"><a href="#cb224-471" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">n_trace =</span> <span class="dv">8</span>,</span>
<span id="cb224-472"><a href="#cb224-472" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">loo_list =</span> <span class="cn">NULL</span>,</span>
<span id="cb224-473"><a href="#cb224-473" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">save_path_prefix =</span> <span class="cn">NULL</span>) {</span>
<span id="cb224-474"><a href="#cb224-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-475"><a href="#cb224-475" aria-hidden="true" tabindex="-1"></a>  rhat_vals <span class="ot">&lt;-</span> <span class="fu">rhat</span>(model)</span>
<span id="cb224-476"><a href="#cb224-476" aria-hidden="true" tabindex="-1"></a>  ess_vals <span class="ot">&lt;-</span> <span class="fu">neff_ratio</span>(model)</span>
<span id="cb224-477"><a href="#cb224-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-478"><a href="#cb224-478" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">glue</span>(<span class="st">"------ {model_name} ------</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb224-479"><a href="#cb224-479" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Rhat &gt; 1.01:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb224-480"><a href="#cb224-480" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(rhat_vals[rhat_vals <span class="sc">&gt;</span> <span class="fl">1.01</span>])</span>
<span id="cb224-481"><a href="#cb224-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-482"><a href="#cb224-482" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">ESS &lt; 0.1:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb224-483"><a href="#cb224-483" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(ess_vals[ess_vals <span class="sc">&lt;</span> <span class="fl">0.1</span>])</span>
<span id="cb224-484"><a href="#cb224-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-485"><a href="#cb224-485" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Summary of Rhat:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb224-486"><a href="#cb224-486" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">summary</span>(rhat_vals))</span>
<span id="cb224-487"><a href="#cb224-487" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb224-488"><a href="#cb224-488" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Summary of ESS ratio:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb224-489"><a href="#cb224-489" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">summary</span>(ess_vals))</span>
<span id="cb224-490"><a href="#cb224-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-491"><a href="#cb224-491" aria-hidden="true" tabindex="-1"></a>posterior_plot <span class="ot">&lt;-</span> <span class="fu">mcmc_areas</span>(</span>
<span id="cb224-492"><a href="#cb224-492" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_draws_df</span>(model),</span>
<span id="cb224-493"><a href="#cb224-493" aria-hidden="true" tabindex="-1"></a>    <span class="at">regex_pars =</span> <span class="st">"^b_"</span>,</span>
<span id="cb224-494"><a href="#cb224-494" aria-hidden="true" tabindex="-1"></a>    <span class="at">prob =</span> <span class="fl">0.8</span>, <span class="at">prob_outer =</span> <span class="fl">0.95</span></span>
<span id="cb224-495"><a href="#cb224-495" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb224-496"><a href="#cb224-496" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">glue</span>(<span class="st">"Posterior Distributions with 95% CI ({model_name})"</span>))</span>
<span id="cb224-497"><a href="#cb224-497" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb224-498"><a href="#cb224-498" aria-hidden="true" tabindex="-1"></a>draw_vars <span class="ot">&lt;-</span> <span class="fu">variables</span>(<span class="fu">as_draws_df</span>(model))</span>
<span id="cb224-499"><a href="#cb224-499" aria-hidden="true" tabindex="-1"></a>trace_candidates <span class="ot">&lt;-</span> draw_vars[<span class="fu">grepl</span>(<span class="st">"^b_"</span>, draw_vars)]</span>
<span id="cb224-500"><a href="#cb224-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-501"><a href="#cb224-501" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(trace_candidates) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb224-502"><a href="#cb224-502" aria-hidden="true" tabindex="-1"></a>  <span class="fu">warning</span>(<span class="fu">glue</span>(<span class="st">"No traceable fixed effect parameters for model {model_name}"</span>))</span>
<span id="cb224-503"><a href="#cb224-503" aria-hidden="true" tabindex="-1"></a>  trace_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">glue</span>(<span class="st">"Trace Plot - {model_name} (No traceable parameters)"</span>))</span>
<span id="cb224-504"><a href="#cb224-504" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb224-505"><a href="#cb224-505" aria-hidden="true" tabindex="-1"></a>  pars_to_plot <span class="ot">&lt;-</span> <span class="fu">head</span>(trace_candidates, n_trace)</span>
<span id="cb224-506"><a href="#cb224-506" aria-hidden="true" tabindex="-1"></a>  trace_plot <span class="ot">&lt;-</span> <span class="fu">mcmc_trace</span>(<span class="fu">as_draws_df</span>(model), <span class="at">pars =</span> pars_to_plot) <span class="sc">+</span></span>
<span id="cb224-507"><a href="#cb224-507" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="fu">glue</span>(<span class="st">"Trace Plot - {model_name} (First {length(pars_to_plot)} parameters)"</span>))</span>
<span id="cb224-508"><a href="#cb224-508" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb224-509"><a href="#cb224-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-510"><a href="#cb224-510" aria-hidden="true" tabindex="-1"></a>  fixef_df <span class="ot">&lt;-</span> <span class="fu">fixef</span>(model) <span class="sc">%&gt;%</span></span>
<span id="cb224-511"><a href="#cb224-511" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb224-512"><a href="#cb224-512" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb224-513"><a href="#cb224-513" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="fu">abs</span>(Estimate)))</span>
<span id="cb224-514"><a href="#cb224-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-515"><a href="#cb224-515" aria-hidden="true" tabindex="-1"></a>  fixef_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(fixef_df, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(Variable, Estimate), <span class="at">y =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb224-516"><a href="#cb224-516" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb224-517"><a href="#cb224-517" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb224-518"><a href="#cb224-518" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb224-519"><a href="#cb224-519" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">glue</span>(<span class="st">"Fixed Effects Estimates with 95% CI ({model_name})"</span>),</span>
<span id="cb224-520"><a href="#cb224-520" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Estimate"</span>, <span class="at">x =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb224-521"><a href="#cb224-521" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb224-522"><a href="#cb224-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-523"><a href="#cb224-523" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(save_path_prefix)) {</span>
<span id="cb224-524"><a href="#cb224-524" aria-hidden="true" tabindex="-1"></a>  dir_path <span class="ot">&lt;-</span> <span class="fu">dirname</span>(save_path_prefix)</span>
<span id="cb224-525"><a href="#cb224-525" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(dir_path)) {</span>
<span id="cb224-526"><a href="#cb224-526" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dir.create</span>(dir_path, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb224-527"><a href="#cb224-527" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb224-528"><a href="#cb224-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-529"><a href="#cb224-529" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">paste0</span>(save_path_prefix, <span class="st">"_posterior.png"</span>), posterior_plot, <span class="at">width =</span> <span class="dv">6</span>, <span class="at">height =</span> <span class="dv">4</span>)</span>
<span id="cb224-530"><a href="#cb224-530" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">paste0</span>(save_path_prefix, <span class="st">"_trace.png"</span>), trace_plot, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">4</span>)</span>
<span id="cb224-531"><a href="#cb224-531" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">paste0</span>(save_path_prefix, <span class="st">"_fixef.png"</span>), fixef_plot, <span class="at">width =</span> <span class="dv">6</span>, <span class="at">height =</span> <span class="dv">4</span>)</span>
<span id="cb224-532"><a href="#cb224-532" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb224-533"><a href="#cb224-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-534"><a href="#cb224-534" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb224-535"><a href="#cb224-535" aria-hidden="true" tabindex="-1"></a>    <span class="at">posterior_plot =</span> posterior_plot,</span>
<span id="cb224-536"><a href="#cb224-536" aria-hidden="true" tabindex="-1"></a>    <span class="at">trace_plot =</span> trace_plot,</span>
<span id="cb224-537"><a href="#cb224-537" aria-hidden="true" tabindex="-1"></a>    <span class="at">fixef_plot =</span> fixef_plot</span>
<span id="cb224-538"><a href="#cb224-538" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb224-539"><a href="#cb224-539" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb224-540"><a href="#cb224-540" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-541"><a href="#cb224-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-544"><a href="#cb224-544" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-545"><a href="#cb224-545" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: auc comparsion function</span></span>
<span id="cb224-546"><a href="#cb224-546" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb224-547"><a href="#cb224-547" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true</span></span>
<span id="cb224-548"><a href="#cb224-548" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb224-549"><a href="#cb224-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-550"><a href="#cb224-550" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== Function: compare_bayes_auc() ====</span></span>
<span id="cb224-551"><a href="#cb224-551" aria-hidden="true" tabindex="-1"></a><span class="co"># this section defines a function to compare auc performance of multiple bayesian logistic models:</span></span>
<span id="cb224-552"><a href="#cb224-552" aria-hidden="true" tabindex="-1"></a><span class="co"># including:</span></span>
<span id="cb224-553"><a href="#cb224-553" aria-hidden="true" tabindex="-1"></a><span class="co"># - 1. computes predicted propabilities on test data</span></span>
<span id="cb224-554"><a href="#cb224-554" aria-hidden="true" tabindex="-1"></a><span class="co"># - 2. plots roc curves for visual comparison</span></span>
<span id="cb224-555"><a href="#cb224-555" aria-hidden="true" tabindex="-1"></a><span class="co"># - 3. performs pairwaise bootsrap tests of auc differences</span></span>
<span id="cb224-556"><a href="#cb224-556" aria-hidden="true" tabindex="-1"></a><span class="co"># - 4. outputs a summary table of auc values</span></span>
<span id="cb224-557"><a href="#cb224-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-558"><a href="#cb224-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-559"><a href="#cb224-559" aria-hidden="true" tabindex="-1"></a>compare_bayes_auc <span class="ot">&lt;-</span> <span class="cf">function</span>(models_named_list, </span>
<span id="cb224-560"><a href="#cb224-560" aria-hidden="true" tabindex="-1"></a>                              test_data, </span>
<span id="cb224-561"><a href="#cb224-561" aria-hidden="true" tabindex="-1"></a>                              <span class="at">label_var =</span> <span class="st">"label"</span>, </span>
<span id="cb224-562"><a href="#cb224-562" aria-hidden="true" tabindex="-1"></a>                              <span class="at">caption =</span> <span class="st">"AUC Comparison on Test Set"</span>,</span>
<span id="cb224-563"><a href="#cb224-563" aria-hidden="true" tabindex="-1"></a>                              <span class="at">colors =</span> <span class="cn">NULL</span>,</span>
<span id="cb224-564"><a href="#cb224-564" aria-hidden="true" tabindex="-1"></a>                              <span class="at">save_path =</span> <span class="cn">NULL</span>) {</span>
<span id="cb224-565"><a href="#cb224-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-566"><a href="#cb224-566" aria-hidden="true" tabindex="-1"></a>  model_names <span class="ot">&lt;-</span> <span class="fu">names</span>(models_named_list)</span>
<span id="cb224-567"><a href="#cb224-567" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(colors)) {</span>
<span id="cb224-568"><a href="#cb224-568" aria-hidden="true" tabindex="-1"></a>    colors <span class="ot">&lt;-</span> RColorBrewer<span class="sc">::</span><span class="fu">brewer.pal</span>(<span class="fu">min</span>(<span class="fu">length</span>(models_named_list), <span class="dv">8</span>), <span class="st">"Set1"</span>)</span>
<span id="cb224-569"><a href="#cb224-569" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb224-570"><a href="#cb224-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-571"><a href="#cb224-571" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 1. predicted probabilities &amp; roc</span></span>
<span id="cb224-572"><a href="#cb224-572" aria-hidden="true" tabindex="-1"></a>  roc_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb224-573"><a href="#cb224-573" aria-hidden="true" tabindex="-1"></a>  auc_list <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb224-574"><a href="#cb224-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-575"><a href="#cb224-575" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(models_named_list)) {</span>
<span id="cb224-576"><a href="#cb224-576" aria-hidden="true" tabindex="-1"></a>    model <span class="ot">&lt;-</span> models_named_list[[i]]</span>
<span id="cb224-577"><a href="#cb224-577" aria-hidden="true" tabindex="-1"></a>    name  <span class="ot">&lt;-</span> model_names[i]</span>
<span id="cb224-578"><a href="#cb224-578" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-579"><a href="#cb224-579" aria-hidden="true" tabindex="-1"></a>    <span class="co"># posterior mean of expected probabilities</span></span>
<span id="cb224-580"><a href="#cb224-580" aria-hidden="true" tabindex="-1"></a>    pred_probs <span class="ot">&lt;-</span> <span class="fu">posterior_epred</span>(model, <span class="at">newdata =</span> test_data, <span class="at">allow_new_levels =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">colMeans</span>()</span>
<span id="cb224-581"><a href="#cb224-581" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-582"><a href="#cb224-582" aria-hidden="true" tabindex="-1"></a>    test_data[[<span class="fu">paste0</span>(<span class="st">"pred_"</span>, name)]] <span class="ot">&lt;-</span> pred_probs</span>
<span id="cb224-583"><a href="#cb224-583" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-584"><a href="#cb224-584" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ROC</span></span>
<span id="cb224-585"><a href="#cb224-585" aria-hidden="true" tabindex="-1"></a>    roc_obj <span class="ot">&lt;-</span> <span class="fu">roc</span>(test_data[[label_var]], pred_probs)</span>
<span id="cb224-586"><a href="#cb224-586" aria-hidden="true" tabindex="-1"></a>    roc_list[[name]] <span class="ot">&lt;-</span> roc_obj</span>
<span id="cb224-587"><a href="#cb224-587" aria-hidden="true" tabindex="-1"></a>    auc_list[i] <span class="ot">&lt;-</span> <span class="fu">auc</span>(roc_obj)</span>
<span id="cb224-588"><a href="#cb224-588" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb224-589"><a href="#cb224-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-590"><a href="#cb224-590" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2. pic</span></span>
<span id="cb224-591"><a href="#cb224-591" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(roc_list[[<span class="dv">1</span>]], <span class="at">col =</span> colors[<span class="dv">1</span>], <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">main =</span> <span class="st">"Bayesian Logistic Models: ROC Comparison"</span>)</span>
<span id="cb224-592"><a href="#cb224-592" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(roc_list)) {</span>
<span id="cb224-593"><a href="#cb224-593" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines</span>(roc_list[[i]], <span class="at">col =</span> colors[i], <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb224-594"><a href="#cb224-594" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb224-595"><a href="#cb224-595" aria-hidden="true" tabindex="-1"></a>  <span class="fu">legend</span>(<span class="st">"bottomright"</span>, <span class="at">legend =</span> model_names, <span class="at">col =</span> colors[<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(roc_list)], <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb224-596"><a href="#cb224-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-597"><a href="#cb224-597" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(save_path)) {</span>
<span id="cb224-598"><a href="#cb224-598" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dev.copy</span>(png, <span class="at">filename =</span> save_path, <span class="at">width =</span> <span class="dv">800</span>, <span class="at">height =</span> <span class="dv">600</span>)</span>
<span id="cb224-599"><a href="#cb224-599" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dev.off</span>()</span>
<span id="cb224-600"><a href="#cb224-600" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb224-601"><a href="#cb224-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-602"><a href="#cb224-602" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. pairwise comparisons</span></span>
<span id="cb224-603"><a href="#cb224-603" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(roc_list) <span class="sc">&gt;=</span> <span class="dv">2</span>) {</span>
<span id="cb224-604"><a href="#cb224-604" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">--- AUC Bootstrap Tests ---</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb224-605"><a href="#cb224-605" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(roc_list) <span class="sc">-</span> <span class="dv">1</span>)) {</span>
<span id="cb224-606"><a href="#cb224-606" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> (i <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(roc_list)) {</span>
<span id="cb224-607"><a href="#cb224-607" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">{model_names[i]} vs {model_names[j]}:</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb224-608"><a href="#cb224-608" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(<span class="fu">roc.test</span>(roc_list[[i]], roc_list[[j]], <span class="at">method =</span> <span class="st">"bootstrap"</span>, <span class="at">paired =</span> <span class="cn">TRUE</span>))</span>
<span id="cb224-609"><a href="#cb224-609" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb224-610"><a href="#cb224-610" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb224-611"><a href="#cb224-611" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb224-612"><a href="#cb224-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-613"><a href="#cb224-613" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 4. AUC tables</span></span>
<span id="cb224-614"><a href="#cb224-614" aria-hidden="true" tabindex="-1"></a>  auc_table <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb224-615"><a href="#cb224-615" aria-hidden="true" tabindex="-1"></a>    <span class="at">Model =</span> model_names,</span>
<span id="cb224-616"><a href="#cb224-616" aria-hidden="true" tabindex="-1"></a>    <span class="at">AUC =</span> auc_list</span>
<span id="cb224-617"><a href="#cb224-617" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb224-618"><a href="#cb224-618" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb224-619"><a href="#cb224-619" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(knitr<span class="sc">::</span><span class="fu">kable</span>(auc_table, <span class="at">digits =</span> <span class="dv">3</span>, <span class="at">caption =</span> caption))</span>
<span id="cb224-620"><a href="#cb224-620" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb224-621"><a href="#cb224-621" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb224-622"><a href="#cb224-622" aria-hidden="true" tabindex="-1"></a>    <span class="at">roc_list =</span> roc_list,</span>
<span id="cb224-623"><a href="#cb224-623" aria-hidden="true" tabindex="-1"></a>    <span class="at">auc_table =</span> auc_table</span>
<span id="cb224-624"><a href="#cb224-624" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb224-625"><a href="#cb224-625" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb224-626"><a href="#cb224-626" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-627"><a href="#cb224-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-628"><a href="#cb224-628" aria-hidden="true" tabindex="-1"></a><span class="fu">## Adver</span></span>
<span id="cb224-629"><a href="#cb224-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-630"><a href="#cb224-630" aria-hidden="true" tabindex="-1"></a><span class="fu">### model training</span></span>
<span id="cb224-631"><a href="#cb224-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-634"><a href="#cb224-634" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-635"><a href="#cb224-635" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: adver_predictive model training</span></span>
<span id="cb224-636"><a href="#cb224-636" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb224-637"><a href="#cb224-637" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true</span></span>
<span id="cb224-638"><a href="#cb224-638" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb224-639"><a href="#cb224-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-640"><a href="#cb224-640" aria-hidden="true" tabindex="-1"></a><span class="co"># ------ model training ----- </span></span>
<span id="cb224-641"><a href="#cb224-641" aria-hidden="true" tabindex="-1"></a>bayes_base <span class="ot">&lt;-</span> <span class="fu">brm</span>(formula_base, <span class="at">data =</span> train_data_adver, <span class="at">family =</span> <span class="fu">bernoulli</span>(),</span>
<span id="cb224-642"><a href="#cb224-642" aria-hidden="true" tabindex="-1"></a>                  <span class="at">prior =</span> priors_base, <span class="at">iter =</span> n_iter, <span class="at">chains =</span> n_chains,</span>
<span id="cb224-643"><a href="#cb224-643" aria-hidden="true" tabindex="-1"></a>                  <span class="at">seed =</span> <span class="dv">123</span>, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.9</span>))</span>
<span id="cb224-644"><a href="#cb224-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-645"><a href="#cb224-645" aria-hidden="true" tabindex="-1"></a>bayes_baseline <span class="ot">&lt;-</span> <span class="fu">brm</span>(formula_baseline, <span class="at">data =</span> train_data_adver, <span class="at">family =</span> <span class="fu">bernoulli</span>(),</span>
<span id="cb224-646"><a href="#cb224-646" aria-hidden="true" tabindex="-1"></a>                 <span class="at">prior =</span> priors_mechanism, <span class="at">iter =</span> n_iter, <span class="at">chains =</span> n_chains,</span>
<span id="cb224-647"><a href="#cb224-647" aria-hidden="true" tabindex="-1"></a>                 <span class="at">seed =</span> <span class="dv">123</span>, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.9</span>))</span>
<span id="cb224-648"><a href="#cb224-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-649"><a href="#cb224-649" aria-hidden="true" tabindex="-1"></a>bayes_raw <span class="ot">&lt;-</span> <span class="fu">brm</span>(formula_raw, <span class="at">data =</span> train_data_adver, <span class="at">family =</span> <span class="fu">bernoulli</span>(),</span>
<span id="cb224-650"><a href="#cb224-650" aria-hidden="true" tabindex="-1"></a>                 <span class="at">prior =</span> priors_mechanism, <span class="at">iter =</span> n_iter, <span class="at">chains =</span> n_chains,</span>
<span id="cb224-651"><a href="#cb224-651" aria-hidden="true" tabindex="-1"></a>                 <span class="at">seed =</span> <span class="dv">123</span>, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.9</span>))</span>
<span id="cb224-652"><a href="#cb224-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-653"><a href="#cb224-653" aria-hidden="true" tabindex="-1"></a>bayes_match <span class="ot">&lt;-</span> <span class="fu">brm</span>(formula_match, <span class="at">data =</span> train_data_adver, <span class="at">family =</span> <span class="fu">bernoulli</span>(),</span>
<span id="cb224-654"><a href="#cb224-654" aria-hidden="true" tabindex="-1"></a>                   <span class="at">prior =</span> priors_mechanism, <span class="at">iter =</span> n_iter, <span class="at">chains =</span> n_chains,</span>
<span id="cb224-655"><a href="#cb224-655" aria-hidden="true" tabindex="-1"></a>                   <span class="at">seed =</span> <span class="dv">123</span>, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.9</span>))</span>
<span id="cb224-656"><a href="#cb224-656" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-657"><a href="#cb224-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-660"><a href="#cb224-660" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-661"><a href="#cb224-661" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: adver_predictive model results</span></span>
<span id="cb224-662"><a href="#cb224-662" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb224-663"><a href="#cb224-663" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true</span></span>
<span id="cb224-664"><a href="#cb224-664" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb224-665"><a href="#cb224-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-666"><a href="#cb224-666" aria-hidden="true" tabindex="-1"></a><span class="co"># ------ LOO ----- </span></span>
<span id="cb224-667"><a href="#cb224-667" aria-hidden="true" tabindex="-1"></a>loo_base <span class="ot">&lt;-</span> <span class="fu">loo</span>(bayes_base)</span>
<span id="cb224-668"><a href="#cb224-668" aria-hidden="true" tabindex="-1"></a>loo_baseline <span class="ot">&lt;-</span> <span class="fu">loo</span>(bayes_baseline)</span>
<span id="cb224-669"><a href="#cb224-669" aria-hidden="true" tabindex="-1"></a>loo_raw <span class="ot">&lt;-</span> <span class="fu">loo</span>(bayes_raw)</span>
<span id="cb224-670"><a href="#cb224-670" aria-hidden="true" tabindex="-1"></a>loo_match <span class="ot">&lt;-</span> <span class="fu">loo</span>(bayes_match)</span>
<span id="cb224-671"><a href="#cb224-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-672"><a href="#cb224-672" aria-hidden="true" tabindex="-1"></a><span class="co"># ------ Bayes R2 ----- </span></span>
<span id="cb224-673"><a href="#cb224-673" aria-hidden="true" tabindex="-1"></a>bayes_r2_brms <span class="ot">&lt;-</span> <span class="cf">function</span>(model) <span class="fu">bayes_R2</span>(model)[<span class="dv">1</span>]</span>
<span id="cb224-674"><a href="#cb224-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-675"><a href="#cb224-675" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb224-676"><a href="#cb224-676" aria-hidden="true" tabindex="-1"></a>  <span class="at">Model =</span> <span class="fu">c</span>(<span class="st">"Base"</span>,<span class="st">"Baseline"</span>, <span class="st">"Raw"</span>, <span class="st">"Match"</span>),</span>
<span id="cb224-677"><a href="#cb224-677" aria-hidden="true" tabindex="-1"></a>  <span class="at">LOOIC =</span> <span class="fu">c</span>(loo_base<span class="sc">$</span>estimates[<span class="st">"looic"</span>, <span class="st">"Estimate"</span>],</span>
<span id="cb224-678"><a href="#cb224-678" aria-hidden="true" tabindex="-1"></a>            loo_baseline<span class="sc">$</span>estimates[<span class="st">"looic"</span>, <span class="st">"Estimate"</span>],</span>
<span id="cb224-679"><a href="#cb224-679" aria-hidden="true" tabindex="-1"></a>            loo_raw<span class="sc">$</span>estimates[<span class="st">"looic"</span>, <span class="st">"Estimate"</span>],</span>
<span id="cb224-680"><a href="#cb224-680" aria-hidden="true" tabindex="-1"></a>            loo_match<span class="sc">$</span>estimates[<span class="st">"looic"</span>, <span class="st">"Estimate"</span>]),</span>
<span id="cb224-681"><a href="#cb224-681" aria-hidden="true" tabindex="-1"></a>  <span class="at">Bayes_R2 =</span> <span class="fu">c</span>(<span class="fu">bayes_r2_brms</span>(bayes_base),</span>
<span id="cb224-682"><a href="#cb224-682" aria-hidden="true" tabindex="-1"></a>                <span class="fu">bayes_r2_brms</span>(bayes_baseline),</span>
<span id="cb224-683"><a href="#cb224-683" aria-hidden="true" tabindex="-1"></a>                <span class="fu">bayes_r2_brms</span>(bayes_raw),</span>
<span id="cb224-684"><a href="#cb224-684" aria-hidden="true" tabindex="-1"></a>                <span class="fu">bayes_r2_brms</span>(bayes_match))</span>
<span id="cb224-685"><a href="#cb224-685" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb224-686"><a href="#cb224-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-687"><a href="#cb224-687" aria-hidden="true" tabindex="-1"></a>results <span class="sc">%&gt;%</span> <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"Bayesian Model Comparison: LOOIC and Approximate Pseudo-R2"</span>)</span>
<span id="cb224-688"><a href="#cb224-688" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-689"><a href="#cb224-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-690"><a href="#cb224-690" aria-hidden="true" tabindex="-1"></a><span class="fu">### posterior diagnosis</span></span>
<span id="cb224-691"><a href="#cb224-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-694"><a href="#cb224-694" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-695"><a href="#cb224-695" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: adver_predictive posterior diagnosis</span></span>
<span id="cb224-696"><a href="#cb224-696" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb224-697"><a href="#cb224-697" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true</span></span>
<span id="cb224-698"><a href="#cb224-698" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb224-699"><a href="#cb224-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-700"><a href="#cb224-700" aria-hidden="true" tabindex="-1"></a>results_base <span class="ot">&lt;-</span> <span class="fu">bayes_posterior_diagnosis</span>(</span>
<span id="cb224-701"><a href="#cb224-701" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> bayes_base,</span>
<span id="cb224-702"><a href="#cb224-702" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_name =</span> <span class="st">"BASE"</span>,</span>
<span id="cb224-703"><a href="#cb224-703" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_trace =</span> <span class="dv">6</span>,</span>
<span id="cb224-704"><a href="#cb224-704" aria-hidden="true" tabindex="-1"></a>  <span class="at">save_path_prefix =</span> <span class="st">"outputs/bayes_base_diagnosis"</span></span>
<span id="cb224-705"><a href="#cb224-705" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb224-706"><a href="#cb224-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-707"><a href="#cb224-707" aria-hidden="true" tabindex="-1"></a>results_baseline <span class="ot">&lt;-</span> <span class="fu">bayes_posterior_diagnosis</span>(</span>
<span id="cb224-708"><a href="#cb224-708" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> bayes_baseline,</span>
<span id="cb224-709"><a href="#cb224-709" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_name =</span> <span class="st">"BASELINE"</span>,</span>
<span id="cb224-710"><a href="#cb224-710" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_trace =</span> <span class="dv">6</span>,</span>
<span id="cb224-711"><a href="#cb224-711" aria-hidden="true" tabindex="-1"></a>  <span class="at">save_path_prefix =</span> <span class="st">"outputs/bayes_baseline_diagnosis"</span></span>
<span id="cb224-712"><a href="#cb224-712" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb224-713"><a href="#cb224-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-714"><a href="#cb224-714" aria-hidden="true" tabindex="-1"></a>results_raw <span class="ot">&lt;-</span> <span class="fu">bayes_posterior_diagnosis</span>(</span>
<span id="cb224-715"><a href="#cb224-715" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> bayes_raw,</span>
<span id="cb224-716"><a href="#cb224-716" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_name =</span> <span class="st">"RAW"</span>,</span>
<span id="cb224-717"><a href="#cb224-717" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_trace =</span> <span class="dv">6</span>,</span>
<span id="cb224-718"><a href="#cb224-718" aria-hidden="true" tabindex="-1"></a>  <span class="at">save_path_prefix =</span> <span class="st">"outputs/bayes_raw_diagnosis"</span></span>
<span id="cb224-719"><a href="#cb224-719" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb224-720"><a href="#cb224-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-721"><a href="#cb224-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-722"><a href="#cb224-722" aria-hidden="true" tabindex="-1"></a>results_match <span class="ot">&lt;-</span><span class="fu">bayes_posterior_diagnosis</span>(</span>
<span id="cb224-723"><a href="#cb224-723" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> bayes_match,</span>
<span id="cb224-724"><a href="#cb224-724" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_name =</span> <span class="st">"MATCH"</span>,</span>
<span id="cb224-725"><a href="#cb224-725" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_trace =</span> <span class="dv">6</span>,</span>
<span id="cb224-726"><a href="#cb224-726" aria-hidden="true" tabindex="-1"></a>  <span class="at">save_path_prefix =</span> <span class="st">"outputs/bayes_match_diagnosis"</span></span>
<span id="cb224-727"><a href="#cb224-727" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb224-728"><a href="#cb224-728" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-729"><a href="#cb224-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-730"><a href="#cb224-730" aria-hidden="true" tabindex="-1"></a><span class="fu">### auc comparison</span></span>
<span id="cb224-731"><a href="#cb224-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-734"><a href="#cb224-734" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-735"><a href="#cb224-735" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: adver_predictive auc compasion</span></span>
<span id="cb224-736"><a href="#cb224-736" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false </span></span>
<span id="cb224-737"><a href="#cb224-737" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true </span></span>
<span id="cb224-738"><a href="#cb224-738" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb224-739"><a href="#cb224-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-740"><a href="#cb224-740" aria-hidden="true" tabindex="-1"></a><span class="co"># models list</span></span>
<span id="cb224-741"><a href="#cb224-741" aria-hidden="true" tabindex="-1"></a>models_adver_compare <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb224-742"><a href="#cb224-742" aria-hidden="true" tabindex="-1"></a>  <span class="at">Base =</span> bayes_base,</span>
<span id="cb224-743"><a href="#cb224-743" aria-hidden="true" tabindex="-1"></a>  <span class="at">Baseline =</span> bayes_baseline,</span>
<span id="cb224-744"><a href="#cb224-744" aria-hidden="true" tabindex="-1"></a>  <span class="at">Raw =</span> bayes_raw,</span>
<span id="cb224-745"><a href="#cb224-745" aria-hidden="true" tabindex="-1"></a>  <span class="at">Match =</span> bayes_match</span>
<span id="cb224-746"><a href="#cb224-746" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb224-747"><a href="#cb224-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-748"><a href="#cb224-748" aria-hidden="true" tabindex="-1"></a><span class="co"># auc comparsion and tables outprint</span></span>
<span id="cb224-749"><a href="#cb224-749" aria-hidden="true" tabindex="-1"></a><span class="fu">compare_bayes_auc</span>(models_adver_compare, <span class="at">test_data =</span> test_data_adver)</span>
<span id="cb224-750"><a href="#cb224-750" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-751"><a href="#cb224-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-752"><a href="#cb224-752" aria-hidden="true" tabindex="-1"></a><span class="fu">## Legis</span></span>
<span id="cb224-753"><a href="#cb224-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-754"><a href="#cb224-754" aria-hidden="true" tabindex="-1"></a><span class="fu">### model training</span></span>
<span id="cb224-755"><a href="#cb224-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-758"><a href="#cb224-758" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-759"><a href="#cb224-759" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: legis_predictive model prepartion</span></span>
<span id="cb224-760"><a href="#cb224-760" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false </span></span>
<span id="cb224-761"><a href="#cb224-761" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true </span></span>
<span id="cb224-762"><a href="#cb224-762" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb224-763"><a href="#cb224-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-764"><a href="#cb224-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-765"><a href="#cb224-765" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-766"><a href="#cb224-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-769"><a href="#cb224-769" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-770"><a href="#cb224-770" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: legis_predictive model training</span></span>
<span id="cb224-771"><a href="#cb224-771" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false </span></span>
<span id="cb224-772"><a href="#cb224-772" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true </span></span>
<span id="cb224-773"><a href="#cb224-773" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb224-774"><a href="#cb224-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-775"><a href="#cb224-775" aria-hidden="true" tabindex="-1"></a>bayes_base_legis <span class="ot">&lt;-</span> <span class="fu">brm</span>(formula_base, <span class="at">data =</span> train_data_legis, <span class="at">family =</span> <span class="fu">bernoulli</span>(),</span>
<span id="cb224-776"><a href="#cb224-776" aria-hidden="true" tabindex="-1"></a>                  <span class="at">prior =</span> priors_base, <span class="at">iter =</span> n_iter, <span class="at">chains =</span> n_chains,</span>
<span id="cb224-777"><a href="#cb224-777" aria-hidden="true" tabindex="-1"></a>                  <span class="at">seed =</span> <span class="dv">123</span>, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.9</span>))</span>
<span id="cb224-778"><a href="#cb224-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-779"><a href="#cb224-779" aria-hidden="true" tabindex="-1"></a>bayes_baseline_legis <span class="ot">&lt;-</span> <span class="fu">brm</span>(formula_baseline, <span class="at">data =</span> train_data_legis, <span class="at">family =</span> <span class="fu">bernoulli</span>(),</span>
<span id="cb224-780"><a href="#cb224-780" aria-hidden="true" tabindex="-1"></a>                 <span class="at">prior =</span> priors_mechanism, <span class="at">iter =</span> n_iter, <span class="at">chains =</span> n_chains,</span>
<span id="cb224-781"><a href="#cb224-781" aria-hidden="true" tabindex="-1"></a>                 <span class="at">seed =</span> <span class="dv">123</span>, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.9</span>))</span>
<span id="cb224-782"><a href="#cb224-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-783"><a href="#cb224-783" aria-hidden="true" tabindex="-1"></a>bayes_raw_legis <span class="ot">&lt;-</span> <span class="fu">brm</span>(formula_raw, <span class="at">data =</span> train_data_legis, <span class="at">family =</span> <span class="fu">bernoulli</span>(),</span>
<span id="cb224-784"><a href="#cb224-784" aria-hidden="true" tabindex="-1"></a>                 <span class="at">prior =</span> priors_mechanism, <span class="at">iter =</span> n_iter, <span class="at">chains =</span> n_chains,</span>
<span id="cb224-785"><a href="#cb224-785" aria-hidden="true" tabindex="-1"></a>                 <span class="at">seed =</span> <span class="dv">123</span>, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.9</span>))</span>
<span id="cb224-786"><a href="#cb224-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-787"><a href="#cb224-787" aria-hidden="true" tabindex="-1"></a>bayes_match_legis <span class="ot">&lt;-</span> <span class="fu">brm</span>(formula_match, <span class="at">data =</span> train_data_legis, <span class="at">family =</span> <span class="fu">bernoulli</span>(),</span>
<span id="cb224-788"><a href="#cb224-788" aria-hidden="true" tabindex="-1"></a>                   <span class="at">prior =</span> priors_mechanism, <span class="at">iter =</span> n_iter, <span class="at">chains =</span> n_chains,</span>
<span id="cb224-789"><a href="#cb224-789" aria-hidden="true" tabindex="-1"></a>                   <span class="at">seed =</span> <span class="dv">123</span>, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.9</span>))</span>
<span id="cb224-790"><a href="#cb224-790" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-791"><a href="#cb224-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-794"><a href="#cb224-794" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-795"><a href="#cb224-795" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: legis_predictive model results</span></span>
<span id="cb224-796"><a href="#cb224-796" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false </span></span>
<span id="cb224-797"><a href="#cb224-797" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true </span></span>
<span id="cb224-798"><a href="#cb224-798" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb224-799"><a href="#cb224-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-800"><a href="#cb224-800" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. loo</span></span>
<span id="cb224-801"><a href="#cb224-801" aria-hidden="true" tabindex="-1"></a>loo_base_legis <span class="ot">&lt;-</span> <span class="fu">loo</span>(bayes_base_legis)</span>
<span id="cb224-802"><a href="#cb224-802" aria-hidden="true" tabindex="-1"></a>loo_baseline_legis <span class="ot">&lt;-</span> <span class="fu">loo</span>(bayes_baseline_legis)</span>
<span id="cb224-803"><a href="#cb224-803" aria-hidden="true" tabindex="-1"></a>loo_raw_legis <span class="ot">&lt;-</span> <span class="fu">loo</span>(bayes_raw_legis)</span>
<span id="cb224-804"><a href="#cb224-804" aria-hidden="true" tabindex="-1"></a>loo_match_legis <span class="ot">&lt;-</span> <span class="fu">loo</span>(bayes_match_legis)</span>
<span id="cb224-805"><a href="#cb224-805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-806"><a href="#cb224-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-807"><a href="#cb224-807" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. bayes r2 </span></span>
<span id="cb224-808"><a href="#cb224-808" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb224-809"><a href="#cb224-809" aria-hidden="true" tabindex="-1"></a>  <span class="at">Model =</span> <span class="fu">c</span>(<span class="st">"Base-legis"</span>, <span class="st">"Baseline-legis"</span>, <span class="st">"Raw-legis"</span>, <span class="st">"Match-legis"</span>),</span>
<span id="cb224-810"><a href="#cb224-810" aria-hidden="true" tabindex="-1"></a>  <span class="at">LOOIC =</span> <span class="fu">c</span>(loo_base_legis<span class="sc">$</span>estimates[<span class="st">"looic"</span>, <span class="st">"Estimate"</span>],</span>
<span id="cb224-811"><a href="#cb224-811" aria-hidden="true" tabindex="-1"></a>            loo_baseline_legis<span class="sc">$</span>estimates[<span class="st">"looic"</span>, <span class="st">"Estimate"</span>],</span>
<span id="cb224-812"><a href="#cb224-812" aria-hidden="true" tabindex="-1"></a>            loo_raw_legis<span class="sc">$</span>estimates[<span class="st">"looic"</span>, <span class="st">"Estimate"</span>],</span>
<span id="cb224-813"><a href="#cb224-813" aria-hidden="true" tabindex="-1"></a>            loo_match_legis<span class="sc">$</span>estimates[<span class="st">"looic"</span>, <span class="st">"Estimate"</span>]),</span>
<span id="cb224-814"><a href="#cb224-814" aria-hidden="true" tabindex="-1"></a>  <span class="at">Bayes_R2 =</span> <span class="fu">c</span>(<span class="fu">bayes_r2_brms</span>(bayes_base_legis),</span>
<span id="cb224-815"><a href="#cb224-815" aria-hidden="true" tabindex="-1"></a>               <span class="fu">bayes_r2_brms</span>(bayes_baseline_legis),</span>
<span id="cb224-816"><a href="#cb224-816" aria-hidden="true" tabindex="-1"></a>               <span class="fu">bayes_r2_brms</span>(bayes_raw_legis),</span>
<span id="cb224-817"><a href="#cb224-817" aria-hidden="true" tabindex="-1"></a>               <span class="fu">bayes_r2_brms</span>(bayes_match_legis))</span>
<span id="cb224-818"><a href="#cb224-818" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb224-819"><a href="#cb224-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-820"><a href="#cb224-820" aria-hidden="true" tabindex="-1"></a>results <span class="sc">%&gt;%</span> <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"Bayesian Model (legis) Comparison: LOOIC and Approximate Bayes-R2"</span>)</span>
<span id="cb224-821"><a href="#cb224-821" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-822"><a href="#cb224-822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-823"><a href="#cb224-823" aria-hidden="true" tabindex="-1"></a><span class="fu">### posterior diagnosis</span></span>
<span id="cb224-824"><a href="#cb224-824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-827"><a href="#cb224-827" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-828"><a href="#cb224-828" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: legis_predictive posterior diagnosis</span></span>
<span id="cb224-829"><a href="#cb224-829" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false </span></span>
<span id="cb224-830"><a href="#cb224-830" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true </span></span>
<span id="cb224-831"><a href="#cb224-831" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb224-832"><a href="#cb224-832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-833"><a href="#cb224-833" aria-hidden="true" tabindex="-1"></a>results_base_legis <span class="ot">&lt;-</span> <span class="fu">bayes_posterior_diagnosis</span>(</span>
<span id="cb224-834"><a href="#cb224-834" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> bayes_base_legis,</span>
<span id="cb224-835"><a href="#cb224-835" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_name =</span> <span class="st">"BASE"</span>,</span>
<span id="cb224-836"><a href="#cb224-836" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_trace =</span> <span class="dv">6</span>,</span>
<span id="cb224-837"><a href="#cb224-837" aria-hidden="true" tabindex="-1"></a>  <span class="at">save_path_prefix =</span> <span class="st">"outputs/bayes_base_diagnosis"</span></span>
<span id="cb224-838"><a href="#cb224-838" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb224-839"><a href="#cb224-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-840"><a href="#cb224-840" aria-hidden="true" tabindex="-1"></a>results_baseline_legis <span class="ot">&lt;-</span> <span class="fu">bayes_posterior_diagnosis</span>(</span>
<span id="cb224-841"><a href="#cb224-841" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> bayes_baseline_legis,</span>
<span id="cb224-842"><a href="#cb224-842" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_name =</span> <span class="st">"BASELINE"</span>,</span>
<span id="cb224-843"><a href="#cb224-843" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_trace =</span> <span class="dv">6</span>,</span>
<span id="cb224-844"><a href="#cb224-844" aria-hidden="true" tabindex="-1"></a>  <span class="at">save_path_prefix =</span> <span class="st">"outputs/bayes_base_diagnosis"</span></span>
<span id="cb224-845"><a href="#cb224-845" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb224-846"><a href="#cb224-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-847"><a href="#cb224-847" aria-hidden="true" tabindex="-1"></a>results_raw_legis <span class="ot">&lt;-</span> <span class="fu">bayes_posterior_diagnosis</span>(</span>
<span id="cb224-848"><a href="#cb224-848" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> bayes_raw_legis,</span>
<span id="cb224-849"><a href="#cb224-849" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_name =</span> <span class="st">"RAW"</span>,</span>
<span id="cb224-850"><a href="#cb224-850" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_trace =</span> <span class="dv">6</span>,</span>
<span id="cb224-851"><a href="#cb224-851" aria-hidden="true" tabindex="-1"></a>  <span class="at">save_path_prefix =</span> <span class="st">"outputs/bayes_raw_diagnosis"</span></span>
<span id="cb224-852"><a href="#cb224-852" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb224-853"><a href="#cb224-853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-854"><a href="#cb224-854" aria-hidden="true" tabindex="-1"></a>results_match_legis <span class="ot">&lt;-</span> <span class="fu">bayes_posterior_diagnosis</span>(</span>
<span id="cb224-855"><a href="#cb224-855" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> bayes_match_legis,</span>
<span id="cb224-856"><a href="#cb224-856" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_name =</span> <span class="st">"MATCH"</span>,</span>
<span id="cb224-857"><a href="#cb224-857" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_trace =</span> <span class="dv">6</span>,</span>
<span id="cb224-858"><a href="#cb224-858" aria-hidden="true" tabindex="-1"></a>  <span class="at">save_path_prefix =</span> <span class="st">"outputs/bayes_match_diagnosis"</span></span>
<span id="cb224-859"><a href="#cb224-859" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb224-860"><a href="#cb224-860" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-861"><a href="#cb224-861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-862"><a href="#cb224-862" aria-hidden="true" tabindex="-1"></a><span class="fu">### auc comparsion</span></span>
<span id="cb224-863"><a href="#cb224-863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-866"><a href="#cb224-866" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-867"><a href="#cb224-867" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: legis_predictive auc comparison</span></span>
<span id="cb224-868"><a href="#cb224-868" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false </span></span>
<span id="cb224-869"><a href="#cb224-869" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true </span></span>
<span id="cb224-870"><a href="#cb224-870" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb224-871"><a href="#cb224-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-872"><a href="#cb224-872" aria-hidden="true" tabindex="-1"></a>models_legis_compare <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb224-873"><a href="#cb224-873" aria-hidden="true" tabindex="-1"></a>  <span class="at">Base =</span> bayes_base_legis,</span>
<span id="cb224-874"><a href="#cb224-874" aria-hidden="true" tabindex="-1"></a>  <span class="at">Baseline =</span> bayes_baseline_legis,</span>
<span id="cb224-875"><a href="#cb224-875" aria-hidden="true" tabindex="-1"></a>  <span class="at">Raw =</span> bayes_raw_legis,</span>
<span id="cb224-876"><a href="#cb224-876" aria-hidden="true" tabindex="-1"></a>  <span class="at">Match =</span> bayes_match_legis</span>
<span id="cb224-877"><a href="#cb224-877" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb224-878"><a href="#cb224-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-879"><a href="#cb224-879" aria-hidden="true" tabindex="-1"></a><span class="fu">compare_bayes_auc</span>(models_legis_compare, <span class="at">test_data =</span> test_data_legis)</span>
<span id="cb224-880"><a href="#cb224-880" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-881"><a href="#cb224-881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-882"><a href="#cb224-882" aria-hidden="true" tabindex="-1"></a><span class="fu"># Discriminant Validity</span></span>
<span id="cb224-883"><a href="#cb224-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-884"><a href="#cb224-884" aria-hidden="true" tabindex="-1"></a>**Discriminant validity** is examined by assessing whether the incremental introduction of first-, second-, and third-type features yields consistent and significant improvements in model performance. This is quantified using expected log predictive density (ELPD) under WAIC or LOO-CV criteria.</span>
<span id="cb224-885"><a href="#cb224-885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-886"><a href="#cb224-886" aria-hidden="true" tabindex="-1"></a><span class="fu">## model setting</span></span>
<span id="cb224-887"><a href="#cb224-887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-890"><a href="#cb224-890" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-891"><a href="#cb224-891" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: discriminant model constuction</span></span>
<span id="cb224-892"><a href="#cb224-892" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false </span></span>
<span id="cb224-893"><a href="#cb224-893" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true </span></span>
<span id="cb224-894"><a href="#cb224-894" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb224-895"><a href="#cb224-895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-896"><a href="#cb224-896" aria-hidden="true" tabindex="-1"></a>formula_base <span class="ot">&lt;-</span> <span class="fu">bf</span>(label <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>issue) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>full_name) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>congress))</span>
<span id="cb224-897"><a href="#cb224-897" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-898"><a href="#cb224-898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-899"><a href="#cb224-899" aria-hidden="true" tabindex="-1"></a>formula_intl <span class="ot">&lt;-</span> <span class="fu">bf</span>(label <span class="sc">~</span> leverage_pl_raw <span class="sc">+</span> leverage_ne_raw <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>issue) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>full_name) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>congress))</span>
<span id="cb224-900"><a href="#cb224-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-901"><a href="#cb224-901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-902"><a href="#cb224-902" aria-hidden="true" tabindex="-1"></a>formula_intldom <span class="ot">&lt;-</span> <span class="fu">bf</span>(label <span class="sc">~</span> leverage_pl_raw <span class="sc">+</span> leverage_ne_raw <span class="sc">+</span> ethnicity_pl_raw <span class="sc">+</span> ethnicity_ne_raw <span class="sc">+</span></span>
<span id="cb224-903"><a href="#cb224-903" aria-hidden="true" tabindex="-1"></a>                    payroll_industry_pl_raw <span class="sc">+</span> payroll_industry_ne_raw <span class="sc">+</span></span>
<span id="cb224-904"><a href="#cb224-904" aria-hidden="true" tabindex="-1"></a>                    party_value_pl_raw <span class="sc">+</span> party_value_ne_raw <span class="sc">+</span></span>
<span id="cb224-905"><a href="#cb224-905" aria-hidden="true" tabindex="-1"></a>                    party_score_pl_raw <span class="sc">+</span> party_score_ne_raw <span class="sc">+</span></span>
<span id="cb224-906"><a href="#cb224-906" aria-hidden="true" tabindex="-1"></a>                    employ_industry_pl_raw <span class="sc">+</span> employ_industry_ne_raw <span class="sc">+</span> </span>
<span id="cb224-907"><a href="#cb224-907" aria-hidden="true" tabindex="-1"></a>                    (<span class="dv">1</span><span class="sc">|</span>issue) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>full_name) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>congress))</span>
<span id="cb224-908"><a href="#cb224-908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-909"><a href="#cb224-909" aria-hidden="true" tabindex="-1"></a>formula_domprof <span class="ot">&lt;-</span> <span class="fu">bf</span>(label <span class="sc">~</span> committee_pl_raw <span class="sc">+</span> committee_ne_raw <span class="sc">+</span>  ethnicity_pl_raw <span class="sc">+</span> ethnicity_ne_raw <span class="sc">+</span></span>
<span id="cb224-910"><a href="#cb224-910" aria-hidden="true" tabindex="-1"></a>                    payroll_industry_pl_raw <span class="sc">+</span> payroll_industry_ne_raw <span class="sc">+</span></span>
<span id="cb224-911"><a href="#cb224-911" aria-hidden="true" tabindex="-1"></a>                    party_value_pl_raw <span class="sc">+</span> party_value_ne_raw <span class="sc">+</span></span>
<span id="cb224-912"><a href="#cb224-912" aria-hidden="true" tabindex="-1"></a>                    party_score_pl_raw <span class="sc">+</span> party_score_ne_raw <span class="sc">+</span></span>
<span id="cb224-913"><a href="#cb224-913" aria-hidden="true" tabindex="-1"></a>                    employ_industry_pl_raw <span class="sc">+</span> employ_industry_ne_raw <span class="sc">+</span> </span>
<span id="cb224-914"><a href="#cb224-914" aria-hidden="true" tabindex="-1"></a>                    (<span class="dv">1</span><span class="sc">|</span>issue) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>full_name) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>congress))</span>
<span id="cb224-915"><a href="#cb224-915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-916"><a href="#cb224-916" aria-hidden="true" tabindex="-1"></a>formula_intlprof <span class="ot">&lt;-</span> <span class="fu">bf</span>(label <span class="sc">~</span> leverage_pl_raw <span class="sc">+</span> leverage_ne_raw <span class="sc">+</span> committee_pl_raw <span class="sc">+</span> committee_ne_raw <span class="sc">+</span> </span>
<span id="cb224-917"><a href="#cb224-917" aria-hidden="true" tabindex="-1"></a>                    (<span class="dv">1</span><span class="sc">|</span>issue) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>full_name) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>congress))</span>
<span id="cb224-918"><a href="#cb224-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-919"><a href="#cb224-919" aria-hidden="true" tabindex="-1"></a>formula_match <span class="ot">&lt;-</span> <span class="fu">bf</span>(</span>
<span id="cb224-920"><a href="#cb224-920" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.formula</span>(<span class="fu">paste</span>(<span class="st">"label ~"</span>, <span class="fu">paste</span>(match_features, <span class="at">collapse =</span> <span class="st">" + "</span>), <span class="st">"+ (1|issue) + (1|full_name) + (1|congress)"</span>))</span>
<span id="cb224-921"><a href="#cb224-921" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb224-922"><a href="#cb224-922" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-923"><a href="#cb224-923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-926"><a href="#cb224-926" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-927"><a href="#cb224-927" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: discriminant prior setting </span></span>
<span id="cb224-928"><a href="#cb224-928" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false </span></span>
<span id="cb224-929"><a href="#cb224-929" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true </span></span>
<span id="cb224-930"><a href="#cb224-930" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb224-931"><a href="#cb224-931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-932"><a href="#cb224-932" aria-hidden="true" tabindex="-1"></a><span class="co"># keep prior_base</span></span>
<span id="cb224-933"><a href="#cb224-933" aria-hidden="true" tabindex="-1"></a>prior_base <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb224-934"><a href="#cb224-934" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_prior</span>(<span class="st">"student_t(3, 0, 2.5)"</span>, <span class="at">class =</span> <span class="st">"Intercept"</span>),</span>
<span id="cb224-935"><a href="#cb224-935" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_prior</span>(<span class="st">"student_t(3, 0, 2.5)"</span>, <span class="at">class =</span> <span class="st">"sd"</span>)</span>
<span id="cb224-936"><a href="#cb224-936" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb224-937"><a href="#cb224-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-938"><a href="#cb224-938" aria-hidden="true" tabindex="-1"></a><span class="co"># change prior_raw/match into prior_mechanism</span></span>
<span id="cb224-939"><a href="#cb224-939" aria-hidden="true" tabindex="-1"></a>prior_mechanism <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb224-940"><a href="#cb224-940" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_prior</span>(<span class="st">"normal(0, 2.5)"</span>, <span class="at">class =</span> <span class="st">"b"</span>),</span>
<span id="cb224-941"><a href="#cb224-941" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_prior</span>(<span class="st">"student_t(3, 0, 2.5)"</span>, <span class="at">class =</span> <span class="st">"Intercept"</span>),</span>
<span id="cb224-942"><a href="#cb224-942" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_prior</span>(<span class="st">"student_t(3, 0, 2.5)"</span>, <span class="at">class =</span> <span class="st">"sd"</span>)</span>
<span id="cb224-943"><a href="#cb224-943" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb224-944"><a href="#cb224-944" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-945"><a href="#cb224-945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-948"><a href="#cb224-948" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-949"><a href="#cb224-949" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: variables importance comparison function</span></span>
<span id="cb224-950"><a href="#cb224-950" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false </span></span>
<span id="cb224-951"><a href="#cb224-951" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true </span></span>
<span id="cb224-952"><a href="#cb224-952" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb224-953"><a href="#cb224-953" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-954"><a href="#cb224-954" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== Function: bayes_value_importance_v2() ====</span></span>
<span id="cb224-955"><a href="#cb224-955" aria-hidden="true" tabindex="-1"></a><span class="co"># this section defines a function visualize and export posterior fixed effect estimates from bayes model</span></span>
<span id="cb224-956"><a href="#cb224-956" aria-hidden="true" tabindex="-1"></a><span class="co"># - 1. ranks predictions by absolute logit coefficient</span></span>
<span id="cb224-957"><a href="#cb224-957" aria-hidden="true" tabindex="-1"></a><span class="co"># - 2. plots estimates with 95% ci</span></span>
<span id="cb224-958"><a href="#cb224-958" aria-hidden="true" tabindex="-1"></a><span class="co"># - 3. optionally saves the plot and the table to disk</span></span>
<span id="cb224-959"><a href="#cb224-959" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-960"><a href="#cb224-960" aria-hidden="true" tabindex="-1"></a>bayes_value_importance_v2 <span class="ot">&lt;-</span> <span class="cf">function</span>(model, <span class="at">model_name =</span> <span class="st">"Model"</span>, </span>
<span id="cb224-961"><a href="#cb224-961" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">save_dir =</span> <span class="fu">file.path</span>(output_dir, <span class="st">"bayes_value_importance"</span>), </span>
<span id="cb224-962"><a href="#cb224-962" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">save_plot =</span> <span class="cn">TRUE</span>, <span class="at">save_table =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb224-963"><a href="#cb224-963" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(save_dir)) <span class="fu">dir.create</span>(save_dir, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb224-964"><a href="#cb224-964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-965"><a href="#cb224-965" aria-hidden="true" tabindex="-1"></a>  effects <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">fixef</span>(model)) <span class="sc">%&gt;%</span></span>
<span id="cb224-966"><a href="#cb224-966" aria-hidden="true" tabindex="-1"></a>    tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb224-967"><a href="#cb224-967" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>(Variable <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"(Intercept)"</span>, <span class="st">"Intercept"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb224-968"><a href="#cb224-968" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="fu">abs</span>(Estimate)))</span>
<span id="cb224-969"><a href="#cb224-969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-970"><a href="#cb224-970" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(effects, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(Variable, <span class="fu">abs</span>(Estimate)), <span class="at">y =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb224-971"><a href="#cb224-971" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"skyblue"</span>) <span class="sc">+</span></span>
<span id="cb224-972"><a href="#cb224-972" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb224-973"><a href="#cb224-973" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb224-974"><a href="#cb224-974" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb224-975"><a href="#cb224-975" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Posterior Estimates (with 95% CI) -"</span>, model_name),</span>
<span id="cb224-976"><a href="#cb224-976" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Logit Coefficient"</span></span>
<span id="cb224-977"><a href="#cb224-977" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb224-978"><a href="#cb224-978" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>)</span>
<span id="cb224-979"><a href="#cb224-979" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-980"><a href="#cb224-980" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (save_plot) {</span>
<span id="cb224-981"><a href="#cb224-981" aria-hidden="true" tabindex="-1"></a>    plot_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(save_dir, <span class="fu">paste0</span>(<span class="st">"bayes_coef_plot_"</span>, model_name, <span class="st">".png"</span>))</span>
<span id="cb224-982"><a href="#cb224-982" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggsave</span>(plot_path, p, <span class="at">width =</span> <span class="dv">7</span>, <span class="at">height =</span> <span class="dv">5</span>)</span>
<span id="cb224-983"><a href="#cb224-983" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"✅ plot saves to: {plot_path}"</span>))</span>
<span id="cb224-984"><a href="#cb224-984" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb224-985"><a href="#cb224-985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-986"><a href="#cb224-986" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (save_table) {</span>
<span id="cb224-987"><a href="#cb224-987" aria-hidden="true" tabindex="-1"></a>    table_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(save_dir, <span class="fu">paste0</span>(<span class="st">"bayes_coef_table_"</span>, model_name, <span class="st">".csv"</span>))</span>
<span id="cb224-988"><a href="#cb224-988" aria-hidden="true" tabindex="-1"></a>    readr<span class="sc">::</span><span class="fu">write_csv</span>(effects, table_path)</span>
<span id="cb224-989"><a href="#cb224-989" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"📄 tables saves to: {table_path}"</span>))</span>
<span id="cb224-990"><a href="#cb224-990" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb224-991"><a href="#cb224-991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-992"><a href="#cb224-992" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">plot =</span> p, <span class="at">data =</span> effects))</span>
<span id="cb224-993"><a href="#cb224-993" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb224-994"><a href="#cb224-994" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-995"><a href="#cb224-995" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-996"><a href="#cb224-996" aria-hidden="true" tabindex="-1"></a><span class="fu">### comparions with shap values function</span></span>
<span id="cb224-997"><a href="#cb224-997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-998"><a href="#cb224-998" aria-hidden="true" tabindex="-1"></a>the following three functions was meant to complete: compares bayesian model coefficients with SHAP values from lgbm models, specifically</span>
<span id="cb224-999"><a href="#cb224-999" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1000"><a href="#cb224-1000" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>aligns variables and compares directionality (signs)</span>
<span id="cb224-1001"><a href="#cb224-1001" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>computes pearson correlation and direction match rate</span>
<span id="cb224-1002"><a href="#cb224-1002" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>visualizes SHAP vs bayesian coefficients in a scatter plot <span class="sc">\#</span> major goal: assessing model interpretability consistenct across frameworks</span>
<span id="cb224-1003"><a href="#cb224-1003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1006"><a href="#cb224-1006" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1007"><a href="#cb224-1007" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: shap values comparison function debug </span></span>
<span id="cb224-1008"><a href="#cb224-1008" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false </span></span>
<span id="cb224-1009"><a href="#cb224-1009" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true </span></span>
<span id="cb224-1010"><a href="#cb224-1010" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb224-1011"><a href="#cb224-1011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1012"><a href="#cb224-1012" aria-hidden="true" tabindex="-1"></a><span class="co"># debug_once(compare_bayes_vs_shap_data)</span></span>
<span id="cb224-1013"><a href="#cb224-1013" aria-hidden="true" tabindex="-1"></a><span class="co"># results_adver &lt;- run_bayes_shap_all_models(model_list, adver_all, match_vars)</span></span>
<span id="cb224-1014"><a href="#cb224-1014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1015"><a href="#cb224-1015" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1016"><a href="#cb224-1016" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1019"><a href="#cb224-1019" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1020"><a href="#cb224-1020" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: shap values comparison function1 </span></span>
<span id="cb224-1021"><a href="#cb224-1021" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false </span></span>
<span id="cb224-1022"><a href="#cb224-1022" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true </span></span>
<span id="cb224-1023"><a href="#cb224-1023" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb224-1024"><a href="#cb224-1024" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1025"><a href="#cb224-1025" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== Function 1: Extract &amp; Match Coefficients with SHAP (robust version) ====</span></span>
<span id="cb224-1026"><a href="#cb224-1026" aria-hidden="true" tabindex="-1"></a>compare_bayes_vs_shap_data <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb224-1027"><a href="#cb224-1027" aria-hidden="true" tabindex="-1"></a>  bayes_model,</span>
<span id="cb224-1028"><a href="#cb224-1028" aria-hidden="true" tabindex="-1"></a>  shap_data,</span>
<span id="cb224-1029"><a href="#cb224-1029" aria-hidden="true" tabindex="-1"></a>  <span class="at">set_name =</span> <span class="st">"test"</span>,</span>
<span id="cb224-1030"><a href="#cb224-1030" aria-hidden="true" tabindex="-1"></a>  <span class="at">match_vars =</span> <span class="cn">NULL</span>,</span>
<span id="cb224-1031"><a href="#cb224-1031" aria-hidden="true" tabindex="-1"></a>  <span class="at">suffix =</span> <span class="st">"_raw"</span></span>
<span id="cb224-1032"><a href="#cb224-1032" aria-hidden="true" tabindex="-1"></a>) {</span>
<span id="cb224-1033"><a href="#cb224-1033" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 1. extract coef names from brms model</span></span>
<span id="cb224-1034"><a href="#cb224-1034" aria-hidden="true" tabindex="-1"></a>  coef_bayes <span class="ot">&lt;-</span> <span class="fu">fixef</span>(bayes_model)[, <span class="st">"Estimate"</span>]</span>
<span id="cb224-1035"><a href="#cb224-1035" aria-hidden="true" tabindex="-1"></a>  coef_names <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(coef_bayes), <span class="fu">c</span>(<span class="st">"(Intercept)"</span>, <span class="st">"Intercept"</span>))</span>
<span id="cb224-1036"><a href="#cb224-1036" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1037"><a href="#cb224-1037" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2. build matching list of coef names (fuzzy matching to capture dummy expansions)</span></span>
<span id="cb224-1038"><a href="#cb224-1038" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(match_vars)) {</span>
<span id="cb224-1039"><a href="#cb224-1039" aria-hidden="true" tabindex="-1"></a>    vars_in_model <span class="ot">&lt;-</span> <span class="fu">character</span>(<span class="dv">0</span>)</span>
<span id="cb224-1040"><a href="#cb224-1040" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (mv <span class="cf">in</span> match_vars) {</span>
<span id="cb224-1041"><a href="#cb224-1041" aria-hidden="true" tabindex="-1"></a>      <span class="co"># try patterns: with suffix (e.g. leverage_pl_raw) and without suffix (leverage_pl)</span></span>
<span id="cb224-1042"><a href="#cb224-1042" aria-hidden="true" tabindex="-1"></a>      pat1 <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"^"</span>, mv, suffix)   <span class="co"># e.g. ^leverage_pl_raw</span></span>
<span id="cb224-1043"><a href="#cb224-1043" aria-hidden="true" tabindex="-1"></a>      pat2 <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"^"</span>, mv)           <span class="co"># e.g. ^leverage_pl</span></span>
<span id="cb224-1044"><a href="#cb224-1044" aria-hidden="true" tabindex="-1"></a>      matched <span class="ot">&lt;-</span> coef_names[<span class="fu">grepl</span>(<span class="fu">paste0</span>(pat1, <span class="st">"|"</span>, pat2), coef_names)]</span>
<span id="cb224-1045"><a href="#cb224-1045" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">length</span>(matched) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb224-1046"><a href="#cb224-1046" aria-hidden="true" tabindex="-1"></a>        vars_in_model <span class="ot">&lt;-</span> <span class="fu">c</span>(vars_in_model, matched)</span>
<span id="cb224-1047"><a href="#cb224-1047" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb224-1048"><a href="#cb224-1048" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb224-1049"><a href="#cb224-1049" aria-hidden="true" tabindex="-1"></a>    vars_in_model <span class="ot">&lt;-</span> <span class="fu">unique</span>(vars_in_model)</span>
<span id="cb224-1050"><a href="#cb224-1050" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb224-1051"><a href="#cb224-1051" aria-hidden="true" tabindex="-1"></a>    vars_in_model <span class="ot">&lt;-</span> coef_names</span>
<span id="cb224-1052"><a href="#cb224-1052" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb224-1053"><a href="#cb224-1053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1054"><a href="#cb224-1054" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(vars_in_model) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb224-1055"><a href="#cb224-1055" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"No matched variables found in Bayesian model. Please check match_vars and suffix."</span>)</span>
<span id="cb224-1056"><a href="#cb224-1056" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb224-1057"><a href="#cb224-1057" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1058"><a href="#cb224-1058" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 3. construct table mapping each matched coef name back to its base variable (var_clean)</span></span>
<span id="cb224-1059"><a href="#cb224-1059" aria-hidden="true" tabindex="-1"></a>  <span class="co">#    e.g. leverage_pl_raw1 -&gt; leverage_pl</span></span>
<span id="cb224-1060"><a href="#cb224-1060" aria-hidden="true" tabindex="-1"></a>  map_var_to_base <span class="ot">&lt;-</span> <span class="cf">function</span>(coef_name, match_vars, suffix) {</span>
<span id="cb224-1061"><a href="#cb224-1061" aria-hidden="true" tabindex="-1"></a>    <span class="co"># remove trailing numeric indexes and optional suffix to recover base name</span></span>
<span id="cb224-1062"><a href="#cb224-1062" aria-hidden="true" tabindex="-1"></a>    base <span class="ot">&lt;-</span> coef_name</span>
<span id="cb224-1063"><a href="#cb224-1063" aria-hidden="true" tabindex="-1"></a>    base <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_remove</span>(base, <span class="fu">paste0</span>(suffix, <span class="st">"[0-9]*$"</span>))   <span class="co"># drop _raw1/_raw2/_raw etc</span></span>
<span id="cb224-1064"><a href="#cb224-1064" aria-hidden="true" tabindex="-1"></a>    base <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_remove</span>(base, <span class="st">"[0-9]+$"</span>)                  <span class="co"># drop trailing digits (safety)</span></span>
<span id="cb224-1065"><a href="#cb224-1065" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if still not matching, try to find the match_var that is prefix</span></span>
<span id="cb224-1066"><a href="#cb224-1066" aria-hidden="true" tabindex="-1"></a>    hit <span class="ot">&lt;-</span> match_vars[<span class="fu">vapply</span>(match_vars, <span class="cf">function</span>(mv) <span class="fu">grepl</span>(<span class="fu">paste0</span>(<span class="st">"^"</span>, mv), base), <span class="fu">logical</span>(<span class="dv">1</span>))]</span>
<span id="cb224-1067"><a href="#cb224-1067" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(hit) <span class="sc">&gt;=</span> <span class="dv">1</span>) {</span>
<span id="cb224-1068"><a href="#cb224-1068" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(hit[<span class="dv">1</span>])</span>
<span id="cb224-1069"><a href="#cb224-1069" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb224-1070"><a href="#cb224-1070" aria-hidden="true" tabindex="-1"></a>      <span class="co"># fallback: drop numeric suffix after last underscore</span></span>
<span id="cb224-1071"><a href="#cb224-1071" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(stringr<span class="sc">::</span><span class="fu">str_remove</span>(base, <span class="st">"_[0-9]+$"</span>))</span>
<span id="cb224-1072"><a href="#cb224-1072" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb224-1073"><a href="#cb224-1073" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb224-1074"><a href="#cb224-1074" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1075"><a href="#cb224-1075" aria-hidden="true" tabindex="-1"></a>  var_clean_vec <span class="ot">&lt;-</span> <span class="fu">vapply</span>(vars_in_model, map_var_to_base, <span class="at">FUN.VALUE =</span> <span class="fu">character</span>(<span class="dv">1</span>), <span class="at">match_vars =</span> match_vars, <span class="at">suffix =</span> suffix)</span>
<span id="cb224-1076"><a href="#cb224-1076" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1077"><a href="#cb224-1077" aria-hidden="true" tabindex="-1"></a>  coef_bayes_tbl <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb224-1078"><a href="#cb224-1078" aria-hidden="true" tabindex="-1"></a>    <span class="at">var =</span> vars_in_model,</span>
<span id="cb224-1079"><a href="#cb224-1079" aria-hidden="true" tabindex="-1"></a>    <span class="at">coef_logit =</span> <span class="fu">as.numeric</span>(coef_bayes[vars_in_model]),</span>
<span id="cb224-1080"><a href="#cb224-1080" aria-hidden="true" tabindex="-1"></a>    <span class="at">var_clean =</span> var_clean_vec</span>
<span id="cb224-1081"><a href="#cb224-1081" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb224-1082"><a href="#cb224-1082" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1083"><a href="#cb224-1083" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 4. aggregate coefficients per var_clean (平均化各个 dummy 的系数)</span></span>
<span id="cb224-1084"><a href="#cb224-1084" aria-hidden="true" tabindex="-1"></a>  coef_bayes_agg <span class="ot">&lt;-</span> coef_bayes_tbl <span class="sc">%&gt;%</span></span>
<span id="cb224-1085"><a href="#cb224-1085" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">group_by</span>(var_clean) <span class="sc">%&gt;%</span></span>
<span id="cb224-1086"><a href="#cb224-1086" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb224-1087"><a href="#cb224-1087" aria-hidden="true" tabindex="-1"></a>      <span class="at">coef_logit =</span> <span class="fu">mean</span>(coef_logit, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb224-1088"><a href="#cb224-1088" aria-hidden="true" tabindex="-1"></a>      <span class="at">n_coefs =</span> dplyr<span class="sc">::</span><span class="fu">n</span>(),</span>
<span id="cb224-1089"><a href="#cb224-1089" aria-hidden="true" tabindex="-1"></a>      <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb224-1090"><a href="#cb224-1090" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb224-1091"><a href="#cb224-1091" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1092"><a href="#cb224-1092" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 5. ensure shap_data has 'set' column</span></span>
<span id="cb224-1093"><a href="#cb224-1093" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="st">"set"</span> <span class="sc">%in%</span> <span class="fu">names</span>(shap_data)) shap_data<span class="sc">$</span>set <span class="ot">&lt;-</span> set_name</span>
<span id="cb224-1094"><a href="#cb224-1094" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1095"><a href="#cb224-1095" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 6. prepare shap variables list (should correspond to var_clean)</span></span>
<span id="cb224-1096"><a href="#cb224-1096" aria-hidden="true" tabindex="-1"></a>  vars_shap <span class="ot">&lt;-</span> <span class="fu">unique</span>(coef_bayes_agg<span class="sc">$</span>var_clean)</span>
<span id="cb224-1097"><a href="#cb224-1097" aria-hidden="true" tabindex="-1"></a>  missing_vars <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(vars_shap, <span class="fu">colnames</span>(shap_data))</span>
<span id="cb224-1098"><a href="#cb224-1098" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(missing_vars) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb224-1099"><a href="#cb224-1099" aria-hidden="true" tabindex="-1"></a>    <span class="fu">warning</span>(glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"⚠️ Missing vars in shap_data and will be skipped: {paste(missing_vars, collapse = ', ')}"</span>))</span>
<span id="cb224-1100"><a href="#cb224-1100" aria-hidden="true" tabindex="-1"></a>    vars_shap <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(vars_shap, missing_vars)</span>
<span id="cb224-1101"><a href="#cb224-1101" aria-hidden="true" tabindex="-1"></a>    coef_bayes_agg <span class="ot">&lt;-</span> coef_bayes_agg <span class="sc">%&gt;%</span> <span class="fu">filter</span>(var_clean <span class="sc">%in%</span> vars_shap)</span>
<span id="cb224-1102"><a href="#cb224-1102" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb224-1103"><a href="#cb224-1103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1104"><a href="#cb224-1104" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(vars_shap) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb224-1105"><a href="#cb224-1105" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"After checking shap_data, no overlapping variables remain for comparison."</span>)</span>
<span id="cb224-1106"><a href="#cb224-1106" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb224-1107"><a href="#cb224-1107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1108"><a href="#cb224-1108" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 7. compute mean SHAP per variable (use new across lambda syntax to avoid deprecation warnings)</span></span>
<span id="cb224-1109"><a href="#cb224-1109" aria-hidden="true" tabindex="-1"></a>  shap_values <span class="ot">&lt;-</span> shap_data <span class="sc">%&gt;%</span></span>
<span id="cb224-1110"><a href="#cb224-1110" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(.data<span class="sc">$</span>set <span class="sc">==</span> set_name) <span class="sc">%&gt;%</span></span>
<span id="cb224-1111"><a href="#cb224-1111" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarise</span>(dplyr<span class="sc">::</span><span class="fu">across</span>(<span class="fu">all_of</span>(vars_shap), \(x) <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb224-1112"><a href="#cb224-1112" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"shap_var"</span>, <span class="at">values_to =</span> <span class="st">"shap_value"</span>)</span>
<span id="cb224-1113"><a href="#cb224-1113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1114"><a href="#cb224-1114" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 8. combine aggregated bayes coefs with shap means</span></span>
<span id="cb224-1115"><a href="#cb224-1115" aria-hidden="true" tabindex="-1"></a>  comparison <span class="ot">&lt;-</span> coef_bayes_agg <span class="sc">%&gt;%</span></span>
<span id="cb224-1116"><a href="#cb224-1116" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">left_join</span>(shap_values, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"var_clean"</span> <span class="ot">=</span> <span class="st">"shap_var"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb224-1117"><a href="#cb224-1117" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb224-1118"><a href="#cb224-1118" aria-hidden="true" tabindex="-1"></a>      <span class="at">abs_coef_logit =</span> <span class="fu">abs</span>(coef_logit),</span>
<span id="cb224-1119"><a href="#cb224-1119" aria-hidden="true" tabindex="-1"></a>      <span class="at">abs_shap_value =</span> <span class="fu">abs</span>(shap_value),</span>
<span id="cb224-1120"><a href="#cb224-1120" aria-hidden="true" tabindex="-1"></a>      <span class="at">dir_logit =</span> <span class="fu">sign</span>(coef_logit),</span>
<span id="cb224-1121"><a href="#cb224-1121" aria-hidden="true" tabindex="-1"></a>      <span class="at">dir_shap =</span> dplyr<span class="sc">::</span><span class="fu">if_else</span>(shap_value <span class="sc">==</span> <span class="dv">0</span>, <span class="cn">NA_real_</span>, <span class="fu">sign</span>(shap_value)),</span>
<span id="cb224-1122"><a href="#cb224-1122" aria-hidden="true" tabindex="-1"></a>      <span class="at">direction_match =</span> (dir_logit <span class="sc">==</span> dir_shap),</span>
<span id="cb224-1123"><a href="#cb224-1123" aria-hidden="true" tabindex="-1"></a>      <span class="at">direction_mismatch =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(direction_match), <span class="cn">NA</span>, <span class="sc">!</span>direction_match)</span>
<span id="cb224-1124"><a href="#cb224-1124" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb224-1125"><a href="#cb224-1125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1126"><a href="#cb224-1126" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 9. summary statistics (handle possible NA in correlations)</span></span>
<span id="cb224-1127"><a href="#cb224-1127" aria-hidden="true" tabindex="-1"></a>  pearson_cor <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(<span class="fu">cor</span>(comparison<span class="sc">$</span>coef_logit, comparison<span class="sc">$</span>shap_value, <span class="at">use =</span> <span class="st">"complete.obs"</span>), <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NA_real_</span>)</span>
<span id="cb224-1128"><a href="#cb224-1128" aria-hidden="true" tabindex="-1"></a>  abs_cor <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(<span class="fu">cor</span>(comparison<span class="sc">$</span>abs_coef_logit, comparison<span class="sc">$</span>abs_shap_value, <span class="at">use =</span> <span class="st">"complete.obs"</span>), <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NA_real_</span>)</span>
<span id="cb224-1129"><a href="#cb224-1129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1130"><a href="#cb224-1130" aria-hidden="true" tabindex="-1"></a>  summary_stats <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb224-1131"><a href="#cb224-1131" aria-hidden="true" tabindex="-1"></a>    <span class="at">Direction_Match_Rate =</span> <span class="fu">mean</span>(comparison<span class="sc">$</span>direction_match, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb224-1132"><a href="#cb224-1132" aria-hidden="true" tabindex="-1"></a>    <span class="at">Pearson_Correlation =</span> pearson_cor,</span>
<span id="cb224-1133"><a href="#cb224-1133" aria-hidden="true" tabindex="-1"></a>    <span class="at">Abs_Value_Correlation =</span> abs_cor</span>
<span id="cb224-1134"><a href="#cb224-1134" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb224-1135"><a href="#cb224-1135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1136"><a href="#cb224-1136" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">summary =</span> summary_stats, <span class="at">detail =</span> comparison))</span>
<span id="cb224-1137"><a href="#cb224-1137" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb224-1138"><a href="#cb224-1138" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1139"><a href="#cb224-1139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1142"><a href="#cb224-1142" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1143"><a href="#cb224-1143" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: shap values comparison function2 </span></span>
<span id="cb224-1144"><a href="#cb224-1144" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false </span></span>
<span id="cb224-1145"><a href="#cb224-1145" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true </span></span>
<span id="cb224-1146"><a href="#cb224-1146" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb224-1147"><a href="#cb224-1147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1148"><a href="#cb224-1148" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== Function 2: Plot SHAP vs Coefficients (adjusted) ====</span></span>
<span id="cb224-1149"><a href="#cb224-1149" aria-hidden="true" tabindex="-1"></a>plot_bayes_vs_shap <span class="ot">&lt;-</span> <span class="cf">function</span>(comparison_df, <span class="at">model_name =</span> <span class="cn">NULL</span>) {</span>
<span id="cb224-1150"><a href="#cb224-1150" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ensure expected cols exist</span></span>
<span id="cb224-1151"><a href="#cb224-1151" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(<span class="fu">c</span>(<span class="st">"coef_logit"</span>, <span class="st">"shap_value"</span>, <span class="st">"var_clean"</span>, <span class="st">"abs_shap_value"</span>, <span class="st">"direction_mismatch"</span>) <span class="sc">%in%</span> <span class="fu">colnames</span>(comparison_df))) {</span>
<span id="cb224-1152"><a href="#cb224-1152" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"comparison_df must contain columns: coef_logit, shap_value, var_clean, abs_shap_value, direction_mismatch"</span>)</span>
<span id="cb224-1153"><a href="#cb224-1153" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb224-1154"><a href="#cb224-1154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1155"><a href="#cb224-1155" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(comparison_df, ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> coef_logit, <span class="at">y =</span> shap_value, <span class="at">label =</span> var_clean)) <span class="sc">+</span></span>
<span id="cb224-1156"><a href="#cb224-1156" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">color =</span> abs_shap_value, <span class="at">shape =</span> direction_mismatch), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb224-1157"><a href="#cb224-1157" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(<span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.8</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb224-1158"><a href="#cb224-1158" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_color_gradient</span>(<span class="at">low =</span> <span class="st">"orange"</span>, <span class="at">high =</span> <span class="st">"red"</span>, <span class="at">name =</span> <span class="st">"Mean |SHAP|"</span>) <span class="sc">+</span></span>
<span id="cb224-1159"><a href="#cb224-1159" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">FALSE</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">16</span>, <span class="st">`</span><span class="at">TRUE</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">17</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Match"</span>, <span class="st">"Mismatch"</span>), <span class="at">name =</span> <span class="st">"Direction Match"</span>) <span class="sc">+</span></span>
<span id="cb224-1160"><a href="#cb224-1160" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray60"</span>) <span class="sc">+</span></span>
<span id="cb224-1161"><a href="#cb224-1161" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray60"</span>) <span class="sc">+</span></span>
<span id="cb224-1162"><a href="#cb224-1162" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb224-1163"><a href="#cb224-1163" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Posterior Mean (Bayesian logit)"</span>,</span>
<span id="cb224-1164"><a href="#cb224-1164" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Average SHAP Value (LGBM)"</span>,</span>
<span id="cb224-1165"><a href="#cb224-1165" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"SHAP vs Bayesian Coefficient Directions"</span>, <span class="fu">ifelse</span>(<span class="fu">is.null</span>(model_name), <span class="st">""</span>, <span class="fu">paste0</span>(<span class="st">" - "</span>, model_name)))</span>
<span id="cb224-1166"><a href="#cb224-1166" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb224-1167"><a href="#cb224-1167" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_minimal</span>()</span>
<span id="cb224-1168"><a href="#cb224-1168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1169"><a href="#cb224-1169" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(p)</span>
<span id="cb224-1170"><a href="#cb224-1170" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb224-1171"><a href="#cb224-1171" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1172"><a href="#cb224-1172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1175"><a href="#cb224-1175" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1176"><a href="#cb224-1176" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: shap values comparison function3</span></span>
<span id="cb224-1177"><a href="#cb224-1177" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false </span></span>
<span id="cb224-1178"><a href="#cb224-1178" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true </span></span>
<span id="cb224-1179"><a href="#cb224-1179" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb224-1180"><a href="#cb224-1180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1181"><a href="#cb224-1181" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== Function 3: Run batch comparisons safely (unchanged interface) ====</span></span>
<span id="cb224-1182"><a href="#cb224-1182" aria-hidden="true" tabindex="-1"></a>run_bayes_shap_all_models <span class="ot">&lt;-</span> <span class="cf">function</span>(model_list, shap_data, match_vars, <span class="at">set_name =</span> <span class="st">"test"</span>, <span class="at">suffix =</span> <span class="st">"_raw"</span>) {</span>
<span id="cb224-1183"><a href="#cb224-1183" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">imap</span>(model_list, <span class="sc">~</span>{</span>
<span id="cb224-1184"><a href="#cb224-1184" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tryCatch</span>({</span>
<span id="cb224-1185"><a href="#cb224-1185" aria-hidden="true" tabindex="-1"></a>      result <span class="ot">&lt;-</span> <span class="fu">compare_bayes_vs_shap_data</span>(</span>
<span id="cb224-1186"><a href="#cb224-1186" aria-hidden="true" tabindex="-1"></a>        <span class="at">bayes_model =</span> .x,</span>
<span id="cb224-1187"><a href="#cb224-1187" aria-hidden="true" tabindex="-1"></a>        <span class="at">shap_data   =</span> shap_data,</span>
<span id="cb224-1188"><a href="#cb224-1188" aria-hidden="true" tabindex="-1"></a>        <span class="at">set_name    =</span> set_name,</span>
<span id="cb224-1189"><a href="#cb224-1189" aria-hidden="true" tabindex="-1"></a>        <span class="at">match_vars  =</span> match_vars,</span>
<span id="cb224-1190"><a href="#cb224-1190" aria-hidden="true" tabindex="-1"></a>        <span class="at">suffix      =</span> suffix</span>
<span id="cb224-1191"><a href="#cb224-1191" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb224-1192"><a href="#cb224-1192" aria-hidden="true" tabindex="-1"></a>      result<span class="sc">$</span>plot <span class="ot">&lt;-</span> <span class="fu">plot_bayes_vs_shap</span>(result<span class="sc">$</span>detail, <span class="at">model_name =</span> .y)</span>
<span id="cb224-1193"><a href="#cb224-1193" aria-hidden="true" tabindex="-1"></a>      result</span>
<span id="cb224-1194"><a href="#cb224-1194" aria-hidden="true" tabindex="-1"></a>    }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb224-1195"><a href="#cb224-1195" aria-hidden="true" tabindex="-1"></a>      <span class="fu">message</span>(glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"❌ Model {.y} error: {e$message}"</span>))</span>
<span id="cb224-1196"><a href="#cb224-1196" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb224-1197"><a href="#cb224-1197" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb224-1198"><a href="#cb224-1198" aria-hidden="true" tabindex="-1"></a>  }) <span class="sc">%&gt;%</span> purrr<span class="sc">::</span><span class="fu">compact</span>()</span>
<span id="cb224-1199"><a href="#cb224-1199" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb224-1200"><a href="#cb224-1200" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1201"><a href="#cb224-1201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1202"><a href="#cb224-1202" aria-hidden="true" tabindex="-1"></a><span class="fu">## Adver</span></span>
<span id="cb224-1203"><a href="#cb224-1203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1204"><a href="#cb224-1204" aria-hidden="true" tabindex="-1"></a><span class="fu">### model training</span></span>
<span id="cb224-1205"><a href="#cb224-1205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1208"><a href="#cb224-1208" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1209"><a href="#cb224-1209" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: adver_discriminant model training</span></span>
<span id="cb224-1210"><a href="#cb224-1210" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false </span></span>
<span id="cb224-1211"><a href="#cb224-1211" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true </span></span>
<span id="cb224-1212"><a href="#cb224-1212" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb224-1213"><a href="#cb224-1213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1214"><a href="#cb224-1214" aria-hidden="true" tabindex="-1"></a><span class="co"># ----- model training ----</span></span>
<span id="cb224-1215"><a href="#cb224-1215" aria-hidden="true" tabindex="-1"></a>bayes_base <span class="ot">&lt;-</span> <span class="fu">brm</span>(formula_base, <span class="at">data =</span> train_data_adver, <span class="at">family =</span> <span class="fu">bernoulli</span>(),</span>
<span id="cb224-1216"><a href="#cb224-1216" aria-hidden="true" tabindex="-1"></a>                  <span class="at">prior =</span> prior_base, <span class="at">iter =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">2</span>, <span class="at">seed =</span> <span class="dv">123</span>)</span>
<span id="cb224-1217"><a href="#cb224-1217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1218"><a href="#cb224-1218" aria-hidden="true" tabindex="-1"></a>bayes_intl <span class="ot">&lt;-</span> <span class="fu">brm</span>(formula_intl, <span class="at">data =</span> train_data_adver, <span class="at">family =</span> <span class="fu">bernoulli</span>(),</span>
<span id="cb224-1219"><a href="#cb224-1219" aria-hidden="true" tabindex="-1"></a>                  <span class="at">prior =</span> prior_mechanism, <span class="at">iter =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">2</span>, <span class="at">seed =</span> <span class="dv">123</span>)</span>
<span id="cb224-1220"><a href="#cb224-1220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1221"><a href="#cb224-1221" aria-hidden="true" tabindex="-1"></a>bayes_intldom <span class="ot">&lt;-</span> <span class="fu">brm</span>(formula_intldom, <span class="at">data =</span> train_data_adver, <span class="at">family =</span> <span class="fu">bernoulli</span>(),</span>
<span id="cb224-1222"><a href="#cb224-1222" aria-hidden="true" tabindex="-1"></a>                 <span class="at">prior =</span> prior_mechanism, <span class="at">iter =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">2</span>, <span class="at">seed =</span> <span class="dv">123</span>)</span>
<span id="cb224-1223"><a href="#cb224-1223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1224"><a href="#cb224-1224" aria-hidden="true" tabindex="-1"></a>bayes_domprof <span class="ot">&lt;-</span> <span class="fu">brm</span>(formula_domprof, <span class="at">data =</span> train_data_adver, <span class="at">family =</span> <span class="fu">bernoulli</span>(),</span>
<span id="cb224-1225"><a href="#cb224-1225" aria-hidden="true" tabindex="-1"></a>                  <span class="at">prior =</span> prior_mechanism, <span class="at">iter =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">2</span>, <span class="at">seed =</span> <span class="dv">123</span>)</span>
<span id="cb224-1226"><a href="#cb224-1226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1227"><a href="#cb224-1227" aria-hidden="true" tabindex="-1"></a>bayes_intlprof <span class="ot">&lt;-</span> <span class="fu">brm</span>(formula_intlprof, <span class="at">data =</span> train_data_adver, <span class="at">family =</span> <span class="fu">bernoulli</span>(),</span>
<span id="cb224-1228"><a href="#cb224-1228" aria-hidden="true" tabindex="-1"></a>                  <span class="at">prior =</span> prior_mechanism, <span class="at">iter =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">2</span>, <span class="at">seed =</span> <span class="dv">123</span>)</span>
<span id="cb224-1229"><a href="#cb224-1229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1230"><a href="#cb224-1230" aria-hidden="true" tabindex="-1"></a>bayes_match <span class="ot">&lt;-</span> <span class="fu">brm</span>(formula_match, <span class="at">data =</span> train_data_adver, <span class="at">family =</span> <span class="fu">bernoulli</span>(),</span>
<span id="cb224-1231"><a href="#cb224-1231" aria-hidden="true" tabindex="-1"></a>                  <span class="at">prior =</span> prior_mechanism, <span class="at">iter =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">2</span>, <span class="at">seed =</span> <span class="dv">123</span>)</span>
<span id="cb224-1232"><a href="#cb224-1232" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1233"><a href="#cb224-1233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1236"><a href="#cb224-1236" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1237"><a href="#cb224-1237" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: adver_discriminant results</span></span>
<span id="cb224-1238"><a href="#cb224-1238" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false </span></span>
<span id="cb224-1239"><a href="#cb224-1239" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true </span></span>
<span id="cb224-1240"><a href="#cb224-1240" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb224-1241"><a href="#cb224-1241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1242"><a href="#cb224-1242" aria-hidden="true" tabindex="-1"></a><span class="co"># ----- loo comparsion -----</span></span>
<span id="cb224-1243"><a href="#cb224-1243" aria-hidden="true" tabindex="-1"></a>loo_base <span class="ot">&lt;-</span> <span class="fu">loo</span>(bayes_base)</span>
<span id="cb224-1244"><a href="#cb224-1244" aria-hidden="true" tabindex="-1"></a>loo_intl <span class="ot">&lt;-</span> <span class="fu">loo</span>(bayes_intl)</span>
<span id="cb224-1245"><a href="#cb224-1245" aria-hidden="true" tabindex="-1"></a>loo_intldom  <span class="ot">&lt;-</span> <span class="fu">loo</span>(bayes_intldom)</span>
<span id="cb224-1246"><a href="#cb224-1246" aria-hidden="true" tabindex="-1"></a>loo_domprof <span class="ot">&lt;-</span> <span class="fu">loo</span>(bayes_domprof)</span>
<span id="cb224-1247"><a href="#cb224-1247" aria-hidden="true" tabindex="-1"></a>loo_intlprof <span class="ot">&lt;-</span> <span class="fu">loo</span>(bayes_intlprof)</span>
<span id="cb224-1248"><a href="#cb224-1248" aria-hidden="true" tabindex="-1"></a>loo_match <span class="ot">&lt;-</span> <span class="fu">loo</span>(bayes_match)</span>
<span id="cb224-1249"><a href="#cb224-1249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1250"><a href="#cb224-1250" aria-hidden="true" tabindex="-1"></a>loo_intl<span class="sc">$</span>estimates[<span class="st">"elpd_loo"</span>, <span class="st">"Estimate"</span>]</span>
<span id="cb224-1251"><a href="#cb224-1251" aria-hidden="true" tabindex="-1"></a>loo_intldom<span class="sc">$</span>estimates[<span class="st">"elpd_loo"</span>, <span class="st">"Estimate"</span>]</span>
<span id="cb224-1252"><a href="#cb224-1252" aria-hidden="true" tabindex="-1"></a>loo_domprof<span class="sc">$</span>estimates[<span class="st">"elpd_loo"</span>, <span class="st">"Estimate"</span>]</span>
<span id="cb224-1253"><a href="#cb224-1253" aria-hidden="true" tabindex="-1"></a>loo_intlprof<span class="sc">$</span>estimates[<span class="st">"elpd_loo"</span>, <span class="st">"Estimate"</span>]</span>
<span id="cb224-1254"><a href="#cb224-1254" aria-hidden="true" tabindex="-1"></a>loo_match<span class="sc">$</span>estimates[<span class="st">"elpd_loo"</span>, <span class="st">"Estimate"</span>]</span>
<span id="cb224-1255"><a href="#cb224-1255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1256"><a href="#cb224-1256" aria-hidden="true" tabindex="-1"></a><span class="co"># tables compares loo</span></span>
<span id="cb224-1257"><a href="#cb224-1257" aria-hidden="true" tabindex="-1"></a>loo_compare_mechanism <span class="ot">&lt;-</span> <span class="fu">loo_compare</span>(loo_base, loo_intl, loo_intldom, loo_domprof, loo_intlprof, loo_match)</span>
<span id="cb224-1258"><a href="#cb224-1258" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(loo_compare_mechanism)</span>
<span id="cb224-1259"><a href="#cb224-1259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1260"><a href="#cb224-1260" aria-hidden="true" tabindex="-1"></a><span class="co"># visualization loo comparison</span></span>
<span id="cb224-1261"><a href="#cb224-1261" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(loo_compare_mechanism, <span class="at">label_points =</span> <span class="cn">TRUE</span>, <span class="at">main =</span> <span class="st">"Bayesian Mechanism Models: LOOIC Comparison"</span>)</span>
<span id="cb224-1262"><a href="#cb224-1262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1263"><a href="#cb224-1263" aria-hidden="true" tabindex="-1"></a><span class="co"># ----- bayes r2 -----</span></span>
<span id="cb224-1264"><a href="#cb224-1264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1265"><a href="#cb224-1265" aria-hidden="true" tabindex="-1"></a>r2_mechanism_models_bayes <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb224-1266"><a href="#cb224-1266" aria-hidden="true" tabindex="-1"></a>  <span class="at">Model =</span> <span class="fu">c</span>(<span class="st">"BASE"</span>, <span class="st">"INTL"</span>, <span class="st">"INTLDOM"</span>, <span class="st">"DOMPROF"</span>, <span class="st">"INTLPROF"</span>, <span class="st">"ALL"</span>),</span>
<span id="cb224-1267"><a href="#cb224-1267" aria-hidden="true" tabindex="-1"></a>  <span class="at">Pseudo_R2 =</span> <span class="fu">c</span>(<span class="fu">bayes_r2_brms</span>(bayes_base),</span>
<span id="cb224-1268"><a href="#cb224-1268" aria-hidden="true" tabindex="-1"></a>                <span class="fu">bayes_r2_brms</span>(bayes_intl),</span>
<span id="cb224-1269"><a href="#cb224-1269" aria-hidden="true" tabindex="-1"></a>                <span class="fu">bayes_r2_brms</span>(bayes_intldom),</span>
<span id="cb224-1270"><a href="#cb224-1270" aria-hidden="true" tabindex="-1"></a>                <span class="fu">bayes_r2_brms</span>(bayes_domprof),</span>
<span id="cb224-1271"><a href="#cb224-1271" aria-hidden="true" tabindex="-1"></a>                <span class="fu">bayes_r2_brms</span>(bayes_intlprof),</span>
<span id="cb224-1272"><a href="#cb224-1272" aria-hidden="true" tabindex="-1"></a>                <span class="fu">bayes_r2_brms</span>(bayes_match))</span>
<span id="cb224-1273"><a href="#cb224-1273" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb224-1274"><a href="#cb224-1274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1275"><a href="#cb224-1275" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. tables outprint</span></span>
<span id="cb224-1276"><a href="#cb224-1276" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(r2_mechanism_models_bayes, <span class="at">caption =</span> <span class="st">"Bayesian Pseudo R² Comparison (Mechanism Models)"</span>)</span>
<span id="cb224-1277"><a href="#cb224-1277" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1278"><a href="#cb224-1278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1279"><a href="#cb224-1279" aria-hidden="true" tabindex="-1"></a><span class="fu">### variables importance comparison</span></span>
<span id="cb224-1280"><a href="#cb224-1280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1283"><a href="#cb224-1283" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1284"><a href="#cb224-1284" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: adver_discriminant variables importance comparison </span></span>
<span id="cb224-1285"><a href="#cb224-1285" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false </span></span>
<span id="cb224-1286"><a href="#cb224-1286" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true </span></span>
<span id="cb224-1287"><a href="#cb224-1287" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb224-1288"><a href="#cb224-1288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1289"><a href="#cb224-1289" aria-hidden="true" tabindex="-1"></a>base_result     <span class="ot">&lt;-</span> <span class="fu">bayes_value_importance_v2</span>(bayes_base, <span class="at">model_name =</span> <span class="st">"BASE"</span>)</span>
<span id="cb224-1290"><a href="#cb224-1290" aria-hidden="true" tabindex="-1"></a>intl_result     <span class="ot">&lt;-</span> <span class="fu">bayes_value_importance_v2</span>(bayes_intl, <span class="at">model_name =</span> <span class="st">"INTL"</span>)</span>
<span id="cb224-1291"><a href="#cb224-1291" aria-hidden="true" tabindex="-1"></a>intldom_result  <span class="ot">&lt;-</span> <span class="fu">bayes_value_importance_v2</span>(bayes_intldom, <span class="at">model_name =</span> <span class="st">"INTLDOM"</span>)</span>
<span id="cb224-1292"><a href="#cb224-1292" aria-hidden="true" tabindex="-1"></a>domprof_result  <span class="ot">&lt;-</span> <span class="fu">bayes_value_importance_v2</span>(bayes_domprof, <span class="at">model_name =</span> <span class="st">"DOMPROF"</span>)</span>
<span id="cb224-1293"><a href="#cb224-1293" aria-hidden="true" tabindex="-1"></a>intlprof_result <span class="ot">&lt;-</span> <span class="fu">bayes_value_importance_v2</span>(bayes_intlprof, <span class="at">model_name =</span> <span class="st">"INTLPROF"</span>)</span>
<span id="cb224-1294"><a href="#cb224-1294" aria-hidden="true" tabindex="-1"></a>match_result    <span class="ot">&lt;-</span> <span class="fu">bayes_value_importance_v2</span>(bayes_match, <span class="at">model_name =</span> <span class="st">"MATCH"</span>)</span>
<span id="cb224-1295"><a href="#cb224-1295" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1296"><a href="#cb224-1296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1297"><a href="#cb224-1297" aria-hidden="true" tabindex="-1"></a><span class="fu">### comparions with shap values</span></span>
<span id="cb224-1298"><a href="#cb224-1298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1301"><a href="#cb224-1301" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1302"><a href="#cb224-1302" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: adver_discriminant with shap values adver</span></span>
<span id="cb224-1303"><a href="#cb224-1303" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false </span></span>
<span id="cb224-1304"><a href="#cb224-1304" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true </span></span>
<span id="cb224-1305"><a href="#cb224-1305" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb224-1306"><a href="#cb224-1306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1307"><a href="#cb224-1307" aria-hidden="true" tabindex="-1"></a>model_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb224-1308"><a href="#cb224-1308" aria-hidden="true" tabindex="-1"></a>  <span class="at">INTL      =</span> bayes_intl,</span>
<span id="cb224-1309"><a href="#cb224-1309" aria-hidden="true" tabindex="-1"></a>  <span class="at">INTLDOM   =</span> bayes_intldom,</span>
<span id="cb224-1310"><a href="#cb224-1310" aria-hidden="true" tabindex="-1"></a>  <span class="at">DOMPROF   =</span> bayes_domprof,</span>
<span id="cb224-1311"><a href="#cb224-1311" aria-hidden="true" tabindex="-1"></a>  <span class="at">INTLPROF  =</span> bayes_intlprof,</span>
<span id="cb224-1312"><a href="#cb224-1312" aria-hidden="true" tabindex="-1"></a>  <span class="at">MATCH     =</span> bayes_match</span>
<span id="cb224-1313"><a href="#cb224-1313" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb224-1314"><a href="#cb224-1314" aria-hidden="true" tabindex="-1"></a>results_adver <span class="ot">&lt;-</span> <span class="fu">run_bayes_shap_all_models</span>(model_list, adver_all, match_vars, <span class="at">suffix =</span> <span class="st">""</span>)</span>
<span id="cb224-1315"><a href="#cb224-1315" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(results_adver)</span>
<span id="cb224-1316"><a href="#cb224-1316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1317"><a href="#cb224-1317" aria-hidden="true" tabindex="-1"></a>summary_adver_shap <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">imap_dfr</span>(results_adver, <span class="sc">~</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb224-1318"><a href="#cb224-1318" aria-hidden="true" tabindex="-1"></a>  <span class="at">Model =</span> .y,</span>
<span id="cb224-1319"><a href="#cb224-1319" aria-hidden="true" tabindex="-1"></a>  <span class="at">Direction_Match_Rate =</span> .x<span class="sc">$</span>summary<span class="sc">$</span>Direction_Match_Rate,</span>
<span id="cb224-1320"><a href="#cb224-1320" aria-hidden="true" tabindex="-1"></a>  <span class="at">Pearson_Correlation   =</span> .x<span class="sc">$</span>summary<span class="sc">$</span>Pearson_Correlation,</span>
<span id="cb224-1321"><a href="#cb224-1321" aria-hidden="true" tabindex="-1"></a>  <span class="at">Abs_Correlation       =</span> .x<span class="sc">$</span>summary<span class="sc">$</span>Abs_Value_Correlation</span>
<span id="cb224-1322"><a href="#cb224-1322" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb224-1323"><a href="#cb224-1323" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(summary_adver_shap)</span>
<span id="cb224-1324"><a href="#cb224-1324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1325"><a href="#cb224-1325" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1326"><a href="#cb224-1326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1329"><a href="#cb224-1329" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1330"><a href="#cb224-1330" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: adver_discriminant with shap values adver debug</span></span>
<span id="cb224-1331"><a href="#cb224-1331" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false </span></span>
<span id="cb224-1332"><a href="#cb224-1332" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true </span></span>
<span id="cb224-1333"><a href="#cb224-1333" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb224-1334"><a href="#cb224-1334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1335"><a href="#cb224-1335" aria-hidden="true" tabindex="-1"></a><span class="co"># diagnose_models &lt;- function(model_list, match_vars, suffix = "_raw") {</span></span>
<span id="cb224-1336"><a href="#cb224-1336" aria-hidden="true" tabindex="-1"></a><span class="co">#  out &lt;- list()</span></span>
<span id="cb224-1337"><a href="#cb224-1337" aria-hidden="true" tabindex="-1"></a><span class="co">#  for (nm in names(model_list)) {</span></span>
<span id="cb224-1338"><a href="#cb224-1338" aria-hidden="true" tabindex="-1"></a><span class="co">#    mod &lt;- model_list[[nm]]</span></span>
<span id="cb224-1339"><a href="#cb224-1339" aria-hidden="true" tabindex="-1"></a><span class="co">#    cat("\n---- MODEL:", nm, "----\n")</span></span>
<span id="cb224-1340"><a href="#cb224-1340" aria-hidden="true" tabindex="-1"></a><span class="co">#    coef_b &lt;- tryCatch(names(fixef(mod)[, "Estimate"]), error = function(e) NULL)</span></span>
<span id="cb224-1341"><a href="#cb224-1341" aria-hidden="true" tabindex="-1"></a><span class="co">#    print(head(coef_b, 30))</span></span>
<span id="cb224-1342"><a href="#cb224-1342" aria-hidden="true" tabindex="-1"></a><span class="co">#    if (is.null(coef_b)) {</span></span>
<span id="cb224-1343"><a href="#cb224-1343" aria-hidden="true" tabindex="-1"></a><span class="co">#      cat("  &gt;&gt; cannot extract fixef() names (model type mismatch?)\n")</span></span>
<span id="cb224-1344"><a href="#cb224-1344" aria-hidden="true" tabindex="-1"></a><span class="co">#      out[[nm]] &lt;- list(coef_names = NA_character_, matched = character(0))</span></span>
<span id="cb224-1345"><a href="#cb224-1345" aria-hidden="true" tabindex="-1"></a><span class="co">#      next</span></span>
<span id="cb224-1346"><a href="#cb224-1346" aria-hidden="true" tabindex="-1"></a><span class="co">#    }</span></span>
<span id="cb224-1347"><a href="#cb224-1347" aria-hidden="true" tabindex="-1"></a><span class="co">#    # exact intersections</span></span>
<span id="cb224-1348"><a href="#cb224-1348" aria-hidden="true" tabindex="-1"></a><span class="co">#    inter1 &lt;- intersect(coef_b, match_vars)</span></span>
<span id="cb224-1349"><a href="#cb224-1349" aria-hidden="true" tabindex="-1"></a><span class="co">#    inter2 &lt;- intersect(coef_b, paste0(match_vars, suffix))</span></span>
<span id="cb224-1350"><a href="#cb224-1350" aria-hidden="true" tabindex="-1"></a><span class="co">#    # fuzzy: coef names that start with any match_var or match_var+suffix</span></span>
<span id="cb224-1351"><a href="#cb224-1351" aria-hidden="true" tabindex="-1"></a><span class="co">#    fuzzy_matches &lt;- coef_b[sapply(coef_b, function(x) any(vapply(match_vars, function(mv) #grepl(paste0("^", mv), x), logical(1))))]</span></span>
<span id="cb224-1352"><a href="#cb224-1352" aria-hidden="true" tabindex="-1"></a><span class="co">#    fuzzy_with_suffix &lt;- coef_b[sapply(coef_b, function(x) any(vapply(paste0(match_vars, #suffix), function(mv) grepl(paste0("^", mv), x), logical(1))))]</span></span>
<span id="cb224-1353"><a href="#cb224-1353" aria-hidden="true" tabindex="-1"></a><span class="co">#    cat("  exact intersect with match_vars:", toString(inter1), "\n")</span></span>
<span id="cb224-1354"><a href="#cb224-1354" aria-hidden="true" tabindex="-1"></a><span class="co">#    cat("  exact intersect with match_vars+suffix:", toString(inter2), "\n")</span></span>
<span id="cb224-1355"><a href="#cb224-1355" aria-hidden="true" tabindex="-1"></a><span class="co">#    cat("  fuzzy matches (startsWith match_vars):", toString(unique(fuzzy_matches)), "\n")</span></span>
<span id="cb224-1356"><a href="#cb224-1356" aria-hidden="true" tabindex="-1"></a><span class="co">#    cat("  fuzzy matches (startsWith match_vars+suffix):", toString(unique(fuzzy_with_suffix)), "\n")</span></span>
<span id="cb224-1357"><a href="#cb224-1357" aria-hidden="true" tabindex="-1"></a><span class="co">#    out[[nm]] &lt;- list(coef_names = coef_b, exact = c(inter1, inter2), fuzzy = unique(c(fuzzy_matches, fuzzy_with_suffix)))</span></span>
<span id="cb224-1358"><a href="#cb224-1358" aria-hidden="true" tabindex="-1"></a><span class="co">#  }</span></span>
<span id="cb224-1359"><a href="#cb224-1359" aria-hidden="true" tabindex="-1"></a><span class="co">#  return(out)</span></span>
<span id="cb224-1360"><a href="#cb224-1360" aria-hidden="true" tabindex="-1"></a><span class="co">#}</span></span>
<span id="cb224-1361"><a href="#cb224-1361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1362"><a href="#cb224-1362" aria-hidden="true" tabindex="-1"></a><span class="co">#diag_res &lt;- diagnose_models(model_list, match_vars, suffix = "")</span></span>
<span id="cb224-1363"><a href="#cb224-1363" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1364"><a href="#cb224-1364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1365"><a href="#cb224-1365" aria-hidden="true" tabindex="-1"></a><span class="fu">## Legis</span></span>
<span id="cb224-1366"><a href="#cb224-1366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1367"><a href="#cb224-1367" aria-hidden="true" tabindex="-1"></a><span class="fu">### model training</span></span>
<span id="cb224-1368"><a href="#cb224-1368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1371"><a href="#cb224-1371" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1372"><a href="#cb224-1372" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: legis_discriminant model training</span></span>
<span id="cb224-1373"><a href="#cb224-1373" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false </span></span>
<span id="cb224-1374"><a href="#cb224-1374" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true </span></span>
<span id="cb224-1375"><a href="#cb224-1375" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb224-1376"><a href="#cb224-1376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1377"><a href="#cb224-1377" aria-hidden="true" tabindex="-1"></a>bayes_base_legis <span class="ot">&lt;-</span> <span class="fu">brm</span>(formula_base, <span class="at">data =</span> train_data_legis, <span class="at">family =</span> <span class="fu">bernoulli</span>(),</span>
<span id="cb224-1378"><a href="#cb224-1378" aria-hidden="true" tabindex="-1"></a>                        <span class="at">prior =</span> prior_base, <span class="at">iter =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">2</span>, <span class="at">seed =</span> <span class="dv">123</span>)</span>
<span id="cb224-1379"><a href="#cb224-1379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1380"><a href="#cb224-1380" aria-hidden="true" tabindex="-1"></a>bayes_intl_legis <span class="ot">&lt;-</span> <span class="fu">brm</span>(formula_intl, <span class="at">data =</span> train_data_legis, <span class="at">family =</span> <span class="fu">bernoulli</span>(),</span>
<span id="cb224-1381"><a href="#cb224-1381" aria-hidden="true" tabindex="-1"></a>                        <span class="at">prior =</span> prior_mechanism, <span class="at">iter =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">2</span>, <span class="at">seed =</span> <span class="dv">123</span>)</span>
<span id="cb224-1382"><a href="#cb224-1382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1383"><a href="#cb224-1383" aria-hidden="true" tabindex="-1"></a>bayes_intldom_legis <span class="ot">&lt;-</span> <span class="fu">brm</span>(formula_intldom, <span class="at">data =</span> train_data_legis, <span class="at">family =</span> <span class="fu">bernoulli</span>(),</span>
<span id="cb224-1384"><a href="#cb224-1384" aria-hidden="true" tabindex="-1"></a>                           <span class="at">prior =</span> prior_mechanism, <span class="at">iter =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">2</span>, <span class="at">seed =</span> <span class="dv">123</span>)</span>
<span id="cb224-1385"><a href="#cb224-1385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1386"><a href="#cb224-1386" aria-hidden="true" tabindex="-1"></a>bayes_domprof_legis <span class="ot">&lt;-</span> <span class="fu">brm</span>(formula_domprof, <span class="at">data =</span> train_data_legis, <span class="at">family =</span> <span class="fu">bernoulli</span>(),</span>
<span id="cb224-1387"><a href="#cb224-1387" aria-hidden="true" tabindex="-1"></a>                           <span class="at">prior =</span> prior_mechanism, <span class="at">iter =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">2</span>, <span class="at">seed =</span> <span class="dv">123</span>)</span>
<span id="cb224-1388"><a href="#cb224-1388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1389"><a href="#cb224-1389" aria-hidden="true" tabindex="-1"></a>bayes_intlprof_legis <span class="ot">&lt;-</span> <span class="fu">brm</span>(formula_intlprof, <span class="at">data =</span> train_data_legis, <span class="at">family =</span> <span class="fu">bernoulli</span>(),</span>
<span id="cb224-1390"><a href="#cb224-1390" aria-hidden="true" tabindex="-1"></a>                            <span class="at">prior =</span> prior_mechanism, <span class="at">iter =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">2</span>, <span class="at">seed =</span> <span class="dv">123</span>)</span>
<span id="cb224-1391"><a href="#cb224-1391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1392"><a href="#cb224-1392" aria-hidden="true" tabindex="-1"></a>bayes_match_legis <span class="ot">&lt;-</span> <span class="fu">brm</span>(formula_match, <span class="at">data =</span> train_data_legis, <span class="at">family =</span> <span class="fu">bernoulli</span>(),</span>
<span id="cb224-1393"><a href="#cb224-1393" aria-hidden="true" tabindex="-1"></a>                         <span class="at">prior =</span> prior_mechanism, <span class="at">iter =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">2</span>, <span class="at">seed =</span> <span class="dv">123</span>)</span>
<span id="cb224-1394"><a href="#cb224-1394" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1395"><a href="#cb224-1395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1398"><a href="#cb224-1398" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1399"><a href="#cb224-1399" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: legis_discriminant model results</span></span>
<span id="cb224-1400"><a href="#cb224-1400" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false </span></span>
<span id="cb224-1401"><a href="#cb224-1401" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true </span></span>
<span id="cb224-1402"><a href="#cb224-1402" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb224-1403"><a href="#cb224-1403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1404"><a href="#cb224-1404" aria-hidden="true" tabindex="-1"></a><span class="co"># ----- LOO-CV -----</span></span>
<span id="cb224-1405"><a href="#cb224-1405" aria-hidden="true" tabindex="-1"></a>loo_legis_base     <span class="ot">&lt;-</span> <span class="fu">loo</span>(bayes_base_legis)</span>
<span id="cb224-1406"><a href="#cb224-1406" aria-hidden="true" tabindex="-1"></a>loo_legis_intl     <span class="ot">&lt;-</span> <span class="fu">loo</span>(bayes_intl_legis)</span>
<span id="cb224-1407"><a href="#cb224-1407" aria-hidden="true" tabindex="-1"></a>loo_legis_intldom  <span class="ot">&lt;-</span> <span class="fu">loo</span>(bayes_intldom_legis)</span>
<span id="cb224-1408"><a href="#cb224-1408" aria-hidden="true" tabindex="-1"></a>loo_legis_domprof  <span class="ot">&lt;-</span> <span class="fu">loo</span>(bayes_domprof_legis)</span>
<span id="cb224-1409"><a href="#cb224-1409" aria-hidden="true" tabindex="-1"></a>loo_legis_intlprof <span class="ot">&lt;-</span> <span class="fu">loo</span>(bayes_intlprof_legis)</span>
<span id="cb224-1410"><a href="#cb224-1410" aria-hidden="true" tabindex="-1"></a>loo_legis_match    <span class="ot">&lt;-</span> <span class="fu">loo</span>(bayes_match_legis)</span>
<span id="cb224-1411"><a href="#cb224-1411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1412"><a href="#cb224-1412" aria-hidden="true" tabindex="-1"></a><span class="co"># elpd_loo</span></span>
<span id="cb224-1413"><a href="#cb224-1413" aria-hidden="true" tabindex="-1"></a>loo_legis_intl<span class="sc">$</span>estimates[<span class="st">"elpd_loo"</span>, <span class="st">"Estimate"</span>]</span>
<span id="cb224-1414"><a href="#cb224-1414" aria-hidden="true" tabindex="-1"></a>loo_legis_intldom<span class="sc">$</span>estimates[<span class="st">"elpd_loo"</span>, <span class="st">"Estimate"</span>]</span>
<span id="cb224-1415"><a href="#cb224-1415" aria-hidden="true" tabindex="-1"></a>loo_legis_domprof<span class="sc">$</span>estimates[<span class="st">"elpd_loo"</span>, <span class="st">"Estimate"</span>]</span>
<span id="cb224-1416"><a href="#cb224-1416" aria-hidden="true" tabindex="-1"></a>loo_legis_intlprof<span class="sc">$</span>estimates[<span class="st">"elpd_loo"</span>, <span class="st">"Estimate"</span>]</span>
<span id="cb224-1417"><a href="#cb224-1417" aria-hidden="true" tabindex="-1"></a>loo_legis_match<span class="sc">$</span>estimates[<span class="st">"elpd_loo"</span>, <span class="st">"Estimate"</span>]</span>
<span id="cb224-1418"><a href="#cb224-1418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1419"><a href="#cb224-1419" aria-hidden="true" tabindex="-1"></a><span class="co"># comparison</span></span>
<span id="cb224-1420"><a href="#cb224-1420" aria-hidden="true" tabindex="-1"></a>loo_compare_legis <span class="ot">&lt;-</span> <span class="fu">loo_compare</span>(</span>
<span id="cb224-1421"><a href="#cb224-1421" aria-hidden="true" tabindex="-1"></a>  loo_legis_base, loo_legis_intl, loo_legis_intldom,</span>
<span id="cb224-1422"><a href="#cb224-1422" aria-hidden="true" tabindex="-1"></a>  loo_legis_domprof, loo_legis_intlprof, loo_legis_match</span>
<span id="cb224-1423"><a href="#cb224-1423" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb224-1424"><a href="#cb224-1424" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(loo_compare_legis)</span>
<span id="cb224-1425"><a href="#cb224-1425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1426"><a href="#cb224-1426" aria-hidden="true" tabindex="-1"></a><span class="co"># visualization</span></span>
<span id="cb224-1427"><a href="#cb224-1427" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(loo_compare_legis, <span class="at">label_points =</span> <span class="cn">TRUE</span>, <span class="at">main =</span> <span class="st">"Bayesian Legis Models: LOOIC Comparison"</span>)</span>
<span id="cb224-1428"><a href="#cb224-1428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1429"><a href="#cb224-1429" aria-hidden="true" tabindex="-1"></a><span class="co"># ----- Bayesian R² -----</span></span>
<span id="cb224-1430"><a href="#cb224-1430" aria-hidden="true" tabindex="-1"></a>r2_mechanism_models_legis <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb224-1431"><a href="#cb224-1431" aria-hidden="true" tabindex="-1"></a>  <span class="at">Model =</span> <span class="fu">c</span>(<span class="st">"BASE-legis"</span>, <span class="st">"INTL-legis"</span>, <span class="st">"INTLDOM-legis"</span>, <span class="st">"DOMPROF-legis"</span>, <span class="st">"INTLPROF-legis"</span>, <span class="st">"MATCH-legis"</span>),</span>
<span id="cb224-1432"><a href="#cb224-1432" aria-hidden="true" tabindex="-1"></a>  <span class="at">Pseudo_R2 =</span> <span class="fu">c</span>(<span class="fu">bayes_r2_brms</span>(bayes_base_legis),</span>
<span id="cb224-1433"><a href="#cb224-1433" aria-hidden="true" tabindex="-1"></a>                <span class="fu">bayes_r2_brms</span>(bayes_intl_legis),</span>
<span id="cb224-1434"><a href="#cb224-1434" aria-hidden="true" tabindex="-1"></a>                <span class="fu">bayes_r2_brms</span>(bayes_intldom_legis),</span>
<span id="cb224-1435"><a href="#cb224-1435" aria-hidden="true" tabindex="-1"></a>                <span class="fu">bayes_r2_brms</span>(bayes_domprof_legis),</span>
<span id="cb224-1436"><a href="#cb224-1436" aria-hidden="true" tabindex="-1"></a>                <span class="fu">bayes_r2_brms</span>(bayes_intlprof_legis),</span>
<span id="cb224-1437"><a href="#cb224-1437" aria-hidden="true" tabindex="-1"></a>                <span class="fu">bayes_r2_brms</span>(bayes_match_legis))</span>
<span id="cb224-1438"><a href="#cb224-1438" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb224-1439"><a href="#cb224-1439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1440"><a href="#cb224-1440" aria-hidden="true" tabindex="-1"></a><span class="co"># tables outprint</span></span>
<span id="cb224-1441"><a href="#cb224-1441" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(r2_mechanism_models_legis, <span class="at">caption =</span> <span class="st">"Bayesian Pseudo R² Comparison (Mechanism Models)"</span>)</span>
<span id="cb224-1442"><a href="#cb224-1442" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1443"><a href="#cb224-1443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1444"><a href="#cb224-1444" aria-hidden="true" tabindex="-1"></a><span class="fu">### variables importance comparison</span></span>
<span id="cb224-1445"><a href="#cb224-1445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1448"><a href="#cb224-1448" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1449"><a href="#cb224-1449" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: legis_discriminant variables importance comparison</span></span>
<span id="cb224-1450"><a href="#cb224-1450" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false </span></span>
<span id="cb224-1451"><a href="#cb224-1451" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true </span></span>
<span id="cb224-1452"><a href="#cb224-1452" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb224-1453"><a href="#cb224-1453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1454"><a href="#cb224-1454" aria-hidden="true" tabindex="-1"></a>base_result     <span class="ot">&lt;-</span> <span class="fu">bayes_value_importance_v2</span>(bayes_base_legis, <span class="at">model_name =</span> <span class="st">"BASE-legis"</span>)</span>
<span id="cb224-1455"><a href="#cb224-1455" aria-hidden="true" tabindex="-1"></a>intl_result     <span class="ot">&lt;-</span> <span class="fu">bayes_value_importance_v2</span>(bayes_intl_legis, <span class="at">model_name =</span> <span class="st">"INTL-legis"</span>)</span>
<span id="cb224-1456"><a href="#cb224-1456" aria-hidden="true" tabindex="-1"></a>intldom_result  <span class="ot">&lt;-</span> <span class="fu">bayes_value_importance_v2</span>(bayes_intldom_legis, <span class="at">model_name =</span> <span class="st">"INTLDOM-legis"</span>)</span>
<span id="cb224-1457"><a href="#cb224-1457" aria-hidden="true" tabindex="-1"></a>domprof_result  <span class="ot">&lt;-</span> <span class="fu">bayes_value_importance_v2</span>(bayes_domprof_legis, <span class="at">model_name =</span> <span class="st">"DOMPROF-legis"</span>)</span>
<span id="cb224-1458"><a href="#cb224-1458" aria-hidden="true" tabindex="-1"></a>intlprof_result <span class="ot">&lt;-</span> <span class="fu">bayes_value_importance_v2</span>(bayes_intlprof_legis, <span class="at">model_name =</span> <span class="st">"INTLPROF-legis"</span>)</span>
<span id="cb224-1459"><a href="#cb224-1459" aria-hidden="true" tabindex="-1"></a>match_result    <span class="ot">&lt;-</span> <span class="fu">bayes_value_importance_v2</span>(bayes_match_legis, <span class="at">model_name =</span> <span class="st">"MATCH-legis"</span>)</span>
<span id="cb224-1460"><a href="#cb224-1460" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1461"><a href="#cb224-1461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1462"><a href="#cb224-1462" aria-hidden="true" tabindex="-1"></a><span class="fu">### comparions with shap values</span></span>
<span id="cb224-1463"><a href="#cb224-1463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1466"><a href="#cb224-1466" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1467"><a href="#cb224-1467" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: legis_discriminant comparions with shap values</span></span>
<span id="cb224-1468"><a href="#cb224-1468" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false </span></span>
<span id="cb224-1469"><a href="#cb224-1469" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true </span></span>
<span id="cb224-1470"><a href="#cb224-1470" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb224-1471"><a href="#cb224-1471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1472"><a href="#cb224-1472" aria-hidden="true" tabindex="-1"></a>legis_model_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb224-1473"><a href="#cb224-1473" aria-hidden="true" tabindex="-1"></a>  <span class="at">INTL      =</span> bayes_intl_legis,</span>
<span id="cb224-1474"><a href="#cb224-1474" aria-hidden="true" tabindex="-1"></a>  <span class="at">INTLDOM   =</span> bayes_intldom_legis,</span>
<span id="cb224-1475"><a href="#cb224-1475" aria-hidden="true" tabindex="-1"></a>  <span class="at">DOMPROF   =</span> bayes_domprof_legis,</span>
<span id="cb224-1476"><a href="#cb224-1476" aria-hidden="true" tabindex="-1"></a>  <span class="at">INTLPROF  =</span> bayes_intlprof_legis,</span>
<span id="cb224-1477"><a href="#cb224-1477" aria-hidden="true" tabindex="-1"></a>  <span class="at">MATCH     =</span> bayes_match_legis</span>
<span id="cb224-1478"><a href="#cb224-1478" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb224-1479"><a href="#cb224-1479" aria-hidden="true" tabindex="-1"></a>results_legis <span class="ot">&lt;-</span> <span class="fu">run_bayes_shap_all_models</span>(legis_model_list, legis_all, match_vars)</span>
<span id="cb224-1480"><a href="#cb224-1480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1481"><a href="#cb224-1481" aria-hidden="true" tabindex="-1"></a>summary_legis_shap <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">imap_dfr</span>(results_legis, <span class="sc">~</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb224-1482"><a href="#cb224-1482" aria-hidden="true" tabindex="-1"></a>  <span class="at">Model =</span> .y,</span>
<span id="cb224-1483"><a href="#cb224-1483" aria-hidden="true" tabindex="-1"></a>  <span class="at">Direction_Match_Rate =</span> .x<span class="sc">$</span>summary<span class="sc">$</span>Direction_Match_Rate,</span>
<span id="cb224-1484"><a href="#cb224-1484" aria-hidden="true" tabindex="-1"></a>  <span class="at">Pearson_Correlation   =</span> .x<span class="sc">$</span>summary<span class="sc">$</span>Pearson_Correlation,</span>
<span id="cb224-1485"><a href="#cb224-1485" aria-hidden="true" tabindex="-1"></a>  <span class="at">Abs_Correlation       =</span> .x<span class="sc">$</span>summary<span class="sc">$</span>Abs_Value_Correlation</span>
<span id="cb224-1486"><a href="#cb224-1486" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb224-1487"><a href="#cb224-1487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1488"><a href="#cb224-1488" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(summary_legis_shap)</span>
<span id="cb224-1489"><a href="#cb224-1489" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




<script src="robustness_analysis_files/libs/quarto-html/zenscroll-min.js"></script>
</body></html>